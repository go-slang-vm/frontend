(globalThis.webpackChunkfrontend=globalThis.webpackChunkfrontend||[]).push([[52256,24128],{24526:(e,t,a)=>{"use strict";a.d(t,{Z:()=>o});var s=a(75621),n=a(44925),i=a(47313),r=a(46417);const o=e=>((0,i.useEffect)((()=>{var t;null===(t=e.loadContentDispatch)||void 0===t||t.call(e)}),[]),(0,r.jsx)("div",{className:"ContentDisplay row center-xs",children:(0,r.jsx)("div",{className:(e.fullWidth?"col-md-12":"col-md-10 col-xs-11")+" contentdisplay-content-parent",children:(0,r.jsx)(s.Z,{className:"contentdisplay-content",elevation:n.u.THREE,children:e.display})})}))},65786:(e,t,a)=>{"use strict";a.d(t,{g:()=>o});var s=a(70352),n=(a(47313),a(33735)),i=a(46417);const r=({onClick:e})=>(0,i.jsx)(n.Z,{label:"Return to Academy",icon:s.d.ARROW_RIGHT,onClick:e,options:{iconOnRight:!0}}),o=e=>e.questionProgress[0]===e.questionProgress[1]?(0,i.jsx)(r,{onClick:e.onClickReturn},"return_to_academy"):(0,i.jsx)(n.Z,{label:"Next",icon:s.d.ARROW_RIGHT,onClick:e.onClickNext,options:{iconOnRight:!0}})},90257:(e,t,a)=>{"use strict";a.d(t,{f:()=>r});var s=a(70352),n=(a(47313),a(33735)),i=a(46417);const r=e=>e.questionProgress[0]<=1?null:(0,i.jsx)(n.Z,{label:"Previous",icon:s.d.ARROW_LEFT,onClick:e.onClick})},50330:(e,t,a)=>{"use strict";a.d(t,{M:()=>i});a(47313);var s=a(33735),n=a(46417);const i=({questionProgress:e})=>(0,n.jsx)(s.Z,{label:`Question ${e[0]} of ${e[1]}  `,isDisabled:!0})},19265:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(70352),n=(a(47313),a(33735)),i=a(46417);const r=({onClick:e})=>(0,i.jsx)(n.Z,{label:"Reset",icon:s.d.REPEAT,onClick:e})},6127:(e,t,a)=>{"use strict";a.d(t,{t:()=>o});var s=a(56195),n=a(70352),i=(a(47313),a(33735)),r=a(46417);const o=e=>{const t=e.hasUnsavedChanges?{intent:s.S.WARNING,minimal:!1}:{};return(0,r.jsx)(i.Z,{label:"Save",icon:n.d.FLOPPY_DISK,onClick:e.onClickSave,options:t})}},72698:(e,t,a)=>{"use strict";a.d(t,{Z:()=>p});var s=a(75621),n=a(68358),i=a(44925),r=a(53006),o=a(46215),l=a(89057),c=a(72884),d=a.n(c),h=a(47313),u=a(45345),g=a(46417);const p=e=>{const{index:t,testcase:a,handleTestcaseEval:c}=e,p=h.useMemo((()=>{const e=void 0!==a.result||a.errors,t=(0,l.stringify)(a.result)===a.answer;return{correct:e&&t,wrong:e&&!t,secret:a.type===u.Be.secret||a.type===u.Be.opaque}}),[a]),m=h.useCallback((()=>{c(t)}),[t,c]);return(0,g.jsx)("div",{className:d()("AutograderCard",p),"data-testid":"AutograderCard",children:(0,g.jsx)(s.Z,{className:n.INTERACTIVE,elevation:i.u.ONE,onClick:m,children:a.type===u.Be.opaque&&"assessment"===e.workspaceLocation?(0,g.jsx)(r.SU,{className:"testcase-placeholder","data-testid":"testcase-placeholder",children:"Hidden testcase"}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(r.SU,{className:"testcase-program",children:a.program}),(0,g.jsx)(r.SU,{className:"testcase-expected",children:a.answer}),(0,g.jsx)(r.SU,{className:"testcase-actual","data-testid":"testcase-actual",children:a.errors?(0,o.parseError)(a.errors):void 0!==a.result?(0,l.stringify)(a.result):"No Answer"})]})})})}},15765:(e,t,a)=>{"use strict";a.d(t,{Z:()=>d});var s=a(68358),n=a(59568),i=a(72884),r=a.n(i),o=a(47313),l=a(46417);const c=()=>{const e=(0,o.useRef)(null);(0,o.useEffect)((()=>{window.ToneMatrix&&window.ToneMatrix.initialise_matrix(e.current)}),[]);return(0,l.jsxs)("div",{className:"sa-tone-matrix",children:[(0,l.jsx)("div",{className:"row",children:(0,l.jsxs)("div",{className:r()("controls","col-xs-12",s.DARK,s.BUTTON_GROUP),children:[(0,l.jsx)(n.z,{id:"clear-matrix",onClick:()=>{window.ToneMatrix.clear_matrix()},children:"Clear"}),(0,l.jsx)(n.z,{id:"randomise-matrix",onClick:()=>{window.ToneMatrix.randomise_matrix()},children:"Randomise"})]})}),(0,l.jsx)("div",{className:"row",children:(0,l.jsx)("div",{className:"col-xs-12",ref:e})})]})},d=o.memo(c,(()=>!0))},43712:(e,t,a)=>{"use strict";a.d(t,{Dh:()=>r,IU:()=>i,gS:()=>o,lu:()=>l});var s=a(70816),n=a.n(s);const i=e=>{const t=n()(e),a=n()();return t.isBefore(a)},r=e=>n()(e).format("Do MMMM, HH:mm"),o=e=>n()(e).format("MMMM Do YYYY, HH:mm"),l=e=>n()(e).format("MMMM Do YYYY")},23908:(e,t,a)=>{"use strict";a.r(t),a.d(t,{Component:()=>yd,default:()=>bd});var s=a(68358),n=a(75621),i=a(43076),r=a(34137),o=a(72884),l=a.n(o),c=a(47313),d=a(66135),h=a(58467),u=a(31197),g=a(82673),p=a(53006),m=a(59568),x=a(56195),y=a(2624),b=a(18666),f=a(46417);const v=()=>{const e=(0,d.I0)();return(0,f.jsx)("div",{className:"research-prompt",children:(0,f.jsxs)(g.V,{className:s.DARK,title:"Agreement to Participate in Educational Research",canOutsideClickClose:!1,canEscapeKeyClose:!1,isCloseButtonShown:!1,isOpen:!0,children:[(0,f.jsxs)("div",{className:s.DIALOG_BODY,children:[(0,f.jsxs)(p.H4,{children:["Welcome to your new ",b.Z.sourceAcademyDeploymentName," course!"]}),(0,f.jsxs)("div",{children:["Here at ",b.Z.sourceAcademyDeploymentName,", our mission is to bring out the beauty and fun in programming and the ideas behind programming, and to make these ideas universally accessible. This includes educational research!"]}),(0,f.jsx)("br",{}),(0,f.jsxs)("div",{children:["We collect programs that students run in ",b.Z.sourceAcademyDeploymentName," and store them anonymously for our research. You are free to opt out of this collection, with no penalty for you whatsoever. Contact your course instructor if you have questions or concerns about this research."]})]}),(0,f.jsx)("div",{className:s.DIALOG_FOOTER,children:(0,f.jsxs)("div",{className:s.DIALOG_FOOTER_ACTIONS,children:[(0,f.jsx)(m.z,{text:"I would like to opt out",onClick:()=>e((0,y.updateCourseResearchAgreement)(!1))}),(0,f.jsx)(m.z,{text:"I consent!",intent:x.S.SUCCESS,onClick:()=>e((0,y.updateCourseResearchAgreement)(!0))})]})})]})})};var C=a(5793),j=a(5041),S=a(44925),I=a(31474),k=a(80145),w=a(13637),A=a(93800),T=a(62708),M=a(68353),P=a(70352),E=a(6909),N=a(16031),R=a.n(N),D=a(2135),L=a(49286),O=a(5602),_=a(84716),G=a(89057),B=a(45345),U=a(29022);const F=(e,t,a,s)=>()=>{if(!s)return e();if(t.type===B.LD.mcq){if(null===t.answer)return(0,U.N9)("Please select an option!",750);if(void 0===t.solution)return e();if(t.answer!==t.solution)return(0,U.N9)("Your MCQ solution is incorrect!",750)}else if(t.type===B.LD.programming){if(!a.reduce(((e,t)=>e&&(0,G.stringify)(t.result)===t.answer),!0))return(0,U.N9)("Your solution has not passed all testcases!",750)}return e()};var z=a(42501),V=a(92566),H=a(12176),K=a(41904),$=a(13821),X=a(43131),W=a(65786),q=a(90257),Z=a(50330),Y=a(19265),J=a(17e3),Q=a(6127),ee=a(33735),te=a(55526),ae=a(83952),se=a(10074),ne=a(72646);const ie=e=>{const{index:t,result:a}=e;return(0,f.jsx)("div",{className:l()("ResultCard","pass"===a.resultType?"correct":"wrong"),"data-testid":"ResultCard",children:(0,f.jsxs)(n.Z,{elevation:S.u.ONE,children:[(0,f.jsxs)("div",{className:"result-data",children:[(0,f.jsx)("div",{className:"result-idx","data-testid":"result-idx",children:t+1}),(0,f.jsx)("div",{className:"result-status","data-testid":"result-status",children:a.resultType.toUpperCase()})]}),(0,f.jsx)(p.SU,{className:"result-expected","data-testid":"result-expected",children:a.expected}),(0,f.jsx)(p.SU,{className:"result-actual","data-testid":"result-actual",children:"error"===a.resultType?(s=a.errors,s.map((e=>{switch(e.errorType){case"timeout":return"[TIMEOUT] Submission exceeded time limit for this test case.";case"syntax":return`[SYNTAX] Line ${e.line}: ${e.errorExplanation}`;case"runtime":return`[RUNTIME] Line ${e.line}: ${e.errorExplanation}`;case"systemError":return`[SYSTEM] ${e.errorMessage}`;default:return`[UNKNOWN] Autograder error: type ${e.errorType}`}})).join("\n\n")):a.actual})]})});var s};var re=a(72698);const oe=(0,f.jsxs)("div",{className:"autograder-help-tooltip",children:[(0,f.jsx)("p",{children:"Click on each testcase below to execute it with the program in the editor."}),(0,f.jsx)("p",{children:"To execute all testcases at once, evaluate the program in the editor with this tab active."}),(0,f.jsx)("p",{children:"A green or red background indicates a passed or failed testcase respectively."}),(0,f.jsx)("p",{children:"Private testcases (only visible to staff when grading) have a grey background."})]}),le=(e,t)=>(0,f.jsxs)("div",{className:e,children:[t,(0,f.jsx)(k.I,{icon:P.d.CARET_DOWN})]}),ce=(0,f.jsxs)("div",{className:"testcases-header","data-testid":"testcases-header",children:[le("header-fn","Testcase"),le("header-expected","Expected result"),le("header-actual","Actual result")]}),de=(0,f.jsxs)("div",{className:"results-header","data-testid":"results-header",children:[(0,f.jsxs)("div",{className:"header-data",children:[le("header-sn","S/N"),le("header-status","Testcase status")]}),le("header-expected","Expected result"),le("header-actual","Actual result")]}),he=(e,t,a)=>(0,f.jsx)(ee.Z,{label:e,icon:t?P.d.CARET_DOWN:P.d.CARET_RIGHT,onClick:a,options:{className:"collapse-button",minimal:!0}}),ue=e=>{const[t,a]=c.useState(!0),[s,n]=c.useState(!0),{testcases:i,autogradingResults:r,handleTestcaseEval:o,workspaceLocation:l}=e,d=c.useMemo((()=>i.length>0?(0,f.jsxs)("div",{className:"testcaseCards",children:[ce,i.map(((e,t)=>(0,f.jsx)(re.Z,{index:t,testcase:e,handleTestcaseEval:o,workspaceLocation:l},t)))]}):(0,f.jsx)("div",{className:"noResults","data-testid":"noResults",children:"There are no testcases provided for this question."})),[i,o,l]),h=c.useMemo((()=>r.length>0?(0,f.jsxs)("div",{children:[de,r.map(((e,t)=>(0,f.jsx)(ie,{index:t,result:e},t)))]}):(0,f.jsx)("div",{className:"noResults","data-testid":"noResults",children:"There are no results to show."})),[r]),u=c.useCallback((()=>{a(!t)}),[t]),g=c.useCallback((()=>n(!s)),[s]);return(0,f.jsxs)("div",{className:"Autograder",children:[(0,f.jsxs)(m.z,{className:"collapse-button",icon:t?P.d.CARET_DOWN:P.d.CARET_RIGHT,minimal:!0,onClick:u,children:[(0,f.jsx)("span",{children:"Testcases"}),(0,f.jsx)(E.u,{content:oe,placement:ne.I.LEFT,children:(0,f.jsx)(k.I,{icon:P.d.HELP})})]}),(0,f.jsx)(w.U,{isOpen:t,keepChildrenMounted:!0,children:d}),he("Autograder Results",s,g),(0,f.jsx)(w.U,{isOpen:s,keepChildrenMounted:!0,children:h})]})};var ge=a(58651);const pe=e=>{const{handleContestEntryClick:t,contestEntry:a,rank:i}=e;return(0,f.jsx)("div",{className:l()("LeaderboardCard"),children:(0,f.jsxs)(n.Z,{className:s.INTERACTIVE,elevation:S.u.ONE,onClick:()=>{var e;return t(a.submission_id,null!==(e=a.answer.code)&&void 0!==e?e:"")},"data-testid":"SideContentLeaderboardCard",children:[(0,f.jsx)(p.SU,{className:"contestentry-entryid",children:a.student_name}),(0,f.jsx)(p.SU,{className:"contestentry-rank",children:i}),(0,f.jsx)(p.SU,{className:"contestentry-score","data-testid":"contestentry-score",children:a.final_score})]})})},me=e=>{const{orderedContestEntries:t,handleContestEntryClick:a,leaderboardType:s}=e,[n,i]=(0,c.useState)(!0),r=(0,c.useMemo)((()=>s===ge.B_.scoreLeaderboard?"Score Leaderboard":s===ge.B_.popularVoteLeaderboard?"Popular Vote Leaderboard":"Contest Leaderboard"),[s]),o=(0,c.useMemo)((()=>s===ge.B_.scoreLeaderboard?"View the highest scoring contest entries!":s===ge.B_.popularVoteLeaderboard?"View the most popular contest entries!":"View the top-rated contest entries!"),[s]),l=(e,t)=>(0,f.jsxs)("div",{className:e,children:[t,(0,f.jsx)(k.I,{icon:P.d.CARET_DOWN})]}),d=(0,c.useMemo)((()=>(0,f.jsxs)("div",{className:"leaderboard-header",children:[l("header-entryid","Student Name"),l("header-entryrank","Rank"),l("header-score",s===ge.B_.scoreLeaderboard?"Calculated Score":s===ge.B_.popularVoteLeaderboard?"Popularity Score":"Metric")]})),[s]),h=(0,c.useMemo)((()=>(0,f.jsxs)("div",{children:[d,t.length>0?t.map(((e,t)=>(0,f.jsx)(pe,{handleContestEntryClick:a,contestEntry:e,rank:t+1},e.submission_id))):(0,f.jsx)("div",{className:"noResults",children:"There are no eligible contest leaderboard entries found."})]})),[a,t,d]);return(0,f.jsxs)("div",{className:"ContestLeaderboard",children:[(0,f.jsxs)(m.z,{className:"collapse-button",icon:n?P.d.CARET_DOWN:P.d.CARET_RIGHT,minimal:!0,onClick:()=>i(!n),children:[(0,f.jsx)("span",{children:r}),(0,f.jsx)(E.u,{content:o,children:(0,f.jsx)(k.I,{icon:P.d.HELP})})]}),(0,f.jsx)(w.U,{isOpen:n,keepChildrenMounted:!0,children:h})]})},xe=[{name:"S",color:"rgb(255, 127, 127)",score:10},{name:"A",color:"rgb(255, 223, 127)",score:7},{name:"B",color:"rgb(255, 255, 127)",score:4},{name:"C",color:"rgb(191, 255, 127)",score:2},{name:"D",color:"rgb(127, 191, 255)",score:1}],ye=e=>{const{contestEntries:t,canSave:a,isValid:i,handleContestEntryClick:r,handleVotingSubmissionChange:o}=e,[d,h]=(0,c.useState)(!0),[u,g]=(0,c.useState)(null),[x,y]=(0,c.useState)(null),b=(0,c.useMemo)((()=>[...t].sort(((e,t)=>e.submission_id-t.submission_id))),[t]),v=e=>{g(e.currentTarget),e.dataTransfer.effectAllowed="move"},C=(0,c.useCallback)((e=>t=>{const a=t.currentTarget.closest(".tier");if(a){const t=a.id.split("-")[1],s=xe.find((e=>e.name.toLowerCase()===t));o(e.submission_id,(null===s||void 0===s?void 0:s.score)||0)}y(null)}),[o]),j=(0,c.useCallback)((e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),I=(0,c.useCallback)((e=>{setTimeout((()=>{const t=e.target.closest(".tier");t&&y(t.id)}),0)}),[]),A=(0,c.useCallback)((e=>{const t=e.target.closest(".tier");t&&t.id===x&&y(null)}),[x]),T=(0,c.useCallback)((e=>{e.preventDefault();const t=e.target.closest(".item-container");t&&t.appendChild(u)}),[u]),M=(0,c.useRef)({}),N=(0,c.useRef)({}),R=(0,c.useMemo)((()=>xe.map(((e,t)=>(0,f.jsxs)("div",{className:l()("tier",{"hovered-tier":x===`tier-${e.name.toLowerCase()}`}),id:`tier-${e.name.toLowerCase()}`,"data-testid":"tier",children:[(0,f.jsx)("h2",{style:{backgroundColor:e.color},children:e.name}),(0,f.jsx)("div",{className:"item-container",onDragOver:j,onDragLeave:A,onDragEnter:I,onDrop:T,ref:e=>N.current[t]=e})]},`tier-${e.name.toLowerCase()}`)))),[x,j,A,I,T]),D=(0,c.useMemo)((()=>(0,f.jsxs)("div",{className:"tier-list",children:[R,b.length>0?(0,f.jsx)("div",{className:"tier",id:"bank","data-testid":"tier",children:(0,f.jsx)("div",{className:"item-container",id:"items",onDragOver:j,onDragLeave:A,onDragEnter:I,onDrop:T,"data-testid":"voting-item-container",children:b.map(((e,t)=>(0,f.jsx)("div",{className:l()("item",{wrong:!i}),draggable:a,id:`item-${t+1}`,onDragStart:v,onDragEnd:C(e),ref:e=>M.current[t]=e,"data-testid":"voting-item",children:(0,f.jsx)(n.Z,{className:s.INTERACTIVE,elevation:S.u.ONE,onClick:()=>{var t;return r(e.submission_id,null!==(t=e.answer.code)&&void 0!==t?t:"")},children:(0,f.jsx)(p.SU,{className:"contestentry-entryid",children:t+1})})},`item-${t+1}`)))})}):(0,f.jsx)("div",{className:"noResults",children:"There are no eligible entries for voting found."})]})),[i,a,b,r,C,I,A,j,T,R]);return(0,c.useEffect)((()=>{b.forEach(((e,t)=>{if(null!==e.score){const a=xe.findIndex((t=>!!e.score&&t.score<=e.score));if(-1!==a){const e=N.current[a],s=M.current[t];e&&s&&e.appendChild(s)}}}))}),[b]),(0,f.jsxs)("div",{className:"ContestEntryVoting",children:[(0,f.jsxs)(m.z,{className:"collapse-button",icon:d?P.d.CARET_DOWN:P.d.CARET_RIGHT,minimal:!0,onClick:()=>h(!d),children:[(0,f.jsx)("span",{children:"Contest Voting"}),(0,f.jsx)(E.u,{content:(0,f.jsx)("span",{children:"Rank your favourite contest entries from tiers D (worst) to S (best)!"}),children:(0,f.jsx)(k.I,{icon:P.d.HELP})})]}),(0,f.jsx)(w.U,{isOpen:d,keepChildrenMounted:!0,children:D})]})},be=e=>{const{canSave:t,contestEntries:a,handleSave:s,handleContestEntryClick:n}=e,[i,r]=(0,c.useState)(!0),[o,l]=(0,c.useState)([]);(0,c.useEffect)((()=>{l(a)}),[a]);return(0,f.jsx)(ye,{isValid:i,canSave:t,handleContestEntryClick:n,handleVotingSubmissionChange:(e,t)=>{const a=o.map((a=>a.submission_id===e?{...a,score:t}:a));l(a);const n=(e=>e.reduce(((e,t)=>e&&void 0!==t.score&&null!==t.score),!0))(a);n?(s(a),r(!0)):((0,U.N9)("Please assign every entry to a tier."),r(!1))},contestEntries:o})};var fe=a(15765),ve=a(38709),Ce=a(98638),je=a(66133),Se=a(98906),Ie=a(69124),ke=a(1278),we=a(34949),Ae=a(25949),Te=a(43712);const Me=e=>(0,f.jsx)("div",{className:"GradingResult",children:(0,f.jsxs)("div",{className:"grading-result-table",children:[(0,f.jsx)(we.v,{children:(0,f.jsxs)("tbody",{children:[(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{children:"XP:"}),(0,f.jsx)("td",{children:(0,f.jsxs)(I.x,{children:[e.xp," / ",e.maxXp]})})]}),(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{children:"Comments:"}),(0,f.jsx)("td",{children:!e.comments&&(0,f.jsx)(I.x,{children:"None"})})]})]})}),e.comments&&(0,f.jsx)(we.v,{children:(0,f.jsx)("tbody",{children:(0,f.jsx)("tr",{children:(0,f.jsxs)("td",{children:[(0,f.jsx)(Ae.i,{}),(0,f.jsx)(ae.Z,{content:e.comments,simplifiedAutoLink:!0,strikethrough:!0,tasklists:!0,openLinksInNewWindow:!0}),(0,f.jsx)(Ae.i,{})]})})})}),(0,f.jsx)("br",{}),(0,f.jsx)("div",{className:"grading-result-info",children:(0,f.jsxs)(I.x,{children:["Graded by ",(0,f.jsx)("b",{children:e.graderName})," on ",(0,Te.Dh)(e.gradedAt)]})})]})}),Pe="assessment",Ee=e=>{var t,a,o,p,v;const[j,S]=(0,c.useState)(!1),[I,k]=(0,c.useState)(!1),[w,M]=(0,c.useState)(""),{isMobileBreakpoint:E}=(0,C.Fs)(),R=(0,C.ix)((t=>t.session.assessments.get(e.assessmentId))),{selectedTab:D,setSelectedTab:L}=(0,Ce.__)(Pe,void 0!==(null===R||void 0===R?void 0:R.questions[e.questionId].grader)?ge.B_.grading:ge.B_.questionOverview),O=(0,h.s0)(),{courseId:G}=(0,C.ix)((e=>e.session)),{isFolderModeEnabled:U,activeEditorTabIndex:ne,editorTabs:ie,autogradingResults:re,editorTestcases:oe,hasUnsavedChanges:le,isRunning:ce,output:de,replValue:he,currentAssessment:pe,currentQuestion:xe}=(0,C.ix)((e=>e.workspaces[Pe])),ye=(0,d.I0)(),{handleTestcaseEval:we,handleClearContext:Ae,handleChangeExecTime:Te,handleUpdateCurrentAssessmentId:Ee,handleResetWorkspace:Ne,handleRunAllTestcases:Re,handleEditorEval:De,handleAssessmentFetch:Le,handleEditorValueChange:Oe,handleEditorUpdateBreakpoints:_e,handleReplEval:Ge,handleSave:Be,handleUpdateHasUnsavedChanges:Ue,handleEnableTokenCounter:Fe,handleDisableTokenCounter:ze}=(0,c.useMemo)((()=>({handleTestcaseEval:e=>ye((0,ke.evalTestcase)(Pe,e)),handleClearContext:(e,t)=>ye((0,ke.beginClearContext)(Pe,e,t)),handleChangeExecTime:e=>ye((0,ke.changeExecTime)(e,Pe)),handleUpdateCurrentAssessmentId:(e,t)=>ye((0,ke.updateCurrentAssessmentId)(e,t)),handleResetWorkspace:e=>ye((0,ke.resetWorkspace)(Pe,e)),handleRunAllTestcases:()=>ye((0,ke.runAllTestcases)(Pe)),handleEditorEval:()=>ye((0,ke.evalEditor)(Pe)),handleAssessmentFetch:(e,t)=>ye((0,y.fetchAssessment)(e,t)),handleEditorValueChange:(e,t)=>ye((0,ke.updateEditorValue)(Pe,e,t)),handleEditorUpdateBreakpoints:(e,t)=>ye((0,ke.setEditorBreakpoint)(Pe,e,t)),handleReplEval:()=>ye((0,ke.evalRepl)(Pe)),handleSave:(e,t)=>ye((0,y.submitAnswer)(e,t)),handleUpdateHasUnsavedChanges:e=>ye((0,ke.updateHasUnsavedChanges)(Pe,e)),handleEnableTokenCounter:()=>ye((0,ke.enableTokenCounter)(Pe)),handleDisableTokenCounter:()=>ye((0,ke.disableTokenCounter)(Pe))})),[ye]);(0,c.useEffect)((()=>{Oe(0,"")}),[]),(0,c.useEffect)((()=>{let t=null;if(e.needsPassword&&(t=window.prompt("Please enter password.",""),!t))return void window.history.back();if(Le(e.assessmentId,t||void 0),0===e.questionId&&e.notAttempted&&S(!0),!R)return;let a=e.questionId;e.questionId>=R.questions.length&&(a=R.questions.length-1);const s=R.questions[a];let n="";s.type===B.LD.programming&&(n=s.answer?s.answer:s.solutionTemplate),Oe(0,n)}),[]),(0,c.useEffect)((()=>{$e()})),(0,c.useEffect)((()=>{e.assessmentConfiguration.hasTokenCounter?Fe():ze()}),[e.assessmentConfiguration.hasTokenCounter,Fe,ze]),(0,c.useEffect)((()=>{D&&!E&&z.JN.includes(D)&&L(ge.B_.questionOverview)}),[E,e,D,L]);const Ve=(0,c.useCallback)((e=>(0,V.cM)(w,e)),[w]),He=(0,c.useRef)(D);He.current=D;const Ke=(0,c.useCallback)((()=>{He.current===ge.B_.autograder?Re():De();const e={time:Date.now(),type:"keyboardCommand",data:H.SO.run};Ve(e)}),[De,Re,Ve]),$e=()=>{var t,a,s,n,i,r;if(void 0===R)return;const{assessmentId:o,questionId:l}=e;if(pe===o&&xe===l)return;const c=R.questions[l],d={};switch(c.type){case B.LD.programming:const t=c;var h,g;if(d.autogradingResults=t.autogradingResults,d.programPrependValue=t.prepend,d.programPostpendValue=t.postpend,d.editorTestcases=t.testcases,d.editorValue=t.answer||t.solutionTemplate,!w)M((0,V.wH)(`${R.number}/${e.questionId}`,{chapter:c.library.chapter,externalLibrary:(null===c||void 0===c||null===(h=c.library)||void 0===h||null===(g=h.external)||void 0===g?void 0:g.name)||"NONE",editorValue:d.editorValue}));break;case B.LD.voting:const a=c;d.programPrependValue=a.prepend,d.programPostpendValue=a.postpend;case B.LD.mcq:}_e(0,[]),Ee(o,l);const p=(0,Se.p)()({autogradingResults:null!==(t=d.autogradingResults)&&void 0!==t?t:[],editorTabs:[{value:null!==(a=d.editorValue)&&void 0!==a?a:"",highlightedLines:[],breakpoints:[]}],programPrependValue:null!==(s=d.programPrependValue)&&void 0!==s?s:"",programPostpendValue:null!==(n=d.programPostpendValue)&&void 0!==n?n:"",editorTestcases:null!==(i=d.editorTestcases)&&void 0!==i?i:[]});Ne(p),Te(null!==(r=c.library.execTimeMs)&&void 0!==r?r:u.t7.assessment.execTime),Ae(c.library,!0),Ue(!1),d.editorValue&&Oe(0,d.editorValue)},Xe=(e,t)=>{const a=R.questions[t],s=void 0!==a.grader,n=(null===a||void 0===a?void 0:a.type)===B.LD.voting,i=(e,t)=>{Oe(0,t)},r=[{label:`Question ${t+1}`,iconName:P.d.NINJA,body:(0,f.jsx)(ae.Z,{content:a.content}),id:ge.B_.questionOverview}];var o,l,c;n?r.push({label:"Contest Voting Briefing",iconName:P.d.BRIEFCASE,body:(0,f.jsx)(ae.Z,{content:R.longSummary}),id:ge.B_.briefing},{label:"Contest Voting",iconName:P.d.NEW_LAYERS,body:(0,f.jsx)(be,{canSave:e.canSave,handleSave:e=>Be(a.id,e),handleContestEntryClick:i,contestEntries:null!==(o=null===a||void 0===a?void 0:a.contestEntries)&&void 0!==o?o:[]}),id:ge.B_.contestVoting},{label:"Score Leaderboard",iconName:P.d.CROWN,body:(0,f.jsx)(me,{handleContestEntryClick:i,orderedContestEntries:null!==(l=null===a||void 0===a?void 0:a.scoreLeaderboard)&&void 0!==l?l:[],leaderboardType:ge.B_.scoreLeaderboard}),id:ge.B_.scoreLeaderboard},{label:"Popular Vote Leaderboard",iconName:P.d.PEOPLE,body:(0,f.jsx)(me,{handleContestEntryClick:i,orderedContestEntries:null!==(c=null===a||void 0===a?void 0:a.popularVoteLeaderboard)&&void 0!==c?c:[],leaderboardType:ge.B_.popularVoteLeaderboard}),id:ge.B_.popularVoteLeaderboard}):r.push({label:"Briefing",iconName:P.d.BRIEFCASE,body:(0,f.jsx)(ae.Z,{className:"sidecontent-overview",content:R.longSummary}),id:ge.B_.briefing},{label:"Autograder",iconName:P.d.AIRPLANE,body:(0,f.jsx)(ue,{testcases:oe,autogradingResults:s||!e.assessmentConfiguration.isManuallyGraded?re:[],handleTestcaseEval:we,workspaceLocation:"assessment"}),id:ge.B_.autograder});s&&r.push({label:"Report Card",iconName:P.d.TICK,body:(0,f.jsx)(Me,{graderName:a.grader.name,gradedAt:a.gradedAt,xp:a.xp,maxXp:a.maxXp,comments:a.comments}),id:ge.B_.grading});a.library.external.symbols.includes("get_matrix")&&r.push({label:"Tone Matrix",iconName:P.d.GRID_VIEW,body:(0,f.jsx)(fe.Z,{}),id:ge.B_.toneMatrix});return{selectedTabId:D,tabs:{beforeDynamicTabs:r,afterDynamicTabs:[]},onChange:(e,t,a)=>{e!==t&&L(e)},workspaceLocation:Pe}},We=t=>{var a;const s=`/courses/${G}/${(0,je.q1)(R.type)}`,n=s+`/${R.id.toString()}`,i=R.questions,r=i[t],o=[t+1,i.length],l=()=>{O(n+`/${(t+1).toString()}`),L(ge.B_.questionOverview)},c=()=>O(s),d=i.filter((e=>null!==e.answer)).length-1,h=t>=d,u=(0,f.jsx)(W.g,{onClickNext:r.blocking?F(l,r,oe,h):l,onClickReturn:r.blocking?F(c,r,oe,h):c,questionProgress:o},"next_question"),g=(0,f.jsx)(q.f,{onClick:()=>{O(n+`/${(t-1).toString()}`),L(ge.B_.questionOverview)},questionProgress:o},"previous_question"),p=(0,f.jsx)(Z.M,{questionProgress:o},"question_view"),m=r.type!==B.LD.mcq?(0,f.jsx)(Y.A,{onClick:()=>{k(!0)}},"reset_template"):null,x=(0,f.jsx)(J.h,{isEntrypointFileDefined:null!==ne,handleEditorEval:Ke},"run"),y=e.canSave&&r.type===B.LD.programming?(0,f.jsx)(Q.t,{hasUnsavedChanges:le,onClickSave:()=>Be(r.id,ie[0].value)},"save"):null,v=(0,f.jsx)(K.b,{handleChapterSelect:()=>{},isFolderModeEnabled:U,sourceChapter:r.library.chapter,sourceVariant:null!==(a=r.library.variant)&&void 0!==a?a:b.Z.defaultSourceVariant,disabled:!0},"chapter");return{editorButtons:E?[y,m]:[x,y,m,v],flowButtons:[g,p,u]}},qe=(0,c.useMemo)((()=>{const e=(0,f.jsx)($._,{handleReplOutputClear:()=>ye((0,ke.clearReplOutput)(Pe))},"clear_repl");return[(0,f.jsx)(X.e,{handleReplEval:Ge,isRunning:ce},"eval_repl"),e]}),[ye,ce,Ge]),Ze=(0,c.useMemo)((()=>({setActiveEditorTabIndex:e=>ye((0,ke.updateActiveEditorTabIndex)(Pe,e)),removeEditorTabByIndex:e=>ye((0,ke.removeEditorTab)(Pe,e)),handleDeclarationNavigate:e=>ye((0,ke.navigateToDeclaration)(Pe,e)),handlePromptAutocomplete:(e,t,a)=>ye((0,ke.promptAutocomplete)(Pe,e,t,a))})),[ye]),Ye=(0,c.useMemo)((()=>({handleBrowseHistoryDown:()=>ye((0,ke.browseReplHistoryDown)(Pe)),handleBrowseHistoryUp:()=>ye((0,ke.browseReplHistoryUp)(Pe)),handleReplValueChange:e=>ye((0,ke.updateReplValue)(e,Pe))})),[ye]),Je=(0,c.useMemo)((()=>({handleSideContentHeightChange:e=>ye((0,ve.changeSideContentHeight)(e,Pe))})),[ye]);if(null===R||void 0===R||!R.questions.length)return(0,f.jsx)(i.t,{className:l()("WorkspaceParent",s.DARK),description:"Getting mission ready...",icon:(0,f.jsx)(r.$,{size:r.E.LARGE})});const Qe=(0,f.jsx)(g.V,{className:"assessment-briefing",isOpen:j,children:(0,f.jsxs)(n.Z,{children:[(0,f.jsx)(ae.Z,{content:R.longSummary}),(0,f.jsx)(m.z,{className:"assessment-briefing-button",onClick:()=>S(!1),text:"Continue"})]})}),et=()=>k(!1),tt=(0,f.jsxs)(g.V,{className:"assessment-reset",icon:P.d.ERROR,isCloseButtonShown:!0,isOpen:I,onClose:et,title:"Confirmation: Reset editor?",children:[(0,f.jsxs)(A.a,{children:[(0,f.jsx)(ae.Z,{content:"Are you sure you want to reset the template?"}),(0,f.jsx)(ae.Z,{content:"*Note this will not affect the saved copy of your program, unless you save over it.*"})]}),(0,f.jsx)(T.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(ee.Z,{label:"Cancel",onClick:et,options:{minimal:!1}}),(0,f.jsx)(ee.Z,{label:"Confirm",onClick:()=>{et(),Oe(0,R.questions[at].solutionTemplate),Ue(!0)},options:{minimal:!1,intent:x.S.DANGER}})]})})]}),at=e.questionId>=R.questions.length?R.questions.length-1:e.questionId,st=R.questions[at],nt=st.type===B.LD.programming||st.type===B.LD.voting?{editorVariant:"normal",isFolderModeEnabled:U,activeEditorTabIndex:ne,setActiveEditorTabIndex:Ze.setActiveEditorTabIndex,removeEditorTabByIndex:Ze.removeEditorTabByIndex,editorTabs:ie.map(te.F),editorSessionId:"",sourceChapter:st.library.chapter||_.Chapter.SOURCE_4,sourceVariant:null!==(t=st.library.variant)&&void 0!==t?t:_.Variant.DEFAULT,externalLibraryName:st.library.external.name||"NONE",handleDeclarationNavigate:Ze.handleDeclarationNavigate,handleEditorEval:Ke,handleEditorValueChange:Oe,handleUpdateHasUnsavedChanges:Ue,handleEditorUpdateBreakpoints:_e,handlePromptAutocomplete:Ze.handlePromptAutocomplete,isEditorAutorun:!1,onChange:(e,t)=>{null===Ue||void 0===Ue||Ue(!0),Oe(0,e);const a={time:Date.now(),type:"codeDelta",data:t};Ve(a)},onCursorChange:e=>{const t={time:Date.now(),type:"cursorPositionChange",data:e.getCursor()};Ve(t)},onSelectionChange:e=>{const t=e.getRange(),a=e.isBackwards();if(!(0,N.isEqual)(t.start,t.end)){const e={time:Date.now(),type:"selectionRangeData",data:{range:t,isBackwards:a}};Ve(e)}}}:void 0,it={mcq:st,handleMCQSubmit:e=>Be(R.questions[at].id,e)},rt={handleBrowseHistoryDown:Ye.handleBrowseHistoryDown,handleBrowseHistoryUp:Ye.handleBrowseHistoryUp,handleReplEval:Ge,handleReplValueChange:Ye.handleReplValueChange,output:de,replValue:he,sourceChapter:(null===st||void 0===st||null===(a=st.library)||void 0===a?void 0:a.chapter)||_.Chapter.SOURCE_4,sourceVariant:null!==(o=st.library.variant)&&void 0!==o?o:_.Variant.DEFAULT,externalLibrary:(null===st||void 0===st||null===(p=st.library)||void 0===p||null===(v=p.external)||void 0===v?void 0:v.name)||"NONE",replButtons:qe},ot={tabs:[]},lt={controlBarProps:We(at),editorContainerProps:nt,handleSideContentHeightChange:Je.handleSideContentHeightChange,hasUnsavedChanges:le,mcqProps:it,sideBarProps:ot,sideContentProps:Xe(e,at),replProps:rt},ct={editorContainerProps:nt,hasUnsavedChanges:le,mcqProps:it,replProps:rt,sideBarProps:ot,mobileSideContentProps:(t=>({mobileControlBarProps:{...We(t)},...Xe(e,t),onChange:(e,t,a)=>{e!==t&&(t===ge.B_.autograder&&e===ge.B_.mobileEditorRun||L(e))},selectedTabId:D,handleEditorEval:Ke}))(at)};return(0,f.jsxs)("div",{className:l()("WorkspaceParent",s.DARK),children:[Qe,tt,E?(0,f.jsx)(se.Z,{...ct}):(0,f.jsx)(Ie.Z,{...lt})]})};var Ne=a(24526),Re=a(46899),De=a(20779);const Le=()=>(0,f.jsx)("div",{className:l()("NoPage",s.DARK),children:(0,f.jsx)(i.t,{icon:P.d.ERROR,title:"Assessment Not Found",description:"Please check the top right dropdown menu to see if you are in the right course."})}),Oe=e=>{let t,a,s;switch(e){case B.TD.graded:t=P.d.TICK,a=x.S.SUCCESS,s="Fully graded";break;case B.TD.grading:t=P.d.TIME,a=x.S.WARNING,s="Grading in progress";break;case B.TD.none:t=P.d.CROSS,a=x.S.DANGER,s="Not graded yet";break;default:t=P.d.DISABLE,a=x.S.PRIMARY,s="Not applicable"}return(0,f.jsx)(E.u,{className:"listing-title-tooltip",content:s,placement:M.Ly.RIGHT,children:(0,f.jsx)(k.I,{icon:t,intent:a})})},_e=(e,t,a)=>(0,f.jsx)(ee.Z,{label:e,icon:t?P.d.CARET_DOWN:P.d.CARET_RIGHT,onClick:a,options:{minimal:!0,className:"collapse-button"}}),Ge=e=>{var t,a;const s=(0,h.UO)(),{isMobileBreakpoint:o}=(0,C.Fs)(),[v,j]=(0,c.useState)(null),[M,R]=(0,c.useState)(!1),[_,G]=(0,c.useState)(!0),[U,F]=(0,c.useState)(!0),{courseId:z,role:V,assessmentOverviews:H}=(0,C.kP)(),K=(0,d.I0)(),$=()=>R(!M),X=()=>G(!_),W=()=>F(!U),q=()=>j(null),Z=e=>(0,N.sortBy)(e,[e=>-e.id]),Y=(e,t)=>(0,f.jsxs)(m.z,{disabled:e.status!==B.PF.attempted,icon:P.d.CONFIRM,intent:e.status===B.PF.attempted?x.S.DANGER:x.S.NONE,minimal:!0,onClick:()=>j(e),children:[(0,f.jsx)("span",{children:"Finalize"}),(0,f.jsx)("span",{className:"custom-hidden-xxs",children:" Submission"})]}),J=e=>{let t,a,s="";switch(e.status){case B.PF.not_attempted:t=P.d.PLAY,a="Attempt";break;case B.PF.attempting:t=P.d.PLAY,a="Continue",s=" Attempt";break;case B.PF.attempted:t=P.d.EDIT,a="Review",s=" Attempt";break;case B.PF.submitted:t=P.d.EYE_OPEN,a="Review",s=" Submission";break;default:t=P.d.PLAY,a="Review"}return(0,f.jsx)(D.OL,{to:`/courses/${z}/${(0,je.q1)(e.type)}/${e.id.toString()}/${b.Z.defaultQuestionId}`,children:(0,f.jsxs)(m.z,{icon:t,minimal:!0,onClick:()=>K((0,y.acknowledgeNotifications)((0,De.Vf)(e.id))),children:[(0,f.jsx)("span",{"data-testid":"Assessment-Attempt-Button",children:a}),(0,f.jsx)("span",{className:"custom-hidden-xxxs",children:s})]})})},Q=(t,a,s,i)=>{const r="graded"===t.gradingStatus||!e.assessmentConfiguration.isManuallyGraded;return(0,f.jsx)("div",{children:(0,f.jsxs)(n.Z,{className:"row listing",elevation:S.u.ONE,children:[(0,f.jsxs)("div",{className:l()("listing-picture",!o&&"col-xs-3"),children:[(0,f.jsx)(Re.Z,{className:"badge",notificationFilter:(0,De.Vf)(t.id),large:!0}),(0,f.jsx)("img",{alt:"Assessment",className:`cover-image-${t.status}`,src:t.coverImage?t.coverImage:O})]}),(0,f.jsxs)("div",{className:l()("listing-text",!o&&"col-xs-9"),children:[te(t,a,i),(0,f.jsx)("div",{className:"listing-xp",children:(0,f.jsx)(p.H6,{children:r?`XP: ${t.xp} / ${t.maxXp}`:`Max XP: ${t.maxXp}`})}),(0,f.jsx)("div",{className:"listing-description",children:(0,f.jsx)(ae.Z,{content:t.shortSummary})}),(0,f.jsxs)("div",{className:"listing-footer",children:[(0,f.jsxs)("div",{children:[(0,f.jsxs)(I.x,{className:"listing-due-date",children:[(0,f.jsx)(k.I,{className:"listing-due-icon",iconSize:12,icon:P.d.CALENDAR}),`${(0,Te.IU)(t.openAt)?"Opened":"Opens"}: ${(0,Te.Dh)(t.openAt)}`]}),(0,Te.IU)(t.openAt)&&(0,f.jsxs)(I.x,{className:"listing-due-date",children:[(0,f.jsx)(k.I,{className:"listing-due-icon",iconSize:12,icon:P.d.TIME}),`Due: ${(0,Te.Dh)(t.closeAt)}`]})]}),(0,f.jsx)("div",{className:"listing-button",children:s?J(t):null})]})]})]})},a)},te=(e,t,a)=>(0,f.jsxs)("div",{className:"listing-header",children:[(0,f.jsx)(I.x,{ellipsize:!0,children:(0,f.jsxs)(p.H4,{className:"listing-title",children:[e.title,e.private?(0,f.jsx)(E.u,{className:"listing-title-tooltip",content:"This assessment is password-protected.",children:(0,f.jsx)(k.I,{icon:"lock"})}):null,a?Oe(e.gradingStatus):null]})}),(0,f.jsx)("div",{className:"listing-button",children:Y(e)})]}),se=(0,c.useMemo)((()=>null===H||void 0===H?void 0:H.filter((t=>t.type===e.assessmentConfiguration.type))),[H,e.assessmentConfiguration.type]);if(s.assessmentId&&(null===(t=s.assessmentId)||void 0===t||!t.match(L.CJ))||s.questionId&&(null===(a=s.questionId)||void 0===a||!a.match(L.CJ)))return(0,f.jsx)(h.Fg,{to:`/courses/${z}/${e.assessmentConfiguration.type}`});const ne=(0,je.GA)(s.assessmentId),ie=(0,je.GA)(s.questionId)||b.Z.defaultQuestionId;if(null!==ne&&void 0!==se){const t=se.filter((e=>e.id===ne))[0];if(!t)return(0,f.jsx)(Le,{});const a=t.status===B.PF.not_attempted,s={assessmentId:ne,questionId:ie,notAttempted:a,needsPassword:!!t.private&&a,canSave:V!==u.uU.Student||t.status!==B.PF.submitted&&!(0,Te.IU)(t.closeAt),assessmentConfiguration:e.assessmentConfiguration};return(0,f.jsx)(Ee,{...s})}let re;if(void 0===se)re=(0,f.jsx)(i.t,{description:"Fetching assessment...",icon:(0,f.jsx)(r.$,{})});else if(0===se.length)re=(0,f.jsx)(i.t,{title:"There are no assessments.",icon:P.d.FLAME});else{const e=e=>!(0,Te.IU)(e.closeAt)&&!(0,Te.IU)(e.openAt),t=Z(se.filter(e)).map(((e,t)=>Q(e,t,V!==u.uU.Student,!1))),a=e=>!(0,Te.IU)(e.closeAt)&&(0,Te.IU)(e.openAt)&&e.status!==B.PF.submitted,s=Z(se.filter((e=>a(e)))).map(((e,t)=>Q(e,t,!0,!1))),n=Z(se.filter((t=>!a(t)&&!e(t)))).map(((e,t)=>Q(e,t,!0,!0))),i=(0,f.jsxs)(f.Fragment,{children:[_e("Upcoming",U,W),(0,f.jsx)(w.U,{isOpen:U,children:t})]}),r=(0,f.jsxs)(f.Fragment,{children:[_e("Open",_,X),(0,f.jsx)(w.U,{isOpen:_,children:s})]}),o=(0,f.jsxs)(f.Fragment,{children:[_e("Closed",M,$),(0,f.jsx)(w.U,{isOpen:M,children:n})]});re=(0,f.jsxs)(f.Fragment,{children:[t.length>0?i:null,s.length>0?r:null,n.length>0?o:null]})}const oe=v?(0,f.jsxs)("p",{children:["You are about to finalise your submission for the ",v.type.toLowerCase()," ",(0,f.jsxs)("i",{children:['"',v.title,'"']}),"."]}):(0,f.jsx)("p",{children:"You are about to finalise your submission."}),le=(0,f.jsxs)(f.Fragment,{children:[oe,(0,f.jsxs)("p",{children:["Finalising your submission early grants you additional XP, but"," ",(0,f.jsx)("span",{className:"warning",children:"this action is irreversible."})]})]}),ce=(0,f.jsxs)(g.V,{className:"betcha-dialog",icon:P.d.ERROR,isCloseButtonShown:!0,isOpen:null!==v,onClose:q,title:"Finalise submission?",children:[(0,f.jsx)(A.a,{children:(0,f.jsx)(I.x,{children:le})}),(0,f.jsx)(T.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(ee.Z,{label:"Cancel",onClick:q,options:{minimal:!1}}),(0,f.jsx)(ee.Z,{label:"Finalise",onClick:()=>{v&&(K((0,y.submitAssessment)(v.id)),q())},options:{minimal:!1,intent:x.S.DANGER}})]})})]});return(0,f.jsxs)("div",{className:"Assessment",children:[(0,f.jsx)(Ne.Z,{display:re,loadContentDispatch:()=>K((0,y.fetchAssessmentOverviews)())}),ce]})};var Be=a(24128),Ue=a(33487);const Fe={coverImage:`${Ue.ej}/default.png`,description:"",completionText:""},ze={uuid:"",title:"Achievement Title Here",xp:0,isVariableXp:!1,isTask:!1,position:0,prerequisiteUuids:[],goalUuids:[],cardBackground:`${Ue.Y9}/default.png`,view:Fe},Ve=({allowNewUuid:e,setNewUuid:t})=>{const a=(0,c.useContext)(Ue.gc);return(0,f.jsx)(m.z,{className:"command-button",disabled:!e,icon:P.d.NEW_OBJECT,onClick:()=>t(a.insertAchievement(ze)),text:"Create Achievement"})};var He=a(92485),Ke=a(63884),$e=a(60013);const Xe=({deleteItem:e,item:t})=>(0,f.jsx)(E.u,{content:"Delete",children:(0,f.jsx)(m.z,{icon:P.d.TRASH,intent:"danger",onClick:async()=>{await(0,$e.pG)({contents:`Are you sure you want to delete '${t}' ?`,negativeLabel:"No",positiveIntent:"danger",positiveLabel:"Yes, delete"})&&e()}})}),We=({discardChanges:e,saveChanges:t})=>(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(E.u,{content:"Save Changes",children:(0,f.jsx)(m.z,{icon:P.d.FLOPPY_DISK,intent:"primary",onClick:()=>{t(),(0,U.rO)("Saved changes locally")}})}),(0,f.jsx)(E.u,{content:"Discard Changes",children:(0,f.jsx)(m.z,{icon:P.d.CROSS,intent:"danger",onClick:()=>{e(),(0,U.N9)("Discarded changes")}})})]});var qe=a(59111),Ze=a(95293),Ye=a(23841);const Je=({changeGoalUuids:e,goalUuids:t})=>{const a=(0,c.useContext)(Ue.gc),s=a.getAllGoalUuids(),n=t.filter((e=>!a.isInvalidGoal(a.getGoal(e)))),i=Ye.N.ofType(),r=new Set(n),o=new Set((0,N.without)(s,...t)),l=t=>{void 0!==l&&(r.delete(t),o.add(t),e([...r]))};return(0,f.jsx)(i,{itemRenderer:(e,{handleClick:t})=>(0,f.jsx)(Ze.s,{onClick:t,text:e.text},e.uuid),items:[...o].map((e=>a.getGoal(e))),noResults:(0,f.jsx)(Ze.s,{disabled:!0,text:"No available goal"}),onItemSelect:t=>{return a=t.uuid,r.add(a),o.delete(a),void e([...r]);var a},selectedItems:[...r].map((e=>a.getGoal(e))),tagInputProps:{onRemove:e=>l((e=>a.getUuidByText(e))(e.toString()))},tagRenderer:e=>e.text,itemPredicate:(e,t)=>t.text.toLowerCase().includes(e.toLowerCase()),resetOnSelect:!0})};var Qe=a(56739);const et=({changePosition:e,position:t})=>{const a=(0,c.useContext)(Ue.gc).listTaskUuids().length+1,s=[...Array(a+1).keys()],n=Qe.P.ofType();return(0,f.jsx)(n,{filterable:!1,itemRenderer:(e,{handleClick:t})=>(0,f.jsx)(Ze.s,{onClick:t,text:e},e),items:s,onItemSelect:e,children:(0,f.jsx)(m.z,{text:t})})},tt=e=>{const{changePrerequisiteUuids:t,uuid:a,prerequisiteUuids:s}=e,n=(0,c.useContext)(Ue.gc),i=[],r=s.filter((e=>!n.isInvalidAchievement(n.getAchievement(e)))),o=Ye.N.ofType(),l=new Set(r),d=new Set((0,N.without)(i,...r));return(0,f.jsx)(o,{itemRenderer:(e,{handleClick:t})=>(0,f.jsx)(Ze.s,{onClick:t,text:e.title},e.uuid),items:[...d].map((e=>n.getAchievement(e))),noResults:(0,f.jsx)(Ze.s,{disabled:!0,text:"No available achievement"}),onItemSelect:e=>{return a=e.uuid,l.add(a),d.delete(a),void t([...l]);var a},selectedItems:[...l].map((e=>n.getAchievement(e))),tagInputProps:{onRemove:e=>{var a;void 0!==(a=(e=>n.getUuidByTitle(e))(e.toString()))&&(l.delete(a),d.add(a),t([...l]))}},tagRenderer:e=>e.title,itemPredicate:(e,t)=>t.title.toLowerCase().includes(e.toLowerCase()),resetOnSelect:!0})},at=e=>{const{changeCardBackground:t,changeGoalUuids:a,changePosition:s,changePrerequisiteUuids:n,changeIsVariableXp:i,editableAchievement:r}=e,{uuid:o,cardBackground:l,goalUuids:d,position:h,prerequisiteUuids:u,isVariableXp:p}=r,[x,y]=(0,c.useState)(!1),b=()=>y(!x);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(E.u,{content:"More Settings",children:(0,f.jsx)(m.z,{icon:P.d.WRENCH,onClick:b})}),(0,f.jsx)(g.V,{title:"More Settings",icon:P.d.WRENCH,isOpen:x,onClose:b,children:(0,f.jsxs)("div",{style:{padding:"0 0.5em"},children:[(0,f.jsx)("h3",{children:"Card Background"}),(0,f.jsx)(He.s,{multiline:!0,onChange:t,placeholder:"Enter card background URL here",value:l}),(0,f.jsx)("h3",{children:"Position"}),(0,f.jsx)("p",{children:"Note: Select position 0 to hide achievement"}),(0,f.jsx)(et,{changePosition:s,position:h}),(0,f.jsx)("h3",{children:"Prerequisites"}),(0,f.jsx)(tt,{changePrerequisiteUuids:n,uuid:o,prerequisiteUuids:u}),(0,f.jsx)("h3",{children:"Goals"}),(0,f.jsx)(Je,{changeGoalUuids:a,goalUuids:d}),(0,f.jsx)("h3",{children:"Variable XP"}),(0,f.jsx)(qe.XZ,{label:"The rewarded XP will be equal to the sum of 'count' of goals",checked:p,onChange:i})]})})]})},st=({uuid:e})=>(0,f.jsx)(E.u,{content:"Click to copy achievement UUID",children:(0,f.jsx)(m.z,{icon:P.d.CLIPBOARD,onClick:()=>{navigator.clipboard.writeText(e),(0,U.rO)("UUID copied to clipboard")}})});let nt=function(e){return e.CHANGE_CARD_BACKGROUND="CHANGE_CARD_BACKGROUND",e.CHANGE_DEADLINE="CHANGE_DEADLINE",e.CHANGE_GOAL_UUIDS="CHANGE_GOAL_UUIDS",e.CHANGE_POSITION="CHANGE_POSITION",e.CHANGE_PREREQUISITE_UUIDS="CHANGE_PREREQUISITE_UUIDS",e.CHANGE_RELEASE="CHANGE_RELEASE",e.CHANGE_TITLE="CHANGE_TITLE",e.CHANGE_IS_VARIABLE_XP="CHANGE_VARIABLE_XP",e.CHANGE_VIEW="CHANGE_VIEW",e.CHANGE_XP="CHANGE_XP",e.DELETE_ACHIEVEMENT="DELETE_ACHIEVEMENT",e.DISCARD_CHANGES="DISCARD_CHANGES",e.SAVE_CHANGES="SAVE_CHANGES",e}({});var it=a(72155),rt=a(74871);const ot=({type:e,date:t,changeDate:a})=>{const[s,n]=(0,c.useState)(!1),i=()=>n(!s),r=void 0===t?`No ${e}`:`${(0,rt.ti)(t)}`;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(E.u,{content:r,children:(0,f.jsx)(m.z,{minimal:!0,onClick:i,outlined:!0,children:`${e}`})}),(0,f.jsxs)(g.V,{isCloseButtonShown:!1,isOpen:s,onClose:i,style:{background:"#fff",maxWidth:"max-content",padding:"0.25em",textAlign:"center"},title:`${e}`,children:[(0,f.jsx)(it.M,{onChange:a,timePickerProps:{showArrowButtons:!0},value:t}),(0,f.jsx)(m.z,{onClick:()=>a(void 0),text:`Remove ${e}`})]})]})},lt=({changeView:e,view:t})=>{const{coverImage:a,description:s,completionText:n}=t,[i,r]=(0,c.useState)(!1),o=()=>r(!i);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(E.u,{content:"Edit View",children:(0,f.jsx)(m.z,{icon:P.d.WIDGET_HEADER,onClick:o})}),(0,f.jsx)(g.V,{title:"Edit View",icon:P.d.WIDGET_HEADER,isOpen:i,onClose:o,children:(0,f.jsxs)("div",{style:{padding:"0 0.5em"},children:[(0,f.jsx)("h3",{children:"Cover Image"}),(0,f.jsx)(He.s,{multiline:!0,onChange:a=>e({...t,coverImage:a}),placeholder:"Enter cover image URL here",value:a}),(0,f.jsx)("h3",{children:"Description"}),(0,f.jsx)(He.s,{multiline:!0,onChange:a=>e({...t,description:a}),placeholder:"Enter description here",value:s}),(0,f.jsx)("h3",{children:"Completion Text"}),(0,f.jsx)(He.s,{multiline:!0,onChange:a=>e({...t,completionText:a}),placeholder:"Enter completion text here",value:n})]})})]})},ct=e=>({editableAchievement:e,isDirty:!1}),dt=(e,t)=>{switch(t.type){case nt.SAVE_CHANGES:return{...e,isDirty:!1};case nt.DISCARD_CHANGES:return ct(t.payload);case nt.DELETE_ACHIEVEMENT:return{...e,isDirty:!1};case nt.CHANGE_CARD_BACKGROUND:return{editableAchievement:{...e.editableAchievement,cardBackground:t.payload},isDirty:!0};case nt.CHANGE_DEADLINE:return{editableAchievement:{...e.editableAchievement,deadline:t.payload},isDirty:!0};case nt.CHANGE_GOAL_UUIDS:return{editableAchievement:{...e.editableAchievement,goalUuids:t.payload},isDirty:!0};case nt.CHANGE_POSITION:return{editableAchievement:{...e.editableAchievement,isTask:0!==t.payload,position:t.payload},isDirty:!0};case nt.CHANGE_PREREQUISITE_UUIDS:return{editableAchievement:{...e.editableAchievement,prerequisiteUuids:t.payload},isDirty:!0};case nt.CHANGE_RELEASE:return{editableAchievement:{...e.editableAchievement,release:t.payload},isDirty:!0};case nt.CHANGE_TITLE:return{editableAchievement:{...e.editableAchievement,title:t.payload},isDirty:!0};case nt.CHANGE_VIEW:return{editableAchievement:{...e.editableAchievement,view:t.payload},isDirty:!0};case nt.CHANGE_XP:return{editableAchievement:{...e.editableAchievement,xp:t.payload},isDirty:!0};case nt.CHANGE_IS_VARIABLE_XP:return{editableAchievement:{...e.editableAchievement,isVariableXp:!e.editableAchievement.isVariableXp},isDirty:!0};default:return e}},ht=e=>{const{uuid:t,isNewAchievement:a,releaseUuid:s,removeCard:n,requestPublish:i}=e,r=(0,c.useContext)(Ue.gc),o=r.getAchievement(t),l=(0,c.useMemo)((()=>(0,N.cloneDeep)(o)),[o]),[d,h]=(0,c.useReducer)(dt,l,ct),[u,g]=(0,c.useState)(a),{editableAchievement:p,isDirty:m}=d,{cardBackground:x,deadline:y,release:b,title:v,view:C,xp:j}=p;return(0,f.jsxs)("li",{className:"editable-card",style:{background:`url(${x}) center/cover`},children:[(0,f.jsx)("div",{className:"action-button",children:m?(0,f.jsx)(We,{discardChanges:()=>h({type:nt.DISCARD_CHANGES,payload:l}),saveChanges:()=>{h({type:nt.SAVE_CHANGES}),r.modifyAchievement(p),u&&(s(),g(!1)),i()}}):(0,f.jsx)(Xe,{deleteItem:()=>{h({type:nt.DELETE_ACHIEVEMENT}),r.removeAchievement(t),u&&(s(),g(!1)),n(t),i()},item:v})}),(0,f.jsxs)("div",{className:"content",children:[(0,f.jsx)("h3",{className:"title",children:(0,f.jsx)(He.s,{onChange:e=>h({type:nt.CHANGE_TITLE,payload:e}),placeholder:"Enter your title here",value:v})}),(0,f.jsx)("div",{className:"xp",children:(0,f.jsx)(E.u,{content:"XP",children:(0,f.jsx)(Ke.A,{value:j,min:0,allowNumericCharactersOnly:!0,leftIcon:P.d.TRENDING_UP,placeholder:"XP",onValueChange:e=>h({type:nt.CHANGE_XP,payload:e})})})}),(0,f.jsxs)("div",{className:"details",children:[(0,f.jsx)(ot,{changeDate:e=>h({type:nt.CHANGE_RELEASE,payload:e}),date:b,type:"Release"}),(0,f.jsx)(ot,{changeDate:e=>h({type:nt.CHANGE_DEADLINE,payload:e}),date:y,type:"Deadline"}),(0,f.jsx)(st,{uuid:t})]})]}),(0,f.jsxs)("div",{className:"content-button",children:[(0,f.jsx)(lt,{changeView:e=>h({type:nt.CHANGE_VIEW,payload:e}),view:C}),(0,f.jsx)(at,{changeCardBackground:e=>h({type:nt.CHANGE_CARD_BACKGROUND,payload:e}),changeGoalUuids:e=>{h({type:nt.CHANGE_GOAL_UUIDS,payload:e})},changePosition:e=>h({type:nt.CHANGE_POSITION,payload:e}),changePrerequisiteUuids:e=>h({type:nt.CHANGE_PREREQUISITE_UUIDS,payload:e}),changeIsVariableXp:()=>h({type:nt.CHANGE_IS_VARIABLE_XP}),editableAchievement:p})]})]})};let ut=[];const gt=({requestPublish:e})=>{const t=(0,c.useContext)(Ue.gc),[a,s]=(0,c.useState)(""),n=""===a,i=()=>s(""),r=e=>{let t=0;for(;ut[t].key!==e&&t<ut.length;)t++;ut.splice(t,1)},o=(t,a)=>(0,f.jsx)(ht,{uuid:t,isNewAchievement:a,releaseUuid:i,removeCard:r,requestPublish:e},t);0===ut.length&&(ut=t.listSortedAchievementUuids().map((e=>o(e,!1))));return(0,f.jsxs)("div",{className:"achievement-editor",children:[(0,f.jsx)("div",{className:"command",children:(0,f.jsx)(Ve,{allowNewUuid:n,setNewUuid:e=>{s(e),ut[ut.length]=ut[0],ut[0]=o(e,!0)}})}),(0,f.jsx)("ul",{className:"achievement-container",children:ut})]})};var pt=a(80654);const mt=({filterState:e,icon:t,ownStatus:a})=>{const[s,n]=e;return(0,f.jsxs)("div",{className:"filter",onClick:()=>n(a),style:{color:(0,Ue.jf)(s,a)},children:[(0,f.jsx)(k.I,{icon:t,iconSize:30}),(0,f.jsx)("p",{children:a})]})};var xt=a(95422),yt=a(82452),bt=a(57689);const ft=({studentXp:e})=>(0,f.jsxs)("div",{className:"milestone",children:[(0,f.jsx)("h3",{children:"Your Total XP"}),(0,f.jsxs)("div",{className:"user-xp",children:[e," XP"]}),(0,f.jsx)("h3",{children:"CA Achievement Level"}),(0,f.jsxs)("div",{className:"details",children:[(0,f.jsxs)("div",{className:"level-badge",children:[(0,f.jsx)("span",{className:"level-icon"}),(0,f.jsx)("p",{children:b.Z.caFulfillmentLevel})]}),(0,f.jsx)("p",{className:"description",children:"Complete CS1101S CA Component"})]}),(0,f.jsx)("div",{className:"footer",children:(0,f.jsxs)("p",{children:["Full CA level of ",b.Z.caFulfillmentLevel," is subjected to change."]})})]}),vt=({studentXp:e})=>{const[t,a]=(0,c.useState)(!1),s=Math.floor(e/Ue.Dt)+1,n=e%Ue.Dt,i=n/Ue.Dt;return(0,f.jsxs)("div",{className:"level",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[(0,f.jsxs)("div",{className:"level-badge",children:[(0,f.jsx)("span",{className:"level-icon"}),(0,f.jsx)("p",{children:`Level ${s}`})]}),(0,f.jsxs)("span",{className:"level-progress",children:[(0,f.jsx)(bt.k,{animate:!1,className:"progress-bar",stripes:!1,value:i}),(0,f.jsxs)("p",{children:[n," / ",Ue.Dt," XP"]})]}),0!==b.Z.caFulfillmentLevel&&t&&(0,f.jsx)(ft,{studentXp:e})]})},Ct=({name:e,userState:t})=>{const[a]=t,s=null===a||void 0===a?void 0:a.courseRegId,n=(0,C.ix)((e=>e.session.courseRegId)),i=(0,d.I0)();(0,c.useEffect)((()=>{i(s&&s!==n?{type:yt.wn,payload:s}:{type:yt.e_})}),[s,n,i]);const r=(0,C.ix)((e=>e.session.xp));return(0,f.jsxs)("div",{className:"achievement-overview",children:[(0,f.jsx)(vt,{studentXp:r}),(0,f.jsx)("h3",{children:e})]})},jt=new Date(0,0,2).getTime()-new Date(0,0,0).getTime(),St=({deadline:e})=>{const t=void 0!==e&&!(0,rt.Bw)(e)&&(0,rt.Y4)(e)<=jt?Ue.dh.RED:Ue.dh.BLACK;return(0,f.jsxs)("div",{className:"deadline",children:[(0,f.jsx)(k.I,{color:t,icon:P.d.STOPWATCH}),(0,f.jsx)("p",{style:{color:t},children:(0,rt.xI)(e)})]})},It=(e,t)=>(t?"Total ":"")+e+" XP",kt=({isBonus:e,xp:t})=>(0,f.jsx)("div",{className:"xp",children:0!==t&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(k.I,{icon:P.d.BANK_ACCOUNT}),(0,f.jsx)("p",{children:It(t,e)})]})}),wt=e=>{const{uuid:t,focusState:a,isDropdownOpen:s,shouldRender:n,toggleDropdown:i}=e,r=(0,c.useContext)(Ue.gc),[o,l]=a,{cardBackground:d,title:h}=r.getAchievement(t),u=r.getDisplayDeadline(t),g=r.getDescendantXp(t),p=r.getProgressFrac(t),m=r.getStatus(t),y=void 0!==s&&0!==r.getImmediateChildren(t).size;return(0,f.jsxs)("div",{className:"achievement-card",onClick:()=>l(t),onClickCapture:i,style:{...(0,Ue.cb)(t,o),opacity:n?"100%":"20%",background:`url(${d}) center/cover`},children:[(0,f.jsx)("div",{className:"dropdown-button",children:y&&(0,f.jsx)(k.I,{icon:s?P.d.CARET_DOWN:P.d.CARET_RIGHT})}),(0,f.jsxs)("div",{className:"content",children:[(0,f.jsxs)("div",{className:"heading",children:[(0,f.jsx)("h3",{children:h.toUpperCase()}),m===pt.Cv.COMPLETED&&(0,f.jsx)(k.I,{icon:P.d.CONFIRM,intent:x.S.SUCCESS,style:{padding:"1em"}})]}),(0,f.jsxs)("div",{className:"details",children:[(0,f.jsx)(St,{deadline:u}),(0,f.jsx)(kt,{isBonus:y,xp:g})]}),(0,f.jsx)(bt.k,{animate:!1,className:"progress",intent:1===p?"success":"primary",stripes:!1,value:p})]})]})},At=({uuid:e,filterStatus:t,focusState:a})=>{const s=(0,c.useContext)(Ue.gc),n=[...s.getImmediateChildren(e)],i=(0,Ue.Xb)(),[r,o]=(0,c.useState)(!1),l=e=>{const a=s.getStatus(e);switch(t){case pt.fS.ALL:return!0;case pt.fS.ACTIVE:return a===pt.Cv.ACTIVE;case pt.fS.COMPLETED:return a===pt.Cv.COMPLETED;default:return!1}};return(0,f.jsx)(f.Fragment,{children:(e=>(e=>!s.isPrerequisite(e)&&l(e))(e)||(e=>[...s.getImmediateChildren(e)].reduce(((e,t)=>e||l(t)),!1))(e))(e)&&(0,f.jsxs)("li",{className:"task",children:[(0,f.jsx)(wt,{uuid:e,focusState:a,isDropdownOpen:r,shouldRender:l(e),toggleDropdown:()=>o(!r)}),(0,f.jsx)(w.U,{isOpen:r,keepChildrenMounted:!0,children:(0,f.jsx)("div",{className:"prerequisite-container",children:n.map((e=>(0,f.jsxs)("div",{className:"prerequisite",children:[(0,f.jsx)("div",{className:"dropdown-lines",style:{borderBottom:`1px solid ${i}`,borderLeft:`1px solid ${i}`}}),(0,f.jsx)(wt,{uuid:e,focusState:a,shouldRender:l(e)})]},e)))})})]})})},Tt="AchievementCommentCard_assessment-feedback__k-sBc",Mt="AchievementCommentCard_feedback-list__o20Gz",Pt="AchievementCommentCard_assessment-comments__0xF7w",Et="AchievementCommentCard_question-header__rBnJx",Nt="AchievementCommentCard_box-comment__CXsWS",Rt="AchievementCommentCard_to-assessment-button__akAcI",Dt=({assessment:e,showToQuestion:t})=>{const a=(0,h.s0)(),s=(0,C.ix)((e=>e.session.courseId)),n=(0,c.useMemo)((()=>t=>{if(!s)return void(0,U.N9)("Course ID not found");const n=`/courses/${s}/${(0,je.q1)(null===e||void 0===e?void 0:e.type)}`+`/${null===e||void 0===e?void 0:e.id.toString()}`;a(n+`/${t}`)}),[null===e||void 0===e?void 0:e.id,null===e||void 0===e?void 0:e.type,s,a]);return(0,f.jsxs)("div",{children:[(0,f.jsx)("h1",{className:Tt,children:"Feedback"}),(0,f.jsx)("div",{className:Mt,children:e&&e.questions.map(((e,a)=>(0,f.jsxs)("div",{className:Pt,children:[(0,f.jsx)("span",{children:(0,f.jsx)("h2",{className:Et,children:"Q"+(a+1)})}),(0,f.jsxs)("div",{className:Nt,children:[(0,f.jsx)("p",{children:null===e.comments?"No Comments":e.comments}),(0,f.jsx)("p",{className:"xp",children:"XP: "+e.xp+"/"+e.maxXp})]}),t&&(0,f.jsx)("button",{className:Rt,onClick:()=>n(a),children:"To Question"})]},a)))})]})},Lt=e=>{const{awardedXp:t,completionText:a}=e,s=a?a.split("\n"):[""];return(0,f.jsxs)("div",{className:"completion",children:[t>0&&(0,f.jsx)("h1",{children:`AWARDED ${t}XP`}),s.map(((e,t)=>(0,f.jsxs)("p",{children:[e,(0,f.jsx)("br",{})]},t)))]})},Ot=({goals:e})=>(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("h1",{className:"progress-header",children:"Progress"}),e.map((e=>(e=>{const{uuid:t,text:a,targetCount:s,count:n,completed:i}=e,r=Math.min(0===s?0:n/s,1);return(0,f.jsxs)("div",{className:"goal",children:[(0,f.jsxs)("div",{className:"goal-badge",children:[(0,f.jsx)("span",{className:"goal-icon"}),(0,f.jsxs)("p",{children:[n," / ",s]})]}),(0,f.jsxs)("div",{className:"goal-progress",children:[(0,f.jsx)("p",{children:a}),(0,f.jsx)(bt.k,{animate:!1,className:"progress",intent:i?"success":void 0,stripes:!1,value:r})]})]},t)})(e)))]}),_t=({focusUuid:e,userState:t})=>{var a;const s=Number.isNaN(+e)||0===+e?void 0:+e;let n;if(t){const[e]=t;n=null===e||void 0===e?void 0:e.courseRegId}const i=(0,C.ix)((e=>e.session.courseRegId)),r=void 0!==n&&n!==i,o=(0,d.I0)();(0,c.useEffect)((()=>{o({type:B.pL}),s&&o(r?{type:yt.hc,payload:{assessmentId:s,courseRegId:n}}:{type:yt.cp,payload:{assessmentId:s}})}),[o,s,n,r]);const l=(0,c.useContext)(Ue.gc),h=(0,C.ix)((e=>e.session.assessments)).get(s),u=(null!==(a=(0,C.ix)((e=>e.session.assessmentOverviews)))&&void 0!==a?a:[]).find((e=>e.id===s));if(""===e)return(0,f.jsxs)("div",{className:"no-view",children:[(0,f.jsx)(k.I,{icon:P.d.MOUNTAIN,iconSize:60}),(0,f.jsx)("h2",{children:"Select an achievement"})]});const g=l.getAchievement(e),{deadline:p,title:m,view:x}=g,{coverImage:y,completionText:b,description:v}=x,j=l.getAchievementXp(e),S=l.listGoals(e),I=l.getStatus(e),w=v?v.split("\n"):[""];return(0,f.jsxs)("div",{className:"view",style:{...(0,Ue.wI)(),...(0,Ue.v_)()},children:[(0,f.jsxs)("div",{className:"cover",style:{background:`rgba(0, 0, 0, 0.5) url(${y}) center/cover`,backgroundBlendMode:"darken"},children:[(0,f.jsx)("h1",{children:m.toUpperCase()}),p&&(0,f.jsx)("p",{children:`Deadline: ${(0,rt.ti)(p)}`}),(0,f.jsx)("span",{className:"description",children:w.map(((e,t)=>(0,f.jsxs)("p",{children:[e,(0,f.jsx)("br",{})]},t)))})]}),I===pt.Cv.COMPLETED&&h&&u&&u.isManuallyGraded&&(0,f.jsx)(Dt,{assessment:h,showToQuestion:!r}),S.length>0&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(Ot,{goals:S}),I===pt.Cv.COMPLETED&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("hr",{}),(0,f.jsx)(Lt,{awardedXp:j,completionText:b})]})]})]})};var Gt=a(24976),Bt=a(70816),Ut=a.n(Bt);function Ft(e){return"graded"===e.gradingStatus||!e.isManuallyGraded&&"submitted"===e.status}const zt=function(e,t,a){const s=[...e].sort(((e,t)=>Ut()(e.closeAt).diff(Ut()(t.closeAt)))),n=e.length,i=t.map((e=>e.type)),r=i.map((e=>[]));s.forEach(((e,t)=>{if(!(0,rt.Oe)(new Date(e.openAt))||(0,rt.Bw)(new Date(e.closeAt))&&"submitted"!==e.status)return;const s=e.id.toString();a.hasAchievement(s)||(a.insertFakeGoalDefinition({uuid:s+"0",text:`Submitted ${e.title}`,achievementUuids:[s],meta:{type:pt.lC.ASSESSMENT,assessmentNumber:e.id,requiredCompletionFrac:0}},"submitted"===e.status),e.isManuallyGraded&&a.insertFakeGoalDefinition({uuid:s+"1",text:`Graded ${e.title}`,achievementUuids:[s],meta:{type:pt.lC.ASSESSMENT,assessmentNumber:e.id,requiredCompletionFrac:0}},"graded"===e.gradingStatus),a.insertFakeAchievement({uuid:s,title:e.title,xp:Ft(e)?e.xp:e.maxXp,isVariableXp:!1,deadline:new Date(e.closeAt),release:new Date(e.openAt),isTask:void 0!==e.isPublished&&e.isPublished,position:t-n-100,prerequisiteUuids:[],goalUuids:e.isManuallyGraded?[s+"0",s+"1"]:[s+"0"],cardBackground:`${Ue.Y9}/default.png`,view:{coverImage:e.coverImage,description:e.shortSummary,completionText:`XP: ${e.xp} / ${e.maxXp}`}}),Ft(e)&&i.forEach(((t,a)=>{t===e.type&&r[a].push(s)})))})),r.forEach(((e,t)=>{const s=i[t];e.length>0&&a.insertFakeAchievement({uuid:s,title:"Completed "+s,xp:0,isVariableXp:!1,deadline:void 0,release:void 0,isTask:!0,position:-1-t,prerequisiteUuids:e,goalUuids:[],cardBackground:`${Ue.Y9}/default.png`,view:{coverImage:`${Ue.ej}/default.png`,description:"Your completed "+s+" are listed here!",completionText:""}})}))};var Vt=a(80799);const Ht=(e,t,a)=>e.map((e=>(0,f.jsx)(At,{uuid:e,filterStatus:t,focusState:a},e))),Kt=()=>{const e=(0,c.useState)(void 0),[t]=e,{group:a,name:s,role:n,assessmentOverviews:i,assessmentConfigurations:r}=(0,C.kP)(),{assessmentOverviews:o,users:l}=(0,C.ix)((e=>e.achievement)),h=(0,C.ix)((e=>new Gt.Z(e.achievement.achievements,e.achievement.goals))),g=(0,d.I0)(),{handleFetchAssessmentOverviews:p,handleGetAchievements:m,handleGetGoals:x,handleGetOwnGoals:b,handleGetUserAssessmentOverviews:v,handleGetUsers:j,handleUpdateGoalProgress:S}=(0,c.useMemo)((()=>({handleFetchAssessmentOverviews:()=>g((0,y.fetchAssessmentOverviews)()),handleGetAchievements:()=>g((0,Vt.getAchievements)()),handleGetGoals:e=>g((0,Vt.getGoals)(e)),handleGetOwnGoals:()=>g((0,Vt.getOwnGoals)()),handleGetUserAssessmentOverviews:e=>g((0,Vt.getUserAssessmentOverviews)(e)),handleGetUsers:()=>g((0,Vt.getUsers)()),handleUpdateGoalProgress:(e,t)=>g((0,Vt.updateGoalProgress)(e,t))})),[g]);(0,c.useEffect)((()=>{t?x(t.courseRegId):b(),t?v(t.courseRegId):p(),m()}),[p,m,x,b,v,t]);const I=t?o:i;I&&r&&zt(I,r,h);const k=(0,c.useState)(pt.fS.ALL),[w]=k,A=(0,c.useState)(""),[T,M]=A,E=(0,c.useState)(!1),[N]=E;return(0,c.useEffect)((()=>{M("")}),[t,M]),(0,f.jsx)(Ue.gc.Provider,{value:h,children:(0,f.jsxs)("div",{className:"AchievementDashboard",children:[(0,f.jsx)(Ct,{name:t?t.name||t.username:s||"User",userState:e}),n&&n!==u.uU.Student&&(0,f.jsx)(xt.Z,{userState:e,hiddenState:E,studio:a||"Staff",users:l,getUsers:j,updateGoalProgress:S}),(0,f.jsxs)("div",{className:"achievement-main",children:[(0,f.jsxs)("div",{className:"filter-container",children:[(0,f.jsx)(mt,{filterState:k,icon:P.d.GLOBE,ownStatus:pt.fS.ALL}),(0,f.jsx)(mt,{filterState:k,icon:P.d.LOCATE,ownStatus:pt.fS.ACTIVE}),(0,f.jsx)(mt,{filterState:k,icon:P.d.ENDORSED,ownStatus:pt.fS.COMPLETED})]}),(0,f.jsx)("ul",{className:"task-container",children:Ht(n!==u.uU.Student&&N?h.listAllSortedAchievementUuids():h.listSortedReleasedTaskUuids(),w,A)}),(0,f.jsx)("div",{className:"view-container",children:(0,f.jsx)(_t,{focusUuid:T,userState:e})})]})]})})},$t=({awaitPublish:e,publishChanges:t})=>{const a=(0,c.useContext)(Ue.gc),[s,n]=(0,c.useReducer)((e=>!e),!1),i=(0,c.useState)(""),[r]=i;return(0,f.jsxs)("div",{className:"achievement-preview",children:[(0,f.jsxs)("div",{className:"command",children:[(0,f.jsx)(m.z,{className:"command-button",icon:s&&P.d.ARROW_LEFT,rightIcon:!s&&P.d.ARROW_RIGHT,text:s?"Task":"View",onClick:n}),e&&(0,f.jsx)(m.z,{className:"command-button",icon:P.d.CLOUD_UPLOAD,intent:"primary",text:"Publish Changes",onClick:t})]}),s?(0,f.jsx)("div",{className:"preview-container",children:(0,f.jsx)(_t,{focusUuid:r})}):(0,f.jsx)("ul",{className:"preview-container",children:Ht(a.listSortedTaskUuids(),pt.fS.ALL,i)})]})};let Xt=function(e){return e.CHANGE_META="CHANGE_META",e.CHANGE_TEXT="CHANGE_TEXT",e.DELETE_GOAL="DELETE_GOAL",e.DISCARD_CHANGES="DISCARD_CHANGES",e.SAVE_CHANGES="SAVE_CHANGES",e}({});const Wt=e=>{switch(e){case pt.lC.ASSESSMENT:return{type:pt.lC.ASSESSMENT,assessmentNumber:0,requiredCompletionFrac:0};case pt.lC.BINARY:return{type:pt.lC.BINARY,condition:!1,targetCount:1};case pt.lC.MANUAL:return{type:pt.lC.MANUAL,targetCount:1};case pt.lC.EVENT:return{type:pt.lC.EVENT,eventNames:[pt.tw.RUN_CODE],targetCount:1,release:void 0,deadline:void 0,observeFrom:void 0,observeTo:void 0}}},qt={uuid:"",text:"Goal Text Here",achievementUuids:[],meta:Wt(pt.lC.MANUAL)},Zt=e=>{const{assessmentMeta:t,changeMeta:a}=e,{assessmentNumber:s,requiredCompletionFrac:n}=t;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(E.u,{content:"Assessment Number",children:(0,f.jsx)(Ke.A,{allowNumericCharactersOnly:!0,onValueChange:e=>a({...t,assessmentNumber:e}),placeholder:"Enter assessment number here",value:s})}),(0,f.jsx)(E.u,{content:"Required Completion Percentage",children:(0,f.jsx)(Ke.A,{allowNumericCharactersOnly:!0,max:100,min:0,onValueChange:e=>{const s=e/100;a({...t,requiredCompletionFrac:s})},placeholder:"Enter required completion percentage here",rightElement:(0,f.jsx)("p",{children:"%"}),value:100*n})})]})};function Yt(...e){return{type:"AND",operands:e}}function Jt(...e){return{type:"OR",operands:e}}const Qt=Qe.P.ofType(),ea=(e,{handleClick:t})=>(0,f.jsx)(Ze.s,{onClick:t,text:e},e),ta=e=>{if("object"===typeof e&&"type"in e){const{type:t,operands:a}=e,s=a.length,n=[];for(let e=0;e<s;e++)n.push(ta(a[e])),e!==s-1&&n.push(t);return n.flat()}return[JSON.stringify(e)]},aa=({binaryMeta:e,changeMeta:t})=>{const{condition:a,targetCount:s}=e,n=[],i=[],r=ta(a);for(let l=0;l<r.length;l++)l%2===0?i[i.length]=r[l]:n[n.length]=r[l];const o=()=>{let a=JSON.parse(i[0]);for(let e=1;e<i.length;e++)a="AND"===n[e-1]?Yt(a,JSON.parse(i[e])):Jt(a,JSON.parse(i[e]));t({...e,condition:a})};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(E.u,{content:"Target Count",children:(0,f.jsx)(Ke.A,{allowNumericCharactersOnly:!0,leftIcon:P.d.BANK_ACCOUNT,min:0,onValueChange:a=>t({...e,targetCount:a}),placeholder:"Enter target count here",value:s})}),r.map(((e,t)=>(0,f.jsx)("div",{children:t%2===0?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(E.u,{content:"Condition",children:(0,f.jsx)(He.s,{onChange:e=>((e,t)=>{i[t]=e,o()})(e,t/2),multiline:!0,placeholder:"Enter condition here",value:e})}),i.length>1&&(0,f.jsx)(E.u,{content:"Delete Condition",children:(0,f.jsx)(m.z,{intent:"danger",icon:"trash",onClick:()=>(e=>{for(let t=e;t<i.length-1;t++)i[t]=i[t+1],n[t]=n[t+1];i.length=i.length-1,n.length=n.length-1,o()})(t)})})]}):(0,f.jsx)(E.u,{content:"And/Or",children:(0,f.jsx)(Qt,{filterable:!1,itemRenderer:ea,items:["AND","OR"],onItemSelect:e=>((e,t)=>{n[t]=e,o()})(e,(t-1)/2),children:(0,f.jsx)(m.z,{minimal:!0,outlined:!0,text:e})})})},t))),(0,f.jsx)("br",{}),(0,f.jsx)(m.z,{minimal:!0,outlined:!0,text:"Add Condition",onClick:()=>{n.push("AND"),i.push('{"event":"", "restriction":""}'),o()}})]})},sa=({type:e,date:t,changeDate:a})=>{const[s,n]=(0,c.useState)(!1),i=()=>n(!s),r=void 0===t?`No ${e}`:`${(0,rt.ti)(t)}`;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(E.u,{content:r,children:(0,f.jsx)(m.z,{minimal:!0,onClick:i,outlined:!0,children:`${e}`})}),(0,f.jsxs)(g.V,{isCloseButtonShown:!1,isOpen:s,onClose:i,style:{background:"#fff",maxWidth:"max-content",padding:"0.25em",textAlign:"center"},title:`${e}`,children:[(0,f.jsx)(it.M,{onChange:a,timePickerProps:{showArrowButtons:!0},value:t}),(0,f.jsx)(m.z,{onClick:()=>a(void 0),text:`Remove ${e}`})]})]})};var na=a(57225);const ia=({type:e,time:t,changeTime:a})=>{const[s,n]=(0,c.useState)(!1),i=()=>n(!s),r=void 0===t?`No ${e}`:`${(0,rt.yG)(t)}`;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(E.u,{content:r,children:(0,f.jsx)(m.z,{minimal:!0,onClick:i,outlined:!0,children:`${e}`})}),(0,f.jsxs)(g.V,{isCloseButtonShown:!1,isOpen:s,onClose:i,style:{background:"#fff",maxWidth:"max-content",padding:"0.25em",textAlign:"center"},title:`${e}`,children:[(0,f.jsx)(na.j,{onChange:a,showArrowButtons:!0,value:t}),(0,f.jsx)(m.z,{onClick:()=>a(void 0),text:`Remove ${e}`})]})]})},ra=Qe.P.ofType(),oa=(e,{handleClick:t})=>(0,f.jsx)(Ze.s,{onClick:t,text:e},e),la=({changeMeta:e,eventMeta:t})=>{const{eventNames:a,targetCount:s,release:n,deadline:i,observeFrom:r,observeTo:o}=t,l=s=>n=>((s,n)=>{s===pt.tw.NONE?e({...t,eventNames:a.filter(((e,t)=>t!==n))}):(a[n]=s,e({...t,eventNames:a}))})(n,s);return(0,f.jsxs)(f.Fragment,{children:[a.map(((e,t)=>(0,f.jsx)(E.u,{content:"Change event type "+t,children:(0,f.jsx)(ra,{filterable:!1,items:Object.values(pt.tw),itemRenderer:oa,onItemSelect:l(t),children:(0,f.jsx)(m.z,{outlined:!0,text:e})})},t))),(0,f.jsx)(E.u,{content:"Add Event",children:(0,f.jsx)(m.z,{outlined:!0,text:"Add Event",onClick:()=>{a[a.length]=pt.tw.RUN_CODE,e({...t,eventNames:a})}})}),(0,f.jsx)(E.u,{content:"Target Count",children:(0,f.jsx)(Ke.A,{allowNumericCharactersOnly:!0,leftIcon:P.d.LOCATE,min:0,onValueChange:a=>e({...t,targetCount:a}),placeholder:"Enter target count here",value:s})}),(0,f.jsx)("br",{}),(0,f.jsx)(sa,{type:"Release",date:n,changeDate:a=>{e({...t,release:a})}}),(0,f.jsx)(sa,{type:"Deadline",date:i,changeDate:a=>{e({...t,deadline:a})}}),(0,f.jsx)(ia,{type:"Observe From",time:r,changeTime:a=>{e({...t,observeFrom:a})}}),(0,f.jsx)(ia,{type:"Observe To",time:o,changeTime:a=>{e({...t,observeTo:a})}})]})},ca=({changeMeta:e,manualMeta:t})=>{const{targetCount:a}=t;return(0,f.jsx)(E.u,{content:"Target Count",children:(0,f.jsx)(Ke.A,{allowNumericCharactersOnly:!0,leftIcon:P.d.BANK_ACCOUNT,min:0,onValueChange:a=>e({...t,targetCount:a}),placeholder:"Enter target count here",value:a})})},da=({changeMeta:e,meta:t})=>{const{type:a}=t,s=Qe.P.ofType();return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(E.u,{content:"Change Goal Type",children:(0,f.jsx)(s,{filterable:!1,itemRenderer:(e,{handleClick:t})=>(0,f.jsx)(Ze.s,{onClick:t,text:e},e),items:Object.values(pt.lC),onItemSelect:t=>e(Wt(t)),children:(0,f.jsx)(m.z,{minimal:!0,outlined:!0,text:a})})}),(a=>{switch(a){case pt.lC.ASSESSMENT:return(0,f.jsx)(Zt,{assessmentMeta:t,changeMeta:e});case pt.lC.BINARY:return(0,f.jsx)(aa,{binaryMeta:t,changeMeta:e});case pt.lC.MANUAL:return(0,f.jsx)(ca,{changeMeta:e,manualMeta:t});case pt.lC.EVENT:return(0,f.jsx)(la,{eventMeta:t,changeMeta:e});default:return null}})(a)]})},ha=e=>({editableGoal:e,isDirty:!1}),ua=(e,t)=>{switch(t.type){case Xt.SAVE_CHANGES:return{...e,isDirty:!1};case Xt.DISCARD_CHANGES:return ha(t.payload);case Xt.DELETE_GOAL:return{...e,isDirty:!1};case Xt.CHANGE_META:return{editableGoal:{...e.editableGoal,meta:t.payload},isDirty:!0};case Xt.CHANGE_TEXT:return{editableGoal:{...e.editableGoal,text:t.payload},isDirty:!0};default:return e}},ga=e=>{const{uuid:t,isNewGoal:a,releaseUuid:s,removeCard:n,requestPublish:i}=e,r=(0,c.useContext)(Ue.gc),o=r.getGoalDefinition(t),l=(0,c.useMemo)((()=>(0,N.cloneDeep)(o)),[o]),[d,h]=(0,c.useReducer)(ua,l,ha),[u,g]=(0,c.useState)(a),{editableGoal:p,isDirty:m}=d,{meta:x,text:y}=p;return(0,f.jsxs)("li",{className:"editable-goal",id:t,children:[(0,f.jsx)("div",{className:"action-button",children:m?(0,f.jsx)(We,{discardChanges:()=>h({type:Xt.DISCARD_CHANGES,payload:l}),saveChanges:()=>{h({type:Xt.SAVE_CHANGES}),r.modifyGoalDefinition(p),u&&(s(),g(!1)),i()}}):(0,f.jsx)(Xe,{deleteItem:()=>{h({type:Xt.DELETE_GOAL}),r.removeGoalDefinition(t),u&&(s(),g(!1)),n(t),i()},item:y})}),(0,f.jsx)("h3",{children:(0,f.jsx)(He.s,{onChange:e=>h({type:Xt.CHANGE_TEXT,payload:e}),placeholder:"Enter goal text here",value:y})}),(0,f.jsx)("div",{className:"meta",children:(0,f.jsx)(da,{changeMeta:e=>h({type:Xt.CHANGE_META,payload:e}),meta:x})})]})},pa=({allowNewUuid:e,setNewUuid:t})=>{const a=(0,c.useContext)(Ue.gc);return(0,f.jsx)(m.z,{className:"command-button",disabled:!e,icon:P.d.NEW_OBJECT,onClick:()=>t(a.insertGoalDefinition(qt)),text:"Create Goal"})};let ma=[];const xa=({requestPublish:e})=>{const t=(0,c.useContext)(Ue.gc),[a,s]=(0,c.useState)(""),n=""===a,i=()=>s(""),r=e=>{let t=0;for(;ma[t].key!==e&&t<ma.length;)t++;ma.splice(t,1)},o=(t,a)=>(0,f.jsx)(ga,{uuid:t,isNewGoal:a,releaseUuid:i,requestPublish:e,removeCard:r},t);0===ma.length&&(ma=t.getAllGoalUuids().map((e=>o(e,!1))));return(0,f.jsxs)("div",{className:"goal-editor",children:[(0,f.jsx)("div",{className:"command",children:(0,f.jsx)(pa,{allowNewUuid:n,setNewUuid:e=>{s(e),ma[ma.length]=ma[0],ma[0]=o(e,!0)}})}),(0,f.jsx)("ul",{className:"goal-container",children:ma})]})};var ya=a(68291);const ba=()=>{const e=(0,d.I0)(),{handleBulkUpdateAchievements:t,handleBulkUpdateGoals:a,handleGetAchievements:s,handleGetOwnGoals:n,handleRemoveAchievement:i,handleRemoveGoal:r}=(0,c.useMemo)((()=>({handleBulkUpdateAchievements:t=>e((0,Vt.bulkUpdateAchievements)(t)),handleBulkUpdateGoals:t=>e((0,Vt.bulkUpdateGoals)(t)),handleGetAchievements:()=>e((0,Vt.getAchievements)()),handleGetOwnGoals:()=>e((0,Vt.getOwnGoals)()),handleRemoveAchievement:t=>e((0,Vt.removeAchievement)(t)),handleRemoveGoal:t=>e((0,Vt.removeGoal)(t))})),[e]),o=(0,C.ix)((e=>new Gt.Z(e.achievement.achievements,e.achievement.goals)));(0,c.useEffect)((()=>{s(),n()}),[s,n]);const[l,h]=(0,c.useState)(!1),u=()=>{h(!0),g()},[,g]=(0,c.useReducer)((e=>e+1),0);return(0,f.jsxs)(Ue.gc.Provider,{value:o,children:[(0,f.jsx)(ya.N,{message:"You have unpublished changes. Are you sure you want to leave?",when:l}),(0,f.jsxs)("div",{className:"AchievementControl",children:[(0,f.jsx)($t,{awaitPublish:l,publishChanges:()=>{a(o.getAllGoals()),t(o.getAllAchievements()),o.getGoalsToDelete().forEach(r),o.getAchievementsToDelete().forEach(i),o.resetToDelete(),h(!1)}}),(0,f.jsx)(gt,{requestPublish:u}),(0,f.jsx)(xa,{requestPublish:u})]})]})},fa=()=>{const e=(0,C.ix)((e=>e.session.role)),t=e===u.uU.Admin||e===u.uU.Staff?(0,f.jsx)(ba,{}):(0,f.jsx)(Be.default,{});return(0,f.jsxs)(h.Z5,{children:[(0,f.jsx)(h.AW,{path:"/",element:(0,f.jsx)(Kt,{})}),(0,f.jsx)(h.AW,{path:"control",element:t}),(0,f.jsx)(h.AW,{path:"*",element:(0,f.jsx)(Be.default,{})})]})};var va=a(63370),Ca=a(72321),ja=a(62125),Sa=a(43030),Ia=a(41063),ka=a(94022),wa=a(42171),Aa=a(10930);class Ta extends c.PureComponent{constructor(e){super(e),this.handleSeeked=()=>{this.stopPreviousPlaybackAndApplyFromStart(this.props.playbackData)},this.handleAudioLoaded=()=>{this.props.handleSetSourcecastDuration(this.audio.current.duration)},this.applyDeltas=e=>{this.props.handleSetCodeDeltasToApply(e)},this.stopPreviousPlaybackAndApplyFromStart=e=>{this.setState({currentDeltaRevision:this.state.currentDeltaRevision+1},(()=>this.applyPlaybackDataFromStart(e)))},this.applyPlaybackDataFromStart=async e=>{const t=e=>new Promise((t=>setTimeout(t,e))),a=this.state.currentDeltaRevision;let s=1e3*this.audio.current.currentTime;this.props.handleEditorValueChange(e.init.editorValue),this.props.handleExternalSelect(e.init.externalLibrary),this.props.handleChapterSelect(e.init.chapter);const n=e.inputs.filter((e=>e.time<=s&&"codeDelta"===e.type)).map((e=>e.data));this.applyDeltas(n);const i=e.inputs.filter((e=>e.time>s)),r=i.length;let o=0;for(;o<r&&this.state.currentDeltaRevision===a;)s=1e3*this.audio.current.currentTime,i[o].time<s?(this.props.handleSetInputToApply(i[o]),o++):await t(20)},this.handlePlayerPausing=()=>{this.audio.current.pause(),this.props.handleSetIsEditorReadonly(!1),this.props.handleSetSourcecastStatus(H.PO.paused),this.stopCurrentPlayback()},this.handlePlayerPlaying=()=>{this.audio.current.play(),this.props.handleSetIsEditorReadonly(!0),this.props.handleSetSourcecastStatus(H.PO.playing),this.stopPreviousPlaybackAndApplyFromStart(this.props.playbackData),this.props.setSelectedTab&&this.props.setSelectedTab(ge.B_.mobileEditor)},this.handlePlayerStopping=()=>{this.props.handleSetIsEditorReadonly(!1),this.props.handleSetSourcecastStatus(H.PO.paused),this.props.handleSetCurrentPlayerTime(0),this.setState({currentPlayerProgress:0})},this.updatePlayerTime=e=>{const{currentTime:t}=e.target;this.props.handleSetCurrentPlayerTime(t),this.setState({currentPlayerProgress:t/this.props.duration}),this.props.playbackStatus===H.PO.forcedPaused&&this.handlePlayerPausing()},this.handlePlayerProgressBarChange=e=>{if(this.audio.current){const t=this.props.duration*e;this.audio.current.currentTime=t,this.props.handleSetCurrentPlayerTime(t),this.setState({currentPlayerProgress:e})}},this.renderLabel=e=>{if(this.props.duration){const t=this.props.duration*e,a=Math.floor(t/60),s=Math.floor(t-60*a);return(a<10?"0"+a:a)+":"+(s<10?"0"+s:s)}return"00:00"},this.audio=c.createRef(),this.state={currentDeltaRevision:0,currentPlayerProgress:0,currentSourcecastItem:null,duration:0}}render(){const e=(0,f.jsx)(ee.Z,{label:"Play",icon:P.d.PLAY,onClick:this.handlePlayerPlaying,isDisabled:!this.props.duration}),t=(0,f.jsx)(ee.Z,{label:"Pause",icon:P.d.PAUSE,onClick:this.handlePlayerPausing});return(0,f.jsxs)("div",{className:"SourcecastControlBar",children:[(0,f.jsx)("audio",{src:this.props.audioUrl,ref:this.audio,onEnded:this.handlePlayerStopping,onLoadedMetadata:this.handleAudioLoaded,onSeeked:this.handleSeeked,onTimeUpdate:this.updatePlayerTime,preload:"metadata"}),(0,f.jsx)("br",{}),(0,f.jsxs)("div",{className:"PlayerControl",children:[(0,f.jsxs)(wa.h,{className:"PlayerControlButton",children:[this.props.playbackStatus===H.PO.paused&&e,this.props.playbackStatus===H.PO.playing&&t]}),(0,f.jsx)("div",{className:"Slider",children:(0,f.jsx)(Aa.i,{min:0,max:1,stepSize:1e-4,onChange:this.handlePlayerProgressBarChange,value:this.state.currentPlayerProgress,labelRenderer:this.renderLabel})})]})]})}stopCurrentPlayback(){this.setState({currentDeltaRevision:this.state.currentDeltaRevision+1})}}const Ma=Ta;a(78286);var Pa=a(46150),Ea=a(78720),Na=a(98462);const Ra=e=>{const[t,a]=(0,c.useState)(!1),n=()=>a(!1);return(0,f.jsxs)("div",{children:[(0,f.jsx)(ee.Z,{icon:P.d.TRASH,onClick:()=>a(!0)}),(0,f.jsxs)(g.V,{icon:"info-sign",isOpen:t,onClose:n,title:"Delete Sourcecast",canOutsideClickClose:!0,children:[(0,f.jsx)("div",{className:s.DIALOG_BODY,children:(0,f.jsx)("p",{children:"Are you sure to delete this sourcecast entry?"})}),(0,f.jsx)("div",{className:s.DIALOG_FOOTER,children:(0,f.jsxs)("div",{className:s.DIALOG_FOOTER_ACTIONS,children:[(0,f.jsx)(ee.Z,{label:"Confirm Delete",icon:P.d.TRASH,onClick:()=>{const{data:t}=e;e.handleDeleteSourcecastEntry(t.id)}}),(0,f.jsx)(ee.Z,{label:"Cancel",icon:P.d.CROSS,onClick:n})]})})]})]})},Da=({data:e,handleSetSourcecastData:t})=>(0,f.jsx)(E.u,{content:"Load Sourcecast Recording",children:(0,f.jsx)(ee.Z,{label:`${e.title}`,icon:P.d.PAPERCLIP,onClick:()=>{t(e.title,e.description,e.uid,e.url,JSON.parse(e.playbackData))}})});var La=a(7292),Oa=a(33538);const _a=e=>{const t=(0,c.useRef)(null),[a]=(0,c.useState)(`${window.location.protocol}//${window.location.host}/courses/${e.courseId}/sourcecast/${e.data.uid}`),s=(0,f.jsxs)("div",{children:[(0,f.jsx)("input",{defaultValue:a,readOnly:!0,ref:t}),(0,f.jsx)(E.u,{content:"Copy link to clipboard",children:(0,f.jsx)(Oa,{text:a,children:(0,f.jsx)(ee.Z,{icon:P.d.DUPLICATE,onClick:()=>{null!==t.current&&(t.current.focus(),t.current.select())}})})})]},a);return(0,f.jsx)(La.p,{popoverClassName:"Popover-share",inheritDarkTheme:!1,content:s,children:(0,f.jsx)(E.u,{content:"Get shareable link",children:(0,f.jsx)(ee.Z,{icon:P.d.SHARE})})})};class Ga extends c.Component{constructor(e){super(e),this.handleFilterChange=e=>{const t=e.target.value;this.setState({filterValue:t}),this.gridApi&&this.gridApi.setQuickFilter(t)},this.onGridReady=e=>{this.gridApi=e.api,this.gridApi.sizeColumnsToFit(),window.onresize=()=>this.gridApi.sizeColumnsToFit()},this.state={columnDefs:[{headerName:"Title",field:"title",cellRenderer:Da,cellRendererParams:{handleSetSourcecastData:this.props.handleSetSourcecastData},minWidth:200,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"left"},hide:!this.props.handleSetSourcecastData},{headerName:"Title",field:"title",minWidth:100,suppressMovable:!0,suppressMenu:!0,hide:!!this.props.handleSetSourcecastData},{headerName:"Uploader",field:"uploader.name",minWidth:150,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"center"}},{headerName:"Date",valueGetter:e=>(0,Te.lu)(e.data.inserted_at),minWidth:150,suppressMovable:!0,suppressMenu:!0},{headerName:"Share",field:"uid",cellRenderer:_a,cellRendererParams:{courseId:this.props.courseId},minWidth:80,suppressMovable:!0,suppressMenu:!0},{headerName:"Delete",field:"",cellRenderer:Ra,cellRendererParams:{handleDeleteSourcecastEntry:this.props.handleDeleteSourcecastEntry},minWidth:100,maxWidth:100,sortable:!1,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"center"},hide:!this.props.handleDeleteSourcecastEntry},{headerName:"description",field:"description",hide:!0},{headerName:"inserted_at",field:"inserted_at",hide:!0},{headerName:"updated_at",field:"updated_at",hide:!0},{headerName:"audio",field:"audio",hide:!0},{headerName:"playbackData",field:"playbackData",hide:!0},{headerName:"url",field:"url",hide:!0}],filterValue:"",groupFilterEnabled:!1},this.defaultColumnDefs={filter:!0,resizable:!0,sortable:!0}}render(){const e=(0,f.jsx)(i.t,{className:"Sourcecast",description:"Fetching sourcecast index...",icon:(0,f.jsx)(r.$,{size:r.E.LARGE})}),t=(0,N.sortBy)(this.props.sourcecastIndex,[e=>-e.id]),a=(0,f.jsxs)("div",{className:"SourcecastContainer",children:[(0,f.jsx)("br",{}),(0,f.jsx)("div",{children:(0,f.jsx)(Pa.c,{label:"",labelFor:"text-input",children:(0,f.jsx)(Ea.B,{id:"searchBar",large:!1,leftIcon:"search",placeholder:"Search",value:this.state.filterValue,onChange:this.handleFilterChange})})}),(0,f.jsx)(Ae.i,{}),(0,f.jsx)("div",{className:"SourcecastTable",children:(0,f.jsx)("div",{className:"ag-grid-parent",children:(0,f.jsx)(Na.AgGridReact,{domLayout:"autoHeight",columnDefs:this.state.columnDefs,defaultColDef:this.defaultColumnDefs,onGridReady:this.onGridReady,rowData:t,rowHeight:30,pagination:!1,paginationPageSize:50})})}),(0,f.jsx)("br",{})]});return(0,f.jsx)("div",{children:void 0===this.props.sourcecastIndex?e:a})}}const Ba=Ga,Ua="sourcecast",Fa="Welcome to Sourcecast!",za=()=>{const{isMobileBreakpoint:e}=(0,C.Fs)(),t=(0,h.UO)(),{audioUrl:a,currentPlayerTime:n,codeDeltasToApply:i,title:r,description:o,externalLibrary:u,isEditorAutorun:g,isEditorReadonly:m,inputToApply:x,isRunning:y,isDebugging:b,output:v,playbackDuration:j,playbackData:S,playbackStatus:I,replValue:k,sourcecastIndex:w,context:{chapter:A,variant:T},uid:M,isFolderModeEnabled:E,activeEditorTabIndex:N,editorTabs:R}=(0,C.ix)((e=>e.workspaces[Ua])),D=(0,C.ix)((e=>e.session.courseId)),L=(0,d.I0)(),{handleFetchSourcecastIndex:O,handleChapterSelect:G,handleEditorEval:B,handleEditorValueChange:U,handleExternalSelect:F,handleReplEval:z,handleSetSourcecastData:V,handleSetSourcecastStatus:W,handleReplOutputClear:q,handleSideContentHeightChange:Z}=(0,c.useMemo)((()=>({handleFetchSourcecastIndex:()=>L((0,Ca.fetchSourcecastIndex)(Ua)),handleChapterSelect:e=>L((0,ke.chapterSelect)(e,_.Variant.DEFAULT,Ua)),handleEditorEval:()=>L((0,ke.evalEditor)(Ua)),handleEditorValueChange:e=>L((0,ke.updateEditorValue)(Ua,0,e)),handleExternalSelect:e=>L((0,ke.externalLibrarySelect)(e,Ua)),handleReplEval:()=>L((0,ke.evalRepl)(Ua)),handleSetSourcecastData:(e,t,a,s,n)=>L((0,ja.setSourcecastData)(e,t,a,s,n,Ua)),handleSetSourcecastStatus:e=>L((0,ja.setSourcecastStatus)(e,Ua)),handleReplOutputClear:()=>L((0,ke.clearReplOutput)(Ua)),handleSideContentHeightChange:e=>L((0,ve.changeSideContentHeight)(e,Ua))})),[L]),{selectedTab:Y,setSelectedTab:J}=(0,Ce.__)(Ua,ge.B_.introduction),Q=()=>{const e=t.sourcecastId;if(e&&e!==M&&w){const t=w.find((t=>t.uid===e));t&&V(t.title,t.description,t.uid,t.url,JSON.parse(t.playbackData))}};(0,c.useEffect)((()=>{O()}),[]),(0,c.useEffect)((()=>{if(Q(),x)switch(x.type){case"activeTabChange":J(x.data);break;case"chapterSelect":G(x.data);break;case"externalLibrarySelect":F(x.data);break;case"forcePause":W(H.PO.forcedPaused)}}),[Q,x]),(0,c.useEffect)((()=>{e||Y!==ge.B_.mobileEditor&&Y!==ge.B_.mobileEditorRun||J(ge.B_.introduction)}),[e,Y,J]);const ee=(0,c.useMemo)((()=>({handleDebuggerPause:()=>L((0,va.beginDebuggerPause)(Ua)),handleDebuggerReset:()=>L((0,va.debuggerReset)(Ua)),handleDebuggerResume:()=>L((0,va.debuggerResume)(Ua)),handleInterruptEval:()=>L((0,va.beginInterruptExecution)(Ua)),handleToggleEditorAutorun:()=>L((0,ke.toggleEditorAutorun)(Ua))})),[L]),ae=(0,f.jsx)(Sa.k,{handleDebuggerPause:ee.handleDebuggerPause,handleDebuggerReset:ee.handleDebuggerReset,handleDebuggerResume:ee.handleDebuggerResume,handleEditorEval:B,handleInterruptEval:ee.handleInterruptEval,handleToggleEditorAutorun:ee.handleToggleEditorAutorun,isEntrypointFileDefined:null!==N,isDebugging:b,isEditorAutorun:g,isRunning:y},"autorun"),ne=(0,f.jsx)(K.b,{handleChapterSelect:({chapter:e},t)=>G(e),isFolderModeEnabled:E,sourceChapter:A,sourceVariant:T},"chapter"),ie=(0,f.jsx)($._,{handleReplOutputClear:q},"clear_repl"),re=(0,f.jsx)(X.e,{handleReplEval:z,isRunning:y},"eval_repl"),oe=(0,ka.Z)(Ua),le=(0,Ia.Z)(Ua),ce=[{label:"Sourcecast Table",iconName:P.d.HOME,body:(0,f.jsxs)("div",{children:[(0,f.jsx)("span",{className:"Multi-line",children:(0,f.jsx)(p.SU,{children:r?"Title: "+r+"\nDescription: "+o:Fa})}),(0,f.jsx)(Ba,{handleSetSourcecastData:V,sourcecastIndex:w,courseId:D})]}),id:ge.B_.introduction},oe,le],de=(e,t,a)=>{e!==t&&J(e)},he=(0,c.useMemo)((()=>({handleDeclarationNavigate:e=>L((0,ke.navigateToDeclaration)(Ua,e)),handleEditorUpdateBreakpoints:e=>L((0,ke.setEditorBreakpoint)(Ua,0,e)),setActiveEditorTabIndex:e=>L((0,ke.updateActiveEditorTabIndex)(Ua,e)),removeEditorTabByIndex:e=>L((0,ke.removeEditorTab)(Ua,e))})),[L]),ue={editorVariant:"sourcecast",isFolderModeEnabled:E,activeEditorTabIndex:N,setActiveEditorTabIndex:he.setActiveEditorTabIndex,removeEditorTabByIndex:he.removeEditorTabByIndex,editorTabs:R.map(te.F),codeDeltasToApply:i,isEditorReadonly:m,editorSessionId:"",handleDeclarationNavigate:he.handleDeclarationNavigate,handleEditorEval:B,handleEditorValueChange:U,isEditorAutorun:g,inputToApply:x,isPlaying:I===H.PO.playing,handleEditorUpdateBreakpoints:he.handleEditorUpdateBreakpoints},pe=(0,c.useMemo)((()=>({handleBrowseHistoryDown:()=>L((0,ke.browseReplHistoryDown)(Ua)),handleBrowseHistoryUp:()=>L((0,ke.browseReplHistoryUp)(Ua)),handleReplValueChange:e=>L((0,ke.updateReplValue)(e,Ua))})),[L]),me={output:v,replValue:k,handleBrowseHistoryDown:pe.handleBrowseHistoryDown,handleBrowseHistoryUp:pe.handleBrowseHistoryUp,handleReplEval:z,handleReplValueChange:pe.handleReplValueChange,sourceChapter:A,sourceVariant:T,externalLibrary:u,replButtons:[re,ie]},xe={tabs:[]},ye={controlBarProps:{editorButtons:[ae,ne]},editorContainerProps:ue,handleSideContentHeightChange:Z,replProps:me,sideBarProps:xe,sideContentProps:{selectedTabId:Y,onChange:de,tabs:{beforeDynamicTabs:ce,afterDynamicTabs:[]},workspaceLocation:Ua}},be={editorContainerProps:ue,replProps:me,sideBarProps:xe,mobileSideContentProps:{mobileControlBarProps:{editorButtons:[ae,ne]},selectedTabId:Y,onChange:de,tabs:{beforeDynamicTabs:ce,afterDynamicTabs:[]},workspaceLocation:Ua}},fe=(0,c.useMemo)((()=>({handlePromptAutocomplete:(e,t,a)=>L((0,ke.promptAutocomplete)(Ua,e,t,a)),handleSetCurrentPlayerTime:e=>L((0,ja.setCurrentPlayerTime)(e,Ua)),handleSetCodeDeltasToApply:e=>L((0,ja.setCodeDeltasToApply)(e,Ua)),handleSetIsEditorReadonly:e=>L((0,ke.setIsEditorReadonly)(Ua,e)),handleSetInputToApply:e=>L((0,ja.setInputToApply)(e,Ua)),handleSetSourcecastDuration:e=>L((0,ja.setSourcecastDuration)(e,Ua))})),[L]),je={handleEditorValueChange:U,handlePromptAutocomplete:fe.handlePromptAutocomplete,handleSetCurrentPlayerTime:fe.handleSetCurrentPlayerTime,handleSetCodeDeltasToApply:fe.handleSetCodeDeltasToApply,handleSetIsEditorReadonly:fe.handleSetIsEditorReadonly,handleSetInputToApply:fe.handleSetInputToApply,handleSetSourcecastDuration:fe.handleSetSourcecastDuration,handleSetSourcecastStatus:W,audioUrl:a,currentPlayerTime:n,duration:j,playbackData:S,playbackStatus:I,handleChapterSelect:G,handleExternalSelect:F,setSelectedTab:J};return(0,f.jsxs)("div",{className:l()("Sourcecast",s.DARK),children:[(0,f.jsx)(Ma,{...je}),e?(0,f.jsx)(se.Z,{...be}):(0,f.jsx)(Ie.Z,{...ye})]})};a(58511);var Va=a(80553),Ha=a(80025),Ka=a(63145),$a=a(69378),Xa=a(794),Wa=a(32230),qa=a(8499);const Za=e=>{const[t,a]=c.useState([]),[s,n]=c.useState(""),i=c.useRef(),{CSVReader:r}=(0,qa.ds)(),o=(0,f.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,f.jsx)(Na.AgGridReact,{domLayout:"autoHeight",columnDefs:[{headerName:"Name",field:"name"},{headerName:"Username",field:"username"},{headerName:"Role",field:"role"}],defaultColDef:{filter:!0,resizable:!0,sortable:!0},onGridReady:e=>{i.current=e.api},onGridSizeChanged:()=>{var e;return null===(e=i.current)||void 0===e?void 0:e.sizeColumnsToFit()},rowData:t,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,pagination:!0})}),l=[...b.Z.authProviders.entries()].map((([e,t])=>e)),[d,h]=c.useState(l[0]);return(0,f.jsxs)("div",{className:"add-users",children:[(0,f.jsx)(p.H2,{children:"Add Stories Users"}),o,(0,f.jsx)(p.H4,{children:"Upload a CSV file to mass insert or update users in your course."}),(0,f.jsx)("div",{className:"upload-container",children:(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{className:"upload-settings",children:[(0,f.jsx)("div",{className:"file-input",children:(0,f.jsx)(r,{onUploadAccepted:e=>(e=>{const{data:s,errors:i}=e;if(i.length)return void n("Error detected while uploading the CSV file! Please recheck the file and try again.");const r=[...t];if(s.length+t.length>1e3)n("Please limit each upload to 1000 entries!");else{for(let e=0;e<s.length;e++){if(3!==s[e].length)return void n((0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{children:["Invalid format (line ",e,")! Please ensure that the name, username and role is specified for each row entry!"]}),(0,f.jsx)("br",{}),(0,f.jsxs)("div",{children:["Format: ",(0,f.jsx)("i",{children:"name,username,role"})]}),(0,f.jsx)("br",{}),(0,f.jsx)("div",{children:"(please hover over the question mark above for more details)"})]}));if(!Object.values(u.xo).includes(s[e][2]))return void n(`Invalid role (line ${e})! Please ensure that the third column of each entry contains one of the following: 'member, moderator, admin'`)}s.forEach((e=>{r.push({name:e[0],username:e[1],role:e[2]})})),(0,N.uniqBy)(r,(e=>e.username)).length===r.length?(a(r),n("")):n("There are duplicate usernames in the uploaded CSV(s)!")}})(e),config:{delimiter:",",skipEmptyLines:!0},children:({getRootProps:e,acceptedFile:t,ProgressBar:a,getRemoveFileProps:s})=>(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)($a.S,{text:"Upload CSV",inputProps:e()}),(0,f.jsx)(La.p,{content:(0,f.jsxs)("div",{children:[(0,f.jsxs)("p",{children:[(0,f.jsx)("u",{children:"CSV Format"}),": \xa0",(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"name,username,role"})})]}),(0,f.jsxs)("p",{children:[(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"name"})}),": the name of the user"]}),(0,f.jsxs)("p",{children:[(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"username"})}),": username of the user in the corresponding authentication"]}),(0,f.jsxs)("p",{children:[(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"role"})}),": the role of the user ",(0,f.jsx)("i",{children:"(member | moderator | admin)"})]}),(0,f.jsx)("p",{children:"\xa0"}),(0,f.jsx)("p",{children:(0,f.jsx)("u",{children:"Examples:"})}),(0,f.jsx)("p",{children:(0,f.jsx)("i",{children:"(Luminus): \xa0 Wei Kai,e1234567,member"})}),(0,f.jsx)("p",{children:(0,f.jsx)("i",{children:"(Google): \xa0 Timothy,learner@gmail.com,moderator"})}),(0,f.jsx)("p",{children:(0,f.jsx)("i",{children:"(GitHub): \xa0 Mingkai,ghusername,admin"})})]}),interactionKind:"hover",position:M.Ly.TOP,popoverClassName:"file-input-popover",children:(0,f.jsx)(k.I,{icon:P.d.HELP,className:"file-input-icon"})})]})})}),(0,f.jsx)(Pa.c,{className:"html-select",label:(0,f.jsxs)("div",{className:"html-select-label",children:[(0,f.jsx)("div",{children:"Authentication Provider"}),(0,f.jsx)(La.p,{content:"The authentication provider your learners will use to log in with",interactionKind:"hover-target",position:M.Ly.TOP,popoverClassName:"html-select-popover",children:(0,f.jsx)(k.I,{icon:P.d.HELP,className:"html-select-label-icon"})})]}),inline:!0,children:(0,f.jsx)(Xa.L,{options:l,value:d,onChange:e=>h(e.target.value)})})]}),s&&(0,f.jsx)(Wa.U,{intent:x.S.DANGER,title:"Invalid CSV file provided!",children:s})]})}),(0,f.jsx)(m.z,{className:"add-button",text:"Add Stories Users",intent:0===t.length?x.S.NONE:x.S.WARNING,onClick:()=>{e.handleAddNewUsersToCourse(t,d),a([]),h(l[0])}})]})},Ya=e=>{const[t,a]=c.useState([]),[s,n]=c.useState(""),i=c.useRef(),{CSVReader:r}=(0,qa.ds)(),o=(0,f.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,f.jsx)(Na.AgGridReact,{domLayout:"autoHeight",columnDefs:[{headerName:"Username",field:"username"},{headerName:"Role",field:"role"},{headerName:"Group",field:"group"}],defaultColDef:{filter:!0,resizable:!0,sortable:!0},onGridReady:e=>{i.current=e.api},onGridSizeChanged:()=>{var e;return null===(e=i.current)||void 0===e?void 0:e.sizeColumnsToFit()},rowData:t,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,pagination:!0})}),l=[...b.Z.authProviders.entries()].map((([e,t])=>e)),[d,h]=c.useState(l[0]);return(0,f.jsxs)("div",{className:"add-users",children:[(0,f.jsx)(p.H2,{children:"Add Users"}),o,(0,f.jsx)(p.H4,{children:"Upload a CSV file to mass insert or update users in your course."}),(0,f.jsx)("div",{className:"upload-container",children:(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{className:"upload-settings",children:[(0,f.jsx)("div",{className:"file-input",children:(0,f.jsx)(r,{onUploadAccepted:e=>(e=>{const{data:s,errors:i}=e;if(i.length)return void n("Error detected while uploading the CSV file! Please recheck the file and try again.");const r=[...t];if(s.length+t.length>1e3)n("Please limit each upload to 1000 entries!");else{for(let e=0;e<s.length;e++){if(2!==s[e].length&&3!==s[e].length)return void n((0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{children:["Invalid format (line ",e,")! Please ensure that the username and role is specified for each row entry!"]}),(0,f.jsx)("br",{}),(0,f.jsxs)("div",{children:["Format: ",(0,f.jsx)("i",{children:"username,role"})," ",(0,f.jsx)("b",{children:"OR"})," ",(0,f.jsx)("i",{children:"username,role,group"})]}),(0,f.jsx)("br",{}),(0,f.jsx)("div",{children:"(please hover over the question mark above for more details)"})]}));if(!Object.values(u.uU).includes(s[e][1]))return void n(`Invalid role (line ${e})! Please ensure that the second column of each entry contains one of the following: 'admin, staff, student'`)}s.forEach((e=>{r.push({username:e[0],role:e[1],group:e[2]})})),(0,N.uniqBy)(r,(e=>e.username)).length===r.length?(a(r),n("")):n("There are duplicate usernames in the uploaded CSV(s)!")}})(e),config:{delimiter:",",skipEmptyLines:!0},children:({getRootProps:e,acceptedFile:t,ProgressBar:a,getRemoveFileProps:s})=>(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)($a.S,{text:"Upload CSV",inputProps:e()}),(0,f.jsx)(La.p,{content:(0,f.jsxs)("div",{children:[(0,f.jsxs)("p",{children:[(0,f.jsx)("u",{children:"CSV Format"}),": \xa0",(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"username,role"})}),"\xa0\xa0OR\xa0\xa0",(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"username,role,group"})})]}),(0,f.jsxs)("p",{children:[(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"username"})}),": the username of the learner in the corresponding authentication provider"]}),(0,f.jsxs)("p",{children:[(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"role"})}),": the role of the learner in this course"," ",(0,f.jsx)("i",{children:"(admin | staff | student)"})]}),(0,f.jsxs)("p",{children:[(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"group (optional)"})}),": the group name that the learner belongs to in this course"]}),(0,f.jsx)("p",{children:(0,f.jsx)("i",{children:"(*Note that staff or admin will automatically be assigned as group leader and each group"})}),(0,f.jsx)("p",{children:(0,f.jsx)("i",{children:"can only have one leader. If there are duplicates the latest entry will take effect)"})}),(0,f.jsx)("p",{children:"\xa0"}),(0,f.jsx)("p",{children:(0,f.jsx)("u",{children:"Examples:"})}),(0,f.jsx)("p",{children:(0,f.jsx)("i",{children:"(Luminus): \xa0e1234567,student \xa0\u2022\xa0 e1234567,student,Group1"})}),(0,f.jsx)("p",{children:(0,f.jsx)("i",{children:"(Google): \xa0learner@gmail.com,staff \xa0\u2022\xa0 learner@gmail.com,staff,Group1"})}),(0,f.jsx)("p",{children:(0,f.jsx)("i",{children:"(GitHub): \xa0ghusername,admin \xa0\u2022\xa0 ghusername,admin,Group1"})})]}),interactionKind:"hover",position:M.Ly.TOP,popoverClassName:"file-input-popover",children:(0,f.jsx)(k.I,{icon:P.d.HELP,className:"file-input-icon"})})]})})}),(0,f.jsx)(Pa.c,{className:"html-select",label:(0,f.jsxs)("div",{className:"html-select-label",children:[(0,f.jsx)("div",{children:"Authentication Provider"}),(0,f.jsx)(La.p,{content:"The authentication provider your learners will use to log in with",interactionKind:"hover-target",position:M.Ly.TOP,popoverClassName:"html-select-popover",children:(0,f.jsx)(k.I,{icon:P.d.HELP,className:"html-select-label-icon"})})]}),inline:!0,children:(0,f.jsx)(Xa.L,{options:l,value:d,onChange:e=>h(e.target.value)})})]}),s&&(0,f.jsx)(Wa.U,{intent:x.S.DANGER,title:"Invalid CSV file provided!",children:s})]})}),(0,f.jsx)(m.z,{className:"add-button",text:"Add Users",intent:0===t.length?x.S.NONE:x.S.WARNING,onClick:()=>{e.handleAddNewUsersToCourse(t,d),a([]),h(l[0])}})]})},Ja=e=>{const{data:t}=e,a=t[e.field],s=c.useCallback((()=>{e.setStateHandler(e.rowIndex,!a)}),[e,a]);return(0,f.jsx)(qe.rs,{checked:a,onChange:s})},Qa=({data:e,rowIndex:t,deleteRowHandler:a})=>{const[s,n]=(0,c.useState)(!1),i=(0,c.useCallback)((()=>{a(t),n(!1)}),[a,t]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(m.z,{icon:P.d.CROSS,onClick:()=>{n(!0)}}),(0,f.jsxs)(g.V,{icon:P.d.WARNING_SIGN,isOpen:s,onClose:()=>n(!1),title:"Warning",children:[(0,f.jsxs)(A.a,{children:[(0,f.jsxs)("p",{children:["Are you sure you want to ",(0,f.jsx)("b",{children:"delete"})," the assessment type ",(0,f.jsx)("i",{children:e.type}),"?"]}),(0,f.jsx)("p",{children:(0,f.jsx)("b",{children:"All related assessments, submissions and answers will be deleted as well upon clicking the main save button."})})]}),(0,f.jsx)(T.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(ee.Z,{label:"Cancel",icon:P.d.CROSS,onClick:()=>n(!1),options:{minimal:!1}}),(0,f.jsx)(ee.Z,{label:"Ok",icon:P.d.TICK,onClick:i,options:{minimal:!1,intent:x.S.WARNING}})]})})]})]})},es=e=>{const{data:t}=e,a=c.useCallback((t=>{e.setStateHandler(e.rowIndex,t)}),[e]);return(0,f.jsx)(Ke.A,{value:t[e.field],min:0,clampValueOnBlur:!0,onValueChange:a})};function ts(e,t){for(let a=0;a<e.length;a++)if((0,N.isEqual)(e[a],t))return a;return-1}const as=e=>{const{assessmentConfig:t,setAssessmentConfig:a,setAssessmentConfigsToDelete:s}=e,n=c.useRef(),i=[{headerName:"Assessment Type",field:"type",rowDrag:!0,editable:!0},{headerName:"Is Manually Graded",field:"isManuallyGraded",cellRenderer:Ja,cellRendererParams:{setStateHandler:(e,s)=>{var i,r;const o=[...t.current];o[e]={...o[e],isManuallyGraded:s},a(o),null===(i=n.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(e))||void 0===r||r.setDataValue("isManuallyGraded",s)},field:"isManuallyGraded"}},{headerName:"Display in Dashboard",field:"displayInDashboard",cellRenderer:Ja,cellRendererParams:{setStateHandler:(e,s)=>{var i,r;const o=[...t.current];o[e]={...o[e],displayInDashboard:s},a(o),null===(i=n.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(e))||void 0===r||r.setDataValue("displayInDashboard",s)},field:"displayInDashboard"}},{headerName:"Has Token Counter",field:"hasTokenCounter",cellRenderer:Ja,cellRendererParams:{setStateHandler:(e,s)=>{var i,r;const o=[...t.current];o[e]={...o[e],hasTokenCounter:s},a(o),null===(i=n.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(e))||void 0===r||r.setDataValue("hasTokenCounter",s)},field:"hasTokenCounter"}},{headerName:"Max Bonus XP",field:"earlySubmissionXp",cellRenderer:es,cellRendererParams:{setStateHandler:(e,s)=>{var i,r;const o=[...t.current];o[e]={...o[e],earlySubmissionXp:s},a(o),null===(i=n.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(e))||void 0===r||r.setDataValue("earlySubmissionXp",s)},field:"earlySubmissionXp"}},{headerName:"Early Hours Before Decay",field:"hoursBeforeEarlyXpDecay",cellRenderer:es,cellRendererParams:{setStateHandler:(e,s)=>{var i,r;const o=[...t.current];o[e]={...o[e],hoursBeforeEarlyXpDecay:s},a(o),null===(i=n.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(e))||void 0===r||r.setDataValue("hoursBeforeEarlyXpDecay",s)},field:"hoursBeforeEarlyXpDecay"}},{headerName:"Delete Row",field:"placeholderToPreventColumnRerender",cellRenderer:Qa,cellRendererParams:{deleteRowHandler:e=>{var i;if(t.current.length<=1)return void(0,U.N9)("You must have at least 1 assessment type!");const r=[...t.current],o=r.splice(e,1);null===(i=n.current)||void 0===i||i.setRowData(r),a(r),s(o[0])}},maxWidth:120,resizable:!1}],r=c.useCallback((e=>{const a=e.node,s=e.overNode;if(a!==s){const e=a.data,n=null===s||void 0===s?void 0:s.data,i=ts(t.current,e),r=ts(t.current,n),o=[...t.current];!function(e,t,a){const s=e[t];e.splice(t,1),e.splice(a,0,s)}(o,i,r),t.current=o}}),[t]),o=a=>{var s;null===(s=n.current)||void 0===s||s.setRowData(t.current),e.setHasChangesAssessmentConfig(!0)},l=(0,f.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,f.jsx)(Na.AgGridReact,{domLayout:"autoHeight",columnDefs:i,defaultColDef:{filter:!1,resizable:!0,sortable:!1},onGridReady:e=>{n.current=e.api,e.api.sizeColumnsToFit()},onGridSizeChanged:()=>{var e;return null===(e=n.current)||void 0===e?void 0:e.sizeColumnsToFit()},rowData:e.assessmentConfig.current,rowHeight:36,rowDragManaged:!0,suppressCellFocus:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0,onRowDragMove:r,onRowDragLeave:o,onRowDragEnd:o,onCellValueChanged:a=>{if("type"===a.colDef.field){const s=[...t.current];s[a.rowIndex]={...s[a.rowIndex],type:a.value},t.current=s,e.setHasChangesAssessmentConfig(!0)}}})});return(0,f.jsxs)("div",{className:"assessment-configuration",children:[(0,f.jsxs)("div",{className:"assessment-configuration-header-container",children:[(0,f.jsx)(p.H2,{children:"Assessment Configuration"}),(0,f.jsx)(m.z,{text:"Add Row",onClick:()=>{var e;if(t.current.length>=8)return void(0,U.N9)("You can have at most 8 assessment types!");const s=[...t.current];s.push({assessmentConfigId:-1,type:"untitled",isManuallyGraded:!0,displayInDashboard:!0,hoursBeforeEarlyXpDecay:0,hasTokenCounter:!1,earlySubmissionXp:0}),a(s),null===(e=n.current)||void 0===e||e.setRowData(s)},className:"add-row-button"})]}),l]})};var ss=a(23957);const ns=e=>{const[t,a]=c.useState(),s=e.data[e.field];s.sort(((e,t)=>e.minutes-t.minutes));const n=e=>e.minutes>=60?Math.round(e.minutes/60*100)/100+" hour(s)":`${e.minutes} minute(s)`,i=s.filter((e=>e.isDefault));1===i.length&&(t&&t.id===i[0].id||a(i[0]));return(0,f.jsx)(Qe.P,{filterable:!1,items:s,itemRenderer:(e,{handleClick:t,handleFocus:a,modifiers:s,query:i})=>(0,f.jsx)(Ze.s,{active:s.active,disabled:s.disabled,onClick:t,onFocus:a,roleStructure:"listoption",text:n(e)},e.id+""+e.minutes),onItemSelect:t=>{a(t);const n=s.map((e=>({...e,isDefault:e.id===t.id&&e.minutes===t.minutes})));e.setStateHandler(e.rowIndex,n)},noResults:(0,f.jsx)(Ze.s,{disabled:!0,text:"No results.",roleStructure:"listoption"}),children:(0,f.jsx)(m.z,{text:t?n(t):"Choose default",rightIcon:"caret-down"})})};var is=a(24527);const rs=e=>{const t=e.data[e.field],[a,s]=(0,c.useState)(t.map((e=>(e.minutes/60).toFixed(2).toString())));return(0,f.jsx)(is.E,{values:a,onRemove:(n,i)=>{s(a.filter((e=>e!==n))),e.setDelete(t[i]),e.setStateHandler(e.rowIndex,t.filter(((e,t)=>t!==i)))},onAdd:n=>{if(function(e){const a=parseFloat(e),s=60*a;return!!(0,N.isInteger)(s)&&!t.some((e=>e.minutes===s))&&!isNaN(a)&&isFinite(a)&&a>=0}(n)){const i={id:-1,minutes:60*parseFloat(n),isDefault:!1};s([...a,n]),e.setStateHandler(e.rowIndex,[...t,i])}}})},os=()=>{const e=c.useRef(),t=(0,d.I0)(),a=(0,C.ix)((e=>e.session)),s=c.useRef(a.notificationConfigs),[n,i]=(0,c.useState)([]),[r,o]=(0,c.useState)(!1),l=e=>{s.current=e,o(!0)};(0,c.useEffect)((()=>{t((0,y.fetchNotificationConfigs)())}),[t]),(0,c.useEffect)((()=>{s.current=(0,N.cloneDeep)(a.notificationConfigs)}),[a]);const h=(t,a)=>{var n,i,r;const c=[...null!==(n=s.current)&&void 0!==n?n:[]];c[t]={...c[t],timeOptions:a},l(c),null===(i=e.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(t))||void 0===r||r.setDataValue("timeOptions",a),o(!0)},u=[{headerName:"Notification Type",field:"notificationType.name",rowDrag:!0},{headerName:"Assessment Type",field:"assessmentConfig.type",valueFormatter:e=>{var t;return(null===(t=e.data.assessmentConfig)||void 0===t?void 0:t.type)||"-"}},{headerName:"Recipients",field:"notificationType.forStaff",valueFormatter:e=>e.data.notificationType.forStaff?"Staff":"Student"},{headerName:"Reminder Time Options (hours)",field:"timeOptions",cellRenderer:rs,cellRendererParams:{setStateHandler:h,setDelete:e=>{if(-1!==e.id){const t=[...n];t.push(e),i(t)}},field:"timeOptions"}},{headerName:"Default Reminder (hours)",field:"timeOptions",cellRenderer:ns,cellRendererParams:{setStateHandler:h,field:"timeOptions"}},{headerName:"Enabled",field:"isEnabled",cellRenderer:Ja,cellRendererParams:{setStateHandler:(t,a)=>{var n,i,r;const c=[...null!==(n=s.current)&&void 0!==n?n:[]];c[t]={...c[t],isEnabled:a},l(c),null===(i=e.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(t))||void 0===r||r.setDataValue("isEnabled",a),o(!0)},field:"isEnabled"}}],g=(0,f.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,f.jsx)(Na.AgGridReact,{domLayout:"autoHeight",columnDefs:u,defaultColDef:{filter:!1,resizable:!0,sortable:!1},onGridReady:t=>{e.current=t.api,t.api.sizeColumnsToFit()},onGridSizeChanged:()=>{var t;return null===(t=e.current)||void 0===t?void 0:t.sizeColumnsToFit()},rowData:s.current,rowHeight:36,rowDragManaged:!0,suppressCellFocus:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0})});return(0,f.jsxs)("div",{className:"assessment-configuration",children:[(0,f.jsx)("div",{className:"assessment-configuration-header-container",children:(0,f.jsx)(p.H2,{children:"Notification Configuration"})}),g,(0,f.jsx)(m.z,{text:"Save",style:{marginTop:"15px"},intent:r?x.S.WARNING:x.S.NONE,onClick:()=>{if(r){var e,a;o(!1);const r=[];null===(e=s.current)||void 0===e||e.forEach((e=>{const t=e.timeOptions.map((t=>({...t,notificationConfigId:e.id})));r.push(...t)})),r.length>0&&t((0,y.updateTimeOptions)(r)),n.length>0&&(t((0,y.deleteTimeOptions)(n.map((e=>e.id)))),i([])),t((0,y.updateNotificationConfigs)(null!==(a=s.current)&&void 0!==a?a:[]))}}})]})},ls=e=>{const{data:t}=e,a=c.useCallback((a=>{e.handleUpdateUserRole(t.courseRegId,a.target.value)}),[t,e]),s=[{label:"Student",value:u.uU.Student},{label:"Staff",value:u.uU.Staff},{label:"Admin",value:u.uU.Admin}];return(0,f.jsx)(La.p,{content:"You cannot downgrade yourself from an admin role!",interactionKind:"click",position:M.Ly.TOP,disabled:e.courseRegId!==t.courseRegId,children:(0,f.jsx)(Xa.L,{options:s,onChange:a,fill:!0,minimal:!0,style:{textAlign:"center"},value:t.role,disabled:e.courseRegId===t.courseRegId})})},cs=({data:e,handleDeleteUserFromCourse:t})=>{const[a,s]=(0,c.useState)(!1),n=(0,c.useCallback)((()=>{t(e.courseRegId),s(!1)}),[e.courseRegId,t]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(La.p,{content:"You cannot delete an admin!",interactionKind:"click",position:M.Ly.TOP,disabled:e.role!==u.uU.Admin,children:(0,f.jsx)(m.z,{text:"Delete User",icon:P.d.CROSS,onClick:()=>{e.role!==u.uU.Admin?s(!0):(0,U.N9)("You cannot delete an admin user!")},disabled:e.role===u.uU.Admin})}),(0,f.jsxs)(g.V,{icon:P.d.WARNING_SIGN,isOpen:a,onClose:()=>s(!1),title:"Deleting User From Course",canOutsideClickClose:!0,children:[(0,f.jsxs)(A.a,{children:[(0,f.jsxs)("p",{children:["Are you sure you want to ",(0,f.jsx)("b",{children:"delete"})," the user"," ",(0,f.jsxs)("i",{children:[e.name," (",e.username,")"]}),"?"]}),(0,f.jsx)("p",{children:(0,f.jsx)("b",{children:"All their assessment answers will be deleted as well."})})]}),(0,f.jsx)(T.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(ee.Z,{label:"Cancel",icon:P.d.CROSS,onClick:()=>s(!1),options:{minimal:!1}}),(0,f.jsx)(ee.Z,{label:"Confirm",icon:P.d.TRASH,onClick:n,options:{minimal:!1,intent:x.S.DANGER}})]})})]})]})},ds=e=>{var t;const a=c.useRef(),s=null===(t=e.userCourseRegistrations)||void 0===t?void 0:t.map((e=>e.name?e:{...e,name:"(user has yet to log in)"})),n=[{headerName:"Name",field:"name",sort:"asc"},{headerName:"Username",field:"username"},{headerName:"Group",field:"group"},{headerName:"Role",field:"role",cellRenderer:ls,cellRendererParams:{courseRegId:e.courseRegId,handleUpdateUserRole:e.handleUpdateUserRole},width:110},{headerName:"Actions",field:"actions",cellRenderer:cs,cellRendererParams:{handleDeleteUserFromCourse:e.handleDeleteUserFromCourse},width:120,filter:!1,resizable:!1}],i=(0,f.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,f.jsx)(Na.AgGridReact,{domLayout:"autoHeight",columnDefs:n,defaultColDef:{filter:!0,resizable:!0,sortable:!0},onGridReady:e=>{a.current=e.api},onGridSizeChanged:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.sizeColumnsToFit()},rowData:s,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,pagination:!0})});return(0,f.jsxs)("div",{className:"users-configuration",children:[(0,f.jsxs)("div",{className:"users-header-container",children:[(0,f.jsx)(p.H2,{children:"Users"}),(0,f.jsx)(m.z,{text:"Export as CSV",className:"export-csv-button",onClick:()=>{a.current&&a.current.exportDataAsCsv({fileName:`SA Users (${(new Date).toISOString()}).csv`,columnKeys:["name","username","group","role"]})}})]}),i]})},hs=()=>{const[e,t]=c.useState(!1),[a,s]=c.useState(!1),[n,i]=c.useState({courseName:"",courseShortName:"",viewable:!0,enableGame:!0,enableAchievements:!0,enableSourcecast:!0,enableStories:!1,moduleHelpText:""}),r=(0,d.I0)(),o=(0,C.ix)((e=>e.session)),l=c.useRef(o.assessmentConfigurations),[h,u]=c.useState([]);c.useEffect((()=>{r((0,y.fetchCourseConfig)()),r((0,y.fetchAssessmentConfigs)()),r((0,y.fetchAdminPanelCourseRegistrations)()),r((0,y.fetchNotificationConfigs)())}),[r]),c.useEffect((()=>{i({courseName:o.courseName,courseShortName:o.courseShortName,viewable:o.viewable,enableGame:o.enableGame,enableAchievements:o.enableAchievements,enableSourcecast:o.enableSourcecast,enableStories:o.enableStories,moduleHelpText:o.moduleHelpText}),l.current=(0,N.cloneDeep)(o.assessmentConfigurations)}),[o]);const g={courseConfiguration:n,setCourseConfiguration:e=>{i(e),t(!0)}},b=c.useMemo((()=>({assessmentConfig:l,setAssessmentConfig:e=>{l.current=e,s(!0)},setAssessmentConfigsToDelete:e=>{if(-1!==e.assessmentConfigId){const t=[...h];t.push(e),u(t)}},setHasChangesAssessmentConfig:s})),[h]),v={courseRegId:o.courseRegId,userCourseRegistrations:o.userCourseRegistrations,handleUpdateUserRole:(e,t)=>r((0,y.updateUserRole)(e,t)),handleDeleteUserFromCourse:e=>r((0,y.deleteUserCourseRegistration)(e))},j={handleAddNewUsersToCourse:(e,t)=>r((0,Ka.addNewUsersToCourse)(e,t))},S={handleAddNewUsersToCourse:(e,t)=>r((0,Ka.addNewStoriesUsersToCourse)(e,t))},I=(0,f.jsxs)("div",{className:"admin-panel",children:[(0,f.jsx)(p.H1,{children:"Admin Panel"}),(0,f.jsxs)(Va.mQ,{id:"admin-panel",renderActiveTabPanelOnly:!0,children:[(0,f.jsx)(Ha.O,{id:"configuration",title:"Configuration",panel:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(ss.Z,{...g}),(0,f.jsx)(Ae.i,{}),(0,f.jsx)(as,{...b}),(0,f.jsx)(m.z,{text:"Save",style:{marginTop:"15px"},intent:e||a?x.S.WARNING:x.S.NONE,onClick:()=>{e&&(r((0,y.updateCourseConfig)(n)),t(!1)),h.length>0&&(h.forEach((e=>{r((0,y.deleteAssessmentConfig)(e))})),u([])),a&&(r((0,y.setAssessmentConfigurations)([])),r((0,y.updateAssessmentConfigs)(l.current)),s(!1))}})]})}),(0,f.jsx)(Ha.O,{id:"users",title:"Users",panel:(0,f.jsx)(ds,{...v})}),(0,f.jsx)(Ha.O,{id:"add-users",title:"Add Users",panel:(0,f.jsx)(Ya,{...j})}),(0,f.jsx)(Ha.O,{id:"add-stories-users",title:"Add Stories Users",panel:(0,f.jsx)(Za,{...S})}),(0,f.jsx)(Ha.O,{id:"notification-config",title:"Notifications",panel:(0,f.jsx)(os,{})})]})]});return(0,f.jsx)(Ne.Z,{loadContentDispatch:()=>{},display:I,fullWidth:!1})};var us=a(37599);const gs={filter:!0,resizable:!0,sortable:!0},ps=e=>{const t=(0,d.I0)(),a=(0,C.ix)((e=>e.dashboard.gradingSummary));let s;const n=a.cols.map((e=>({headerName:(0,N.startCase)(e),field:e}))),i=(0,f.jsx)("div",{className:"Dashboard",children:(0,f.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,f.jsx)(Na.AgGridReact,{domLayout:"autoHeight",columnDefs:n,defaultColDef:gs,onGridReady:e=>{s=e.api},onGridSizeChanged:()=>{s&&s.sizeColumnsToFit()},rowData:a.rows,rowHeight:30,suppressCellFocus:!0,suppressMovableColumns:!0})})});return(0,f.jsx)("div",{children:(0,f.jsx)(Ne.Z,{display:i,loadContentDispatch:()=>t((0,us.fetchGroupGradingSummary)())})})};var ms=a(61805);const xs={zektonFont:{key:"zekton",pngPath:"../../assets/zekton.png",fntPath:"../../assets/zekton.fnt"},zektonDarkFont:{key:"zektonDark",pngPath:"../../assets/zekton_dark.png",fntPath:"../../assets/zekton.fnt"},alienCowsFont:{key:"alienAndCows",pngPath:"../../assets/alien_and_cows.png",fntPath:"../../assets/alien_and_cows.fnt"},alienLeagueFont:{key:"alienLeague",pngPath:"../../assets/alien_league.png",fntPath:"../../assets/alien_league.fnt"},pixelFont:{key:"pixel",pngPath:"../../assets/pixel.png",fntPath:"../../assets/pixel.fnt"}},ys={assetsFolder:b.y.sourceAcademyAssets,fadeDuration:600,nullFunction:()=>{},nullInteractionId:"",nullSequenceNumber:-1,popUpDuration:1e3,defaultAssetPath:"/ui/wristDeviceButton.png",defaultFontStyle:{key:xs.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},defaultCursor:""},bs={x:1920,y:1080},fs={x:bs.x/2,y:bs.y/2},vs={navy:"#03092c",lightBlue:"#ece1fb",offWhite:"#bbc1c9",white:"#ffffff",darkGrey:"#333333",lightGrey:"#555555",blue:"#1133ff",darkBlue:"#0d2440",orange:"#ff9933",yellow:"#ffee33",red:"0#ff0000",maroon:"#142B2E",black:"#000000",purple:"#dd33dd",paleYellow:"#f6ffbd"},Cs=N.mapValues(vs,(e=>parseInt(e.slice(1),16)));let js=function(e){return e.Row="Row",e.Column="Column",e}({});function Ss({direction:e=js.Row,numOfItems:t,maxXSpace:a=bs.x,maxYSpace:s=bs.y,numItemLimit:n=0,redistributeLast:i=!0}){let r=n||t;const o=Math.ceil(t/r);return N.times(t,(n=>{const l=n%r,c=Math.floor(n/r);return i&&c===o-1&&(r=t%o||r),e===js.Row?[Is(bs.x,a,l,r),Is(bs.y,s,c,o)]:[Is(bs.x,a,c,o),Is(bs.y,s,l,r)]}))}function Is(e,t,a,s){const n=t/s;return(e-t+n)/2+n*a}function ks({numOfItems:e,xSpacing:t=30,ySpacing:a=30}){const s=new Array;for(let n=0;n<e;n++)s.push([n*t,n*a]);return s}const ws={fontFamily:"Verdana",fontSize:"15px",fill:vs.lightBlue,align:"left",wordWrap:{width:290}};class As extends Phaser.GameObjects.Container{constructor(e,t,a,s,n=300){super(e,t,a),this.renderTextHover(s,n)}renderTextHover(e,t){const a=parseInt(ws.fontSize.substring(0,ws.fontSize.length-2)),s=e.length*a*.75,n=Math.min(s,t),i=new Phaser.GameObjects.Text(this.scene,30,10,e,{...ws,wordWrap:{width:n-10}}),r=new Phaser.GameObjects.Rectangle(this.scene,20,0,n,i.getBounds().bottom+10,Cs.darkBlue).setOrigin(0,0).setAlpha(.8);this.add([r,i]),this.setDepth(1),this.setVisible(!1)}}const Ts=As,Ms=(e,t,{x:a,y:s,oriX:n,oriY:i},r)=>new Phaser.GameObjects.BitmapText(e,a,s,r.key,t,r.size,r.align).setOrigin(n,i),Ps={key:xs.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},Es={key:xs.alienLeagueFont.key,size:50,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Ns={key:xs.zektonFont.key,size:18,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},Rs={fontFamily:"Verdana",fontSize:"18px",fill:vs.lightBlue,align:"center",lineSpacing:10,wordWrap:{width:500}},Ds={id:"default-award",assetKey:ys.nullInteractionId,assetPath:ys.nullInteractionId,title:ys.nullInteractionId,description:"There is no asset associated with this award.",completed:!1},Ls="Asset key can be used to include the asset into your room by using 'create_award' function.",Os=.3*-bs.x,_s=.05*-bs.y,Gs=_s+275,Bs={arrow:{x:.08*bs.x,y:.34*bs.y,xOffset:80,xScale:.4,yScale:.3},itemsPerPage:7,list:{yStart:.31*-bs.y,ySpace:100},listTextConfig:{x:.09*-bs.x,y:0,oriX:0,oriY:.55},noPreviewTextConfig:{x:Os,y:-40,oriX:.5,oriY:.5},preview:{descText:{yOffset:320},rect:{dim:430,x:Os,y:_s,xOffset:30,yOffset:15},key:{x:Os,y:Gs,width:430,height:35},keyTagTextConfig:{x:Os-205,y:Gs,oriX:0,oriY:.5},keyTextConfig:{x:Os-90,y:Gs,oriX:0,oriY:.5},explanation:{x:Os-150,y:_s+200},titleTextConfig:{x:Os+20,y:_s-275,oriX:.5,oriY:.5}}},Us=e=>e.map((e=>Fs(e))),Fs=e=>{const t=vl.getInstance().getAwardsMapping().get(e);return t||{...Ds,title:e}};let zs=function(e){return e.Image="Image",e.Sprite="Sprite",e}({}),Vs=function(e){return e.Background="Background",e.Object="Object",e}({});const Hs={spaceshipBg:{type:zs.Image,key:"spaceship-bg",path:"/locations/spaceshipBackground.png"},saBanner:{type:zs.Image,key:"sa-banner",path:"/ui/sourceAcadBannerOneLine.png"},shortButton:{type:zs.Image,key:"short-button",path:"/ui/shortButton.png"},mediumButton:{type:zs.Image,key:"med-button",path:"/ui/mediumButton.png"},longButton:{type:zs.Image,key:"long-button",path:"/ui/longButton.png"},topButton:{type:zs.Image,key:"top-button",path:"/ui/topButton.png"},speechBox:{type:zs.Image,key:"speechBox",path:"/ui/speechbox.png"},speakerBox:{type:zs.Image,key:"speakerBox",path:"/ui/speakerBox.png"},defaultLocationImg:{type:zs.Image,key:"loc-default",path:"/ui/defaultLocation.jpg"},locationPreviewFrame:{type:zs.Image,key:"loc-preview-frame",path:"/ui/locationPreviewFrame.png"},locationPreviewFill:{type:zs.Image,key:"loc-preview-fill",path:"/ui/locationPreviewFill.png"},talkOptButton:{type:zs.Image,key:"talk-opt-button",path:"/ui/talkOptButton.png"},talkOptCheck:{type:zs.Image,key:"talk-opt-check",path:"/ui/talkOptCheck.png"},modeMenuBanner:{type:zs.Image,key:"mode-banner",path:"/ui/modeMenuBanner.png"},popUpFrame:{type:zs.Image,key:"pop-up-frame",path:"/ui/popUpFrame.png"},mediumBox:{type:zs.Image,key:"medium-box",path:"/ui/mediumBox.png"},diamond:{type:zs.Image,key:"diamond",path:"/ui/zircon.png"},arrow:{type:zs.Image,key:"arrow",path:"/ui/arrow.png"},cookies:{type:zs.Image,key:"cookies",path:"/images/cookies.png"},scrollFrame:{type:zs.Image,key:"scroll-frame",path:"/ui/scrollFrame.png"},messageBar:{type:zs.Image,key:"message-bar",path:"/ui/messageBg.png"},escapeMenuBackground:{type:zs.Image,key:"escape-bg",path:"/ui/escapeMenu.png"},awardsMenu:{type:zs.Image,key:"award-bg",path:"/ui/collectiblesBg.png"},awardsBanner:{type:zs.Image,key:"award-banner",path:"/ui/awardsBanner.png"},awardsPageChosen:{type:zs.Image,key:"award-pg-chosen",path:"/ui/collectiblesPageOptChosen.png"},awardsPage:{type:zs.Image,key:"award-pg-opt",path:"/ui/collectiblesPageOpt.png"},awardsBackground:{type:zs.Image,key:"award-hall-bg",path:"/ui/awardsHall.png"},gear:{type:zs.Image,key:"gear",path:"/ui/settings.png"},journal:{type:zs.Image,key:"journal",path:"/ui/journal.png"},chapterRepeatButton:{type:zs.Image,key:"chapter-repeat",path:"/ui/chapterRepeat.png"},chapterContinueButton:{type:zs.Image,key:"chapter-continue",path:"/ui/chapterContinue.png"},StarGold:{type:zs.Image,key:"StarGold",path:"/ui/StarGold.png"},StarSilver:{type:zs.Image,key:"StarSilver",path:"/ui/StarSilver.png"},StarBronze:{type:zs.Image,key:"StarBronze",path:"/ui/StarBronze.png"},chapterSelectFrame:{type:zs.Image,key:"chapter-select-frame",path:"/ui/chapterSelectionFrame.png"},chapterSelectBorder:{type:zs.Image,key:"chapter-select-border",path:"/ui/chapterSelectionBorder.png"},chapterSelectArrow:{type:zs.Image,key:"chapter-select-arrow",path:"/ui/chapSelectArrow.png"},mainMenuOptBanner:{type:zs.Image,key:"menu-option",path:"/ui/menuOption.png"},settingBanner:{type:zs.Image,key:"settings-bg",path:"/ui/settingsBg.png"},settingOption:{type:zs.Image,key:"settings-opt",path:"/ui/settingsOption.png"},verifiedFrame:{type:zs.Image,key:"verified-frame",path:"/ui/verifiedFrame.png"},sourceCrashedPod:{type:zs.Image,key:"source-crashed-pod",path:"/locations/sourceCrashedPod.png"},squareKeyboardIcon:{type:zs.Image,key:"keyboard-key-square",path:"/ui/keyboardKeyIcon.png"},medKeyboardIcon:{type:zs.Image,key:"keyboard-key-medium",path:"/ui/TabIcon.png"}},Ks={volume:0,ease:"Power2"};let $s=function(e){return e[e.SFX=0]="SFX",e[e.BGM=1]="BGM",e}({});const Xs={buttonHover:{key:"btn-hover",path:"/sfx/buttonHover.mp3",config:{volume:.1},soundType:$s.SFX},buttonClick:{key:"btn-click",path:"/sfx/buttonClick.mp3",config:{volume:.1},soundType:$s.SFX},radioButtonClick:{key:"radio-btn-click",path:"/sfx/radioButtonClick.mp3",config:{volume:.15},soundType:$s.SFX},dialogueAdvance:{key:"dialogue-advance",path:"/sfx/dialogueAdvance.mp3",config:{volume:.3},soundType:$s.SFX},popUpEnter:{key:"pop-up-enter",path:"/sfx/popUpEnter.mp3",config:{volume:.35},soundType:$s.SFX},popUpExit:{key:"pop-up-exit",path:"/sfx/popUpExit.mp3",config:{volume:.35},soundType:$s.SFX},menuEnter:{key:"menu-enter",path:"/sfx/menuEnter.mp3",config:{volume:.5},soundType:$s.SFX},menuExit:{key:"menu-exit",path:"/sfx/menuExit.mp3",config:{volume:.5},soundType:$s.SFX},modeEnter:{key:"mode-enter",path:"/sfx/modeEnter.mp3",config:{volume:.1},soundType:$s.SFX},notifEnter:{key:"notif-enter",path:"/sfx/notifEnter.mp3",config:{volume:.25},soundType:$s.SFX},notifExit:{key:"notif-exit",path:"/sfx/notifExit.mp3",config:{volume:.25},soundType:$s.SFX},radioStatic:{key:"radio-static",path:"/sfx/radioStatic.mp3",config:{volume:.1},soundType:$s.SFX},galacticHarmony:{key:"galactic-harmony",path:"/bgm/GalacticHarmony.mp3",config:{volume:.25,loop:!0},soundType:$s.BGM}};let Ws=function(e){return e[e.Effects=0]="Effects",e[e.Background=1]="Background",e[e.Character=2]="Character",e[e.Speaker=3]="Speaker",e[e.PopUp=4]="PopUp",e[e.Dialogue=5]="Dialogue",e[e.SpeakerBox=6]="SpeakerBox",e[e.UI=7]="UI",e[e.Objects=8]="Objects",e[e.BBox=9]="BBox",e[e.Escape=10]="Escape",e[e.Selector=11]="Selector",e[e.Dashboard=12]="Dashboard",e[e.WorkerMessage=13]="WorkerMessage",e}({});const qs=[Ws.Background,Ws.Selector,Ws.Objects,Ws.BBox,Ws.Character,Ws.Speaker,Ws.PopUp,Ws.Dialogue,Ws.SpeakerBox,Ws.Effects,Ws.Dashboard,Ws.Escape,Ws.UI,Ws.WorkerMessage];var Zs=a(34386);function Ys(e){return new Promise((t=>setTimeout(t,e)))}function Js(e,t,a){return Math.min(Math.max(e,t),a)}function Qs(e,t=!1){return e.startsWith("/")&&(e=e.substr(1)),ys.assetsFolder+(t?an()+e:e)}function en(e,t){if(void 0===e)throw new Error(t||"Object not found");return e}const tn=()=>Zs.h.getState().session.courseId,an=()=>Zs.h.getState().session.assetsPrefix||"",sn=(e,t=ys.fadeDuration)=>({alpha:0,targets:e,duration:t,ease:"Power2"}),nn=(e,t=ys.fadeDuration)=>({alpha:1,targets:e,duration:t,ease:"Power2"});function rn(e,t,{fadeDuration:a}={}){t&&(e.add.tween(sn([t],a||ys.fadeDuration)),setTimeout((()=>t.destroy()),a||ys.fadeDuration))}function on(e){return new Phaser.GameObjects.Rectangle(e,fs.x,fs.y,bs.x,bs.y,0)}function ln(e,t){let a=0;const s=setInterval((()=>{a%2!==0?(t.setAlpha(0),e.tweens.add(nn([t],250))):(t.setAlpha(1),e.tweens.add(sn([t],250))),a++}),500);return function(){a=0,clearInterval(s)}}const cn={y:0,duration:300,ease:"Power2"},dn={y:-bs.y,duration:250,ease:"Power2"},hn=(bs.x,{x:0,duration:500,ease:"Power2"}),un={x:bs.x,duration:500,ease:"Power2"},gn=3e3,pn={x:1900,y:100,oriX:1,oriY:.5},mn={key:xs.zektonDarkFont.key,size:24,align:Phaser.GameObjects.BitmapText.ALIGN_RIGHT},xn=(()=>{let e=Promise.resolve();return(t,a)=>{e=e.then((()=>async function(e,t){const a=new Phaser.GameObjects.Container(e,0,0),s=new Phaser.GameObjects.Sprite(e,bs.x,100,Hs.messageBar.key);s.setScale(-1.5,.8);const n=Ms(e,t,pn,mn);a.add([s,n]),e.getLayerManager().addToLayer(Ws.Effects,a),a.setPosition(bs.x,0),a.setAlpha(0),vl.getInstance().getSoundManager().playSound(Xs.notifEnter.key),e.add.tween({targets:a,alpha:1,...hn}),await Ys(hn.duration+gn),vl.getInstance().getSoundManager().playSound(Xs.notifExit.key),e.add.tween({targets:a,alpha:1,...un}),await Ys(un.duration),rn(e,a,{fadeDuration:ys.fadeDuration})}(t,a)))}})();const yn={prompt:{x:30,y:60,xPad:30,yPad:10},rect:{x:10,y:760,width:bs.x-20},text:{xPad:100,yPad:70},speakerTextConfig:{x:320,y:745,oriX:.5,oriY:.5}},bn={fontFamily:"Verdana",fontSize:"30px",fill:vs.lightBlue,align:"left",lineSpacing:10,wordWrap:{width:yn.rect.width-2*yn.text.xPad-2*yn.rect.x}},fn={key:xs.zektonFont.key,size:36,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},vn=yn;const Cn=function(e,{x:t=0,y:a=0,textStyle:s={},typeWriterInterval:n=1}){const i=new Phaser.GameObjects.Text(e,t,a,"",s);let r,o="",l=0;const c=()=>{r&&clearInterval(r)};return{container:i,changeLine:e=>{e&&(o=e,i.text="",l=0,c(),r=setInterval((()=>{i.text+=o[l++],l===o.length&&clearInterval(r)}),n))},clearTyping:c}};const jn=class{constructor(e){const t=Gn.getInstance().getGameManager();var a;this.dialogueBox=(a=t,new Phaser.GameObjects.Image(a,fs.x,fs.y,Hs.speechBox.key).setAlpha(.9)).setInteractive({useHandCursor:!0,pixelPerfect:!0}),this.typewriter=function(e,t){return Cn(e,{x:vn.rect.x+vn.text.xPad,y:vn.rect.y+vn.text.yPad,textStyle:t})}(t,e),this.blinkingDiamond=this.drawDiamond(t)}getDialogueContainer(){const e=Gn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0);return t.add([this.dialogueBox,this.blinkingDiamond.container,this.typewriter.container]),t}drawDiamond(e){const t=new Phaser.GameObjects.Image(e,bs.x-vn.prompt.x-vn.prompt.xPad,bs.y-vn.prompt.y-vn.prompt.yPad,Hs.diamond.key).setDisplaySize(vn.prompt.x,vn.prompt.y);return{container:t,clearBlink:ln(e,t)}}getDialogueBox(){return this.dialogueBox}destroy(){const e=Gn.getInstance().getGameManager();this.typewriter.clearTyping(),this.blinkingDiamond.clearBlink(),this.getDialogueBox().off(Phaser.Input.Events.GAMEOBJECT_POINTER_UP),rn(e,this.getDialogueContainer())}changeText(e){this.typewriter.changeLine(e)}},Sn={Dashboard:Phaser.Input.Keyboard.KeyCodes.TAB,Menu:Phaser.Input.Keyboard.KeyCodes.ESC,Next:Phaser.Input.Keyboard.KeyCodes.SPACE,Notif:Phaser.Input.Keyboard.KeyCodes.SPACE,Explore:Phaser.Input.Keyboard.KeyCodes.E,Move:Phaser.Input.Keyboard.KeyCodes.V,Talk:Phaser.Input.Keyboard.KeyCodes.T,Options:[Phaser.Input.Keyboard.KeyCodes.ONE,Phaser.Input.Keyboard.KeyCodes.TWO,Phaser.Input.Keyboard.KeyCodes.THREE,Phaser.Input.Keyboard.KeyCodes.FOUR]};const In=class{constructor(e){this.keyboardListeners=[],this.eventListeners=[],this.scene=e}setDefaultCursor(e){this.scene.input.setDefaultCursor(e)}enableMouseInput(e){this.scene.input.mouse.enabled=e}enableKeyboardInput(e){this.scene.input.keyboard.enabled=e}registerKeyboardListener(e,t,a){const s=this.scene.input.keyboard.addKey(e).addListener(t,a);this.keyboardListeners.push(s)}registerEventListener(e,t){const a=this.scene.input.addListener(e,t);this.eventListeners.concat(a)}clearListeners(){this.keyboardListeners.forEach((e=>e.removeAllListeners())),this.eventListeners.forEach((e=>e.removeAllListeners()))}clearKeyboardListeners(e){this.keyboardListeners.forEach((t=>{e.includes(t.keyCode)&&t.removeAllListeners()}))}},kn={key:xs.alienLeagueFont.key,size:100,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},wn={x:fs.x,y:vn.rect.y+2*kn.size,oriX:.5,oriY:.9};const An=1,Tn=.9;function Mn(e,t){return"[ "+e+" ]  "+t}function Pn(e,{assetKey:t,message:a="",textConfig:s={x:0,y:0,oriX:0,oriY:0},bitMapTextStyle:n=ys.defaultFontStyle,onDown:i=ys.nullFunction,onUp:r=ys.nullFunction,onHover:o=ys.nullFunction,onOut:l=ys.nullFunction,onPointerMove:c=ys.nullFunction,onHoverEffect:d=!0,onClickSound:h=Xs.buttonClick.key,onHoverSound:u=Xs.buttonHover.key}){const g=new Phaser.GameObjects.Container(e,0,0),p=new Phaser.GameObjects.Sprite(e,0,0,t);p.setInteractive({pixelPerfect:!0,useHandCursor:!0}),p.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(()=>{vl.getInstance().getSoundManager().playSound(h),r()})),p.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,(()=>{vl.getInstance().getSoundManager().playSound(u),d&&g.setAlpha(An),o()})),p.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,(()=>{d&&g.setAlpha(Tn),l()})),p.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,(()=>{i()})),p.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,((e,t,a)=>{c(e,t,a)}));const m=Ms(e,a,s,n);return g.add([p,m]),d&&g.setAlpha(Tn),g}const En={textPad:20,textConfig:{x:15,y:-15,oriX:.5,oriY:.5},y:100,width:450,yInterval:100},Nn={fontFamily:"Verdana",fontSize:"20px",fill:vs.offWhite,align:"right",lineSpacing:10,wordWrap:{width:En.width-2*En.textPad}},Rn={key:xs.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};async function Dn(e,t,a){const s=new Phaser.GameObjects.Container(e,0,0),n=Math.ceil(a.length/5),i=a.length>5?5:a.length,r=new Phaser.GameObjects.Text(e,bs.x-En.textPad,En.y,t,Nn).setOrigin(1,0),o=new Phaser.GameObjects.Rectangle(e,bs.x,En.y-En.textPad,En.width*n,.5*r.getBounds().bottom+En.textPad,Cs.darkBlue,.8).setOrigin(1,0),l=new Phaser.GameObjects.Rectangle(e,bs.x,En.y-En.textPad,En.width*n,.5*o.getBounds().bottom+(i+.5)*En.yInterval,Cs.lightBlue,.2).setOrigin(1,0);s.add([l,o,r]);const c=ks({numOfItems:a.length,xSpacing:0,ySpacing:En.yInterval});Gn.getInstance().addToLayer(Ws.UI,s);const d=new Promise((t=>{s.add(a.map(((a,i)=>Pn(e,{assetKey:Hs.mediumButton.key,message:a,textConfig:En.textConfig,bitMapTextStyle:Rn,onUp:()=>{s.destroy(),t(i)}}).setPosition(bs.x-En.width/2-En.width*(n-Math.floor(i/5)-1),c[i][1]%(5*En.yInterval)+o.getBounds().bottom+75))))}));s.setPosition(bs.x,0),vl.getInstance().getSoundManager().playSound(Xs.notifEnter.key),e.add.tween({targets:s,alpha:1,...hn}),await Ys(hn.duration);const h=await d;return vl.getInstance().getSoundManager().playSound(Xs.notifExit.key),e.add.tween({targets:s,alpha:1,...un}),await Ys(un.duration),rn(e,s,{fadeDuration:ys.fadeDuration}),h}let Ln=function(e){return e.Move="Move",e.Explore="Explore",e.Talk="Talk",e.Menu="Menu",e.EscapeMenu="EscapeMenu",e.None="None",e.Sequence="Sequence",e.Dashboard="Dashboard",e}({}),On=function(e){return e.EscapeMenu="EscapeMenu",e.Dashboard="Dashboard",e}({});class _n{constructor(){this.getGameManager=()=>en(this.gameManager),this.gameManager=void 0}static getInstance(){return _n.instance||(_n.instance=new _n),_n.instance}setGameManager(e){this.gameManager=e}getCurrLocId(){return this.getGameManager().currentLocationId}getLocationAtId(e){return this.getGameManager().getStateManager().getGameMap().getLocationAtId(e)}async changeLocationTo(e){await this.getGameManager().changeLocationTo(e)}getLocationModes(e){return this.getGameManager().getStateManager().getLocationModes(e)}addLocationMode(e,t){this.getGameManager().getStateManager().addLocationMode(e,t)}removeLocationMode(e,t){this.getGameManager().getStateManager().removeLocationMode(e,t)}hasTriggeredInteraction(e){return this.getGameManager().getStateManager().hasTriggeredInteraction(e)}triggerStateChangeAction(e){this.getGameManager().getStateManager().triggerStateChangeAction(e)}triggerInteraction(e){this.getGameManager().getStateManager().triggerInteraction(e)}watchGameItemType(e,t){this.getGameManager().getStateManager().watchGameItemType(e,t)}getGameMap(){return this.getGameManager().getStateManager().getGameMap()}getGameItemsInLocation(e,t){return this.getGameManager().getStateManager().getGameItemsInLocation(e,t)}addItem(e,t,a){this.getGameManager().getStateManager().addItem(e,t,a)}removeItem(e,t,a){return this.getGameManager().getStateManager().removeItem(e,t,a)}makeObjectGlow(e,t){this.getGameManager().getObjectManager().makeObjectGlow(e,t)}makeObjectBlink(e,t){this.getGameManager().getObjectManager().makeObjectBlink(e,t)}setObjProperty(e,t){this.getGameManager().getStateManager().setObjProperty(e,t)}renderObjectLayerContainer(e){this.getGameManager().getObjectManager().renderObjectsLayerContainer(e)}getAllActivatables(){return[...this.getGameManager().getObjectManager().getActivatables(),...this.getGameManager().getBBoxManager().getActivatables()]}setBBoxProperty(e,t){this.getGameManager().getStateManager().setBBoxProperty(e,t)}renderBBoxLayerContainer(e){this.getGameManager().getBBoxManager().renderBBoxLayerContainer(e)}areAllObjectivesComplete(){return this.getGameManager().getStateManager().areAllObjectivesComplete()}isObjectiveComplete(e){return this.getGameManager().getStateManager().isObjectiveComplete(e)}areObjectivesComplete(e){return this.getGameManager().getStateManager().areObjectivesComplete(e)}completeObjective(e){this.getGameManager().getStateManager().completeObjective(e)}isTaskComplete(e){return this.getGameManager().getStateManager().isTaskComplete(e)}areTasksComplete(e){return this.getGameManager().getStateManager().areTasksComplete(e)}completeTask(e){this.getGameManager().getStateManager().completeTask(e),xn(this.getGameManager(),"Task completed!")}showTask(e){this.getGameManager().getStateManager().showTask(e),xn(this.getGameManager(),"New task added")}getAllVisibleTaskData(){return this.getGameManager().getStateManager().getAllVisibleTaskData()}addCollectible(e){vl.getInstance().getUserStateManager().addCollectible(e)}async isInUserState(e,t){return vl.getInstance().getUserStateManager().isInUserState(e,t)}clearSeveralLayers(e){this.getGameManager().getLayerManager().clearSeveralLayers(e)}addToLayer(e,t){this.getGameManager().getLayerManager().addToLayer(e,t)}showLayer(e){this.getGameManager().getLayerManager().showLayer(e)}hideLayer(e){this.getGameManager().getLayerManager().hideLayer(e)}async fadeInLayer(e,t){await this.getGameManager().getLayerManager().fadeInLayer(e,t)}async fadeOutLayer(e,t){await this.getGameManager().getLayerManager().fadeOutLayer(e,t)}async bringUpUpdateNotif(e){await async function(e,t){const a=new jn({}),s=a.getDialogueContainer();e.getLayerManager().addToLayer(Ws.Effects,s),e.getLayerManager().fadeInLayer(Ws.Effects);const n=Ms(e,t,wn,kn).setAlpha(0);s.add(n),vl.getInstance().getSoundManager().playSound(Xs.notifEnter.key),e.add.tween(nn([n],2*ys.fadeDuration)),await Ys(2*ys.fadeDuration);const i=new In(e),r=()=>{vl.getInstance().getSoundManager().playSound(Xs.notifExit.key),rn(e,n,{fadeDuration:ys.fadeDuration/4}),a.destroy()},o=new Promise((e=>{i.registerKeyboardListener(Sn.Notif,"up",(async()=>{i.clearKeyboardListeners([Sn.Notif]),r(),e()})),a.getDialogueBox().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(()=>{r(),e()}))}));await o}(this.getGameManager(),e)}async processGameActions(e){await this.getGameManager().getPhaseManager().pushPhase(Ln.Sequence),await this.getGameManager().getActionManager().processGameActions(e),await this.getGameManager().getPhaseManager().popPhase()}async processGameActionsInSamePhase(e){await this.getGameManager().getActionManager().processGameActions(e)}async showDialogue(e){await this.getGameManager().getPhaseManager().pushPhase(Ln.Sequence),await this.getGameManager().getDialogueManager().showDialogue(e),await this.getGameManager().getPhaseManager().popPhase()}async showDialogueInSamePhase(e){await this.getGameManager().getDialogueManager().showDialogue(e)}storeDialogueLine(e,t){this.getGameManager().getDialogueStorageManager().storeLine(e,t)}getDialogueStorage(){return this.getGameManager().getDialogueStorageManager().getDialogueStorage()}async obtainCollectible(e){xn(this.getGameManager(),`Obtained ${Fs(e).title}`),vl.getInstance().getUserStateManager().addCollectible(e)}displayPopUp(e,t,a,s){this.getGameManager().getPopupManager().displayPopUp(e,t,a,s)}destroyAllPopUps(){this.getGameManager().getPopupManager().destroyAllPopUps()}async destroyPopUp(e){this.getGameManager().getPopupManager().destroyPopUp(e)}async saveGame(){await this.getGameManager().getSaveManager().saveGame()}async saveSettings(e){await this.getGameManager().getSaveManager().saveSettings(e)}getLoadedUserState(){return this.getGameManager().getSaveManager().getLoadedUserState()}getSoundManager(){return vl.getInstance().getSoundManager()}playSound(e){vl.getInstance().getSoundManager().playSound(e)}playBgMusic(e){vl.getInstance().getSoundManager().playBgMusic(e)}async stopAllSound(){vl.getInstance().getSoundManager().stopAllSound()}pauseCurrBgMusic(){vl.getInstance().getSoundManager().pauseCurrBgMusic()}continueCurrBgMusic(){vl.getInstance().getSoundManager().continueCurrBgMusic()}applySoundSettings(e){vl.getInstance().getSoundManager().applyUserSettings(e)}loadSounds(e){vl.getInstance().getSoundManager().loadSounds(e)}startAnimation(e,t,a){const s=this.getAssetByKey(this.getGameMap().getAssetKeyFromId(e));this.getGameManager().getAnimationManager().displayAnimation(s,t,a)}stopAnimation(e){const t=this.getAssetByKey(this.getGameMap().getAssetKeyFromId(e));this.getGameManager().getAnimationManager().stopAnimation(t)}setDefaultCursor(e){this.getGameManager().getInputManager().setDefaultCursor(e)}enableKeyboardInput(e){this.getGameManager().getInputManager().enableKeyboardInput(e)}enableMouseInput(e){this.getGameManager().getInputManager().enableMouseInput(e)}enableSprite(e,t){t?this.getGameManager().input.enable(e):this.getGameManager().input.disable(e)}async popPhase(){await this.getGameManager().getPhaseManager().popPhase()}async pushPhase(e){await this.getGameManager().getPhaseManager().pushPhase(e)}async swapPhase(e){await this.getGameManager().getPhaseManager().swapPhase(e)}isCurrentPhase(e){return this.getGameManager().getPhaseManager().isCurrentPhase(e)}renderBackgroundLayerContainer(e){this.getGameManager().getBackgroundManager().renderBackgroundLayerContainer(e)}async promptNavigateToAssessment(e){0===await Dn(_n.getInstance().getGameManager(),"Are you ready for the challenge?",["Yes","No"])&&(window.open(`/courses/${tn()}/missions/${e}/0`,"blank"),window.focus())}async updateAssessmentState(){await vl.getInstance().getUserStateManager().loadAssessments()}createCharacterSprite(e,t,a){return this.getGameManager().getCharacterManager().createCharacterSprite(e,t,a)}moveCharacter(e,t,a){this.getGameManager().getStateManager().moveCharacter(e,t,a)}updateCharacter(e,t){this.getGameManager().getStateManager().updateCharacter(e,t)}getDialogueById(e){return en(this.getGameMap().getDialogueMap().get(e))}getCharacterById(e){return en(this.getGameMap().getCharacterMap().get(e))}getActionById(e){return en(this.getGameMap().getActionMap().get(e))}getObjectById(e){return en(this.getGameMap().getObjectPropMap().get(e))}getBBoxById(e){return en(this.getGameMap().getBBoxPropMap().get(e))}getAssetByKey(e){return this.getGameMap().getAssetByKey(e)}}const Gn=_n;let Bn=function(e){return e.UserState="UserState",e.ChecklistState="ChecklistState",e.TasklistState="TasklistState",e}({}),Un=function(e){return e.collectibles="collectibles",e.assessments="assessments",e.achievements="achievements",e}({});class Fn{static async checkAllConditionsSatisfied(e){return(await Promise.all(e.map((async e=>await this.checkConditionSatisfied(e))))).every((e=>!0===e))}static async checkConditionSatisfied(e){const{state:t,conditionParams:a,boolean:s}=e;switch(t){case Bn.UserState:return await Gn.getInstance().isInUserState(a.userStateType,a.id)===s;case Bn.ChecklistState:return Gn.getInstance().isObjectiveComplete(a.id)===s;case Bn.TasklistState:return Gn.getInstance().isTaskComplete(a.id)===s;default:return!0}}}let zn=function(e){return e.MoveCharacter="MoveCharacter",e.UpdateCharacter="UpdateCharacter",e.ObtainCollectible="ObtainCollectible",e.CompleteObjective="CompleteObjective",e.CompleteTask="CompleteTask",e.ShowTask="ShowTask",e.PreviewLocation="PreviewLocation",e.AddItem="AddItem",e.RemoveItem="RemoveItem",e.ShowDialogue="ShowDialogue",e.ChangeBackground="ChangeBackground",e.StartAnimation="StartAnimation",e.StopAnimation="StopAnimation",e.RemoveLocationMode="RemoveLocationMode",e.AddLocationMode="AddLocationMode",e.AddPopup="AddPopup",e.MakeObjectBlink="MakeObjectBlink",e.MakeObjectGlow="MakeObjectGlow",e.PlayBGM="PlayBGM",e.PlaySFX="PlaySFX",e.ShowObjectLayer="ShowObjectLayer",e.NavigateToAssessment="NavigateToAssessment",e.UpdateAssessmentStatus="UpdateAssessmentStatus",e.Delay="Delay",e}({});class Vn{static async executeGameAction(e,t){const a=Gn.getInstance();switch(e){case zn.AddItem:return void a.addItem(t.gameItemType,t.locationId,t.id);case zn.RemoveItem:return void a.removeItem(t.gameItemType,t.locationId,t.id);case zn.AddLocationMode:return void a.addLocationMode(t.locationId,t.mode);case zn.RemoveLocationMode:return void a.removeLocationMode(t.locationId,t.mode);case zn.MoveCharacter:return void a.moveCharacter(t.id,t.locationId,t.position);case zn.UpdateCharacter:return void a.updateCharacter(t.id,t.expression);case zn.ChangeBackground:return void a.renderBackgroundLayerContainer(t.id);case zn.StartAnimation:return void a.startAnimation(t.id,t.startFrame,t.frameRate);case zn.StopAnimation:return void a.stopAnimation(t.id);case zn.PreviewLocation:return a.renderBackgroundLayerContainer(t.id),a.renderObjectLayerContainer(t.id),void a.renderBBoxLayerContainer(t.id);case zn.ObtainCollectible:return void a.obtainCollectible(t.id);case zn.CompleteObjective:return void a.completeObjective(t.id);case zn.CompleteTask:return void a.completeTask(t.id);case zn.ShowTask:return void a.showTask(t.id);case zn.ShowDialogue:return void(a.isCurrentPhase(Ln.Sequence)?await a.showDialogueInSamePhase(t.id):await a.showDialogue(t.id));case zn.AddPopup:return void await a.displayPopUp(t.id,t.position,t.duration,t.size);case zn.MakeObjectBlink:return void await a.makeObjectBlink(t.id,t.turnOn);case zn.MakeObjectGlow:return void await a.makeObjectGlow(t.id,t.turnOn);case zn.PlayBGM:return void vl.getInstance().getSoundManager().playBgMusic(t.id);case zn.PlaySFX:return void await vl.getInstance().getSoundManager().playSound(t.id);case zn.ShowObjectLayer:return void(t.show?a.showLayer(Ws.Objects):a.hideLayer(Ws.Objects));case zn.NavigateToAssessment:return void await a.promptNavigateToAssessment(t.assessmentId);case zn.UpdateAssessmentStatus:return void await a.updateAssessmentState();case zn.Delay:return void await Ys(t.duration);default:return}}static isStateChangeAction(e){switch(e){case zn.AddItem:case zn.RemoveItem:case zn.AddLocationMode:case zn.RemoveLocationMode:case zn.MoveCharacter:case zn.UpdateCharacter:return!0;case zn.NavigateToAssessment:case zn.UpdateAssessmentStatus:case zn.PreviewLocation:case zn.ChangeBackground:case zn.StartAnimation:case zn.StopAnimation:case zn.ObtainCollectible:case zn.CompleteObjective:case zn.CompleteTask:case zn.ShowTask:case zn.ShowDialogue:case zn.AddPopup:case zn.MakeObjectBlink:case zn.MakeObjectGlow:case zn.PlayBGM:case zn.PlaySFX:case zn.ShowObjectLayer:case zn.Delay:return!1}}}class Hn{async fastForwardGameActions(e){if(e)for(const t of e){const{actionType:e,actionParams:a}=Gn.getInstance().getActionById(t);await Vn.executeGameAction(e,a)}}async processGameActions(e){if(e){for(const t of e)await this.processGameAction(t);await Gn.getInstance().saveGame()}}async processGameAction(e){const{actionType:t,actionParams:a,actionConditions:s,isRepeatable:n,interactionId:i}=Gn.getInstance().getActionById(e);await this.checkCanPlayAction(n,i,s)&&(await Vn.executeGameAction(t,a),Vn.isStateChangeAction(t)&&Gn.getInstance().triggerStateChangeAction(e),Gn.getInstance().triggerInteraction(e))}async checkCanPlayAction(e,t,a){return(e||!Gn.getInstance().hasTriggeredInteraction(t))&&await Fn.checkAllConditionsSatisfied(a)}}let Kn=function(e){return e.navigation="navigation",e.locations="locations",e.talkTopics="talkTopics",e.dialogues="dialogues",e.objects="objects",e.boundingBoxes="boundingBoxes",e.characters="characters",e.actions="actions",e.bgmKey="bgmKey",e.collectibles="collectibles",e}({});class $n{constructor(){this.game=Gn.getInstance().getGameManager(),this.animationInstanceMap=new Map,this.isSprite=e=>e.type===zs.Sprite}createImage(e,t){var a,s,n,i;switch(e.type){case zs.Sprite:return this.createAnimation(e,(null===(a=e.config)||void 0===a?void 0:a.start)||0,(null===(s=e.config)||void 0===s?void 0:s.frameRate)||20),this.getAnimation(e);case zs.Image:return new Phaser.GameObjects.Image(this.game,(null===e||void 0===e||null===(n=e.config)||void 0===n?void 0:n.centreX)||0,(null===e||void 0===e||null===(i=e.config)||void 0===i?void 0:i.centreY)||0,t)}}displayAnimation(e,t,a){var s;const n=Gn.getInstance().getAssetByKey(e.path);switch(n&&n.config&&(n.config.start=t,n.config.frameRate=a),null===(s=n.config)||void 0===s?void 0:s.animType){case Vs.Object:const t=Gn.getInstance().getCurrLocId();Gn.getInstance().addItem(Kn.objects,t,e.key);break;case Vs.Background:Gn.getInstance().renderBackgroundLayerContainer(e.key)}}createAnimation(e,t,a){if(this.isSprite(e)){var s,n,i;this.removeAnimation(e);const r=new Phaser.GameObjects.Sprite(this.game,(null===(s=e.config)||void 0===s?void 0:s.centreX)||0,(null===(n=e.config)||void 0===n?void 0:n.centreY)||0,e.path),o={key:e.path,frames:this.game.anims.generateFrameNumbers(e.path,{start:t,end:(null===(i=e.config)||void 0===i?void 0:i.endFrame)||0,first:0}),frameRate:a,repeat:-1};this.game.anims.create(o),this.animationInstanceMap.set(e.key,r)}}startAnimation(e){if(this.isSprite(e)){const t=this.getAnimation(e);t.play(e.path,!1),this.game.add.existing(t)}}stopAnimation(e){const t=this.animationInstanceMap.get(e.key);this.isSprite(e)&&t&&t.anims&&t.anims.stop()}removeAnimation(e){const t=this.animationInstanceMap.get(e.key);t&&(this.game.anims.remove(e.path),t.destroy(),this.animationInstanceMap.delete(e.key))}getAnimation(e){return en(this.animationInstanceMap.get(e.key),`Image: ${e.path} not found`)}}function Xn(e,t,a){const s=e.displayHeight/e.displayWidth;t?(e.displayWidth=t,e.displayHeight=a||t*s):(e.displayWidth=a/s,e.displayHeight=a)}function Wn(e,t,a){e.displayWidth>e.displayHeight?Xn(e,0,a):Xn(e,t)}function qn(e,t,a){e.displayWidth>e.displayHeight?Xn(e,t):Xn(e,0,a)}const Zn=class{constructor(e,t){this.scene=e,this.awardsGetter=t,this.activePageNumber=0}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0);this.uiContainer=e;const t=Pn(this.scene,{assetKey:Hs.arrow.key,onUp:()=>this.nextPage(!1)}).setScale(Bs.arrow.yScale,Bs.arrow.yScale).setRotation(-90*Math.PI/180).setPosition(Bs.arrow.x-Bs.arrow.xOffset,Bs.arrow.y),a=Pn(this.scene,{assetKey:Hs.arrow.key,onUp:()=>this.nextPage(!0)}).setScale(Bs.arrow.xScale,Bs.arrow.yScale).setRotation(90*Math.PI/180).setPosition(Bs.arrow.x+Bs.arrow.xOffset,Bs.arrow.y);e.add([t,a]);const s=new Phaser.GameObjects.Sprite(this.scene,Bs.preview.rect.x,Bs.preview.rect.y,Hs.popUpFrame.key).setScale(1.2);return e.add(s),e.add(function(e){const t=new Phaser.GameObjects.Container(e,Bs.preview.rect.xOffset,Bs.preview.rect.yOffset),a=Bs.preview.key,s=new Phaser.GameObjects.Rectangle(e,a.x,a.y,a.width,a.height,Cs.lightBlue,.1),n=new Phaser.GameObjects.Rectangle(e,a.x-a.width*s.originX*.75,a.y,a.width/4,a.height,Cs.lightBlue,.2),i=Ms(e,"asset key",Bs.preview.keyTagTextConfig,Ns),r=new Ts(e,Bs.preview.explanation.x,Bs.preview.explanation.y,Ls);return n.setInteractive(),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,(()=>r.setVisible(!0))),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,(()=>r.setVisible(!1))),t.add([s,n,i,r]),t}(this.scene)),this.setPage(),e}setPage(){this.uiContainer&&(this.itemsContainer&&this.itemsContainer.destroy(),this.itemsContainer=this.createItemsContainer(),this.uiContainer.add(this.itemsContainer),this.setPreview())}setPreview(e){if(this.uiContainer){if(this.previewContainer&&this.previewContainer.destroy(),!e)return;let t;if(this.previewContainer=new Phaser.GameObjects.Container(this.scene,Bs.preview.rect.xOffset,Bs.preview.rect.yOffset),e.assetKey===ys.nullInteractionId)t=Ms(this.scene,"No preview available",Bs.noPreviewTextConfig,Ns);else{const a=Bs.preview.rect;t=new Phaser.GameObjects.Sprite(this.scene,0,0,e.assetKey),qn(t,a.dim,a.dim),t.setPosition(a.x,a.y)}const a=Ms(this.scene,e.title,Bs.preview.titleTextConfig,Es),s=new Phaser.GameObjects.Text(this.scene,Bs.preview.rect.x,Bs.preview.rect.y+Bs.preview.descText.yOffset,e.description,Rs).setOrigin(.5,0),n=!1===e.completed?"":e.assetKey,i=Ms(this.scene,n,Bs.preview.keyTextConfig,Ns),r=new Phaser.GameObjects.Rectangle(this.scene,Bs.preview.rect.x,Bs.preview.rect.y,Bs.preview.rect.dim,Bs.preview.rect.dim,0).setAlpha(e.completed?0:.8);this.previewContainer.add([t,r,a,s,i]),this.uiContainer.add(this.previewContainer)}}nextPage(e){const t=this.activePageNumber,a=Js(e?t+1:t-1,0,Number.MAX_SAFE_INTEGER);this.getItems(a).length>0&&(this.activePageNumber=a,this.setPage())}createItemsContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=this.getItems(this.activePageNumber),a=ks({numOfItems:t.length,xSpacing:0,ySpacing:Bs.list.ySpace});return e.add(t.map(((e,t)=>this.createItemButton(e.title,a[t][0],a[t][1]+Bs.list.yStart,(()=>this.setPreview(e)),!1!==e.completed)))),e}createItemButton(e,t,a,s,n){const i=Pn(this.scene,{assetKey:Hs.awardsBanner.key,message:e,textConfig:Bs.listTextConfig,bitMapTextStyle:Ps,onUp:s,onHoverEffect:n}).setPosition(t,a);return n||i.setAlpha(.5),i}getItems(e){const t=this.awardsGetter(),a=Us(t),s=e*Bs.itemsPerPage;return a.slice(s,s+Bs.itemsPerPage)}};class Yn{renderBackgroundLayerContainer(e){const t=Gn.getInstance().getLocationAtId(e).assetKey;this.renderBackgroundImage(t)}renderBackgroundImage(e){Gn.getInstance().clearSeveralLayers([Ws.Background]),this.currentBackground=Gn.getInstance().getAssetByKey(e);const t=Gn.getInstance().getGameManager().getAnimationManager();let a;this.currentBackground&&(a=t.createImage(this.currentBackground,e),t.startAnimation(this.currentBackground),Wn(a,bs.x,bs.y),Gn.getInstance().addToLayer(Ws.Background,a),Gn.getInstance().fadeInLayer(Ws.Background))}}const Jn=class{constructor(){this.bboxes=new Map,Gn.getInstance().watchGameItemType(Kn.boundingBoxes,this)}renderBBoxLayerContainer(e){Gn.getInstance().clearSeveralLayers([Ws.BBox]);const t=Gn.getInstance().getGameItemsInLocation(Kn.boundingBoxes,e);this.bboxes.clear(),t.map((e=>this.handleAdd(e)))}createBBox(e){const t=Gn.getInstance().getGameManager(),{x:a,y:s,width:n,height:i,actionIds:r,interactionId:o}=e,l=new Phaser.GameObjects.Rectangle(t,a,s,n,i,0,0);return e.isInteractive&&l.setInteractive(),{sprite:l,clickArea:l,actionIds:r,interactionId:o}}handleAdd(e){const t=Gn.getInstance().getBBoxById(e),a=this.createBBox(t);return Gn.getInstance().addToLayer(Ws.BBox,a.sprite),this.bboxes.set(e,a),!0}handleMutate(e){return this.handleDelete(e)&&this.handleAdd(e)}handleDelete(e){const t=this.bboxes.get(e);return!!t&&(this.bboxes.delete(e),t.sprite.destroy(),!0)}getActivatables(){return Array.from(this.bboxes.values())}},Qn={charWidth:600,charRect:{x:{Left:350,Middle:fs.x,Right:bs.x-350}}};class ei{constructor(){this.characterSpriteMap=new Map,Gn.getInstance().watchGameItemType(Kn.characters,this)}renderCharacterLayerContainer(e){const t=Gn.getInstance().getGameItemsInLocation(Kn.characters,e);this.characterSpriteMap.clear(),t.map((e=>this.handleAdd(e)))}createCharacterSprite(e,t,a){const s=Gn.getInstance().getCharacterById(e),{defaultPosition:n,defaultExpression:i,expressions:r,scale:o}=s,l=Qn.charRect.x[a||n],c=r.get(t||i),d=new Phaser.GameObjects.Image(Gn.getInstance().getGameManager(),l,bs.y,c).setOrigin(.5,1);return Xn(d,Qn.charWidth*o),d}handleAdd(e){const t=this.createCharacterSprite(e);return Gn.getInstance().addToLayer(Ws.Character,t),this.characterSpriteMap.set(e,t),!0}handleMutate(e){return this.handleDelete(e)&&this.handleAdd(e)}handleDelete(e){const t=this.characterSpriteMap.get(e);return!!t&&(this.characterSpriteMap.delete(e),t.destroy(),!0)}}const ti={key:xs.alienLeagueFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},ai={backButton:{y:.3*bs.y},page:{yStart:.3*-bs.y,ySpace:150},pageTextConfig:{x:.3*bs.x,y:0,oriX:.1,oriY:.5},pageArea:{x:-869,y:-412,width:.72*bs.x,height:.77*bs.y}};let si=function(e){return e.Log="Log",e.Tasks="Tasks",e.Collectibles="Collectibles",e.Achievements="Achievements",e}({});const ni=class{constructor(e,t,a){this.getSoundManager=()=>vl.getInstance().getSoundManager(),this.scene=e,this.pages=t,this.pageManagers=a,this.pageMask=this.createPageMask(),this.pageUIContainers=new Array(t.length),this.currPageIndex=0,this.scene.getPhaseManager().addPhaseToMap(Ln.Dashboard,this)}createPageMask(){const e=new Phaser.GameObjects.Graphics(this.scene),{x:t,y:a,width:s,height:n}=ai.pageArea;return e.fillRect(t,a,s,n),e.createGeometryMask()}setPage(e){if(this.uiContainer){this.pageChosenContainer&&this.pageChosenContainer.destroy();const t=this.pageUIContainers[this.currPageIndex];t&&t.setVisible(!1),this.currPageIndex=e;let a=this.pageUIContainers[this.currPageIndex];a?a.setVisible(!0):(a=this.pageManagers[this.currPageIndex].createUIContainer(),a.setMask(this.pageMask),this.pageUIContainers[this.currPageIndex]=a,this.uiContainer.add(a));const s=this.getPageOptPositions(),n=this.currPageIndex,i=new Phaser.GameObjects.Sprite(this.scene,s[n][0],s[n][1]+ai.page.yStart,Hs.awardsPageChosen.key);this.pageChosenContainer=new Phaser.GameObjects.Container(this.scene,0,0,[i]),this.uiContainer.add(this.pageChosenContainer)}}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=new Phaser.GameObjects.Rectangle(this.scene,0,0,bs.x,4*bs.y,0).setAlpha(.7).setInteractive(),a=new Phaser.GameObjects.Image(this.scene,0,0,Hs.awardsMenu.key);e.add([t,a]);const s=this.pages.map(((e,t)=>({text:e,callback:()=>this.setPage(t)}))),n=this.getPageOptPositions();e.add(s.map(((e,t)=>this.createPageOpt(e.text,n[t][0],n[t][1]+ai.page.yStart,e.callback))));const i=this.createPageOpt("Back",0,ai.backButton.y,(async()=>{this.scene.getPhaseManager().isCurrentPhase(Ln.Dashboard)&&await this.scene.getPhaseManager().popPhase()}));return e.add(i),e}getPageOptPositions(){return ks({numOfItems:Object.keys(si).length,xSpacing:0,ySpacing:ai.page.ySpace})}createPageOpt(e,t,a,s){return Pn(this.scene,{assetKey:Hs.awardsPage.key,message:e,textConfig:ai.pageTextConfig,bitMapTextStyle:ti,onUp:s}).setPosition(t,a)}async activateUI(){this.uiContainer=this.createUIContainer(),this.scene.getLayerManager().addToLayer(Ws.Dashboard,this.uiContainer),this.getSoundManager().playSound(Xs.menuEnter.key),this.setPage(this.currPageIndex),this.uiContainer.setPosition(fs.x,-bs.y),this.pageMask.geometryMask.setPosition(fs.x,-bs.y),this.scene.tweens.add({targets:[this.uiContainer,this.pageMask.geometryMask],...cn,y:fs.y})}async deactivateUI(){this.uiContainer&&(this.pageUIContainers=new Array(this.pages.length),this.uiContainer.setPosition(this.uiContainer.x,this.uiContainer.y),this.getSoundManager().playSound(Xs.menuExit.key),this.scene.tweens.add({targets:[this.uiContainer,this.pageMask.geometryMask],...dn}),await Ys(dn.duration),rn(this.scene,this.uiContainer,{fadeDuration:50}))}};class ii{constructor(e){this.dialogueContent=e,this.currPart=e.keys().next().value,this.currLineNum=0}async generateNextLine(){const e=this.dialogueContent.get(this.currPart)[this.currLineNum];if(!e||!e.line)return{line:""};if(e.goto){let t=e.goto.part;if(await Fn.checkAllConditionsSatisfied(e.goto.conditions)||(t=e.goto.altPart),t){if(!this.dialogueContent.get(t))return{line:""};this.currPart=t,this.currLineNum=0}else this.currLineNum++}else this.currLineNum++;return e}updateCurrPart(e){this.currPart=e,this.currLineNum=0}}let ri=function(e){return e.Left="Left",e.Middle="Middle",e.Right="Right",e}({}),oi=function(e){return e.Small="Small",e.Medium="Medium",e.Large="Large",e}({});class li{static splitToParagraph(e){const t=[];return e.forEach((e=>{if(e.startsWith("\t")||e.startsWith("    ")){const a=e.startsWith("\t")?e.slice(1):e.slice(4);if(0===t.length)return void console.error("Unexpected tabs");t[t.length-1][1].push(a)}else t.push([e.trim(),[]])})),t}static mapByHeader(e,t){const a=new Map;if(!t(e[0]))return a.set("0",e),a;let s="";return e.forEach((e=>{if(t(e))return s=e,void a.set(e,[]);a.get(s).push(e)})),a}static splitWithLimit(e,t,a){if(a>=0){const s=e.split(t),n=s.slice(0,a);return n.push(s.slice(a).join(t)),n.map((e=>e.trim()))}return li.splitByChar(e,t)}static splitByChar(e,t){return e.split(t).map((e=>e.trim()))}static splitToLines(e){return e.split("\n").map((e=>e.trimRight())).filter((e=>""!==e))}static splitToLinesAndRemoveComments(e){return this.removeMultiLineComments(e.split("\n"),"/*","*/").map((e=>this.removeSingleLineComment(e,"//"))).map((e=>e.trimRight())).filter((e=>""!==e))}static removeSingleLineComment(e,t,a=!0){const s=e.indexOf(t);return-1===s?e:a?e.slice(0,s):e.slice(s+t.length)}static removeMultiLineComments(e,t,a){const s=[];let n=!1;for(let i=0;i<e.length;i++){const r=e[i],o=[],l=this.findAllInstances(r,t),c=this.findAllInstances(r,a);let d=-1,h=0,u=0,g=n?[0]:[];for(;h<l.length||u<c.length;){const e=d;d=n?c[u++]+a.length:l[h++],d<=e?(console.error(`Comment mismatch: Line ${i+1},  Pos ${d+1}`),d=e):(g.push(d),n=!n),2===g.length&&(o.push([g[0],g[1]]),g=[])}1===g.length&&o.push([g[0],r.length]),s.push(this.removeCommentRegions(r,o))}return s}static removeCommentRegions(e,t){let a="",s=0;return t.forEach((t=>{a+=e.slice(s,t[0]),s=t[1]})),a+=e.slice(s,e.length),a}static findAllInstances(e,t){const a=[];let s=e.indexOf(t);for(;-1!==s;)a.push(s),s=e.indexOf(t,s+1);return a}static capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}static toCapitalizedWords(e){return(e.match(/[A-Za-z][a-z]*/g)||[]).map(li.capitalize).join(" ")}static toIntString(e){return Math.floor(e).toString()}static isEmptyString(e){return e===ys.nullInteractionId}}class ci{constructor(){this.getUsername=()=>vl.getInstance().getAccountInfo().name}changeSpeakerTo(e){void 0!==e&&(this.currentSpeakerId&&Gn.getInstance().clearSeveralLayers([Ws.Speaker,Ws.SpeakerBox]),this.showNewSpeaker(e))}showNewSpeaker(e){e&&(this.drawSpeakerSprite(e),this.drawSpeakerBox(e.speakerId))}drawSpeakerBox(e){if("narrator"===e)return;const t="you"===e?this.createSpeakerBox(this.getUsername(),ri.Right):this.createSpeakerBox(Gn.getInstance().getCharacterById(e).name,ri.Left);Gn.getInstance().addToLayer(Ws.SpeakerBox,t)}drawSpeakerSprite({speakerId:e,speakerPosition:t,expression:a}){if(this.currentSpeakerId=e,"you"===e||"narrator"===e)return;const s=Gn.getInstance().createCharacterSprite(e,a,t);Gn.getInstance().addToLayer(Ws.Speaker,s)}createSpeakerBox(e,t){const a=Gn.getInstance().getGameManager(),s=new Phaser.GameObjects.Container(a,0,0),n=new Phaser.GameObjects.Image(a,fs.x,fs.y,Hs.speakerBox.key).setAlpha(.8),i=Ms(a,"",vn.speakerTextConfig,fn);return t===ri.Right&&(n.displayWidth*=-1,i.x=bs.x-i.x),s.add([n,i]),i.text=li.capitalize(e),s}}class di{constructor(){this.gameInputManager=new In(Gn.getInstance().getGameManager()),this.getDialogueGenerator=()=>this.dialogueGenerator,this.getDialogueRenderer=()=>this.dialogueRenderer,this.getSpeakerRenderer=()=>this.speakerRenderer,this.getInputManager=()=>this.gameInputManager,this.getUsername=()=>vl.getInstance().getAccountInfo().name}async showDialogue(e){const t=Gn.getInstance().getDialogueById(e);this.dialogueRenderer=new jn(bn),this.dialogueGenerator=new ii(t.content),this.speakerRenderer=new ci,Gn.getInstance().addToLayer(Ws.Dialogue,this.dialogueRenderer.getDialogueContainer()),Gn.getInstance().fadeInLayer(Ws.Dialogue),await new Promise((e=>this.playWholeDialogue(e))),this.getDialogueRenderer().destroy(),this.getSpeakerRenderer().changeSpeakerTo(null)}async playWholeDialogue(e){await this.showNextLine(e),this.getInputManager().registerKeyboardListener(Sn.Next,"up",(async()=>{Gn.getInstance().getGameManager().getPhaseManager().isCurrentPhaseTerminal()||await this.showNextLine(e)})),this.getDialogueRenderer().getDialogueBox().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(async()=>{await this.showNextLine(e)}))}async showNextLine(e){Gn.getInstance().playSound(Xs.dialogueAdvance.key);const{line:t,speakerDetail:a,actionIds:s,prompt:n}=await this.getDialogueGenerator().generateNextLine(),i=t.replace("{name}",this.getUsername());if(this.getDialogueRenderer().changeText(i),this.getSpeakerRenderer().changeSpeakerTo(a),Gn.getInstance().storeDialogueLine(i,a),Gn.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(),!1),n){this.getInputManager().enableKeyboardInput(!1);const e=await Dn(Gn.getInstance().getGameManager(),n.promptTitle,n.choices.map((e=>e[0])));this.getInputManager().enableKeyboardInput(!0),this.getDialogueGenerator().updateCurrPart(n.choices[e][1])}await Gn.getInstance().processGameActionsInSamePhase(s),Gn.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(),!0),t||(this.getInputManager().clearKeyboardListeners([Sn.Next]),e())}}class hi{constructor(){this.getUsername=()=>vl.getInstance().getAccountInfo().name}storeLine(e,t){if(!t)return;this.dialogueStorage||(this.dialogueStorage=new Array);const a={speaker:this.getSpeakerName(t),line:e};this.dialogueStorage.push(a)}getSpeakerName(e){const t=null===e||void 0===e?void 0:e.speakerId;return t?"you"===t?this.getUsername():"narrator"===t?"Narrator":Gn.getInstance().getCharacterById(t).name:""}clearDialogueStorage(){this.dialogueStorage=new Array}getDialogueStorage(){return this.dialogueStorage?this.dialogueStorage.map((e=>`${e.speaker}:\n${e.line}`)):new Array}}const ui=320,gi=50,pi=ui-20,mi=gi-20,xi=fs.x-ui/2,yi=fs.y,bi=xi+10,fi=yi+10;function vi(e){let t,a,s;e.load.on("start",(()=>{s=e.add.existing(on(e)),t=e.add.graphics(),a=e.add.graphics(),a.fillStyle(2236962,.8),a.fillRect(xi,yi,ui,gi)})),e.load.on("progress",(e=>{t.clear(),t.fillStyle(16777215,1),t.fillRect(bi,fi,pi*e,mi)})),e.load.on("complete",(function(){t.destroy(),a.destroy(),s.destroy()}))}class Ci extends Phaser.GameObjects.Container{constructor(e,{choices:t,defaultChoiceIdx:a=0,maxXSpace:s=bs.x,radioChoiceConfig:n={circleDim:20,checkedDim:10,outlineThickness:5},choiceTextConfig:i={x:0,y:0,oriX:.5,oriY:.5},bitmapTextStyle:r=ys.defaultFontStyle},o,l,c=Xs.radioButtonClick.key){super(e,o,l),this.activeChoiceIdx=a,this.choices=t,this.choiceTextConfig=i,this.bitmapTextStyle=r,this.radioChoiceConfig=n,this.buttonClickSoundKey=c;const d=this.getRadioButtons(t);this.buttonPositions=Ss({numOfItems:d.length,maxXSpace:s}),this.renderRadioButtons(d,this.buttonPositions,this.radioChoiceConfig),this.activate(a)}getRadioButtons(e){return e.map(((e,t)=>({text:e,callback:()=>this.activate(t)})))}renderRadioButtons(e,t,a){this.add(e.map(((e,s)=>this.createRadioButton(t[s][0],t[s][1],e.callback,a))))}createRadioButton(e,t,a,s){return new Phaser.GameObjects.Ellipse(this.scene,e,t,s.circleDim,s.circleDim,Cs.lightBlue).setStrokeStyle(s.outlineThickness,Cs.darkBlue).setInteractive({useHandCursor:!0}).addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(()=>{vl.getInstance().getSoundManager().playSound(this.buttonClickSoundKey),a()}))}activate(e){this.activeChoiceIdx=e,this.activeChoice&&this.activeChoice.destroy(),this.activeChoice=new Phaser.GameObjects.Container(this.scene,this.buttonPositions[e][0],this.buttonPositions[e][1]);const t=Ms(this.scene,this.choices[e],this.choiceTextConfig,this.bitmapTextStyle),a=new Phaser.GameObjects.Ellipse(this.scene,0,0,this.radioChoiceConfig.checkedDim,this.radioChoiceConfig.checkedDim,Cs.darkBlue);this.activeChoice.add([t,a]),this.add(this.activeChoice)}getValueIdx(){return this.activeChoiceIdx}getChoices(){return this.choices}getChosenChoice(){return this.activeChoiceIdx<this.choices.length?this.choices[this.activeChoiceIdx]:ys.nullInteractionId}}const ji=Ci,Si={key:xs.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Ii={key:xs.zektonFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},ki={key:xs.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},wi={optHeaderTextConfig:{x:.25*bs.x,y:0,oriX:.5,oriY:.75},opt:{x:140,xSpace:.4*bs.x,ySpace:.7*bs.y},radioButtonsTextConfig:{x:0,y:-50,oriX:.5,oriY:.25},volContainerOpts:["0","0.25","0.5","1.0","1.5","2.0"]},Ai={key:xs.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Ti={key:xs.zektonFont.key,size:20,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Mi={key:xs.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Pi={button:{y:.15*bs.y},escapeOptTextConfig:{x:0,y:0,oriX:.37,oriY:.75},settings:{yOffset:.1*-fs.y,ySpace:.3*bs.y},settingsTextConfig:{x:.38*bs.x,y:.1*-fs.y,oriX:0,oriY:.5},radioButtons:{xSpace:.2*bs.x},radioChoiceTextConfig:{x:0,y:-45,oriX:.5,oriY:.25},volOpt:{x:.05*bs.x}};const Ei=class{constructor(e){this.getSoundManager=()=>vl.getInstance().getSoundManager(),this.getSettingsSaveManager=()=>vl.getInstance().getSaveManager(),this.scene=e,this.scene.getPhaseManager().addPhaseToMap(Ln.EscapeMenu,this)}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=new Phaser.GameObjects.Image(this.scene,fs.x,fs.y,Hs.escapeMenuBackground.key).setDisplaySize(bs.x,bs.y).setInteractive({pixelPerfect:!0});e.add(t);const a=this.getSettings(),s=Ss({direction:js.Column,numOfItems:a.length,maxYSpace:Pi.settings.ySpace});e.add(a.map(((e,t)=>Ms(this.scene,e,{...Pi.settingsTextConfig,y:s[t][1]+Pi.settingsTextConfig.y},Mi))));const{bgmVolume:n,sfxVolume:i}=this.getSettingsSaveManager().getSettings(),r=wi.volContainerOpts.findIndex((e=>parseFloat(e)===i)),o=wi.volContainerOpts.findIndex((e=>parseFloat(e)===n));this.sfxVolumeRadioButtons=this.createSettingsRadioOptions(r,s[0][1]),this.bgmVolumeRadioButtons=this.createSettingsRadioOptions(o,s[1][1]),e.add([this.sfxVolumeRadioButtons,this.bgmVolumeRadioButtons]);const l=this.getOptButtons(),c=Ss({numOfItems:l.length});return e.add(l.map(((e,t)=>this.createEscapeOptButton(e.text,c[t][0],c[t][1]+Pi.button.y,e.callback)))),e}getSettings(){return["SFX","BGM"]}createSettingsRadioOptions(e,t){return new ji(this.scene,{choices:wi.volContainerOpts,defaultChoiceIdx:e,maxXSpace:Pi.radioButtons.xSpace,radioChoiceConfig:{circleDim:15,checkedDim:10,outlineThickness:3},choiceTextConfig:Pi.radioChoiceTextConfig,bitmapTextStyle:Ti},Pi.volOpt.x,-fs.y+t+Pi.settings.yOffset)}getOptButtons(){return[{text:"Main Menu",callback:()=>{this.cleanUp(),vl.getInstance().isGameType(fl.Simulator)?this.scene.scene.start("GameSimulatorMenu"):this.scene.scene.start("MainMenu")}},{text:"Continue",callback:async()=>{this.scene.getPhaseManager().isCurrentPhase(Ln.EscapeMenu)&&await this.scene.getPhaseManager().popPhase()}},{text:"Apply Settings",callback:()=>this.applySettings()}]}createEscapeOptButton(e,t,a,s){return Pn(this.scene,{assetKey:Hs.mediumButton.key,message:e,textConfig:Pi.escapeOptTextConfig,bitMapTextStyle:Ai,onUp:s}).setPosition(t,a)}async applySettings(){const e=this.sfxVolumeRadioButtons?parseFloat(this.sfxVolumeRadioButtons.getChosenChoice()):1,t={bgmVolume:this.bgmVolumeRadioButtons?parseFloat(this.bgmVolumeRadioButtons.getChosenChoice()):1,sfxVolume:e};await this.getSettingsSaveManager().saveSettings(t),vl.getInstance().getSoundManager().applyUserSettings(t)}cleanUp(){this.scene.getInputManager().clearListeners(),this.scene.getLayerManager().clearAllLayers()}activateUI(){const e=this.createUIContainer();this.getSoundManager().playSound(Xs.menuEnter.key),this.scene.getLayerManager().addToLayer(Ws.Escape,e)}deactivateUI(){this.getSoundManager().playSound(Xs.menuExit.key),this.scene.getLayerManager().clearSeveralLayers([Ws.Escape])}};const Ni=class{constructor(e){this.layers=new Map(qs.map((t=>[t,new Phaser.GameObjects.Container(e,0,0)]))),this.layers.forEach((t=>e.add.existing(t)))}getLayer(e){return this.layers.get(e)}hideLayer(e){const t=this.layers.get(e);t&&t.setVisible(!1)&&t.setAlpha(0)}showLayer(e){const t=this.layers.get(e);t&&t.setVisible(!0)&&t.setAlpha(1)}async fadeInLayer(e,t=ys.fadeDuration){const a=Gn.getInstance().getGameManager(),s=this.layers.get(e);s.setVisible(!0),s.setAlpha(0),a.tweens.add(nn([s],t)),await Ys(t)}async fadeOutLayer(e,t=ys.fadeDuration){const a=Gn.getInstance().getGameManager(),s=this.layers.get(e);s.setVisible(!0),s.setAlpha(1),a.tweens.add(sn([s],t)),await Ys(t)}addToLayer(e,t){const a=this.layers.get(e);a&&a.add(t)}clearSeveralLayers(e){e.forEach((e=>this.clearLayerContents(e)))}clearAllLayers(){this.layers.forEach(((e,t)=>this.clearLayerContents(t)))}clearLayerContents(e){const t=this.layers.get(e);if(t)for(;t.list.length;)t.list[0].destroy()}},Ri={key:xs.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},Di=.251*bs.x,Li={logTextConfig:{x:-.44*bs.x,y:-.378*bs.y,oriX:0,oriY:0},textMaxWidth:.68*bs.x,logHeight:.7632*bs.y,scrollbarTrack:{x:Di,y:.005*bs.y,width:7,height:.73*bs.y,color:5592405},scrollbarThumb:{x:Di,width:7,color:8947848},scrollSpeed:.5};const Oi=class{constructor(e){this.scene=e}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=Gn.getInstance().getDialogueStorage();if(0===t.length)return e;const a=Ms(this.scene,t.join("\n\n"),Li.logTextConfig,Ri).setMaxWidth(Li.textMaxWidth),s=Li.logTextConfig.y-Math.max(a.height-Li.logHeight,0);a.y=s,e.add(a);const n=new Phaser.GameObjects.Rectangle(this.scene,Li.scrollbarTrack.x,Li.scrollbarTrack.y,Li.scrollbarTrack.width,Li.scrollbarTrack.height,Li.scrollbarTrack.color),i=Math.max(Li.logHeight/a.height*Li.scrollbarTrack.height,4*Li.scrollbarThumb.width),r=Li.scrollbarTrack.y+Li.scrollbarTrack.height/2-i/2,o=(Li.scrollbarTrack.height-i)/(Li.logTextConfig.y-s),l=new Phaser.GameObjects.Rectangle(this.scene,Li.scrollbarThumb.x,r,Li.scrollbarThumb.width,i,Li.scrollbarThumb.color);e.add(n),e.add(l),a.height<=Li.logHeight&&(n.setVisible(!1),l.setVisible(!1));const{x:c,y:d,width:h,height:u}=ai.pageArea,g=new Phaser.GameObjects.Zone(this.scene,c+h/2,d+u/2,h,u);return g.setInteractive(),g.on("wheel",((e,t,n,i)=>{a.y=Js(a.y-n*Li.scrollSpeed,s,Li.logTextConfig.y),l.y=r-(a.y-s)*o})),e.add(g),e}};let _i=function(e){return e.Move="Move",e.Explore="Explore",e.Talk="Talk",e.Menu="Menu",e}({});const Gi={Move:Ln.Move,Explore:Ln.Explore,Talk:Ln.Talk,Menu:Ln.Menu};class Bi{constructor(e,t,a,s,n,i){this.scene=e,this.container=new Phaser.GameObjects.Container(e,t,a),this.imageGlow=new Phaser.GameObjects.Image(e,0,0,s).setAlpha(0).setBlendMode(Phaser.BlendModes.ADD),this.clickArea=new Phaser.GameObjects.Image(e,0,0,s).setAlpha(.01).setInteractive({pixelPerfect:!0});const r=Gn.getInstance().getGameMap().getMapAssets().get(s),o=Gn.getInstance().getGameManager().getAnimationManager();if(r){const e=o.createImage(r,s);switch(null===r||void 0===r?void 0:r.type){case zs.Sprite:this.clickArea.setAlpha(0),o.startAnimation(r);break;case zs.Image:n&&(Xn(e,n,i),Xn(this.imageGlow,n,i),Xn(this.clickArea,n,i))}this.container.add([e,this.imageGlow,this.clickArea])}}startGlow(){this.glowClearer&&this.glowClearer(),this.glowClearer=ln(this.scene,this.imageGlow),this.imageGlow.setAlpha(1)}clearGlow(){this.glowClearer&&this.glowClearer(),this.imageGlow.setAlpha(0)}startBlink(){this.blinkClearer=ln(this.scene,this.getContainer())}clearBlink(){this.getContainer().setAlpha(1),this.blinkClearer&&this.blinkClearer()}getContainer(){return this.container}getClickArea(){return this.clickArea}}const Ui=class{constructor(){this.objects=new Map,Gn.getInstance().watchGameItemType(Kn.objects,this)}renderObjectsLayerContainer(e){Gn.getInstance().clearSeveralLayers([Ws.Objects]);const t=Gn.getInstance().getGameItemsInLocation(Kn.objects,e);this.objects.clear(),t.map((e=>this.handleAdd(e)))}makeObjectGlow(e,t){const a=this.objects.get(e);a&&(t?a.sprite.startGlow():a.sprite.clearGlow())}makeObjectBlink(e,t){const a=this.objects.get(e);a&&(t?a.sprite.startBlink():a.sprite.clearBlink())}createObject(e){const t=Gn.getInstance().getGameManager(),{assetKey:a,x:s,y:n,width:i,height:r,actionIds:o,interactionId:l}=e,c=new Bi(t,s,n,a,i,r);return{sprite:c,clickArea:c.getClickArea(),actionIds:o,interactionId:l}}handleAdd(e){const t=Gn.getInstance().getObjectById(e),a=this.createObject(t);return Gn.getInstance().addToLayer(Ws.Objects,a.sprite.getContainer()),this.objects.set(e,a),!0}handleMutate(e){return this.handleDelete(e)&&this.handleAdd(e)}handleDelete(e){const t=this.objects.get(e);return!!t&&(this.objects.delete(e),t.sprite.getContainer().destroy(),!0)}getActivatables(){return Array.from(this.objects.values())}};class Fi{constructor(e,t){this.phaseStack=[Ln.None],this.phaseMap=e,this.interruptCheckCallback=()=>!1,this.interruptTransitionCallback=async()=>ys.nullFunction(),this.transitionCallback=ys.nullFunction,this.inputManager=t}addPhaseToMap(e,t){this.phaseMap.set(e,t)}setInterruptCheckCallback(e){this.interruptCheckCallback=e}setInterruptCallback(e){this.interruptTransitionCallback=e}setCallback(e){this.transitionCallback=e}async popPhase(){const e=this.phaseStack.pop();await this.executePhaseTransition(e,this.getCurrentPhase())}async pushPhase(e){const t=this.getCurrentPhase();e!==t&&(this.phaseStack.push(e),await this.executePhaseTransition(t,e))}async swapPhase(e){const t=this.getCurrentPhase();e!==t&&(this.phaseStack.pop(),this.phaseStack.push(e),await this.executePhaseTransition(t,e))}async executePhaseTransition(e,t){if(this.inputManager.enableKeyboardInput(!1),this.inputManager.enableMouseInput(!1),await this.phaseMap.get(e).deactivateUI(),this.interruptCheckCallback(e,t))return this.inputManager.enableMouseInput(!0),this.inputManager.enableKeyboardInput(!0),void await this.interruptTransitionCallback(e,t);this.transitionCallback(e,t),await this.phaseMap.get(t).activateUI(),this.inputManager.enableMouseInput(!0),this.inputManager.enableKeyboardInput(!0)}isCurrentPhase(e){return this.getCurrentPhase()===e}isCurrentPhaseTerminal(){return Object.values(On).includes(this.getCurrentPhase())}getCurrentPhase(){return this.phaseStack.length||(this.phaseStack=[Ln.None]),this.phaseStack[this.phaseStack.length-1]}}const zi={image:{xOffset:20,yOffset:20},rect:{x:{Left:400,Middle:fs.x,Right:bs.x-400},y:{Small:325,Medium:350,Large:420},scale:{Small:.7,Medium:1,Large:1.5},width:280,height:280},tweenDuration:300};const Vi=class{constructor(){this.currPopUp=new Map}async displayPopUp(e,t,a=ys.popUpDuration,s=oi.Medium){this.destroyPopUp(t);const n=Gn.getInstance().getGameManager(),i=new Phaser.GameObjects.Container(n,0,0),r=new Phaser.GameObjects.Image(n,zi.rect.x[t],zi.rect.y[s],Hs.popUpFrame.key).setScale(zi.rect.scale[s]),o=this.getAssetKey(e);if(!o)return;const l=new Phaser.GameObjects.Image(n,zi.rect.x[t]+zi.image.xOffset,zi.rect.y[s]+zi.image.yOffset,o);qn(l,zi.rect.width*zi.rect.scale[s],zi.rect.height*zi.rect.scale[s]),i.add([r,l]),this.currPopUp.set(t,i),Gn.getInstance().addToLayer(Ws.PopUp,i),Gn.getInstance().playSound(Xs.popUpEnter.key),i.setActive(!0),i.setVisible(!0),i.setScale(1,0),n.tweens.add(((e,t=500)=>({scaleY:1,targets:e,duration:t,ease:"Power1"}))([i],zi.tweenDuration)),await Ys(zi.tweenDuration),setTimeout((()=>this.destroyPopUp(t)),a)}destroyAllPopUps(){this.currPopUp.forEach(((e,t,a)=>{this.destroyPopUp(t)}))}async destroyPopUp(e){const t=this.currPopUp.get(e);t&&(Gn.getInstance().getGameManager().tweens.add(((e,t=500)=>({scaleY:0,targets:e,duration:t,ease:"Power1"}))([t],zi.tweenDuration)),await Ys(zi.tweenDuration),t.setVisible(!1),t.setActive(!1),t.destroy(),this.currPopUp.delete(e),Gn.getInstance().playSound(Xs.popUpExit.key))}getAssetKey(e){const t=Gn.getInstance().getGameMap().getObjectPropMap().get(e);if(t)return t.assetKey}};const Hi=()=>({gameSaveStates:{},userSaveState:{collectibles:[],settings:{bgmVolume:1,sfxVolume:1},recentlyPlayedCheckpoint:[-1,-1],largestCompletedChapter:-1}}),Ki=()=>({lastCheckpointPlayed:0,currentLocation:void 0,currentPhase:Ln.Menu,chapterNewlyCompleted:!1,incompleteTasks:[],completedTasks:[],completedObjectives:[],triggeredInteractions:[],triggeredStateChangeActions:[]});function $i(e){return Array.from(e).filter((([e,t])=>t)).map((([e])=>e))}const Xi=class{constructor(e){this.getGameMap=()=>this.gameMap,this.getCharacterAtId=e=>en(this.gameMap.getCharacterMap().get(e)),this.getSaveManager=()=>vl.getInstance().getSaveManager(),this.getChapterNewlyCompleted=()=>this.chapterNewlyCompleted,this.subscribers=new Map,this.gameMap=e.map,this.checkpointObjective=e.objectives,this.checkpointTask=e.tasks,this.chapterNewlyCompleted=!1,this.updatedLocations=new Set(this.gameMap.getLocationIds()),this.triggeredInteractions=new Map,this.triggeredStateChangeActions=[],this.loadStatesFromSaveManager()}loadStatesFromSaveManager(){this.triggeredStateChangeActions=this.getSaveManager().getTriggeredStateChangeActions(),this.getSaveManager().getTriggeredInteractions().forEach((e=>this.triggerInteraction(e))),this.getSaveManager().getCompletedObjectives().forEach((e=>this.checkpointObjective.setObjective(e,!0))),this.getSaveManager().getCompletedTasks().forEach((e=>{this.checkpointTask.setTask(e,!0),this.checkpointTask.showTask(e)})),this.getSaveManager().getIncompleteTasks().forEach((e=>{this.checkpointTask.setTask(e,!1),this.checkpointTask.showTask(e)})),this.chapterNewlyCompleted=this.getSaveManager().getChapterNewlyCompleted()}watchGameItemType(e,t){this.subscribers.set(e,t)}getSubscriberForItemType(e){return this.subscribers.get(e)}triggerInteraction(e){this.triggeredInteractions.set(e,!0)}triggerStateChangeAction(e){this.triggeredStateChangeActions.push(e)}hasTriggeredInteraction(e){return this.triggeredInteractions.get(e)}addLocationNotif(e){this.updatedLocations.add(e)}removeLocationNotif(e){this.updatedLocations.delete(e)}hasLocationNotif(e){return this.updatedLocations.has(e)}isCurrentLocation(e){return e===Gn.getInstance().getCurrLocId()}getLocationModes(e){return Array.from(this.gameMap.getLocationAtId(e).modes)||[]}addLocationMode(e,t){this.gameMap.getLocationAtId(e).modes.add(t),!this.isCurrentLocation(e)&&this.addLocationNotif(e)}removeLocationMode(e,t){this.gameMap.getLocationAtId(e).modes.delete(t),!this.isCurrentLocation(e)&&this.addLocationNotif(e)}getGameItemsInLocation(e,t){return Array.from(this.gameMap.getLocationAtId(t)[e])||[]}addItem(e,t,a){var s,n;null===(s=this.gameMap.getLocationAtId(t)[e])||void 0===s||s.add(a),this.isCurrentLocation(t)?null===(n=this.getSubscriberForItemType(e))||void 0===n||n.handleAdd(a):this.addLocationNotif(t)}removeItem(e,t,a){var s,n;null===(s=this.gameMap.getLocationAtId(t)[e])||void 0===s||s.delete(a),this.isCurrentLocation(t)?null===(n=this.getSubscriberForItemType(e))||void 0===n||n.handleDelete(a):this.addLocationNotif(t)}setObjProperty(e,t){this.gameMap.setItemInMap(Kn.objects,e,t),this.gameMap.getLocations().forEach(((t,a)=>{var s;t.objects.has(e)&&(this.isCurrentLocation(a)?null===(s=this.getSubscriberForItemType(Kn.objects))||void 0===s||s.handleMutate(e):this.addLocationNotif(a))}))}setBBoxProperty(e,t){this.gameMap.setItemInMap(Kn.boundingBoxes,e,t),this.gameMap.getLocations().forEach(((t,a)=>{var s;t.boundingBoxes.has(e)&&(this.isCurrentLocation(a)?null===(s=this.getSubscriberForItemType(Kn.boundingBoxes))||void 0===s||s.handleMutate(e):this.addLocationNotif(a))}))}moveCharacter(e,t,a){this.getCharacterAtId(e).defaultPosition=a,this.gameMap.getLocations().forEach(((t,a)=>{t.characters.has(e)&&this.removeItem(Kn.characters,a,e)})),this.addItem(Kn.characters,t,e)}updateCharacter(e,t){this.getCharacterAtId(e).defaultExpression=t,this.gameMap.getLocations().forEach(((t,a)=>{var s;t.characters.has(e)&&(this.isCurrentLocation(a)?null===(s=this.getSubscriberForItemType(Kn.characters))||void 0===s||s.handleMutate(e):this.addLocationNotif(a))}))}areAllObjectivesComplete(){return this.checkpointObjective.isAllComplete()}isObjectiveComplete(e){return this.checkpointObjective.getObjectiveState(e)}areObjectivesComplete(e){let t=!0;return e.forEach((e=>t=t&&this.isObjectiveComplete(e))),t}completeObjective(e){this.checkpointObjective.setObjective(e,!0)}isTaskComplete(e){return this.checkpointTask.getTaskState(e)}areTasksComplete(e){let t=!0;return e.forEach((e=>t=t&&this.isTaskComplete(e))),t}completeTask(e){this.checkpointTask.setTask(e,!0)}showTask(e){this.checkpointTask.showTask(e)}getAllVisibleTaskData(){return this.checkpointTask.getAllVisibleTaskData()}getCompletedObjectives(){return $i(this.checkpointObjective.getObjectives())}getCompletedTasks(){return $i(this.checkpointTask.getAllTasks())}getIncompleteTasks(){return this.checkpointTask.getAllIncompleteTasks()}getTriggeredInteractions(){return $i(this.triggeredInteractions)}getTriggeredStateChangeActions(){return this.triggeredStateChangeActions}},Wi={key:xs.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},qi=.251*bs.x,Zi={taskTextConfig:{x:-.42*bs.x,y:-.378*bs.y,oriX:0,oriY:0},textMaxWidth:.66*bs.x,checkMark:{x:-.202*bs.x,y:-.369*bs.y,imageUrl:Hs.talkOptCheck.key},logHeight:.7632*bs.y,scrollbarTrack:{x:qi,y:.005*bs.y,width:7,height:.73*bs.y,color:5592405},scrollbarThumb:{x:qi,width:7,color:8947848},scrollSpeed:.5};const Yi=class{constructor(e){this.scene=e}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=Gn.getInstance().getAllVisibleTaskData(),a=new Phaser.GameObjects.Container(this.scene,0,0);let s=0;if(0===t.length){const e=Ms(this.scene,"No tasks available.",Zi.taskTextConfig,Wi).setMaxWidth(Zi.textMaxWidth);a.add(e),s=e.height}else for(let m=0;m<t.length;m++){const e=t[m][0];if(t[m][1]){const e=new Phaser.GameObjects.Image(this.scene,Zi.checkMark.x,Zi.checkMark.y+s,Zi.checkMark.imageUrl);a.add(e)}const n=Ms(this.scene,e.title,{...Zi.taskTextConfig,y:Zi.taskTextConfig.y+s},Wi).setMaxWidth(Zi.textMaxWidth),i=Ms(this.scene,"_",{...Zi.taskTextConfig,y:Zi.taskTextConfig.y+s},Wi);i.setScale(n.width/i.width,1),a.add(n),a.add(i),s+=n.height;const r=Ms(this.scene,e.description+(m<t.length-1?"\n ":""),{...Zi.taskTextConfig,y:Zi.taskTextConfig.y+s},Wi).setMaxWidth(Zi.textMaxWidth);a.add(r),s+=r.height}const n=-Math.max(s-Zi.logHeight,0);a.y=n,e.add(a);const i=new Phaser.GameObjects.Rectangle(this.scene,Zi.scrollbarTrack.x,Zi.scrollbarTrack.y,Zi.scrollbarTrack.width,Zi.scrollbarTrack.height,Zi.scrollbarTrack.color),r=Math.max(Zi.logHeight/s*Zi.scrollbarTrack.height,4*Zi.scrollbarThumb.width),o=Zi.scrollbarTrack.y+Zi.scrollbarTrack.height/2-r/2,l=(Zi.scrollbarTrack.height-r)/-n,c=new Phaser.GameObjects.Rectangle(this.scene,Zi.scrollbarThumb.x,o,Zi.scrollbarThumb.width,r,Zi.scrollbarThumb.color);e.add(i),e.add(c),s<=Zi.logHeight&&(i.setVisible(!1),c.setVisible(!1));const{x:d,y:h,width:u,height:g}=ai.pageArea,p=new Phaser.GameObjects.Zone(this.scene,d+u/2,h+g/2,u,g);return p.setInteractive(),p.on("wheel",((e,t,s,i)=>{a.y=Js(a.y-s*Zi.scrollSpeed,n,0),c.y=o-(a.y-n)*l})),e.add(p),e}},Ji=[{assetKey:Hs.gear.key,onUp:e=>async()=>{const t=e.getPhaseManager();t.isCurrentPhase(Ln.EscapeMenu)?await t.popPhase():t.isCurrentPhaseTerminal()?await t.swapPhase(Ln.EscapeMenu):await t.pushPhase(Ln.EscapeMenu)}},{assetKey:Hs.journal.key,onUp:e=>async()=>{const t=e.getPhaseManager();t.isCurrentPhase(Ln.Dashboard)?await t.popPhase():t.isCurrentPhaseTerminal()?await t.swapPhase(Ln.Dashboard):await t.pushPhase(Ln.Dashboard)}}],Qi={firstButton:{x:bs.x-37,y:37},xOffset:64,buttonConfigs:Ji};const er=class{constructor(e){this.scene=e}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0);return e.add(Qi.buttonConfigs.map(((e,t)=>this.createToolbarButton(Qi.firstButton.x-Qi.xOffset*t,Qi.firstButton.y,e)))),e}createToolbarButton(e,t,a){return Pn(this.scene,{assetKey:a.assetKey,onUp:a.onUp(this.scene)}).setPosition(e,t)}async renderToolbarContainer(){this.uiContainer=this.createUIContainer(),this.scene.getLayerManager().addToLayer(Ws.UI,this.uiContainer)}},tr=.975*-fs.y,ar={key:xs.zektonDarkFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};class sr extends Phaser.GameObjects.Container{constructor(e,t){super(e,0,0),this.renderBackButton(t)}renderBackButton(e){const t=Pn(this.scene,{assetKey:Hs.topButton.key,message:"Back",textConfig:{x:0,y:tr,oriX:.5,oriY:.25},bitMapTextStyle:ar,onUp:e}).setPosition(fs.x,fs.y);this.add(t)}}const nr=sr,ir={normal:`url(${Qs("/ui/magnifying.png",!1)}), pointer`,hover:`url(${Qs("/ui/magnifying_trigg.png",!1)}), pointer`,checked:`url(${Qs("/ui/magnifying_check.png",!1)}), pointer`};const rr=class{createUIContainer(){const e=Gn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=new nr(e,(async()=>await Gn.getInstance().swapPhase(Ln.Menu)));return t.add(a),t}async activateUI(){const e=Gn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),Gn.getInstance().addToLayer(Ws.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,-bs.y),this.enableInteractions(),e.tweens.add({targets:this.uiContainer,...cn}),Gn.getInstance().setDefaultCursor(ir.normal),Gn.getInstance().playSound(Xs.modeEnter.key)}async deactivateUI(){const e=Gn.getInstance().getGameManager();Gn.getInstance().setDefaultCursor(ys.defaultCursor),this.disableInteractions(),this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...dn}),await Ys(500),rn(e,this.uiContainer))}enableInteractions(){Gn.getInstance().getAllActivatables().forEach((e=>{e.actionIds&&e.actionIds.length&&(e.clickArea.on("pointerout",(()=>this.explorePointerOut())),e.clickArea.on("pointerover",(()=>this.explorePointerOver(e.interactionId))),e.clickArea.on("pointerup",(async()=>{this.explorePointerUp(e.interactionId),await Gn.getInstance().processGameActions(e.actionIds)})))}))}disableInteractions(){Gn.getInstance().getAllActivatables().forEach((e=>{e.clickArea.off("pointerout"),e.clickArea.off("pointerover"),e.clickArea.off("pointerup")}))}explorePointerOver(e){Gn.getInstance().hasTriggeredInteraction(e)?Gn.getInstance().setDefaultCursor(ir.checked):Gn.getInstance().setDefaultCursor(ir.hover)}explorePointerOut(){Gn.getInstance().setDefaultCursor(ir.normal)}explorePointerUp(e){Gn.getInstance().setDefaultCursor(ys.defaultCursor),Gn.getInstance().triggerInteraction(e),Gn.getInstance().setDefaultCursor(ir.normal)}},or={key:xs.zektonFont.key,size:45,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},lr={button:{yOffset:.3*bs.y},entryTweenProps:{y:0,duration:500,ease:"Power2"},exitTweenProps:{y:.4*bs.y,duration:300,ease:"Power2"}},cr=0,dr=15,hr=20,ur=4,gr=-68,pr=20,mr=-30,xr=20,yr=12380122;const br=class{getLatestLocationModes(){const e=Gn.getInstance().getCurrLocId();let t=Gn.getInstance().getLocationModes(e);return 0===Gn.getInstance().getGameItemsInLocation(Kn.talkTopics,e).length&&(t=t.filter((e=>e!==_i.Talk))),t}createUIContainer(){const e=Gn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=new Phaser.GameObjects.Image(e,fs.x,fs.y,Hs.modeMenuBanner.key);t.add(a);const s=this.getLatestLocationModes(),n=this.getModeButtons(s),i=Ss({numOfItems:n.length}),r=n.map(((e,t)=>this.createLine(i[t][0],i[t][1]+lr.button.yOffset+xr,e)));return t.add(n.map(((e,t)=>this.createModeButton(e.text,i[t][0],i[t][1]+lr.button.yOffset,e.callback)))),t.add(r),t}createLine(e,t,a){const s=Gn.getInstance().getGameManager();a.text===_i.Explore?e+=gr:a.text===_i.Move?e+=pr:e+=mr;const n=s.add.line(cr,dr,e,t,e+hr,t,yr);return n.setLineWidth(ur),n}getModeButtons(e){return e.sort().map((e=>({text:e,callback:async()=>await Gn.getInstance().swapPhase(Gi[e])})))}createModeButton(e,t,a,s){return Pn(Gn.getInstance().getGameManager(),{assetKey:Hs.shortButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.25},bitMapTextStyle:or,onUp:s}).setPosition(t,a)}async activateUI(){const e=Gn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),Gn.getInstance().addToLayer(Ws.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,bs.y),e.tweens.add({targets:this.uiContainer,...lr.entryTweenProps}),await Ys(500),Gn.getInstance().playSound(Xs.modeEnter.key)}async deactivateUI(){const e=Gn.getInstance().getGameManager();this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...lr.exitTweenProps}),await Ys(500),rn(e,this.uiContainer))}},fr={key:xs.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},vr={button:{xOffSet:.25*bs.x,ySpace:.8*bs.y},preview:{rect:{x:.3125*bs.x,y:.515*bs.y,width:.473*bs.x,height:.56*bs.y},frame:{x:.3*bs.x}}};const Cr=class{setPreview(e,t){e.setTexture(t).setDisplaySize(vr.preview.rect.width,vr.preview.rect.height).setPosition(vr.preview.rect.x,vr.preview.rect.y)}getLatestNavigations(){return Gn.getInstance().getGameItemsInLocation(Kn.navigation,Gn.getInstance().getCurrLocId())}createUIContainer(){const e=Gn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=new Phaser.GameObjects.Sprite(e,vr.preview.frame.x,fs.y,Hs.locationPreviewFrame.key),s=new Phaser.GameObjects.Sprite(e,fs.x,fs.y,Hs.locationPreviewFill.key);t.add([a,s]);const n=this.getLatestNavigations(),i=this.getMoveButtons(n,s),r=Ss({numOfItems:i.length,numItemLimit:1,maxYSpace:vr.button.ySpace});t.add(i.map(((e,t)=>this.createMoveButton(Mn(t+1,e.text),r[t][0]+vr.button.xOffSet,r[t][1],e.callback,e.onHover,e.onOut))));const o=new nr(e,(async()=>await Gn.getInstance().swapPhase(Ln.Menu)));return t.add(o),this.setPreview(s,Hs.defaultLocationImg.key),t}getMoveButtons(e,t){const a=e=>this.setPreview(t,e),s=()=>this.setPreview(t,Hs.defaultLocationImg.key);return e.map((e=>{const t=Gn.getInstance().getLocationAtId(e);return{text:t.name,callback:async()=>{await Gn.getInstance().swapPhase(Ln.Sequence),await Gn.getInstance().changeLocationTo(e)},onHover:()=>a(t.previewKey||t.assetKey),onOut:()=>s()}}))}createMoveButton(e,t,a,s,n,i){return Pn(Gn.getInstance().getGameManager(),{assetKey:Hs.longButton.key,message:e,textConfig:{x:0,y:0,oriX:.4,oriY:.15},bitMapTextStyle:fr,onUp:s,onHover:n,onOut:i}).setPosition(t,a)}registerKeyboardListener(){const e=Gn.getInstance().getGameManager().getInputManager();this.getLatestNavigations().forEach(((t,a)=>{e.registerKeyboardListener(Sn.Options[a],"up",(async()=>{await Gn.getInstance().swapPhase(Ln.Sequence),await Gn.getInstance().changeLocationTo(t)}))}))}async activateUI(){const e=Gn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),Gn.getInstance().addToLayer(Ws.UI,this.uiContainer),this.registerKeyboardListener(),this.uiContainer.setPosition(this.uiContainer.x,-bs.y),e.tweens.add({targets:this.uiContainer,...cn}),Gn.getInstance().playSound(Xs.modeEnter.key)}removeKeyboardListener(){Gn.getInstance().getGameManager().getInputManager().clearKeyboardListeners(Sn.Options)}async deactivateUI(){const e=Gn.getInstance().getGameManager();this.removeKeyboardListener(),this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...dn}),await Ys(500),rn(e,this.uiContainer))}};const jr=class{activateUI(){}deactivateUI(){}},Sr={key:xs.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Ir={button:{ySpace:.7*bs.y}};const kr=class{getLatestTalkTopics(){return Gn.getInstance().getGameItemsInLocation(Kn.talkTopics,Gn.getInstance().getCurrLocId())}createUIContainer(){const e=Gn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=this.getLatestTalkTopics(),s=this.getTalkTopicButtons(a),n=Ss({direction:js.Column,numOfItems:s.length,maxYSpace:Ir.button.ySpace});t.add(s.map(((e,t)=>this.createTalkTopicButton(Mn(t+1,e.text),n[t][0],n[t][1],e.callback)))),s.forEach(((a,s)=>{const i=new Phaser.GameObjects.Sprite(e,n[s][0],n[s][1],Hs.talkOptCheck.key);!!a.interactionId&&Gn.getInstance().hasTriggeredInteraction(a.interactionId)&&t.add(i)}));const i=new nr(e,(async()=>await Gn.getInstance().swapPhase(Ln.Menu)));return t.add(i),t}getTalkTopicButtons(e){return e.map((e=>({text:en(Gn.getInstance().getDialogueById(e)).title,callback:async()=>{Gn.getInstance().triggerInteraction(e),await Gn.getInstance().showDialogue(e)},interactionId:e})))}createTalkTopicButton(e,t,a,s){return Pn(Gn.getInstance().getGameManager(),{assetKey:Hs.talkOptButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.2},bitMapTextStyle:Sr,onUp:s}).setPosition(t,a)}registerKeyboardListener(){const e=this.getLatestTalkTopics(),t=Gn.getInstance().getGameManager().getInputManager();e.forEach(((e,a)=>{t.registerKeyboardListener(Sn.Options[a],"up",(async()=>{Gn.getInstance().triggerInteraction(e),await Gn.getInstance().showDialogue(e)}))}))}async activateUI(){const e=Gn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),Gn.getInstance().addToLayer(Ws.UI,this.uiContainer),this.registerKeyboardListener(),this.uiContainer.setPosition(this.uiContainer.x,-bs.y),e.tweens.add({targets:this.uiContainer,...cn}),Gn.getInstance().playSound(Xs.modeEnter.key)}removeKeyboardListener(){Gn.getInstance().getGameManager().getInputManager().clearKeyboardListeners(Sn.Options)}async deactivateUI(){const e=Gn.getInstance().getGameManager();this.removeKeyboardListener(),this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...dn}),await Ys(500),rn(e,this.uiContainer))}};class wr extends Phaser.Scene{constructor(){super("GameManager"),this.getSaveManager=()=>vl.getInstance().getSaveManager(),this.getStateManager=()=>en(this.stateManager),this.getObjectManager=()=>en(this.objectManager),this.getDialogueManager=()=>en(this.dialogueManager),this.getCharacterManager=()=>en(this.characterManager),this.getBBoxManager=()=>en(this.boundingBoxManager),this.getActionManager=()=>en(this.actionManager),this.getInputManager=()=>en(this.inputManager),this.getLayerManager=()=>en(this.layerManager),this.getPhaseManager=()=>en(this.phaseManager),this.getBackgroundManager=()=>en(this.backgroundManager),this.getAnimationManager=()=>en(this.animationManager),this.getPopupManager=()=>en(this.popUpManager),this.getEscapeManager=()=>en(this.escapeManager),this.getCollectibleManager=()=>en(this.collectibleManager),this.getAchievementManager=()=>en(this.achievementManager),this.getLogManager=()=>en(this.logManager),this.getDialogueStorageManager=()=>en(this.dialogueStorageManager),this.getToolbarManager=()=>en(this.toolbarManager),this.getTaskLogManager=()=>en(this.taskLogManager),this.getDashboardManager=()=>en(this.dashboardManager),this.currentLocationId=ys.nullInteractionId,this.hasTransitioned=!1}init({gameCheckpoint:e,continueGame:t,chapterNum:a,checkpointNum:s}){Gn.getInstance().setGameManager(this),vl.getInstance().setCurrentSceneRef(this),this.getSaveManager().registerGameInfo(a,s,t),this.currentLocationId=this.getSaveManager().getLoadedLocation()||e.startingLoc,this.hasTransitioned=!1,this.stateManager=new Xi(e),this.layerManager=new Ni(this),this.inputManager=new In(this),this.phaseManager=new Fi(new Map([[Ln.Menu,new br],[Ln.Move,new Cr],[Ln.Explore,new rr],[Ln.Talk,new kr],[Ln.Sequence,new jr],[Ln.None,new jr]]),this.inputManager),this.characterManager=new ei,this.objectManager=new Ui,this.dialogueManager=new di,this.actionManager=new Hn,this.boundingBoxManager=new Jn,this.backgroundManager=new Yn,this.animationManager=new $n,this.popUpManager=new Vi,this.escapeManager=new Ei(this),this.collectibleManager=new Zn(this,vl.getInstance().getUserStateManager().getCollectibles),this.achievementManager=new Zn(this,vl.getInstance().getUserStateManager().getAchievements),this.logManager=new Oi(this),this.dialogueStorageManager=new hi,this.toolbarManager=new er(this),this.taskLogManager=new Yi(this),this.dashboardManager=new ni(this,[si.Log,si.Tasks,si.Collectibles,si.Achievements],[this.logManager,this.taskLogManager,this.collectibleManager,this.achievementManager])}preload(){vi(this),this.getPhaseManager().setInterruptCheckCallback(((e,t)=>this.transitionChecker(e,t))),this.getPhaseManager().setInterruptCallback((async(e,t)=>await this.checkpointTransition())),this.getPhaseManager().setCallback((async(e,t)=>await this.handleCharacterLayer(e,t))),this.preloadLocationsAssets(),this.bindKeyboardTriggers()}preloadLocationsAssets(){const e=this.getStateManager().getGameMap();Gn.getInstance().loadSounds(e.getSoundAssets()),e.getMapAssets().forEach(((e,t)=>{this.loadImage(e,t)}))}loadImage(e,t){switch(e.type){case zs.Image:this.load.image(t,Qs(e.path,!0));break;case zs.Sprite:this.load.spritesheet(t,Qs(e.path,!0),e.config)}}async create(){Gn.getInstance().hideLayer(Ws.Character),await this.changeLocationTo(this.currentLocationId,!0),await Gn.getInstance().saveGame()}async renderLocation(e,t){const a=Gn.getInstance().getLocationAtId(e);this.getToolbarManager().renderToolbarContainer(),await Gn.getInstance().playBgMusic(a.bgmKey),this.getBackgroundManager().renderBackgroundLayerContainer(e),this.getObjectManager().renderObjectsLayerContainer(e),this.getBBoxManager().renderBBoxLayerContainer(e),this.getCharacterManager().renderCharacterLayerContainer(e),await this.getPhaseManager().swapPhase(Ln.Sequence),t&&(await this.getActionManager().fastForwardGameActions(this.getStateManager().getTriggeredStateChangeActions()),await this.getActionManager().processGameActions(this.getStateManager().getGameMap().getGameStartActions())),await this.getActionManager().processGameActions(a.actionIds),this.getStateManager().hasLocationNotif(e)&&(await Gn.getInstance().bringUpUpdateNotif(a.name),this.getStateManager().removeLocationNotif(e)),this.getPhaseManager().isCurrentPhase(Ln.Sequence)&&await this.getPhaseManager().swapPhase(Ln.Menu)}async changeLocationTo(e,t=!1){this.currentLocationId=e,await(async(e,t,a,s)=>{const n=on(e);e.getLayerManager().addToLayer(Ws.Effects,n),n.setAlpha(0),e.tweens.add(nn([n],t)),await Ys(t),await s(),await Ys(a),n.setAlpha(1),e.tweens.add(sn([n],t)),await Ys(t),n.destroy()})(this,300,500,(async()=>{await this.getLayerManager().clearAllLayers(),await this.renderLocation(e,t)})),this.getStateManager().triggerInteraction(e)}bindKeyboardTriggers(){this.getInputManager().registerKeyboardListener(Sn.Menu,"up",(async()=>{this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().popPhase():await this.getPhaseManager().pushPhase(Ln.EscapeMenu)})),this.getInputManager().registerKeyboardListener(Sn.Dashboard,"up",(async()=>{this.getPhaseManager().isCurrentPhase(Ln.Dashboard)?await this.getPhaseManager().popPhase():this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().swapPhase(Ln.Dashboard):await this.getPhaseManager().pushPhase(Ln.Dashboard)})),this.registerMenuKeyboardListener(Sn.Explore,_i.Explore,Ln.Explore),this.registerMenuKeyboardListener(Sn.Move,_i.Move,Ln.Move),this.registerMenuKeyboardListener(Sn.Talk,_i.Talk,Ln.Talk)}registerMenuKeyboardListener(e,t,a){this.getInputManager().registerKeyboardListener(e,"up",(async()=>{this.getCurrentLocationModes().includes(t)&&this.getPhaseManager().isCurrentPhase(Ln.Menu)?await this.getPhaseManager().pushPhase(a):this.getPhaseManager().isCurrentPhase(a)&&await this.getPhaseManager().swapPhase(Ln.Menu)}))}getCurrentLocationModes(){const e=this.currentLocationId;let t=this.getStateManager().getLocationModes(e);return 0===Gn.getInstance().getGameItemsInLocation(Kn.talkTopics,e).length&&(t=t.filter((e=>e!==_i.Talk))),t}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers(),this.getDialogueStorageManager().clearDialogueStorage()}transitionChecker(e,t){return!this.hasTransitioned&&t!==Ln.Sequence&&Gn.getInstance().areAllObjectivesComplete()&&!this.getStateManager().getChapterNewlyCompleted()}async checkpointTransition(){this.hasTransitioned=!0,await this.getActionManager().processGameActions(this.getStateManager().getGameMap().getCheckpointCompleteActions()),this.getInputManager().setDefaultCursor(ys.defaultCursor),this.getInputManager().enableMouseInput(!0),this.getInputManager().enableKeyboardInput(!0),this.tweens.add(nn([on(this).setAlpha(0)],ys.fadeDuration)),await Ys(ys.fadeDuration),this.cleanUp(),this.scene.start("CheckpointTransition")}async handleCharacterLayer(e,t){e===Ln.Menu&&Gn.getInstance().fadeOutLayer(Ws.Character),t===Ln.Menu&&Gn.getInstance().fadeInLayer(Ws.Character)}}const Ar=wr;class Tr{constructor(){this.getTriggeredStateChangeActions=()=>this.getGameSaveState().triggeredStateChangeActions,this.getTriggeredInteractions=()=>this.getGameSaveState().triggeredInteractions,this.getCompletedObjectives=()=>this.getGameSaveState().completedObjectives,this.getCompletedTasks=()=>this.getGameSaveState().completedTasks,this.getIncompleteTasks=()=>this.getGameSaveState().incompleteTasks,this.getLoadedPhase=()=>this.getGameSaveState().currentPhase,this.getChapterNewlyCompleted=()=>this.getGameSaveState().chapterNewlyCompleted,this.getChapterNum=()=>en(this.chapterNum),this.getCheckpointNum=()=>en(this.checkpointNum),this.getFullSaveState=()=>this.fullSaveState,this.fullSaveState=Hi()}async loadLastSaveState(){this.fullSaveState=await async function(){var e;const t={method:"GET",headers:Il(vl.getInstance().getAccountInfo().accessToken)},a=await fetch(`${b.Z.backendUrl}/v2/user`,t),s=await a.text(),n=null===(e=JSON.parse(s).courseRegistration)||void 0===e?void 0:e.gameStates;return R().isEmpty(n)?Hi():n}()}registerGameInfo(e,t,a){this.chapterNum=e,this.checkpointNum=t,a||(this.fullSaveState.gameSaveStates[e]=Ki())}async saveGame(){vl.getInstance().getCurrentSceneRef()instanceof Ar&&(this.fullSaveState=function(e,t,a){const s=Gn.getInstance().getGameManager(),n=s.getStateManager(),i=s.getPhaseManager();return{gameSaveStates:{...e.gameSaveStates,[t]:{lastCheckpointPlayed:a,currentLocation:s.currentLocationId,currentPhase:i.getCurrentPhase(),chapterNewlyCompleted:n.getChapterNewlyCompleted(),incompleteTasks:n.getIncompleteTasks(),completedTasks:n.getCompletedTasks(),completedObjectives:n.getCompletedObjectives(),triggeredInteractions:n.getTriggeredInteractions(),triggeredStateChangeActions:n.getTriggeredStateChangeActions()}},userSaveState:{settings:e.userSaveState.settings,recentlyPlayedCheckpoint:[t,a],collectibles:vl.getInstance().getUserStateManager().getCollectibles(),largestCompletedChapter:e.userSaveState.largestCompletedChapter}}}(this.fullSaveState,this.getChapterNum(),this.getCheckpointNum()),await Sl(this.fullSaveState))}async saveChapterComplete(e){this.fullSaveState.gameSaveStates[e].chapterNewlyCompleted=!0,e>this.getLargestCompletedChapterNum()&&(this.fullSaveState.userSaveState.largestCompletedChapter=e),await Sl(this.fullSaveState)}async saveSettings(e){this.fullSaveState.userSaveState.settings=e,await Sl(this.fullSaveState)}getSettings(){return this.fullSaveState.userSaveState.settings}getLoadedUserState(){return this.fullSaveState.userSaveState}getLargestCompletedChapterNum(){return this.fullSaveState.userSaveState.largestCompletedChapter}getGameSaveState(){return this.fullSaveState.gameSaveStates[this.getChapterNum()]||Ki()}getLoadedLocation(){return this.getGameSaveState().currentLocation}getChapterSaveState(e){return this.fullSaveState.gameSaveStates[e]||Ki()}}const Mr={key:xs.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};const Pr=["Clang. Thud. One hit to the wall, one hit to my flesh.","","They told me I was to be the pillar of this","spaceship - who knew they meant it literally?","- A. Halim"],Er=["I blink synchronously with the screen;","I breathe as the machine steams on and off.","","Behind this closed space, my very blood fuels","these engines - hoping for you to find me.","- T. S. Chong"],Nr={yInterval:80,messageDuration:5e3};function Rr(e,t,a,s,n=50,i=50){const r=new Phaser.GameObjects.Rectangle(e,a,s,n,i,0,0),o="A"===t?Pr:Er;r.setInteractive({useHandCursor:!0}),r.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(()=>async function(e,t){const a=on(e).setInteractive().setAlpha(0),s=ks({numOfItems:t.length,xSpacing:0,ySpacing:Nr.yInterval}),n={x:fs.x,y:0,oriX:.5,oriY:.5},i=fs.y-t.length*Nr.yInterval*.5;e.getLayerManager().addToLayer(Ws.WorkerMessage,a),e.add.tween(nn([a],ys.fadeDuration)),vl.getInstance().getSoundManager().playSound(Xs.radioStatic.key),await Ys(ys.fadeDuration),t.forEach(((t,a)=>{const r=function(e,t,a={x:0,y:0,oriX:.5,oriY:.5},s=Mr,n=4,i=5,r=3){const o=[];for(let l=0;l<n;l++){const n={x:a.x+i*Math.random(),y:a.y+r*Math.random(),oriX:a.oriX,oriY:a.oriY},l=Ms(e,t,n,s);l.setAlpha(.4).setBlendMode(Phaser.BlendModes.SCREEN),o.push(l)}return o.forEach((t=>{e.tweens.add({targets:t,x:t.x+i*Math.random(),y:t.y+r*Math.random(),alpha:.5,duration:20,yoyo:!0,loop:-1,loopDelay:1e3*Math.random()})})),o}(e,t,{...n,y:s[a][1]+i});r.forEach((t=>e.getLayerManager().addToLayer(Ws.WorkerMessage,t))),setTimeout((()=>r.forEach((e=>e.destroy()))),Nr.messageDuration)})),await Ys(Nr.messageDuration),rn(e,a)}(e,o))),e.getLayerManager().addToLayer(Ws.UI,r)}const Dr={scrollSpeed:20,tileDim:2048,maxAwardsPerCol:2,arrow:{xOffset:875},award:{xSpace:300,yStart:300,ySpace:fs.y-50,dim:200},awardInfo:{width:300},banner:{xOffset:.28*-bs.x},bannerTextConfig:{x:30,y:0,oriX:0,oriY:.5}},Lr={key:xs.alienLeagueFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},Or={fontFamily:"Verdana",fontSize:"30px",fill:vs.lightBlue,align:"center",wordWrap:{width:Dr.award.dim-20}},_r={fontFamily:"Verdana",fontSize:"20px",fill:vs.lightBlue,align:"left",wordWrap:{width:Dr.awardInfo.width-20}},Gr={fontFamily:"Verdana",fontSize:"15px",fill:vs.offWhite,align:"left",wordWrap:{width:Dr.awardInfo.width-20}},Br={fontFamily:"Verdana",fontSize:"15px",fill:vs.lightBlue,align:"left",wordWrap:{width:Dr.awardInfo.width-20}};class Ur extends Phaser.Scene{constructor(){super("AwardsHall"),this.getUserStateManager=()=>vl.getInstance().getUserStateManager(),this.getInputManager=()=>en(this.inputManager),this.getLayerManager=()=>en(this.layerManager),vl.getInstance().setCurrentSceneRef(this),this.isScrollLeft=!1,this.isScrollRight=!1,this.scrollLim=0,this.awardXSpace=0}init(){this.layerManager=new Ni(this),this.inputManager=new In(this)}preload(){vi(this)}async create(){const e=this.getUserStateManager().getAchievements().length,t=this.getUserStateManager().getCollectibles().length;this.awardXSpace=Math.ceil(Math.max(e,t)/Dr.maxAwardsPerCol)*Dr.award.xSpace,this.scrollLim=this.awardXSpace<bs.x?0:this.awardXSpace-bs.x,this.renderBackground(),this.renderAwards(),Rr(this,"A",.95*bs.x,.99*bs.y)}update(){if(!this.backgroundTile||!this.awardsContainer)return;let e=this.awardsContainer.x;this.isScrollRight?e-=Dr.scrollSpeed:this.isScrollLeft&&(e+=Dr.scrollSpeed),e=Js(e,-this.scrollLim,0),this.backgroundTile.tilePositionX=-e,this.awardsContainer.x=e}renderBackground(){this.backgroundTile&&this.backgroundTile.destroy(),this.backgroundTile=new Phaser.GameObjects.TileSprite(this,0,0,Dr.tileDim,Dr.tileDim,Hs.awardsBackground.key).setOrigin(0,.25),this.getLayerManager().addToLayer(Ws.Background,this.backgroundTile);const e=["Achievements","Collectibles"],t=Ss({direction:js.Column,numOfItems:e.length});e.forEach(((e,a)=>{const s=this.createBanner(e,t[a][1]);this.getLayerManager().addToLayer(Ws.UI,s)}));const a=Pn(this,{assetKey:Hs.chapterSelectArrow.key,onDown:()=>this.isScrollLeft=!0,onUp:()=>this.isScrollLeft=!1,onOut:()=>this.isScrollLeft=!1}).setPosition(fs.x-Dr.arrow.xOffset,fs.y),s=Pn(this,{assetKey:Hs.chapterSelectArrow.key,onDown:()=>this.isScrollRight=!0,onUp:()=>this.isScrollRight=!1,onOut:()=>this.isScrollRight=!1}).setPosition(fs.x+Dr.arrow.xOffset,fs.y).setScale(-1,1),n=new nr(this,(()=>{this.cleanUp(),this.scene.start("MainMenu")}));this.getLayerManager().addToLayer(Ws.UI,a),this.getLayerManager().addToLayer(Ws.UI,s),this.getLayerManager().addToLayer(Ws.UI,n)}renderAwards(){this.awardsContainer&&this.awardsContainer.destroy(),this.awardsContainer=new Phaser.GameObjects.Container(this,0,0);const e=this.getAwards(this.getUserStateManager().getAchievements()),t=Ss({direction:js.Column,numOfItems:e.length,numItemLimit:Dr.maxAwardsPerCol,redistributeLast:!1,maxXSpace:this.awardXSpace,maxYSpace:Dr.award.ySpace});this.awardsContainer.add(e.map(((e,a)=>this.createAward(e,t[a][0],t[a][1]+Dr.award.yStart-fs.y))));const a=this.getAwards(this.getUserStateManager().getCollectibles()),s=Ss({direction:js.Column,numOfItems:a.length,numItemLimit:Dr.maxAwardsPerCol,redistributeLast:!1,maxXSpace:this.awardXSpace,maxYSpace:Dr.award.ySpace});this.awardsContainer.add(a.map(((e,t)=>this.createAward(e,s[t][0],s[t][1]+Dr.award.yStart)))),this.getLayerManager().addToLayer(Ws.Objects,this.awardsContainer)}getAwards(e){return Us(e)}createAward(e,t,a){const s=new Phaser.GameObjects.Container(this,t,a);let n;if(e.assetKey===ys.nullInteractionId){n=new Phaser.GameObjects.Rectangle(this,0,0,Dr.award.dim,Dr.award.dim,Cs.darkBlue,.8),n.setInteractive();const t=new Phaser.GameObjects.Text(this,0,0,e.title,Or).setOrigin(.5,.5);s.add([n,t])}else n=new Phaser.GameObjects.Sprite(this,0,0,e.assetKey).setOrigin(.5),qn(n,Dr.award.dim,Dr.award.dim),n.setInteractive({pixelPerfect:!0,useHandCursor:!0}),s.add(n);const i=new Phaser.GameObjects.Rectangle(this,0,0,Dr.award.dim,Dr.award.dim,0).setAlpha(e.completed?0:.8);s.add(i);const r=((e,t)=>{const a=new Phaser.GameObjects.Container(e,0,0),s=new Phaser.GameObjects.Text(e,20,20,t.title,_r),n=new Phaser.GameObjects.Text(e,20,s.getBounds().bottom+20,t.assetKey,Gr),i=new Phaser.GameObjects.Text(e,20,n.getBounds().bottom+20,t.description,Br),r=new Phaser.GameObjects.Rectangle(e,0,0,Dr.awardInfo.width,i.getBounds().bottom+20,Cs.darkBlue).setOrigin(0,0).setAlpha(.8),o=new Phaser.GameObjects.Sprite(e,Dr.awardInfo.width/2,0,Hs.scrollFrame.key),l=new Phaser.GameObjects.Sprite(e,Dr.awardInfo.width/2,r.getBounds().bottom,Hs.scrollFrame.key);return a.add([r,s,i,o,l]),t.completed&&a.add(n),a.setVisible(!1),a})(this,e);return n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,(()=>r.setVisible(!0))),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,(()=>r.setVisible(!1))),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,(e=>{r.x=e.x+10,r.y=e.y-10})),this.getLayerManager().addToLayer(Ws.UI,r),s}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers()}createBanner(e,t){const a=new Phaser.GameObjects.Container(this,0,t),s=new Phaser.GameObjects.Sprite(this,Dr.banner.xOffset,0,Hs.awardsPage.key),n=Ms(this,e,Dr.bannerTextConfig,Lr);return a.add([s,n]),a}}const Fr=Ur,zr={keyTextConfig:{x:fs.x-100,y:0,oriX:.5,oriY:.5},keyDescTextConfig:{x:fs.x+100,y:0,oriX:.5,oriY:.5},key:{xOffset:bs.x/5,yOffset1:fs.y-bs.y/4,yOffset2:fs.y-bs.y/1.5,yInterval:150},icon:{x:fs.x-100}},Vr={key:xs.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Hr={key:xs.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};class Kr extends Phaser.Scene{constructor(){super("Bindings"),this.getInputManager=()=>en(this.inputManager),this.getLayerManager=()=>en(this.layerManager)}init(){this.layerManager=new Ni(this),this.inputManager=new In(this)}create(){this.renderBackground(),this.renderBindings()}renderBackground(){const e=new Phaser.GameObjects.Image(this,fs.x,fs.y,Hs.spaceshipBg.key),t=new Phaser.GameObjects.Rectangle(this,fs.x,fs.y,bs.x,bs.y,0).setAlpha(.3);this.getLayerManager().addToLayer(Ws.Background,e),this.getLayerManager().addToLayer(Ws.Background,t)}renderBindings(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getBindings(),a=ks({numOfItems:t.length,xSpacing:0,ySpacing:zr.key.yInterval});e.add(t.map(((e,t)=>this.createBinding(e.key,e.text,a[t][1]<450?a[t][0]-zr.key.xOffset:a[t][0]+zr.key.xOffset,a[t][1]<450?a[t][1]+zr.key.yOffset1:a[t][1]+zr.key.yOffset2))));const s=new nr(this,(()=>{this.getLayerManager().clearAllLayers(),this.scene.start("MainMenu")}));this.getLayerManager().addToLayer(Ws.UI,e),this.getLayerManager().addToLayer(Ws.UI,s)}getBindings(){return[{key:"Esc",text:"Escape Menu"},{key:"Tab",text:"Dashboard"},{key:"Space",text:"Next dialogue"},{key:"E",text:"Explore mode"},{key:"V",text:"Move mode"},{key:"T",text:"Talk mode"},{key:"<Number>",text:"       Select topics/locations"}]}createBinding(e,t,a,s){const n=new Phaser.GameObjects.Container(this,a,s),i=new Phaser.GameObjects.Sprite(this,zr.icon.x,0,Hs.squareKeyboardIcon.key);if("Tab"===e)i.setTexture(Hs.medKeyboardIcon.key);if("Space"===e)i.setTexture(Hs.medKeyboardIcon.key);if("<Number>"===e)i.setTexture(Hs.medKeyboardIcon.key);const r=Ms(this,e,zr.keyTextConfig,Vr),o=Ms(this,t,zr.keyDescTextConfig,Hr);return n.add([i,r,o]),n}}const $r=Kr,Xr=(e,t,a)=>new Promise((s=>{"__MISSING"!==e.textures.get(t).key?s(t):(e.load.image(t,a),e.load.once(`filecomplete-image-${t}`,s),e.load.once("loaderror",s),e.load.start())})),Wr=(e,t,a)=>new Promise((s=>{e.cache.text.exists(t)?s(t):(e.load.text(t,a),e.load.once(`filecomplete-text-${t}`,s),e.load.start())})),qr={key:xs.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Zr={key:xs.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Yr={key:xs.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Jr={arrow:{xOffset:875},buttons:{scale:.65},resetButton:{xOffset:135,yOffset:85},playButton:{xOffset:55,yOffset:85},frame:{xOffset:12,yOffset:-4},scrollSpeed:100,indexTextConfig:{x:0,y:-110,oriX:.5,oriY:.5},titleTextConfig:{x:0,y:-50,oriX:.5,oriY:.5},pageNumberTextConfig:{x:fs.x,y:bs.y-30,oriX:.5,oriY:.5},imageRect:{width:400,height:280},imageScale:{x:.8,y:.4},chapComplete:{y:10,height:30,text:"Chapter Completed"},grid:{chapPerRow:3,chapPerCol:3,chapPerPage:9,chapGapX:50,chapGapY:50}},Qr=e=>Qs(`/stories/${e}`,!0),eo={defaultCheckpoint:{key:"default-chap",path:Qr("defaultCheckpoint.txt")},awardsMapping:{key:"awards-mapping",path:Qr("awardsMapping.txt")},roomPreviewMapping:{key:"room-prev-mapping",path:Qr("roomPreviewMapping.txt")}},to={defaultCheckpoint:{key:"mock-default-chap",path:"../../assets/mockDefaultCheckpoint.txt"},awardsMapping:{key:"mock-awards-mapping",path:"../../assets/mockAwardsMapping.txt"},roomPreviewMapping:{key:"mock-room-prev-mapping",path:"../../assets/mockRoomPreviewMapping.txt"}},ao=eo;const so=class{constructor(){this.getLocationAtId=e=>en(this.locations.get(e),`Location ${e} was not found!`),this.getAssetByKey=e=>en(this.mapAssets.get(e),`Asset ${e} not found!`),this.soundAssets=[],this.mapAssets=new Map,this.locations=new Map,this.dialogues=new Map,this.objects=new Map,this.boundingBoxes=new Map,this.characters=new Map,this.actions=new Map,this.gameStartActions=[],this.checkpointCompleteActions=[]}addSoundAsset(e){this.soundAssets.push(e)}addMapAsset(e,t){this.mapAssets.set(e,t)}getMapAssets(){return this.mapAssets}addLocation(e,t){this.locations.set(e,t)}setModesAt(e,t){this.getLocationAtId(e).modes=new Set(t)}setNavigationFrom(e,t){this.getLocationAtId(e).navigation=new Set(t)}getNavigationFrom(e){return this.getLocationAtId(e).navigation}setGameStartActions(e){this.gameStartActions=e}setCheckpointCompleteActions(e){this.checkpointCompleteActions=e}getGameStartActions(){return this.gameStartActions}getCheckpointCompleteActions(){return this.checkpointCompleteActions}getLocations(){return this.locations}getObjectPropMap(){return this.objects}getBBoxPropMap(){return this.boundingBoxes}getDialogueMap(){return this.dialogues}getCharacterMap(){return this.characters}getActionMap(){return this.actions}getSoundAssets(){return this.soundAssets}setItemInMap(e,t,a){this[e].set(t,a)}addItemToLocation(e,t,a){this.getLocationAtId(e)[t].add(a)}setBGMusicAt(e,t){this.getLocationAtId(e).bgmKey=t}getLocationIds(){return Array.from(this.locations.keys())}getAssetKeyFromId(e){var t,a;return en((null===(t=this.objects.get(e))||void 0===t?void 0:t.assetKey)||(null===(a=this.locations.get(e))||void 0===a?void 0:a.assetKey),`Id ${e} not found!`)}};const no=class{constructor(){this.objective=new Map,this.totalNumOfObjectives=0,this.numOfCompletedObjectives=0}setObjective(e,t){const a=this.objective.get(e);this.objective.set(e,t),void 0!==a&&a!==t&&this.numOfCompletedObjectives++}addObjective(e){this.objective.set(e,!1),this.totalNumOfObjectives++}addObjectives(e){e.forEach((e=>this.addObjective(e)))}isAllComplete(){return this.numOfCompletedObjectives>=this.totalNumOfObjectives}getObjectiveState(e){const t=this.objective.get(e);if(void 0===t)throw new Error(`Cannot find objective with the given task id "${e}"`);return t}getObjectives(){return this.objective}setObjectives(e){this.objective=e}};const io=class{constructor(){this.tasks=new Map,this.taskDetails=new Map}setTask(e,t){this.tasks.set(e,t)}showTask(e){const t=this.taskDetails.get(e);if(void 0!==t){const a={...t,visible:!0};this.taskDetails.set(e,a)}}addTask(e){const t=e.taskId;this.tasks.set(t,!1),this.taskDetails.set(t,e)}addTasks(e){e.forEach((e=>this.addTask(e)))}getTaskState(e){const t=this.tasks.get(e);if(void 0===t)throw new Error(`Cannot find task with the given task id "${e}"`);return t}getTaskDetail(e){const t=this.taskDetails.get(e);if(void 0===t)throw new Error(`Cannot find task with the given task id "${e}"`);return t}getAllTasks(){return this.tasks}getAllIncompleteTasks(){const e=new Array;for(const a of this.tasks.keys()){var t;!this.tasks.get(a)&&null!==(t=this.taskDetails.get(a))&&void 0!==t&&t.visible&&e.push(a)}return e}getAllVisibleTaskData(){const e=new Array;for(const t of this.tasks.keys()){const a=this.getTaskState(t),s=this.getTaskDetail(t);void 0!==a&&void 0!==s&&s.visible&&e.push([s,a])}return e}},ro={small:oi.Small,medium:oi.Medium,large:oi.Large},oo={left:ri.Left,middle:ri.Middle,right:ri.Right},lo={talk:_i.Talk,explore:_i.Explore,move:_i.Move,menu:_i.Menu},co={navigation:Kn.navigation,talkTopics:Kn.talkTopics,objects:Kn.objects,boundingBoxes:Kn.boundingBoxes,characters:Kn.characters,actions:Kn.actions,bgmKey:Kn.bgmKey,collectibles:Kn.collectibles},ho={move_character:zn.MoveCharacter,update_character:zn.UpdateCharacter,obtain_collectible:zn.ObtainCollectible,complete_objective:zn.CompleteObjective,complete_task:zn.CompleteTask,show_task:zn.ShowTask,add_item:zn.AddItem,remove_item:zn.RemoveItem,change_background:zn.ChangeBackground,start_animation:zn.StartAnimation,stop_animation:zn.StopAnimation,show_dialogue:zn.ShowDialogue,add_mode:zn.AddLocationMode,remove_mode:zn.RemoveLocationMode,add_popup:zn.AddPopup,make_object_glow:zn.MakeObjectGlow,make_object_blink:zn.MakeObjectBlink,play_bgm:zn.PlayBGM,play_sfx:zn.PlaySFX,preview_location:zn.PreviewLocation,show_object_layer:zn.ShowObjectLayer,navigate_to_assessment:zn.NavigateToAssessment,update_assessment_status:zn.UpdateAssessmentStatus,delay:zn.Delay},uo={checklist:Bn.ChecklistState,tasklist:Bn.TasklistState,userstate:Bn.UserState},go={assessments:Un.assessments,achievements:Un.achievements,collectibles:Un.collectibles};class po{static stringToSize(e){return ro[e]||oi.Medium}static stringToPosition(e){return oo[e]||ri.Middle}static stringToGameMode(e){return en(lo[e],`Invalid location mode, ${e}`)}static stringToActionType(e){return en(ho[e],`Invalid action type, ${e}`)}static stringToGameStateStorage(e){return en(uo[e],`Invalid condition type, ${e}`)}static stringToGameItemType(e){return en(co[e],`Invalid entity type, ${e}`)}static stringToBoolean(e){return"false"!==e}static stringToUserStateType(e){return en(go[e],`Invalid user state type ${e}`)}}let mo=function(e){return e.locations="locations",e.objectives="objectives",e.tasks="tasks",e.bgms="bgms",e.sfxs="sfxs",e}({});class xo{constructor(){this.gameAnimMaps=[Oo.checkpoint.map.getLocations(),Oo.checkpoint.map[Kn.objects]],this.gameItemAsserts=new Map,this.gameEntityAsserts=new Map,this.gameAnimAsserts=[],this.allItemIds=new Set}registerId(e){if(this.allItemIds.has(e))throw new Error(`Duplicate item id ${e}`);this.allItemIds.add(e)}verifyAssertions(){this.verifyGameItemAssert(),this.verifyGameEntityAsserts(),this.verifyGameAnimAsserts()}assertItemType(e,t,a){e===Kn.talkTopics?e=Kn.dialogues:e===Kn.navigation&&(e=Kn.locations),this.gameItemAsserts.get(e)||this.gameItemAsserts.set(e,[]),this.gameItemAsserts.get(e).push({itemId:t,actionType:a})}verifyGameItemAssert(){this.gameItemAsserts.forEach(((e,t)=>{e.forEach((e=>{const{itemId:a,actionType:s}=e;if(!Oo.checkpoint.map[t].has(a))throw s&&this.actionAssertionError(a,t,s),new Error(`Cannot find id "${a}" under ${t} entity type`)}))}))}assertItemTypes(e,t,a){t.forEach((t=>this.assertItemType(e,t,a)))}assertEntityType(e,t,a){this.gameEntityAsserts.get(e)||this.gameEntityAsserts.set(e,[]),this.gameEntityAsserts.get(e).push({itemId:t,actionType:a})}verifyGameEntityAsserts(){this.gameEntityAsserts.forEach(((e,t)=>{e.forEach((e=>{const{itemId:a,actionType:s}=e;switch(t){case mo.locations:Oo.checkpoint.map.getLocationAtId(a);break;case mo.objectives:if(void 0===Oo.checkpoint.objectives.getObjectives().get(a))throw s&&this.actionAssertionError(a,t,s),new Error(`Cannot find objective id "${a}"`);break;case mo.tasks:if(void 0===Oo.checkpoint.tasks.getAllTasks().get(a))throw s&&this.actionAssertionError(a,t,s),new Error(`Cannot find task id "${a}"`);break;case mo.bgms:const e=Oo.checkpoint.map.getSoundAssets().filter((e=>e.soundType===$s.BGM&&e.key===a)).length;if(0===e)throw new Error(`Cannot find bgm key "${a}"`);if(e>1)throw new Error(`More than 1 bgm key "${a}"`);break;case mo.sfxs:const n=Oo.checkpoint.map.getSoundAssets().filter((e=>e.soundType===$s.SFX&&e.key===a)).length;if(0===n)throw new Error(`Cannot find sfx key "${a}"`);if(n>1)throw new Error(`More than 1 sfx key "${a}"`)}}))}))}assertAnimType(e,t){this.gameAnimAsserts.push({itemId:e,actionType:t})}verifyGameAnimAsserts(){this.gameAnimAsserts.forEach((e=>{const{itemId:t,actionType:a}=e;let s=!1;this.gameAnimMaps.forEach((e=>{e.get(t)&&(s=!0)})),s||this.actionAssertionError(t,"locationId or itemId",a)}))}actionAssertionError(e,t,a){throw new Error(`Expected type of "${t}" as argument for "${a}", obtained "${e}" which is either undefined or the wrong id.`)}}class yo{static parse(e){const t="!"===e[0];t&&(e=e.slice(1));const[a,...s]=li.splitByChar(e,".");switch(po.stringToGameStateStorage(a)){case Bn.ChecklistState:return Oo.validator.assertEntityType(mo.objectives,s[0]),{state:Bn.ChecklistState,conditionParams:{id:s[0]},boolean:!t};case Bn.TasklistState:return Oo.validator.assertEntityType(mo.tasks,s[0]),{state:Bn.TasklistState,conditionParams:{id:s[0]},boolean:!t};case Bn.UserState:return{state:Bn.UserState,conditionParams:{userStateType:po.stringToUserStateType(s[0]),id:s[1]},boolean:!t};default:throw new Error("Parsing error: Invalid condition param")}}}class bo{static parseActions(e){return e.map((e=>this.parseAction(e)))}static parseAction(e){const[t,a]=li.splitByChar(e,"if"),s=this.parseActionContent(t);return a&&(s.actionConditions=li.splitByChar(a,"AND").map((e=>yo.parse(e)))),Oo.checkpoint.map.setItemInMap(Kn.actions,s.interactionId,s),s.interactionId}static parseActionContent(e){const[t,a]=li.splitByChar(e,"(");let s=!1,n=t;"*"===t[t.length-1]&&(s=!0,n=n.slice(0,-1));const i=po.stringToActionType(n),r=li.splitByChar(a.slice(0,-1),","),o={};switch(i){case zn.ObtainCollectible:o.id=r[0];break;case zn.CompleteObjective:o.id=r[0],Oo.validator.assertEntityType(mo.objectives,r[0],n);break;case zn.CompleteTask:case zn.ShowTask:o.id=r[0],Oo.validator.assertEntityType(mo.tasks,r[0],n);break;case zn.PreviewLocation:case zn.ChangeBackground:o.id=r[0],Oo.validator.assertEntityType(mo.locations,r[0],n);break;case zn.StartAnimation:o.id=r[0],o.startFrame=+r[1],o.frameRate=+r[2],o.assetCategory=r[3],Oo.validator.assertAnimType(r[0],n);break;case zn.StopAnimation:o.id=r[0],Oo.validator.assertAnimType(r[0],n);break;case zn.ShowDialogue:o.id=r[0],Oo.validator.assertItemType(Kn.dialogues,r[0],n);break;case zn.AddItem:case zn.RemoveItem:const e=po.stringToGameItemType(r[0]);o.gameItemType=e,o.locationId=r[1],Oo.validator.assertEntityType(mo.locations,r[1],n),o.id=r[2],Oo.validator.assertItemType(e,r[2],n);break;case zn.AddLocationMode:case zn.RemoveLocationMode:Oo.validator.assertEntityType(mo.locations,r[0],n),o.locationId=r[0],o.mode=po.stringToGameMode(r[1]);break;case zn.AddPopup:Oo.validator.assertItemType(Kn.objects,r[0],n),o.id=r[0],o.position=po.stringToPosition(r[1]),r[2]&&(o.duration=1e3*parseInt(r[2])),r[3]&&(o.size=po.stringToSize(r[3]));break;case zn.MakeObjectBlink:case zn.MakeObjectGlow:Oo.validator.assertItemType(Kn.objects,r[0],n),o.id=r[0],o.turnOn=po.stringToBoolean(r[1]);break;case zn.PlayBGM:o.id=r[0],Oo.validator.assertEntityType(mo.bgms,r[0],n);break;case zn.PlaySFX:o.id=r[0],Oo.validator.assertEntityType(mo.sfxs,r[0],n);break;case zn.ShowObjectLayer:o.show=po.stringToBoolean(r[0]);break;case zn.UpdateCharacter:Oo.validator.assertItemType(Kn.characters,r[0],n),o.id=r[0],o.expression=r[1];break;case zn.MoveCharacter:Oo.validator.assertItemType(Kn.characters,r[0],n),Oo.validator.assertEntityType(mo.locations,r[1],n),o.id=r[0],o.locationId=r[1],o.position=po.stringToPosition(r[2]);break;case zn.NavigateToAssessment:o.assessmentId=r[0];break;case zn.Delay:o.duration=1e3*parseInt(r[0])}return{actionType:i,actionParams:o,actionConditions:[],interactionId:Oo.generateActionId(),isInteractive:!1,isRepeatable:s}}}class fo{static parsePrompt(e,t){return{promptTitle:e.split("prompt:")[1].trim(),choices:t.map(this.splitChoice)}}static splitChoice(e){const t=li.splitWithLimit(e,"->",1);return[t[0].trim(),t[1].split(" ")[1].trim()]}}class vo{static parse(e,t){t.forEach((t=>this.parseCharacterDetails(e,t)))}static characterAssetKey(e,t){return e+"-"+t}static characterAssetPath(e,t){return`/avatars/${e}/${e}.${t}.png`}static parseCharacterDetails(e,t){const a="+"===t[0];a&&(t=t.slice(1));const[s,n,i,r,o]=li.splitByChar(t,",");Oo.validator.registerId(s);const l=new Map,c={id:s,name:n,expressions:l,defaultExpression:i,defaultPosition:po.stringToPosition(r),scale:o?parseFloat(o):1};l.set(i,this.characterAssetKey(s,i)),Oo.checkpoint.map.addMapAsset(this.characterAssetKey(s,i),{type:zs.Image,path:this.characterAssetPath(s,i),key:s}),Oo.checkpoint.map.setItemInMap(Kn.characters,s,c),a&&Oo.checkpoint.map.addItemToLocation(e,Kn.characters,s)}}class Co{static parse(e){const[t,a,s]=li.splitByChar(e.slice(1),","),n=po.stringToPosition(s);return this.addCharacterExprToMap(t,a),{speakerId:t,expression:a,speakerPosition:n}}static addCharacterExprToMap(e,t){if("you"===e||"narrator"===e)return;const a=Oo.checkpoint.map.getCharacterMap().get(e);if(!a)throw new Error(`Character "${e}" not in map`);const s=t||a.defaultExpression;a.expressions.set(t,vo.characterAssetKey(e,t||s)),Oo.checkpoint.map.addMapAsset(vo.characterAssetKey(e,s),{path:vo.characterAssetPath(e,s),type:zs.Image,key:e})}}class jo{static parse(e){li.splitToParagraph(e).forEach((([e,t])=>{0!==t.length?this.parseDialogue(e,t):console.error("No dialogue found for dialogueId")}))}static parseDialogue(e,t){const[a,s]=li.splitWithLimit(e,",",1);Oo.validator.registerId(a);const n={title:s,content:this.parseDialogueContent(t)};n.title||(n.title=li.toCapitalizedWords(a)),Oo.checkpoint.map.setItemInMap(Kn.dialogues,a,n)}static parseDialogueContent(e){return function(e,t){const a=new Map;return e.forEach(((e,s)=>{const n=t(e,s);a.set(s,n)})),a}(li.mapByHeader(e,So),this.createDialogueLines)}static createDialogueLines(e){const t=[];let a=0;for(;a!==e.length;){const s=e[a];switch(!0){case Io(s):const[n,i]=li.splitByChar(s,"if"),[r,o]=i?li.splitByChar(i,"else"):[null,null],l=r?li.splitByChar(r,"AND").map((e=>yo.parse(e))):[];t[t.length-1].goto={conditions:l,part:n.split(" ")[1],altPart:o};break;case Ao(s):const c=s,d=[];for(;e[a+1]&&To(e[a+1]);)a++,d.push(e[a].trim());const h=fo.parsePrompt(c,d);t[t.length-1].prompt=h;break;case ko(s):const u=t[t.length-1];!u.actionIds&&(u.actionIds=[]),u.actionIds.push(bo.parseAction(s));break;case wo(s):a++;const g=e[a];if(!g)throw new Error("Parsing error: Cannot change speaker without next line");t.push({line:g}),t[t.length-1].speakerDetail=Co.parse(s);break;default:t.push({line:s}),t[t.length-1].speakerDetail=Co.parse("@narrator")}a++}return t}}const So=e=>new RegExp(/^[0-9]+$/).test(e),Io=e=>new RegExp(/^goto [0-9]+.*$/).test(e),ko=e=>e&&("\t"===e[0]||"    "===e.slice(0,4)),wo=e=>e&&"@"===e[0],Ao=e=>e.trim().startsWith("prompt:"),To=e=>new RegExp(/-> +goto/).test(e);class Mo{static parse(e){e.forEach((e=>{const[t,a,s,n,i]=li.splitByChar(e,",");Oo.validator.registerId(t),Oo.checkpoint.map.addLocation(t,{id:"",name:"",assetKey:"",previewKey:null,modes:new Set([]),navigation:new Set([]),talkTopics:new Set([]),objects:new Set([]),boundingBoxes:new Set([]),bgmKey:"",characters:new Set([]),id:t,name:s,assetKey:this.locationAssetKey(a)}),Oo.checkpoint.map.addMapAsset(this.locationAssetKey(a),{type:zs[n]||zs.Image,key:t,path:this.locationPath(a),config:{frameWidth:bs.x,frameHeight:bs.y,centreX:fs.x,centreY:fs.y,endFrame:parseInt(i)-1||0,animType:Vs.Background}})}))}static locationAssetKey(e){return e}static locationPath(e){return e}}class Po{static parse(e,t){li.splitToParagraph(t).forEach((([t,a])=>{const s=this.parseBBoxConfig(e,t);a.length&&(s.isInteractive=!0,s.actionIds=bo.parseActions(a))}))}static parseBBoxConfig(e,t){const a="+"===t[0];a&&(t=t.slice(1));const[s,n,i,r,o]=li.splitByChar(t,","),l={x:parseInt(n),y:parseInt(i),width:parseInt(r),height:parseInt(o),isInteractive:!1,interactionId:s};return Oo.validator.registerId(s),Oo.checkpoint.map.setItemInMap(Kn.boundingBoxes,s,l),a&&Oo.checkpoint.map.addItemToLocation(e,Kn.boundingBoxes,s),l}}class Eo{static parse(e,t,a){t.forEach(((t,s)=>{const[n,i,r]=li.splitByChar(t,",");Oo.validator.registerId(n),Oo.checkpoint.map.addSoundAsset({key:n,path:i,config:{volume:parseFloat(r),loop:a===$s.BGM},soundType:a}),a===$s.BGM&&0===s&&Oo.checkpoint.map.setBGMusicAt(e,n)}))}}class No{static parse(e,t){li.splitToParagraph(t).forEach((([t,a])=>{const s=this.parseObjectConfig(e,t);a.length&&(s.isInteractive=!0,s.actionIds=bo.parseActions(a))}))}static objectAssetKey(e){return e}static objectPath(e){return e}static parseObjectConfig(e,t){const a="+"===t[0];a&&(t=t.slice(1));const[s,n,i,r,o,l,c,d]=li.splitByChar(t,",");Oo.validator.registerId(s);const h={assetKey:this.objectAssetKey(n),x:parseInt(i),y:parseInt(r),width:parseInt(o)||void 0,height:parseInt(l)||void 0,isInteractive:!1,interactionId:s};return Oo.checkpoint.map.addMapAsset(this.objectAssetKey(n),{type:zs[c]||zs.Image,key:s,path:this.objectPath(n),config:{frameHeight:parseInt(l)||-1,frameWidth:parseInt(o)||-1,centreX:0,centreY:0,endFrame:parseInt(d)-1||0,animType:Vs.Object}}),Oo.checkpoint.map.setItemInMap(Kn.objects,s,h),a&&Oo.checkpoint.map.addItemToLocation(e,Kn.objects,s),h}}class Ro{static parse(e,t){const a=Oo.checkpoint.map.getLocationAtId(e);li.splitToParagraph(t).forEach((([e,t])=>{0===t.length&&e.includes(":")?this.parseLocationConfig(a,e):this.parseLocationParagraphs(a,e,t)}))}static parseLocationConfig(e,t){const[a,s]=li.splitByChar(t,":"),n=li.splitByChar(s,",");switch(a){case"modes":n.forEach((t=>{const a=po.stringToGameMode(t);e.modes.add(a)}));break;case"nav":n.forEach((t=>{Oo.validator.assertEntityType(mo.locations,t),e.navigation.add(t)}));break;case"talkTopics":const t=n;Oo.validator.assertItemTypes(Kn.dialogues,t),e.talkTopics=new Set(t);break;case"preview":const[s]=n;if(s){const t="/preview"+s;Oo.checkpoint.map.addMapAsset(t,{type:zs.Image,key:e.id+"Preview",path:s}),e.previewKey=t}break;default:throw new Error(`Invalid config key "${a}" specified under location "${e.id}"`)}}static parseLocationParagraphs(e,t,a){switch(t){case"objects":No.parse(e.id,a);break;case"boundingBoxes":Po.parse(e.id,a);break;case"characters":vo.parse(e.id,a);break;case"bgm":Eo.parse(e.id,a,$s.BGM);break;case"sfx":Eo.parse(e.id,a,$s.SFX);break;case"actions":e.actionIds=bo.parseActions(a);break;default:throw new Error(`Invalid location paragraph header "${t}"`)}}}class Do{static parse(e){const t=[];e.forEach((e=>{const[a,s,n]=li.splitWithLimit(e,",",2),i={taskId:a,title:s,description:n,visible:!1};t.push(i)})),Oo.checkpoint.tasks.addTasks(t)}}class Lo{static generateActionId(){return Lo.actionIdNum++,`action#${Lo.actionIdNum}`}static init(){Lo.actionIdNum=0,Lo.checkpoint={map:new so,startingLoc:"",objectives:new no,tasks:new io},Lo.validator=new xo}static parse(e,t=!1){t||Lo.init();const a=li.splitToLinesAndRemoveComments(e);li.splitToParagraph(a).forEach((([e,t])=>{0===t.length&&e.includes(":")?Lo.parseCheckpointConfig(e):Lo.parseCheckpointParagraphs(e,t)||Ro.parse(e,t)})),Lo.validator.verifyAssertions()}static parseCheckpointConfig(e){const[t,a]=li.splitByChar(e,":");if("startingLoc"!==t)throw new Error(`Invalid checkpoint config key, "${e}"`);Lo.validator.assertEntityType(mo.locations,a),Lo.checkpoint.startingLoc=a}static parseCheckpointParagraphs(e,t){switch(e){case"objectives":Lo.checkpoint.objectives.addObjectives(t);break;case"tasks":Do.parse(t);break;case"locations":Mo.parse(t);break;case"gameStartActions":Lo.checkpoint.map.setGameStartActions(bo.parseActions(t));break;case"checkpointCompleteActions":Lo.checkpoint.map.setCheckpointCompleteActions(bo.parseActions(t));break;case"dialogues":jo.parse(t);break;default:return!1}return!0}}const Oo=Lo;async function _o(e,t,a){const s=vl.getInstance().getIsUsingMock()?to:ao,n=vl.getInstance().getCurrentSceneRef(),i=vl.getInstance().getGameChapters()[t].filenames[a];if(!i)return;await Wr(n,i,i),await Wr(n,s.defaultCheckpoint.key,s.defaultCheckpoint.path);const r=n.cache.text.get(i),o=n.cache.text.get(s.defaultCheckpoint.key);Oo.parse(o),Oo.parse(r,!0);const l=Oo.checkpoint;n.scene.start("GameManager",{gameCheckpoint:l,continueGame:e,chapterNum:t,checkpointNum:a})}async function Go(){const e=vl.getInstance().getCurrentSceneRef(),t=vl.getInstance().getSSChapterSimFilenames();if(!t.length)return void e.scene.start("GameSimulatorMenu");const a=t.pop();await Wr(e,a,Qr(a)),await Wr(e,ao.defaultCheckpoint.key,ao.defaultCheckpoint.path);const s=e.cache.text.get(a),n=e.cache.text.get(ao.defaultCheckpoint.key);Oo.parse(n),Oo.parse(s,!0);const i=Oo.checkpoint;return e.scene.start("GameManager",{gameCheckpoint:i,chapterNum:-1,checkpointNum:-1}),!0}function Bo(e,{title:t,imageUrl:a},s){const[n,i]=function(e){const t=Math.floor(e/Jr.grid.chapPerPage);e%=Jr.grid.chapPerPage;const a=Math.floor(e/Jr.grid.chapPerRow),s=e%Jr.grid.chapPerRow,n=(Jr.grid.chapPerRow-1)/2,i=(Jr.grid.chapPerCol-1)/2;let r=t*bs.x+fs.x;r+=(s-n)*(Jr.imageRect.width+Jr.grid.chapGapX);let o=fs.y;return o+=(a-i)*(Jr.imageRect.height+Jr.grid.chapGapY),[r,o]}(s),r=new Phaser.GameObjects.Container(e,n,i),o=s<=vl.getInstance().getSaveManager().getLargestCompletedChapterNum(),l=new Phaser.GameObjects.Image(e,0,0,a).setDisplaySize(Jr.imageRect.width,Jr.imageRect.height),c=new Phaser.GameObjects.Sprite(e,Jr.frame.xOffset,Jr.frame.yOffset,Hs.chapterSelectFrame.key).setScale(.99*Jr.imageScale.x,.99*Jr.imageScale.y),d=new Phaser.GameObjects.Rectangle(e,0,Jr.chapComplete.y,Jr.imageRect.width,Jr.chapComplete.height,0).setOrigin(.5).setAlpha(.7).setInteractive().setVisible(o),h=Ms(e,Jr.chapComplete.text,{x:0,y:Jr.chapComplete.y,oriX:.5,oriY:.5},qr).setVisible(o),u=new Ts(e,Jr.resetButton.xOffset+8,Jr.resetButton.yOffset-20,"Reset progress"),g=new Ts(e,Jr.playButton.xOffset+8,Jr.playButton.yOffset-20,"Play/Continue"),p=Pn(e,{assetKey:Hs.chapterRepeatButton.key,onUp:async()=>await _o(!1,s,0),onHover:()=>u.setVisible(!0),onOut:()=>u.setVisible(!1)}).setPosition(Jr.resetButton.xOffset,Jr.resetButton.yOffset).setScale(Jr.buttons.scale),m=vl.getInstance().getSaveManager().getChapterSaveState(s).lastCheckpointPlayed,x=Pn(e,{assetKey:Hs.chapterContinueButton.key,onUp:async()=>await _o(!0,s,m),onHover:()=>g.setVisible(!0),onOut:()=>g.setVisible(!1)}).setPosition(Jr.playButton.xOffset,Jr.playButton.yOffset).setScale(Jr.buttons.scale),y=Ms(e,`Chapter ${s}`,Jr.indexTextConfig,qr),b=Ms(e,t,Jr.titleTextConfig,Zr),f=s<=vl.getInstance().getSaveManager().getLargestCompletedChapterNum()+1,v=new Phaser.GameObjects.Rectangle(e,0,0,Jr.imageRect.width,Jr.imageRect.height,0).setOrigin(.5).setAlpha(f?0:.8).setInteractive();return r.add([l,c,d,h,p,x,u,g,y,b,v]),r}class Uo extends Phaser.Scene{constructor(){super("ChapterSelect"),this.getGameChapters=()=>vl.getInstance().getGameChapters(),this.getLayerManager=()=>en(this.layerManager),this.chaptersContainer=void 0,this.backButtonContainer=void 0,this.pageNumberText=void 0,this.targetPage=0}preload(){vi(this)}async create(){vl.getInstance().setCurrentSceneRef(this),this.layerManager=new Ni(this),await this.preloadChapterAssets(),this.renderBackground(),this.renderChapters()}update(){if(!this.chaptersContainer)return;const e=-this.targetPage*bs.x;if(this.chaptersContainer.x>e){const t=this.chaptersContainer.x-Jr.scrollSpeed;this.chaptersContainer.x=Math.max(t,e)}else if(e>this.chaptersContainer.x){const t=this.chaptersContainer.x+Jr.scrollSpeed;this.chaptersContainer.x=Math.min(t,e)}}cleanUp(){this.getLayerManager().clearAllLayers()}async preloadChapterAssets(){await Promise.all(this.getGameChapters().map((async e=>await Xr(this,e.imageUrl,Qs(e.imageUrl,!0)))))}renderBackground(){const e=new Phaser.GameObjects.Image(this,fs.x,fs.y,Hs.spaceshipBg.key),t=new Phaser.GameObjects.Rectangle(this,fs.x,fs.y,bs.x,bs.y,0).setAlpha(.3);this.getLayerManager().addToLayer(Ws.Background,e),this.getLayerManager().addToLayer(Ws.Background,t)}renderChapters(){this.backButtonContainer=new nr(this,(()=>{this.cleanUp(),this.scene.start("MainMenu")})),this.chaptersContainer=this.createChaptersContainer(),this.pageNumberText=Ms(this,`1 / ${this.numPages()}`,Jr.pageNumberTextConfig,Yr);const e=Math.min(vl.getInstance().getSaveManager().getLargestCompletedChapterNum()+1,this.getGameChapters().length-1);this.targetPage=Math.floor(e/Jr.grid.chapPerPage),this.targetPage<0&&(this.targetPage=0),this.pageNumberText.setText(`${this.targetPage+1} / ${this.numPages()}`);const t=new Phaser.GameObjects.Image(this,fs.x,fs.y,Hs.chapterSelectBorder.key),a=Pn(this,{assetKey:Hs.chapterSelectArrow.key,onUp:()=>this.scrollPrevPage()}).setPosition(fs.x-Jr.arrow.xOffset,fs.y),s=Pn(this,{assetKey:Hs.chapterSelectArrow.key,onUp:()=>this.scrollNextPage()}).setPosition(fs.x+Jr.arrow.xOffset,fs.y).setScale(-1,1);this.getLayerManager().addToLayer(Ws.UI,this.chaptersContainer),this.getLayerManager().addToLayer(Ws.UI,this.backButtonContainer),this.getLayerManager().addToLayer(Ws.UI,this.pageNumberText),this.getLayerManager().addToLayer(Ws.UI,t),this.getLayerManager().addToLayer(Ws.UI,a),this.getLayerManager().addToLayer(Ws.UI,s)}createChaptersContainer(){const e=new Phaser.GameObjects.Container(this,0,0);return e.add(this.getGameChapters().map(((e,t)=>Bo(this,e,t)))).sort("depth").reverse(),e}numPages(){const e=Math.ceil(this.getGameChapters().length/Jr.grid.chapPerPage);return Math.max(e,1)}scrollPrevPage(){var e;this.targetPage=Math.max(this.targetPage-1,0),null===(e=this.pageNumberText)||void 0===e||e.setText(`${this.targetPage+1} / ${this.numPages()}`)}scrollNextPage(){var e;const t=this.numPages();this.targetPage=Math.min(this.targetPage+1,t-1),null===(e=this.pageNumberText)||void 0===e||e.setText(`${this.targetPage+1} / ${t}`)}}const Fo=Uo,zo={key:xs.alienCowsFont.key,size:80,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Vo=1500,Ho={text:{chapter:"Chapter completed.",checkpoint:"Checkpoint reached."},transitionTextConfig:{x:fs.x,y:fs.y,oriX:.5,oriY:.5},tweenDuration:Vo,entryTween:{alpha:1,duration:Vo,ease:"Power2"},exitTween:{alpha:0,duration:Vo,ease:"Power2"}};class Ko extends Phaser.Scene{constructor(){super("CheckpointTransition")}preload(){vl.getInstance().setCurrentSceneRef(this)}async create(){if(vl.getInstance().isGameType(fl.Simulator))return await this.showTransitionText(Ho.text.checkpoint),void await Go();const e=vl.getInstance().getSaveManager().getFullSaveState(),t=vl.getInstance().getGameChapters(),[a,s]=e.userSaveState.recentlyPlayedCheckpoint;return this.isLastCheckpoint(t,a,s)?(await vl.getInstance().getSaveManager().saveChapterComplete(a),await this.showTransitionText(Ho.text.chapter),this.isLastChapter(t,a)?void this.scene.start("ChapterSelect"):void await _o(!0,a+1,0)):(await this.showTransitionText(Ho.text.checkpoint),void await _o(!1,a,s+1))}async showTransitionText(e){const t=Ms(this,e,Ho.transitionTextConfig,zo).setAlpha(0);this.add.existing(t),this.tweens.add({targets:t,...Ho.entryTween}),await Ys(2*Ho.tweenDuration),this.tweens.add({targets:t,...Ho.exitTween}),await Ys(Ho.tweenDuration)}isLastCheckpoint(e,t,a){return a>=e[t].filenames.length-1}isLastChapter(e,t){return t>=e.length-1}}const $o=Ko,Xo={key:xs.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_RIGHT},Wo={text:{chapterSelect:"Play Chapter",studentRoom:"Go to My Room",awards:"Awards Hall",settings:"Settings",bindings:"Key Bindings"},button:{ySpace:.5*bs.y},buttonTextConfig:{x:600,y:0,oriX:1,oriY:.1},banner:{xHide:300},onFocusTween:{x:fs.x+200,duration:200,ease:"Power2"},outFocusTween:{x:fs.x+300,duration:200,ease:"Power2"},saBanner:{x:.3*bs.x,y:.9*bs.y}};class qo extends Phaser.Scene{constructor(){super("MainMenu"),this.getLayerManager=()=>en(this.layerManager)}async create(){vl.getInstance().setCurrentSceneRef(this),this.layerManager=new Ni(this),this.renderBackground(),this.renderOptionButtons(),Rr(this,"T",1.12*fs.x,1.1*fs.y),vl.getInstance().getSoundManager().playBgMusic(Xs.galacticHarmony.key)}renderBackground(){const e=new Phaser.GameObjects.Image(this,fs.x,fs.y,Hs.spaceshipBg.key).setDisplaySize(bs.x,bs.y),t=on(this).setAlpha(.15),a=new Phaser.GameObjects.Image(this,Wo.saBanner.x,Wo.saBanner.y,Hs.saBanner.key).setAlpha(.7);this.getLayerManager().addToLayer(Ws.Background,e),this.getLayerManager().addToLayer(Ws.Background,t),this.getLayerManager().addToLayer(Ws.Background,a)}renderOptionButtons(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getOptionButtons(),a=Ss({direction:js.Column,numOfItems:t.length,maxYSpace:Wo.button.ySpace});e.add(t.map(((e,t)=>this.createOptionButton(e.text,a[t][0]+Wo.banner.xHide,a[t][1],e.callback)))),this.getLayerManager().addToLayer(Ws.UI,e)}createOptionButton(e,t,a,s){const n=e=>{this.tweens.add({targets:e,...Wo.onFocusTween})},i=e=>{this.tweens.add({targets:e,...Wo.outFocusTween})},r=Pn(this,{assetKey:Hs.mainMenuOptBanner.key,message:e,textConfig:Wo.buttonTextConfig,bitMapTextStyle:Xo,onUp:s,onHover:()=>n(r),onOut:()=>i(r),onHoverEffect:!1}).setPosition(t,a);return r}getOptionButtons(){return[{text:Wo.text.chapterSelect,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("ChapterSelect")}},{text:Wo.text.awards,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("AwardsHall")}},{text:Wo.text.studentRoom,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("RoomPreview")}},{text:Wo.text.settings,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("Settings")}},{text:Wo.text.bindings,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("Bindings")}}]}}const Zo=qo;var Yo=a(46215),Jo=a(16671);const Qo='\nimport { prepend_remote_url, get_screen_width, get_screen_height, load_image, create_image, create_text, create_rect, add, set_display_size, set_alpha, set_origin } from \'game\';\n\nfunction preload() {\n    load_image("galaxy", prepend_remote_url("/locations/galaxy/normal.png"));\n}\n\nfunction create() {\n    const width = get_screen_width();\n    const height = get_screen_height();\n    const centre_x = width / 2;\n    const centre_y = height / 2;\n\n    const image = create_image(centre_x, centre_y, "galaxy");\n    const image_resized = set_display_size(image, width, height);\n\n    const black_tint = create_rect(centre_x, centre_y, width, height, 0x000011);\n    const black_tint_alpha = set_alpha(black_tint, 0.5);\n\n    const text = create_text(centre_x, centre_y, "Unable to fetch mission!");\n    const text_repos = set_origin(text, 0.5, 0.5);\n\n    add(image_resized);\n    add(black_tint_alpha);\n    add(text_repos);\n}\n\nfunction update() {}\n',el={key:xs.pixelFont.key,size:20,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},tl={assessmentNumber:"MYROOM",verifiedText:"VERIFIED",tag:{width:128,height:50},hoverTagTextConfig:{x:64,y:0,oriX:.5,oriY:.55},refreshButton:{x:.95*bs.x,y:.92*bs.y}};var al=a(95404);async function sl(){const e=await async function(){const e=(await(0,al.$C)(vl.getInstance().getAccountInfo())||[]).find((e=>e.number===tl.assessmentNumber));return e?e.id:null}();if(!e)return nl(null);return nl(await(0,al.AZ)(e,vl.getInstance().getAccountInfo()))}function nl(e){if(e){const t=e.questions[0],a=t.answer;return a||t.solutionTemplate}return Qo}class il extends Phaser.Scene{constructor(){super("RoomPreview"),this.sceneLoaded=!1,this.getVerifCont=()=>en(this.verifCont),this.getUserStateManager=()=>vl.getInstance().getUserStateManager(),this.getInputManager=()=>en(this.inputManager),this.getLayerManager=()=>en(this.layerManager),this.getPhaseManager=()=>en(this.phaseManager),this.getEscapeManager=()=>en(this.escapeManager),this.getCollectibleManager=()=>en(this.collectibleManager),this.getAchievementManager=()=>en(this.achievementManager),this.getToolbarManager=()=>en(this.toolbarManager),this.getDashboardManager=()=>en(this.dashboardManager),this.preloadImageMap=new Map,this.preloadSoundMap=new Map,this.preloadSpritesheetMap=new Map,this.studentCode=Qo}init(){vl.getInstance().setCurrentSceneRef(this),this.studentCode=vl.getInstance().getRoomCode(),this.createContext()}preload(){vi(this),this.verifCont=(e=>{const t=new Phaser.GameObjects.Container(e,0,0),a=new Phaser.GameObjects.Rectangle(e,0,0,tl.tag.width,tl.tag.height,Cs.darkBlue).setOrigin(0,.5).setAlpha(.8),s=new Phaser.GameObjects.Sprite(e,0,0,Hs.verifiedFrame.key).setOrigin(0,.5),n=new Phaser.GameObjects.Rectangle(e,0,.5*-a.height,a.width,.05*a.height,Cs.offWhite).setOrigin(0,0),i=Ms(e,tl.verifiedText,tl.hoverTagTextConfig,el).setBlendMode(Phaser.BlendModes.DIFFERENCE);return e.tweens.add({targets:n,alpha:.2,y:.35*a.height,duration:2e3,ease:"Power0",yoyo:!0,loop:-1}),t.add([a,i,n,s]),t.setVisible(!1),t})(this)}async create(){await this.eval(this.studentCode),this.renderDefaultBackground(),await this.eval("preload();"),await Promise.all(Array.from(this.preloadImageMap).map((async([e,t])=>{await Xr(this,e,t)}))),await Promise.all(Array.from(this.preloadSoundMap).map((async([e,t])=>{var a,s,n;await(a=this,s=e,n=t,new Promise((e=>{null!==a.sound.get(s)?e(s):(a.load.audio(s,n).on("filecomplete",e),a.load.start())})))}))),await Promise.all(Array.from(this.preloadSpritesheetMap).map((async([e,[t,a]])=>{await((e,t,a,s)=>new Promise((n=>{"__MISSING"!==e.textures.get(t).key?n(t):(e.load.spritesheet(t,a,s),e.load.once(`filecomplete-spritesheet-${t}`,n),e.load.once("loaderror",n),e.load.start())})))(this,e,t,a)})));const e=new Ts(this,tl.refreshButton.x-200,tl.refreshButton.y-30,"Refresh Room"),t=Pn(this,{assetKey:Hs.chapterRepeatButton.key,onUp:async()=>{await vl.getInstance().loadRoomCode(),this.studentCode=vl.getInstance().getRoomCode(),this.getLayerManager().clearAllLayers(),this.sound.stopAll(),this.sceneLoaded=!1,this.scene.restart()},onHover:()=>e.setVisible(!0),onOut:()=>e.setVisible(!1)}).setPosition(tl.refreshButton.x,tl.refreshButton.y);await this.eval("create();"),vl.getInstance().getSoundManager().playBgMusic(ys.nullInteractionId),this.initialiseManagers(),this.bindKeyboardTriggers(),this.getLayerManager().addToLayer(Ws.UI,this.getVerifCont()),this.getLayerManager().addToLayer(Ws.UI,t),this.getLayerManager().addToLayer(Ws.UI,e),this.getToolbarManager().renderToolbarContainer(),this.sceneLoaded=!0}update(){this.sceneLoaded&&this.eval("update();")}createContext(){this.context=(0,Jo.kr)(_.Chapter.SOURCE_4,[],"playground",_.Variant.DEFAULT),this.context.moduleContexts.game={tabs:null,state:{scene:this,preloadImageMap:this.preloadImageMap,preloadSoundMap:this.preloadSoundMap,preloadSpritesheetMap:this.preloadSpritesheetMap,remotePath:e=>Qs(e,!0),screenSize:bs,createAward:(e,t,a)=>this.createAward(e,t,a)}}}async eval(e){await(0,Yo.runInContext)(e,this.context)}bindKeyboardTriggers(){this.getInputManager().registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.ESC,"up",(async()=>{this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().popPhase():await this.getPhaseManager().pushPhase(Ln.EscapeMenu)})),this.getInputManager().registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.TAB,"up",(async()=>{this.getPhaseManager().isCurrentPhase(Ln.Dashboard)?await this.getPhaseManager().popPhase():this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().swapPhase(Ln.Dashboard):await this.getPhaseManager().pushPhase(Ln.Dashboard)}))}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers()}createAward(e,t,a){const s=this.getUserStateManager().getAchievements(),n=this.getUserStateManager().getCollectibles(),i=new Phaser.GameObjects.Sprite(this,e,t,Hs.cookies.key);if(!s.includes(a)&&!n.includes(a))return i;const r=Fs(a);if(!r.completed)return i;const o=new Phaser.GameObjects.Sprite(this,e,t,r.assetKey);return this.attachVerificationTag(o)}attachVerificationTag(e){const t=this.getVerifCont();return e.setInteractive({pixelPerfect:!0,useHandCursor:!0}),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,(()=>t.setVisible(!0))),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,(()=>t.setVisible(!1))),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,(e=>{t.x=e.x+10,t.y=e.y-10})),e}renderDefaultBackground(){const e=new Phaser.GameObjects.Image(this,fs.x,fs.y,this.getDefaultBackgroundKey());Wn(e,bs.x,bs.y),this.add.existing(e)}getDefaultBackgroundKey(){const e=this.getUserStateManager().getAssessments().reverse(),t=vl.getInstance().getRoomPreviewMapping();for(let a=0;a<e.length;a++)if(t.has(e[a]))return e[a];return Hs.sourceCrashedPod.key}initialiseManagers(){this.layerManager=new Ni(this),this.inputManager=new In(this),this.phaseManager=new Fi(new Map([[Ln.None,new jr]]),this.inputManager),this.escapeManager=new Ei(this),this.collectibleManager=new Zn(this,vl.getInstance().getUserStateManager().getCollectibles),this.achievementManager=new Zn(this,vl.getInstance().getUserStateManager().getAchievements),this.toolbarManager=new er(this),this.dashboardManager=new ni(this,[si.Collectibles,si.Achievements],[this.collectibleManager,this.achievementManager])}}class rl extends Phaser.Scene{constructor(){super("Settings"),this.getSaveManager=()=>vl.getInstance().getSaveManager(),this.getLayerManager=()=>en(this.layerManager)}async create(){vl.getInstance().setCurrentSceneRef(this),this.layerManager=new Ni(this),this.renderBackground(),this.renderOptions()}renderBackground(){const e=new Phaser.GameObjects.Image(this,fs.x,fs.y,Hs.spaceshipBg.key),t=new Phaser.GameObjects.Image(this,fs.x,fs.y,Hs.settingBanner.key);this.getLayerManager().addToLayer(Ws.Background,e),this.getLayerManager().addToLayer(Ws.Background,t)}renderOptions(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getSettingsHeader(),a=Ss({direction:js.Column,numOfItems:t.length,maxYSpace:wi.opt.ySpace});e.add(t.map(((e,t)=>this.createOptionHeader(e,a[t][1]))));const{bgmVolume:s,sfxVolume:n}=this.getSaveManager().getSettings(),i=wi.volContainerOpts.findIndex((e=>parseFloat(e)===n)),r=wi.volContainerOpts.findIndex((e=>parseFloat(e)===s));this.sfxVolumeRadioButtons=this.createOptRadioOptions(i,a[0][1]),this.bgmVolumeRadioButtons=this.createOptRadioOptions(r,a[1][1]);const o=Pn(this,{assetKey:Hs.mediumButton.key,message:"Apply Settings",textConfig:{x:0,y:0,oriX:.33,oriY:.85},bitMapTextStyle:ki,onUp:()=>this.applySettings()}).setPosition(fs.x,.925*bs.y),l=new nr(this,(()=>{this.getLayerManager().clearAllLayers(),this.scene.start("MainMenu")}));this.getLayerManager().addToLayer(Ws.UI,e),this.getLayerManager().addToLayer(Ws.UI,this.sfxVolumeRadioButtons),this.getLayerManager().addToLayer(Ws.UI,this.bgmVolumeRadioButtons),this.getLayerManager().addToLayer(Ws.UI,o),this.getLayerManager().addToLayer(Ws.UI,l)}getSettingsHeader(){return["SFX","BGM"]}createOptionHeader(e,t){const a=new Phaser.GameObjects.Container(this,0,t),s=new Phaser.GameObjects.Image(this,fs.x,0,Hs.settingOption.key),n=Ms(this,e,wi.optHeaderTextConfig,Ii);return a.add([s,n]),a}createOptRadioOptions(e,t){return new ji(this,{choices:wi.volContainerOpts,defaultChoiceIdx:e,maxXSpace:wi.opt.xSpace,choiceTextConfig:wi.radioButtonsTextConfig,bitmapTextStyle:Si},wi.opt.x,-fs.y+t)}async applySettings(){const e=this.sfxVolumeRadioButtons?parseFloat(this.sfxVolumeRadioButtons.getChosenChoice()):1,t=this.bgmVolumeRadioButtons?parseFloat(this.bgmVolumeRadioButtons.getChosenChoice()):1;await this.getSaveManager().saveSettings({bgmVolume:t,sfxVolume:e}),vl.getInstance().getSoundManager().applyUserSettings(this.getSaveManager().getSettings())}}const ol=rl;const ll=class{constructor(){this.getBaseSoundManager=()=>this.getCurrentScene().sound,this.getCurrentScene=()=>en(vl.getInstance().getCurrentSceneRef()),this.soundAssetMap=new Map,this.bgmVol=1,this.sfxVol=1,this.currBgMusicKey=ys.nullInteractionId}applyUserSettings(e){if(this.bgmVol=void 0!==e.bgmVolume?e.bgmVolume:1,this.sfxVol=void 0!==e.sfxVolume?e.sfxVolume:1,this.currBgMusic&&this.currBgMusic.isPlaying){const e=en(this.getSoundAsset(this.currBgMusicKey)),t=void 0!==e.config.volume?e.config.volume:1;this.currBgMusic.setVolume(t*this.bgmVol)}}addSoundAsset(e){this.soundAssetMap.set(e.key,e)}getSoundAsset(e){return this.soundAssetMap.get(e)}loadSounds(e){e.forEach((e=>{this.addSoundAsset(e),this.loadSound(e.key,Qs(e.path,!0))}))}loadSoundAssetMap(e){Object.values(e).forEach((e=>{this.addSoundAsset(e),this.loadSound(e.key,Qs(e.path,!1))}))}loadSound(e,t){this.getCurrentScene().load.audio(e,t)}playSound(e){const t=this.getSoundAsset(e);if(t){const e=void 0!==t.config.volume?t.config.volume:1;this.getBaseSoundManager().play(t.key,{...t.config,volume:e*this.sfxVol})}}playBgMusic(e,t){if(!vl.getInstance().isMounted)return;if(this.currBgMusicKey===e)return;if(e===ys.nullInteractionId&&this.currBgMusic)return this.fadeOutAndDestroyMusic(this.currBgMusic,t),this.currBgMusic=void 0,void(this.currBgMusicKey=e);this.currBgMusic&&this.fadeOutAndDestroyMusic(this.currBgMusic);const a=en(this.getSoundAsset(e)),s=void 0!==a.config.volume?a.config.volume:1;this.currBgMusic=this.getBaseSoundManager().add(a.key,{...a.config,volume:s*this.bgmVol}),this.currBgMusicKey=a.key,this.currBgMusic.play()}fadeOutAndDestroyMusic(e,t=1e3){this.getCurrentScene().tweens.add({targets:e,...Ks,duration:t}),setTimeout((()=>e.destroy()),2*t)}stopAllSound(){this.getBaseSoundManager().stopAll()}pauseCurrBgMusic(){this.getCurrentScene()&&this.currBgMusic&&this.currBgMusic.isPlaying&&this.currBgMusic.pause()}continueCurrBgMusic(){this.getCurrentScene()&&this.currBgMusic&&this.currBgMusic.isPaused&&this.currBgMusic.play()}};var cl=a(44408);const dl=[{title:"Spaceship Emergency",imageUrl:"/locations/planet-y-orbit/crashing.png",filenames:["../../assets/mockChapter0.txt","../../assets/mockChapter0.1.txt"]},{title:"Alien Attack",imageUrl:"/locations/telebay/emergency.png",filenames:["../../assets/mockChapter1.txt"]},{title:"Jedi Master",imageUrl:"/locations/classroom/normal.png",filenames:["../../assets/mockChapter2.txt"]}];class hl{static parse(e){hl.awardsMapping=new Map;const t=li.splitToLines(e);return li.splitToParagraph(t).forEach((([,e])=>{hl.parseAwardParagraphs(e)})),this.awardsMapping}static parseAwardParagraphs(e){li.splitToParagraph(e).forEach((([e,t])=>{const[a,s,n,i]=li.splitWithLimit(t[0],",",3);hl.awardsMapping.set(e,{id:e,assetKey:a,assetPath:Qs(s,!0),title:n,description:i,completed:!0})}))}}const ul=hl;class gl{static parse(e){gl.backgroundMapping=new Map;const t=li.splitToLines(e);return li.splitToParagraph(t).forEach((([e,t])=>{gl.backgroundMapping.set(e,Qs(t[0],!0))})),gl.backgroundMapping}}const pl=gl;class ml extends Phaser.Scene{constructor(){super("Entry")}async preload(){vl.getInstance().setCurrentSceneRef(this),this.preloadAssets(),vi(this),await vl.getInstance().loadGameChapters(),await vl.getInstance().loadRoomCode(),await vl.getInstance().getSaveManager().loadLastSaveState()}async create(){await this.preloadAwards(),await vl.getInstance().getUserStateManager().loadUserState(),await this.preloadRoomPreviewBackgrounds(),this.applyLoadedSettings(),this.scene.start("MainMenu")}applyLoadedSettings(){const e=vl.getInstance().getSaveManager().getSettings();vl.getInstance().getSoundManager().applyUserSettings(e)}async preloadAwards(){const e=this.cache.text.get(ao.awardsMapping.key)||"",t=ul.parse(e);vl.getInstance().setAwardsMapping(t),await Promise.all(Array.from(t.values()).map((async e=>await Xr(this,e.assetKey,e.assetPath))))}async preloadRoomPreviewBackgrounds(){const e=this.cache.text.get(ao.roomPreviewMapping.key)||"",t=pl.parse(e);vl.getInstance().setRoomPreviewMapping(t),await Promise.all(Array.from(t.entries()).map((async([e,t])=>await Xr(this,e,t))))}preloadAssets(){vl.getInstance().getSoundManager().loadSoundAssetMap(Xs),Object.values(Hs).forEach((e=>this.load.image(e.key,Qs(e.path,!1)))),Object.values(xs).forEach((e=>this.load.bitmapFont(e.key,e.pngPath,e.fntPath))),Object.values(ao).forEach((e=>this.load.text(e.key,e.path)))}}const xl=ml;class yl{constructor(){this.getCollectibles=()=>Array.from(this.collectibles),this.getAchievements=()=>Array.from(this.achievements),this.getAssessments=()=>Array.from(this.assessments),this.collectibles=new Set([]),this.achievements=new Set([]),this.assessments=new Set([])}async loadUserState(){vl.getInstance().isGameType(fl.Simulator)||(await this.loadAchievements(),await this.loadAssessments(),this.collectibles=new Set(vl.getInstance().getSaveManager().getLoadedUserState().collectibles))}addCollectible(e){this.collectibles.add(e)}async loadAssessments(){const e=await(0,al.$C)(vl.getInstance().getAccountInfo());this.assessments=new Set((e||[]).filter((e=>"submitted"===e.status)).sort(((e,t)=>e.closeAt<=t.closeAt?-1:1)).map((e=>e.id.toString())))}async isInUserState(e,t){if(vl.getInstance().isGameType(fl.Game))return this[e].has(t);return 0===await Dn(Gn.getInstance().getGameManager(),`${li.capitalize(e)} ${t}?`,["Yes","No"])}async loadAchievements(){const e=vl.getInstance().getAwardsMapping(),t=vl.getInstance().getAchievements(),a=vl.getInstance().getGoals(),s=new Map;a.forEach((e=>s.set(e.uuid,e))),t.forEach((t=>{const a=t.uuid.toString(),n=t.goalUuids.reduce(((e,t)=>{var a;return e&&!(null===(a=s.get(t))||void 0===a||!a.completed)}),!0),i=e.get(a);if(i){const e={...i,completed:n};vl.getInstance().addAwardMapping(e.assetKey,e),this.achievements.add(e.assetKey)}}))}}var bl;let fl=function(e){return e.Simulator="Simulator",e.Game="Game",e}({});class vl extends ms.Game{constructor(e,t){super(e),this.getAwardsMapping=()=>en(this.global.awardsMapping),this.getAccountInfo=()=>en(this.global.accountInfo),this.getAchievements=()=>en(this.global.achievements),this.getSoundManager=()=>en(this.global.soundManager),this.getGoals=()=>en(this.global.goals),this.getRoomPreviewMapping=()=>en(this.global.roomPreviewMapping),this.getUserStateManager=()=>en(this.global.userStateManager),this.getSaveManager=()=>en(this.global.saveManager),this.getCurrentSceneRef=()=>en(this.global.currentSceneRef),this.isGameType=e=>this.global.gameType===e,this.getSSChapterSimFilenames=()=>this.global.ssChapterSimFilenames,this.getIsUsingMock=()=>this.global.isUsingMock,this.getRoomCode=()=>this.global.roomCode,this.getGameChapters=()=>this.global.isUsingMock?dl:this.global.gameChapters,vl.instance=this,this.isMounted=!0,this.global={awardsMapping:new Map,accountInfo:void 0,achievements:void 0,currentSceneRef:void 0,gameChapters:[],gameType:t,goals:void 0,isUsingMock:!1,roomCode:"",roomPreviewMapping:new Map,saveManager:new Tr,setGameSimState:ys.nullFunction,soundManager:new ll,ssChapterSimFilenames:[],userStateManager:new yl}}stopAllSounds(){this.sound.stopAll()}setAccountInfo(e){this.global.accountInfo=e}setAchievements(e){this.global.achievements=e}setAwardsMapping(e){this.global.awardsMapping=e}addAwardMapping(e,t){this.global.awardsMapping.set(e,t)}setGoals(e){this.global.goals=e}setGameSimStateSetter(e){this.setGameSimState=e}setRoomPreviewMapping(e){this.global.roomPreviewMapping=e}async loadGameChapters(){this.global.gameChapters=await async function(){const e=Zs.h.getState().session.courseId,t=await(0,cl.WY)(`courses/${e}/stories`,"GET",{accessToken:vl.getInstance().getAccountInfo().accessToken,refreshToken:vl.getInstance().getAccountInfo().refreshToken});if(!t)return[];const a=200===t.status?await t.json():[],s=R().sortBy(a,(e=>new Date(e.openAt)));return s.forEach((e=>e.filenames=e.filenames.map(Qr))),s}()}async loadRoomCode(){this.global.roomCode=await sl()}setGameSimState(e){this.global.setGameSimState(e)}setCurrentSceneRef(e){this.global.currentSceneRef=e}toggleUsingMock(e){this.global.isUsingMock=void 0===e?!this.global.isUsingMock:e}setChapterSimStack(e){this.global.ssChapterSimFilenames=e.reverse()}}bl=vl,vl.getInstance=()=>en(bl.instance);const Cl={debug:!0,type:ms.CANVAS,width:bs.x,height:bs.y,physics:{default:"arcade"},scale:{mode:ms.Scale.FIT,parent:"game-display"},fps:{target:24},scene:[xl,Zo,ol,Fo,Ar,$o,Fr,il,$r]},jl=()=>new vl(Cl,fl.Game);async function Sl(e){if("student"!==vl.getInstance().getAccountInfo().role)return;const t={method:"PUT",headers:Il(vl.getInstance().getAccountInfo().accessToken),body:JSON.stringify({gameStates:e})},a=await fetch(`${b.Z.backendUrl}/v2/courses/${tn()}/user/game_states`,t);return a&&a.ok?a:void 0}function Il(e){const t=new Headers;return t.append("Accept","application/json"),t.append("Authorization",`Bearer ${e}`),t.append("Content-Type","application/json"),t}const kl=function(){const e=(0,C.ix)((e=>e.session)),t=(0,d.I0)(),a=(0,C.ix)((e=>e.achievement.achievements)),s=(0,C.ix)((e=>e.achievement.goals)),[n,i]=c.useState(!1),[r,o]=c.useState(!1);return c.useEffect((()=>{t((0,Vt.getAchievements)()),t((0,Vt.getOwnGoals)())}),[t]),c.useEffect((()=>{const e=jl();return()=>{e.isMounted=!1,e.stopAllSounds(),e.destroy(!0)}}),[]),c.useEffect((()=>{vl.getInstance().setAccountInfo({accessToken:e.accessToken,refreshToken:e.refreshToken,role:e.role,name:e.name}),vl.getInstance().setAchievements(a),vl.getInstance().setGoals(s)}),[e,a,s]),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{id:"game-display"}),n&&(0,f.jsxs)("div",{className:"Horizontal",children:[(0,f.jsx)("button",{onClick:async()=>{await Sl({}),alert("Game cleared! Please refresh")},children:"Clear data"}),(0,f.jsx)("button",{onClick:()=>{o(!r),vl.getInstance().toggleUsingMock()},children:r?"Use Game Chapters":"Use Mock Chapters"})]})]})};let wl=function(e){return e.Default="Default",e.AssetUploader="AssetUploader",e.CheckpointSim="CheckpointSim",e.ChapterSim="ChapterSim",e}({});var Al=a(68050);const Tl=e=>async(t,a,s={},n={})=>{try{const i=function(e){const t=new Headers;return t.append("Accept","application/json"),t.append("Authorization",`Bearer ${e}`),t}(vl.getInstance().getAccountInfo().accessToken||"");Object.entries(s).forEach((([e,t])=>{i.append(e,t)}));const r={method:a,headers:i,...n};return fetch(b.Z.backendUrl+`/v2/courses/${tn()}/${e}/`+t,r)}finally{}},Ml=Tl("admin/assets"),Pl=Tl("stories"),El=Tl("admin/stories");const Nl=["locations","objects","images","avatars","ui","sfx","bgm","stories"];const Rl=async()=>(await Ll("stories")).filter((e=>e.startsWith("stories")&&e.endsWith("txt"))).map((e=>e.slice(8)));async function Dl(){return(await Promise.all(Nl.map((async e=>{const t=await Ll(e);return t.length?t:[`${e}`]})))).reduce(((e,t)=>e.concat(t)),[])}async function Ll(e){const t=await Ml(e,"GET",{"Content-Type":"application/json"});return 200===t.status?t.json():[]}async function Ol(e,t){const a=await Promise.all(Array.from(e).map((async e=>{const a=await async function(e,t){const a=new FormData;a.set("upload",e);const s=await Ml(`${t}/${e.name}`,"POST",{},{body:a,mode:"cors"});return s?s.text():""}(e,t);return e.name+" => "+a})));return a.join("\n")}async function _l(){const e=await Pl("","GET"),t=200===e.status?await e.json():[];return R().sortBy(t,(e=>new Date(e.openAt)))}async function Gl(e,t){const a=await El(e,"POST",{"Content-Type":"application/json"},{body:JSON.stringify(t)});return 200===a.status?"Chapter successfully created/updated":a.text()}const Bl="Specify own folder...",Ul=()=>{const[e,t]=c.useState(),[a,s]=c.useState(Nl[0]),[n,i]=c.useState(),[r,o]=c.useState(!1);function l(e){e.target.innerText&&(s(e.target.innerText),o(!1))}const d=(0,f.jsxs)(Al.v,{children:[Nl.map((e=>(0,f.jsx)(Ze.s,{onClick:l,id:e,text:e},e))),(0,f.jsx)(Ze.s,{onClick:function(e){e.target.innerText&&(s(e.target.innerText),o(!0))},id:Bl,text:Bl},Bl)]});return(0,f.jsxs)("div",{className:"LeftAlign",children:[(0,f.jsx)("h4",{children:"Choose Folder"}),(0,f.jsx)(La.p,{placement:M.Ly.BOTTOM,content:d,children:(0,f.jsx)(m.z,{text:a})}),r&&(0,f.jsx)(Ea.B,{placeholder:"Or specify your own, e.g. 'locations/hallway'",onChange:function(e){i(e.target.value)}}),(0,f.jsx)("br",{}),(0,f.jsx)("h4",{children:"Choose File"}),(0,f.jsx)("input",{type:"file",multiple:!0,onChange:function(e){if(!e.target.files)return;const a=e.target.files;t(a)}}),(0,f.jsx)(m.z,{onClick:async function(){const t=n||a;if(!e||!t)return;const s=await Ol(e,t);alert(s)},children:"Upload"})]})};var Fl=a(4514);function zl(e,t){e&&e.forEach((e=>{t(e),zl(e.childNodes,t)}))}function Vl(e,t,a=[]){const s={};return e.forEach((e=>R().set(s,e.split("/"),"FILE"))),a.forEach((e=>{s[e]&&"FILE"!==s[e]||(s[e]=[])})),function e(a,s){return Object.keys(s).map((n=>{const i="/"+a.join("/")+"/"+n;return{id:i,label:n,secondaryLabel:t(i),childNodes:"FILE"===s[n]?void 0:e([...a,n],s[n])}}))}([],s)}const Hl=(0,c.memo)((({assetPath:e})=>{const t=e||ys.defaultAssetPath;return(0,f.jsx)("img",{alt:"asset",crossOrigin:"anonymous",src:Qs(t,!!e),width:"150px",onError:e=>{e.target.onerror=null,e.target.src=Qs(ys.defaultAssetPath,!1)}})})),Kl=e=>(0,f.jsx)(E.u,{content:"Delete",children:(0,f.jsx)(k.I,{icon:"trash",onClick:$l(e)})}),$l=e=>async()=>{const t=window.confirm(`Are you sure you want to delete ${e}?\nThere is no undoing this action!`);alert(t?await async function(e){const t=await Ml(e,"DELETE");return await t.text()||"Successfully Deleted"}(e):"Whew")},Xl=()=>{const{value:e}=(0,C.QT)(Dl,[]),[t,a]=c.useState(""),[s,n]=c.useState({nodes:[]});c.useEffect((()=>{n({nodes:Vl(e,Kl,Nl)})}),[e]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(Hl,{assetPath:t}),(0,f.jsx)(Fl.m,{contents:s.nodes,onNodeClick:e=>{zl(s.nodes,(e=>e.isSelected=!1)),e.isSelected=!e.isSelected,e.isExpanded=!e.isExpanded;const t=e.id.toString();e.childNodes||(a(t),sessionStorage.setItem("selectedAsset",t)),n({...s})}})]})};var Wl=a(34419),ql=a(36658);const Zl=c.memo((0,ql.W8)((({value:e})=>(0,f.jsx)("div",{children:(0,f.jsx)(m.z,{children:e})})))),Yl=c.memo((0,ql.JN)((({items:e})=>(0,f.jsx)("div",{children:e&&e.map(((e,t)=>(0,f.jsx)(Zl,{index:t,value:e},`item-${e}`)))})))),Jl=c.memo((({chapterDetail:e,checkpointFilenames:t})=>{const{id:a}=e,{value:s,setValue:n,inputProps:i}=(0,C.Gl)(""),{value:r,setValue:o,inputProps:l}=(0,C.Gl)(""),{items:d,setItems:h,onSortEnd:u}=(()=>{const[e,t]=c.useState([]),a=c.useCallback((({oldIndex:e,newIndex:a})=>{t((t=>(0,Wl.q)(t,e,a)))}),[]);return{items:e,setItems:t,onSortEnd:a}})(),[g,p]=c.useState(!1),[y,b]=c.useState(new Date),[v,j]=c.useState([]),[S,I]=c.useState(!1);c.useEffect((()=>{n(e.title),o(e.imageUrl),b(new Date(e.openAt)),h(e.filenames),p(e.isPublished),j((t||[]).filter((t=>!e.filenames.includes(t))))}),[e,h,o,b,n,t,S]);const k=c.useCallback((e=>{h((t=>t.filter((t=>t!==e)))),j((t=>[...t,e]))}),[h]),w=c.useCallback((e=>{h((t=>[...t,e])),j((t=>t.filter((t=>t!==e))))}),[h]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("h4",{children:["Title: ",(0,f.jsx)("input",{className:"bp4-input",type:"text",...i})]}),(0,f.jsx)("b",{children:"Open date: "}),y&&(0,Te.gS)(y.toISOString()),(0,f.jsx)(it.M,{onChange:e=>{e&&b(e)}}),(0,f.jsxs)("h4",{children:["Image url: ",(0,f.jsx)("input",{className:"bp4-input",type:"text",...l}),(0,f.jsx)(m.z,{onClick:e=>window.open(Qs(r,!0)),children:"View"})]}),(0,f.jsx)("b",{children:"Checkpoint Txt Files"}),(0,f.jsx)(Yl,{items:d,onSortEnd:u}),(0,f.jsx)("br",{}),d.length>0&&(0,f.jsx)(m.z,{icon:"delete",onClick:()=>d.map(k),children:"Clear checkpoint files"}),(0,f.jsx)("br",{}),(0,f.jsx)("b",{children:"All Txt Files"}),v&&v.map((e=>(0,f.jsx)("div",{children:(0,f.jsx)(m.z,{onClick:()=>w(e),icon:"add",children:e})},`choice-${e}`))),(0,f.jsx)("br",{}),(0,f.jsx)(m.z,{icon:"play",onClick:async()=>{vl.getInstance().setChapterSimStack(d),await Go()},children:"Simulate Chapter"}),(0,f.jsx)("br",{}),(0,f.jsx)("br",{}),(0,f.jsx)(qe.rs,{checked:g,labelElement:"Published",onChange:()=>p(!g)}),(0,f.jsx)(m.z,{onClick:async()=>{const e={openAt:y.toISOString(),closeAt:Ql(y).toISOString(),title:s,filenames:d,imageUrl:r,isPublished:g};if(!window.confirm(`Are you sure you want to save changes to ${JSON.stringify(e)}`))return;const t=parseInt(a)===ec?await Gl("",{story:e}):await Gl(a,{story:e});alert(t)},children:"Save Changes"}),(0,f.jsx)(m.z,{intent:x.S.WARNING,onClick:()=>{window.confirm("Are you you want to clear changes for this chapter?")&&(I(!S),alert("Cleared changes"))},children:"Clear Changes"}),(0,f.jsx)("br",{}),(0,f.jsx)("br",{}),(0,f.jsx)(m.z,{icon:"trash",intent:x.S.DANGER,onClick:async()=>{if(window.confirm("Are you sure you want to delete this chapter?")){const e=await async function(e){const t=await El(e,"DELETE");return 204===t.status?"Chapter successfully deleted":t.text()}(a);alert(e)}},children:"Delete Chapter"})]})})),Ql=e=>(e.setFullYear(e.getFullYear()+1),e),ec=-1,tc={id:ec,title:"title goes here",imageUrl:"/locations/telebay/emergency.png",openAt:(new Date).toISOString(),closeAt:Ql(new Date).toISOString(),isPublished:!1,filenames:[]},ac=c.memo((()=>{const{value:e}=(0,C.QT)(Rl,[]),{value:t}=(0,C.QT)(_l,[]),[a,s]=c.useState(ec);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("h3",{children:"Chapter Simulator"}),(0,f.jsxs)("select",{className:"bp4-menu",onChange:e=>s(e.target.value),children:[t.map(((e,t)=>(0,f.jsx)("option",{value:t,children:`Chapter ${t}: ${e.title}`},t))),(0,f.jsx)("option",{value:ec,children:"Create new chapter"},ec)]}),(0,f.jsx)("hr",{}),(0,f.jsx)(Jl,{chapterDetail:t[a]||tc,checkpointFilenames:e})]})})),sc={key:xs.zektonDarkFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},nc={maxOptButtonsRow:2,optButton:{xSpace:.9*bs.x,ySpace:.5*bs.y},gameTxtStorageName:{defaultChapter:"defaultChapter",checkpointTxt:"checkpointTxt"}};a(76370);const ic=(e,t)=>{const a=new FileReader;a.readAsText(t),a.onloadend=t=>{a.result&&sessionStorage.setItem(e,a.result.toString())}},rc=function({storageName:e,s3TxtFiles:t}){const[a,s]=c.useState(t[0]),n=(0,f.jsx)("input",{type:"file",onChange:function(t){if(!t.target.files)return;const[a]=t.target.files;ic(e,a)},style:{width:"250px"}}),i=(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("select",{className:"bp4-menu",onChange:async function(t){const a=t.target.value;s(a);const n=await fetch(Qs(`/stories/${a}`,!0),{headers:oc()}),i=await n.text();sessionStorage.setItem(e,i)},children:t.map((e=>(0,f.jsx)("option",{value:e,children:e},e)))}),(0,f.jsx)(m.z,{icon:"download",onClick:()=>window.open(Qr(a))})]});return(0,f.jsxs)("div",{className:"LeftAlign",children:[(0,f.jsx)("hr",{}),(0,f.jsxs)(Va.mQ,{id:"Tabs",renderActiveTabPanelOnly:!0,children:[(0,f.jsx)(Ha.O,{id:"own",title:"Local",panel:n}),(0,f.jsx)(Ha.O,{id:"s3",title:"S3",panel:i})]},"vertical"),(0,f.jsx)("hr",{})]})};function oc(){const e=new Headers;return e.append("Access-Control-Allow-Origin","*"),e}function lc(){const{value:e}=(0,C.QT)(Rl,[]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("h3",{children:"Checkpoint Text Loader"}),(0,f.jsx)("b",{children:"Step 1: Choose default checkpoint"}),(0,f.jsx)(rc,{s3TxtFiles:e,storageName:nc.gameTxtStorageName.defaultChapter}),(0,f.jsx)("b",{children:"Step 2: Choose checkpoint text"}),(0,f.jsx)(rc,{s3TxtFiles:e,storageName:nc.gameTxtStorageName.checkpointTxt}),(0,f.jsx)("br",{}),(0,f.jsx)(m.z,{onClick:function(){vl.getInstance().getCurrentSceneRef().simulateCheckpoint()},icon:"play",children:"Simulate Checkpoint"}),(0,f.jsx)("br",{}),(0,f.jsx)("br",{}),(0,f.jsx)(m.z,{onClick:cc,children:"Reset All Files"}),(0,f.jsx)("br",{})]})}function cc(e){sessionStorage.setItem(nc.gameTxtStorageName.checkpointTxt,""),sessionStorage.setItem(nc.gameTxtStorageName.defaultChapter,"")}const dc={gameSimBg:{type:zs.Image,key:"student-room",path:"/locations/deathCube_ext/shields-down.png"},shortButton:{type:zs.Image,key:"short-button",path:"/ui/shortButton.png"},invertedButton:{type:zs.Image,key:"inverted-button",path:"/ui/invertedColorButton.png"},blueUnderlay:{type:zs.Image,key:"blue-underlay",path:"/ui/blueUnderlay.png"},topButton:{type:zs.Image,key:"top-button",path:"/ui/topButton.png"},colorIcon:{type:zs.Image,key:"color-icon",path:"/ui/colorIcon.png"},imageIcon:{type:zs.Image,key:"image-icon",path:"/ui/imageIcon.png"},bboxIcon:{type:zs.Image,key:"bbox-icon",path:"/ui/bboxIcon.png"},handIcon:{type:zs.Image,key:"hand-icon",path:"/ui/handIcon.png"},listIcon:{type:zs.Image,key:"list-icon",path:"/ui/listIcon.png"},eraseIcon:{type:zs.Image,key:"erase-icon",path:"/ui/eraserIcon.png"},iconBg:{type:zs.Image,key:"icon-bg",path:"/ui/modeIconBg.png"}};class hc extends Phaser.Scene{constructor(){super("GameSimulatorMenu"),this.getLayerManager=()=>en(this.layerManager)}preload(){vl.getInstance().setCurrentSceneRef(this),this.layerManager=new Ni(this),vi(this),Object.values(Hs).forEach((e=>this.load.image(e.key,Qs(e.path,!1)))),Object.values(dc).forEach((e=>this.load.image(e.key,Qs(e.path,!1)))),Object.values(xs).forEach((e=>this.load.bitmapFont(e.key,e.pngPath,e.fntPath))),vl.getInstance().getSoundManager().loadSoundAssetMap(Xs)}async create(){"student"!==vl.getInstance().getAccountInfo().role?(this.renderBackground(),this.renderOptionButtons()):console.log("Students cannot use Game sim")}renderOptionButtons(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getOptionButtons(),a=Ss({numOfItems:t.length,maxXSpace:nc.optButton.xSpace,maxYSpace:nc.optButton.ySpace,numItemLimit:nc.maxOptButtonsRow,redistributeLast:!0});e.add(t.map(((e,t)=>this.createOptButton(e.text,a[t][0],a[t][1],e.callback)))),this.getLayerManager().addToLayer(Ws.UI,e)}getOptionButtons(){return[{text:"Checkpoint Simulator",callback:()=>{vl.getInstance().setGameSimState(wl.CheckpointSim)}},{text:"Asset Uploader",callback:()=>{vl.getInstance().setGameSimState(wl.AssetUploader)}},{text:"Chapter Simulator",callback:()=>{vl.getInstance().setGameSimState(wl.ChapterSim)}}]}createOptButton(e,t,a,s){return Pn(this,{assetKey:dc.invertedButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.5},bitMapTextStyle:sc,onUp:s}).setPosition(t,a)}simulateCheckpoint(){const e=sessionStorage.getItem(nc.gameTxtStorageName.defaultChapter)||"",t=sessionStorage.getItem(nc.gameTxtStorageName.checkpointTxt)||"";if(""===e&&""===t)return;this.getLayerManager().clearAllLayers(),Oo.parse(e),t&&Oo.parse(t,!0);const a=Oo.checkpoint;this.scene.start("GameManager",{gameCheckpoint:a,chapterNum:-1,checkpointNum:-1})}renderBackground(){const e=new Phaser.GameObjects.Image(this,fs.x,fs.y,dc.gameSimBg.key);e.setDisplaySize(bs.x,bs.y);const t=new Phaser.GameObjects.Image(this,fs.x,fs.y,dc.blueUnderlay.key).setAlpha(.5);this.getLayerManager().addToLayer(Ws.Background,e),this.getLayerManager().addToLayer(Ws.Background,t)}}const uc=hc,gc={debug:!0,type:ms.CANVAS,width:bs.x,height:bs.y,physics:{default:"arcade"},scale:{mode:ms.Scale.FIT,parent:"game-display"},fps:{target:24}},pc=()=>{const e=new vl(gc,fl.Simulator);return e.scene.add("GameSimulatorMenu",uc,!0),e.scene.add("GameManager",Ar),e.scene.add("CheckpointTransition",$o),e};const mc=function(){const e=(0,C.ix)((e=>e.session)),[t,a]=c.useState(wl.Default);return c.useEffect((()=>{pc().setGameSimStateSetter(a)}),[]),c.useEffect((()=>{vl.getInstance().setAccountInfo({accessToken:e.accessToken,refreshToken:e.refreshToken,role:e.role,name:e.name})}),[e]),(0,f.jsxs)("div",{className:"GameSimulatorWrapper",children:[(0,f.jsx)("div",{id:"game-display"}),(0,f.jsxs)("div",{className:"LeftAlign GameSimulatorPanel",children:[t===wl.Default&&(0,f.jsx)("h3",{children:"Welcome to Game simulator!"}),t===wl.CheckpointSim&&(0,f.jsx)(lc,{}),t===wl.AssetUploader&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("h3",{children:"Asset uploader"}),(0,f.jsx)(Ul,{}),(0,f.jsx)("h3",{children:"Asset Viewer"}),(0,f.jsx)(Xl,{})]}),t===wl.ChapterSim&&(0,f.jsx)(ac,{})]})]})};a(94463);var xc=a(92421),yc=a(80010),bc=a(55362),fc=a(92960),vc=a(94522);const Cc=({submissionId:e})=>{const t=(0,d.I0)(),a=(0,C.ix)((e=>e.session.courseId));return(0,f.jsxs)(xc.kC,{justifyContent:"justify-start",spaceX:"space-x-2",children:[(0,f.jsx)(D.rU,{to:`/courses/${a}/grading/${e}`,children:(0,f.jsx)(xc.JO,{tooltip:"Grade",icon:()=>(0,f.jsx)(k.I,{icon:P.d.EDIT}),variant:"light"})}),(0,f.jsx)("button",{type:"button",style:{padding:0},onClick:async()=>{await(0,$e.pG)({contents:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("p",{children:"Reautograde this submission?"}),(0,f.jsx)("p",{children:"Note: all manual adjustments will be reset to 0."})]}),positiveIntent:"danger",positiveLabel:"Reautograde"})&&t((0,y.reautogradeSubmission)(e))},children:(0,f.jsx)(xc.JO,{tooltip:"Reautograde",icon:()=>(0,f.jsx)(k.I,{icon:P.d.REFRESH}),variant:"simple"})}),(0,f.jsx)("button",{type:"button",style:{padding:0},onClick:async()=>{await(0,$e.pG)({contents:"Are you sure you want to unsubmit?",positiveIntent:"danger",positiveLabel:"Unsubmit"})&&t((0,y.unsubmitSubmission)(e))},children:(0,f.jsx)(xc.JO,{tooltip:"Unsubmit",icon:()=>(0,f.jsx)(k.I,{icon:P.d.UNDO}),variant:"simple"})})]})},jc={missions:"indigo",quests:"emerald",paths:"sky",submitted:"green",attempting:"yellow",attempted:"red",graded:"green",grading:"yellow",none:"red"};function Sc(e){return jc[e.toLowerCase()]||"gray"}const Ic=({type:e,size:t="sm"})=>(0,f.jsx)(xc.Ct,{text:"xs"===t?e.charAt(0).toUpperCase():e,size:t,color:Sc(e)}),kc=({status:e})=>{const t=e.charAt(0).toUpperCase()+e.slice(1);return(0,f.jsx)(xc.Ct,{text:t,color:Sc(e)})},wc=({status:e})=>{const t=e.charAt(0).toUpperCase()+e.slice(1);return(0,f.jsx)(xc.Ct,{text:t,color:Sc(e),icon:()=>(0,f.jsx)(k.I,{icon:"graded"===e?P.d.TICK:"grading"===e?P.d.TIME:"none"===e?P.d.CROSS:P.d.DISABLE,style:{marginRight:"0.5rem"}})})},Ac=({filter:e,onRemove:t})=>{let a=e.value;return a=a.charAt(0).toUpperCase()+a.slice(1),(0,f.jsx)("button",{type:"button",className:"grading-overview-filterable-btns",onClick:()=>t(e),children:(0,f.jsx)(xc.Ct,{text:a,icon:()=>(0,f.jsx)(k.I,{icon:P.d.CROSS,style:{marginRight:"0.25rem"}}),color:Sc(a)})})},Tc=({filters:e,onFilterRemove:t})=>(0,f.jsx)(xc.kC,{justifyContent:"justify-start",spaceX:"space-x-1",children:e.map((e=>(0,f.jsx)(Ac,{filter:e,onRemove:t},e.id)))}),Mc=(0,fc.Cl)(),Pc=({column:e,value:t,children:a,onClick:s})=>(0,f.jsx)("button",{type:"button",className:"grading-overview-filterable-btns",onClick:()=>{e.setFilterValue(t),null===s||void 0===s||s()},children:a||t}),Ec=({totalRows:e,pageSize:t,submissions:a,updateEntries:s})=>{const n=(0,d.I0)(),i=(0,C.ix)((e=>e.workspaces.grading.submissionsTableFilters)),[r,o]=(0,c.useState)([...i.columnFilters]),[l,h]=(0,c.useState)(0),u=(0,c.useMemo)((()=>Math.ceil(e/t)-1),[e,t]),g=(0,c.useCallback)((()=>h(0)),[h]),[p,m]=(0,c.useState)(""),[x,y]=(0,c.useState)(""),b=(0,c.useMemo)((()=>(0,N.debounce)((e=>{g(),y(e)}),300)),[g]),v=(0,c.useMemo)((()=>{const e=[{id:"assessmentName",value:x},...r].map(bc.Sl),t={};return e.forEach((e=>{Object.keys(e).forEach((a=>{t[a]=e[a]}))})),t}),[r,x]),j=(0,c.useMemo)((()=>{return e=g,[Mc.accessor("assessmentName",{header:"Name",cell:t=>(0,f.jsx)(Pc,{onClick:e,column:t.column,value:t.getValue()})}),Mc.accessor("assessmentType",{header:"Type",cell:t=>(0,f.jsx)(Pc,{onClick:e,column:t.column,value:t.getValue(),children:(0,f.jsx)(Ic,{type:t.getValue()})})}),Mc.accessor("studentName",{header:"Student",cell:t=>(0,f.jsx)(Pc,{onClick:e,column:t.column,value:t.getValue()})}),Mc.accessor("studentUsername",{header:"Username",cell:t=>(0,f.jsx)(Pc,{onClick:e,column:t.column,value:t.getValue()})}),Mc.accessor("groupName",{header:"Group",cell:t=>(0,f.jsx)(Pc,{onClick:e,column:t.column,value:t.getValue()})}),Mc.accessor("submissionStatus",{header:"Progress",cell:t=>(0,f.jsx)(Pc,{onClick:e,column:t.column,value:t.getValue(),children:(0,f.jsx)(kc,{status:t.getValue()})})}),Mc.accessor("gradingStatus",{header:"Grading",cell:e=>(0,f.jsx)(wc,{status:e.getValue()})}),Mc.accessor((({currentXp:e,xpBonus:t,maxXp:a})=>({currentXp:e,xpBonus:t,maxXp:a})),{header:"Raw XP (+Bonus)",enableColumnFilter:!1,cell:e=>{const{currentXp:t,xpBonus:a,maxXp:s}=e.getValue();return(0,f.jsxs)(xc.kC,{justifyContent:"justify-start",spaceX:"space-x-2",children:[(0,f.jsxs)(xc.xv,{children:[t," (+",a,")"]}),(0,f.jsx)(xc.xv,{children:"/"}),(0,f.jsx)(xc.xv,{children:s})]})}}),Mc.accessor((({submissionId:e})=>({submissionId:e})),{header:"Actions",enableColumnFilter:!1,cell:e=>{const{submissionId:t}=e.getValue();return(0,f.jsx)(Cc,{submissionId:t})}})];var e}),[g]),S=(0,vc.b7)({data:a,columns:j,state:{columnFilters:r,pagination:{pageIndex:0,pageSize:t}},onColumnFiltersChange:o,getCoreRowModel:(0,fc.sC)(),getFilteredRowModel:(0,fc.vL)(),getPaginationRowModel:(0,fc.G_)()});return(0,c.useEffect)((()=>{n((0,ke.updateSubmissionsTableFilters)({columnFilters:r}))}),[r,n]),(0,c.useEffect)((()=>{g()}),[s,g,x]),(0,c.useEffect)((()=>{s(l,v)}),[s,l,v]),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(xc.kC,{marginTop:"mt-2",justifyContent:"justify-between",alignItems:"items-center",children:[(0,f.jsxs)(xc.kC,{alignItems:"items-center",spaceX:"space-x-2",children:[(0,f.jsxs)("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",height:"1.75rem"},children:[(0,f.jsx)(k.I,{icon:P.d.FILTER_LIST}),(0,f.jsxs)(xc.xv,{children:[r.length>0?"Filters: ":"No filters applied. Click on any cell to filter by its value."," "]})]}),(0,f.jsx)(Tc,{filters:r,onFilterRemove:({id:e,value:t})=>{const a=r.filter((a=>a.id!==e&&a.value!==t));o(a),g()}})]}),(0,f.jsx)(xc.oi,{maxWidth:"max-w-sm",icon:()=>(0,f.jsx)(k.I,{icon:P.d.SEARCH,style:{marginLeft:"0.75rem"}}),placeholder:"Search by assessment name",value:p,onChange:e=>{m(e.target.value),b(e.target.value)}})]}),(0,f.jsxs)(xc.iA,{marginTop:"mt-2",children:[(0,f.jsx)(xc.ss,{children:S.getHeaderGroups().map((e=>(0,f.jsx)(xc.SC,{children:e.headers.map((e=>(0,f.jsx)(xc.xs,{children:e.isPlaceholder?null:(0,vc.ie)(e.column.columnDef.header,e.getContext())},e.id)))},e.id)))}),(0,f.jsx)(xc.RM,{children:S.getRowModel().rows.map((e=>(0,f.jsx)(xc.SC,{children:e.getVisibleCells().map((e=>(0,f.jsx)(xc.pj,{children:(0,vc.ie)(e.column.columnDef.cell,e.getContext())},e.id)))},e.id)))}),(0,f.jsx)("div",{className:"grading-overview-footer-sibling"}),(0,f.jsx)(xc.$_,{children:(0,f.jsxs)(xc.kC,{justifyContent:"justify-center",spaceX:"space-x-3",children:[(0,f.jsx)(xc.zx,{size:"xs",icon:()=>(0,f.jsx)(k.I,{icon:P.d.DOUBLE_CHEVRON_LEFT}),variant:"light",onClick:()=>h(0),disabled:l<=0}),(0,f.jsx)(xc.zx,{size:"xs",icon:()=>(0,f.jsx)(k.I,{icon:P.d.ARROW_LEFT}),variant:"light",onClick:()=>h(l-1),disabled:l<=0}),(0,f.jsxs)(xc.d8,{children:["Page ",l+1," of ",u+1]}),(0,f.jsx)(xc.zx,{size:"xs",icon:()=>(0,f.jsx)(k.I,{icon:P.d.ARROW_RIGHT}),variant:"light",onClick:()=>h(l+1),disabled:l>=u}),(0,f.jsx)(xc.zx,{size:"xs",icon:()=>(0,f.jsx)(k.I,{icon:P.d.DOUBLE_CHEVRON_RIGHT}),variant:"light",onClick:()=>h(u),disabled:l>=u})]})})]}),(0,f.jsx)(xc.kC,{marginTop:"-mt-6",children:(0,f.jsx)(f.Fragment,{})})]})};var Nc=a(10878);const Rc="grading-editor-button",Dc={header:[P.d.HEADER,"Header Styles"],bold:[P.d.BOLD,"Bold"],italic:[P.d.ITALIC,"Italic"],strikethrough:[P.d.STRIKETHROUGH,"Strikethrough"],link:[P.d.LINK,"Link"],quote:[P.d.CITATION,"Quote"],code:[P.d.CODE,"Monospaced"],image:[P.d.MEDIA,"Image"],"unordered-list":[P.d.UNGROUP_OBJECTS,"Bullets"],"ordered-list":[P.d.NUMBERED_LIST,"Numbering"],"checked-list":[P.d.SQUARE,"Checkboxes"]},Lc=e=>{switch(e){case"header":case"bold":case"italic":case"strikethrough":case"link":case"quote":case"code":case"image":case"unordered-list":case"ordered-list":case"checked-list":const[t,a]=Dc[e];return{iconName:t,title:a};default:return{iconName:P.d.HELP}}},Oc=e=>{const t=(0,d.I0)(),{handleGradingSave:a,handleGradingSaveAndContinue:s,handleReautogradeAnswer:n}=(0,c.useMemo)((()=>({handleGradingSave:(...e)=>t((0,y.submitGrading)(...e)),handleGradingSaveAndContinue:(...e)=>t((0,y.submitGradingAndContinue)(...e)),handleReautogradeAnswer:(...e)=>t((0,y.reautogradeAnswer)(...e))})),[t]),[i,r]=(0,c.useState)(e.xpAdjustment.toString()),[o,l]=(0,c.useState)(e.comments),[h,u]=(0,c.useState)("write"),[g,b]=(0,c.useState)(!1);(0,c.useEffect)((()=>{v()}),[e.submissionId,e.questionId]);const v=()=>{r(e.xpAdjustment.toString()),l(e.comments),u("write"),b(!1)};const C=t=>()=>{const a=(0,je.GA)(i||void 0)||void 0,s=e.initialXp+(a||0);s<0||s>e.maxXp?(0,U.N9)(`XP ${s.toString()} is out of bounds. Maximum xp is ${e.maxXp.toString()}.`):t(e.submissionId,e.questionId,a,o)},j=()=>{const t=(0,je.GA)(i||void 0);return e.xpAdjustment!==t||e.comments!==o},S=j(),I={intent:S?x.S.WARNING:x.S.NONE,minimal:!S,className:Rc},w={intent:S?x.S.DANGER:x.S.NONE,minimal:!S,className:Rc},A={intent:S?x.S.SUCCESS:x.S.NONE,minimal:!S,className:Rc},T=e.initialXp+((0,je.GA)(i||void 0)||0),E=`${e.initialXp>0?"-":""}${e.initialXp} to ${e.maxXp-e.initialXp}`;return(0,f.jsxs)("div",{className:"GradingEditor",children:[(0,f.jsx)(ya.N,{when:!g&&S,message:"You have unsaved changes. Are you sure you want to leave?"}),(0,f.jsx)("div",{className:"grading-editor-header",children:(0,f.jsxs)(p.H3,{children:["Currently Grading: ",e.studentName," (",e.studentUsername,")"]})}),null!==e.solution?(0,f.jsx)("div",{className:"grading-editor-marking-scheme",children:(0,f.jsxs)(p.SU,{children:[e.solution.toString()," "]})}):null,(0,f.jsx)("div",{className:"grading-editor-container",children:(0,f.jsxs)("div",{className:"grading-editor-xp",children:[(0,f.jsxs)("div",{className:"autograder-xp",children:[(0,f.jsx)("div",{children:"Autograder XP:"}),(0,f.jsxs)("div",{children:[`${e.initialXp} / ${e.maxXp}`," ",(0,f.jsx)(m.z,{icon:"refresh",small:!0,minimal:!0,onClick:async()=>{await(0,$e.pG)({contents:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("p",{children:"Reautograde this answer?"}),(0,f.jsx)("p",{children:"Note: manual adjustments will be reset to 0."})]}),positiveLabel:"Reautograde",positiveIntent:"danger"})&&n(e.submissionId,e.questionId)}})]})]}),(0,f.jsxs)("div",{className:"xp-adjustment",children:[(0,f.jsx)("div",{children:"XP adjustment:"}),(0,f.jsx)("div",{children:(0,f.jsx)(Ke.A,{className:"adjustment-input",onValueChange:(e,t)=>{r(t)},value:i||"",buttonPosition:M.Ly.RIGHT,fill:!0,placeholder:E,intent:T<0||T>e.maxXp?x.S.DANGER:x.S.NONE,min:0-e.initialXp,max:e.maxXp>e.initialXp?e.maxXp-e.initialXp:void 0,stepSize:50,minorStepSize:25,majorStepSize:100})})]}),(0,f.jsxs)("div",{className:"final-xp",children:[(0,f.jsx)("div",{children:"Final XP:"}),(0,f.jsx)("div",{children:`${T} / ${e.maxXp}`})]})]})}),(0,f.jsx)("div",{className:"react-mde-parent",children:(0,f.jsx)(Nc.default,{value:o,onChange:l,selectedTab:h,onTabChange:e=>u(e),generateMarkdownPreview:e=>Promise.resolve((0,f.jsx)(ae.Z,{content:e,simplifiedAutoLink:!0,strikethrough:!0,tasklists:!0,openLinksInNewWindow:!0})),minEditorHeight:200,maxEditorHeight:1e3,minPreviewHeight:240,getIcon:function(e){const t=Lc(e);return(0,f.jsx)(k.I,{icon:t.iconName,htmlTitle:t.title})}})}),"write"===h&&(0,f.jsxs)("div",{className:"grading-editor-draft-buttons",children:[(0,f.jsx)("div",{className:"grading-editor-save-button",children:(0,f.jsx)(ee.Z,{label:"Save Changes",icon:P.d.FLOPPY_DISK,onClick:C(a),options:I})}),(0,f.jsx)("div",{className:"grading-editor-discard-button",children:(0,f.jsx)(ee.Z,{label:"Discard Changes",icon:P.d.TRASH,onClick:()=>{j()&&!window.confirm("This will reset the editor. Are you sure?")||(r(e.xpAdjustment.toString()),l(e.comments),(0,U.rO)("Discarded!",1e3))},options:w})})]}),(0,f.jsx)("div",{className:"grading-editor-save-continue-button",children:(0,f.jsx)(ee.Z,{label:"Save and Continue",icon:P.d.UPDATED,onClick:C(((e,t,a,n)=>{b(!0),s(e,t,a,n)})),options:A})}),e.graderName&&e.gradedAt&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(Ae.i,{}),(0,f.jsxs)("div",{className:"grading-editor-last-graded-details",children:["Last edited by ",(0,f.jsx)("b",{children:e.graderName})," on ",(0,Te.Dh)(e.gradedAt)]})]})]})},_c="grading",Gc="// This answer does not have significant changes from the given solution\n// template and has thus been flagged as unanswered.\n// If you think this is wrong, please ignore and grade accordingly.\n\n\n",Bc=e=>{var t,a,n,o,g,p,m,x,b,v;const j=(0,h.s0)(),{selectedTab:S,setSelectedTab:I}=(0,Ce.__)(_c,ge.B_.grading),k=(0,C.ix)((t=>t.session.gradings.get(e.submissionId))),w=(0,C.ix)((e=>e.session.courseId)),{autogradingResults:A,isFolderModeEnabled:T,activeEditorTabIndex:M,editorTabs:E,editorTestcases:N,isRunning:R,output:D,replValue:L,currentSubmission:O,currentQuestion:G}=(0,C.ix)((e=>e.workspaces[_c])),U=(0,d.I0)(),{handleBrowseHistoryDown:F,handleBrowseHistoryUp:z,handleClearContext:V,handleDeclarationNavigate:H,handleEditorEval:K,handleSetActiveEditorTabIndex:Y,handleRemoveEditorTabByIndex:Q,handleEditorValueChange:ee,handleEditorUpdateBreakpoints:se,handleGradingFetch:ne,handleReplEval:ie,handleReplOutputClear:re,handleReplValueChange:oe,handleResetWorkspace:le,handleChangeExecTime:ce,handleSideContentHeightChange:de,handleTestcaseEval:he,handleRunAllTestcases:pe,handleUpdateCurrentSubmissionId:me,handleUpdateHasUnsavedChanges:xe,handlePromptAutocomplete:ye}=(0,c.useMemo)((()=>({handleBrowseHistoryDown:()=>U((0,ke.browseReplHistoryDown)(_c)),handleBrowseHistoryUp:()=>U((0,ke.browseReplHistoryUp)(_c)),handleClearContext:(e,t)=>U((0,ke.beginClearContext)(_c,e,t)),handleDeclarationNavigate:e=>U((0,ke.navigateToDeclaration)(_c,e)),handleEditorEval:()=>U((0,ke.evalEditor)(_c)),handleSetActiveEditorTabIndex:e=>U((0,ke.updateActiveEditorTabIndex)(_c,e)),handleRemoveEditorTabByIndex:e=>U((0,ke.removeEditorTab)(_c,e)),handleEditorValueChange:(e,t)=>U((0,ke.updateEditorValue)(_c,0,t)),handleEditorUpdateBreakpoints:(e,t)=>U((0,ke.setEditorBreakpoint)(_c,e,t)),handleGradingFetch:e=>U((0,y.fetchGrading)(e)),handleReplEval:()=>U((0,ke.evalRepl)(_c)),handleReplOutputClear:()=>U((0,ke.clearReplOutput)(_c)),handleReplValueChange:e=>U((0,ke.updateReplValue)(e,_c)),handleResetWorkspace:e=>U((0,ke.resetWorkspace)(_c,e)),handleChangeExecTime:e=>U((0,ke.changeExecTime)(e,_c)),handleSideContentHeightChange:e=>U((0,ve.changeSideContentHeight)(e,_c)),handleTestcaseEval:e=>U((0,ke.evalTestcase)(_c,e)),handleRunAllTestcases:()=>U((0,ke.runAllTestcases)(_c)),handleUpdateCurrentSubmissionId:(e,t)=>U((0,ke.updateCurrentSubmissionId)(e,t)),handleUpdateHasUnsavedChanges:e=>U((0,ke.updateHasUnsavedChanges)(_c,e)),handlePromptAutocomplete:(e,t,a)=>U((0,ke.promptAutocomplete)(_c,e,t,a))})),[U]);(0,c.useEffect)((()=>{if(ne(e.submissionId),!k)return;let t=e.questionId;e.questionId>=k.answers.length&&(t=k.answers.length-1);const a=k.answers[t].question;let s="";a.type===B.LD.programming&&(a.answer?a.answer.trim()===a.solutionTemplate.trim()?(s=Gc+a.answer,(0,$e.qY)({contents:"Question has not been answered."})):s=a.answer:s=a.solutionTemplate||""),ee(0,s)}),[]),(0,c.useEffect)((()=>{if(void 0===k)return;const t=e.questionId;void 0===k.answers[t]?j(`/courses/${w}/grading`):be(e)}));const be=e=>{var t;const a=e.submissionId,s=e.questionId;if(O===a&&G===s)return;const n=k.answers[s].question;let i=[],r="",o="",l="",c=[];if(n.type===B.LD.programming){var d;const e=n;i=e.autogradingResults,o=e.prepend,l=e.postpend,c=e.testcases,r=e.answer,r||(r=e.solutionTemplate),r.trim()===(null===(d=e.solutionTemplate)||void 0===d?void 0:d.trim())&&((0,$e.qY)({contents:"Question has not been answered."}),r=Gc+r)}se(0,[]),me(a,s),le({autogradingResults:i,editorTabs:[{value:r,highlightedLines:[],breakpoints:[]}],programPrependValue:o,programPostpendValue:l,editorTestcases:c}),ce(null!==(t=n.library.execTimeMs)&&void 0!==t?t:u.t7.grading.execTime),V(n.library,!0),xe(!1),r&&ee(0,r)},je=()=>{K(),S===ge.B_.autograder&&pe()};if(void 0===k)return(0,f.jsx)(i.t,{className:l()("WorkspaceParent",s.DARK),description:"Getting assessment ready...",icon:(0,f.jsx)(r.$,{size:r.E.LARGE})});const Se=e.questionId>=k.answers.length?k.answers.length-1:e.questionId,we=k.answers[Se].question,Ae={controlBarProps:(t=>{const a=`/courses/${w}/grading`,s=a+`/${e.submissionId}`,n=[t+1,k.answers.length],i=(0,f.jsx)(W.g,{onClickNext:()=>j(s+`/${(t+1).toString()}`),onClickReturn:()=>j(a),questionProgress:n},"next_question"),r=(0,f.jsx)(q.f,{onClick:()=>j(s+`/${(t-1).toString()}`),questionProgress:n},"previous_question"),o=(0,f.jsx)(Z.M,{questionProgress:n},"question_view");return{editorButtons:[(0,f.jsx)(J.h,{isEntrypointFileDefined:null!==M,handleEditorEval:je},"run")],flowButtons:[r,o,i]}})(Se),editorContainerProps:we.type===B.LD.programming||we.type===B.LD.voting?{editorVariant:"normal",isFolderModeEnabled:T,activeEditorTabIndex:M,setActiveEditorTabIndex:Y,removeEditorTabByIndex:Q,editorTabs:E.map(te.F),editorSessionId:"",handleDeclarationNavigate:H,handleEditorEval:je,handleEditorValueChange:ee,handleEditorUpdateBreakpoints:se,handlePromptAutocomplete:ye,isEditorAutorun:!1,sourceChapter:(null===we||void 0===we||null===(t=we.library)||void 0===t?void 0:t.chapter)||_.Chapter.SOURCE_4,sourceVariant:null!==(a=null===we||void 0===we||null===(n=we.library)||void 0===n?void 0:n.variant)&&void 0!==a?a:_.Variant.DEFAULT,externalLibraryName:(null===we||void 0===we||null===(o=we.library)||void 0===o||null===(g=o.external)||void 0===g?void 0:g.name)||"NONE"}:void 0,handleSideContentHeightChange:de,mcqProps:{mcq:we,handleMCQSubmit:e=>{}},sideBarProps:{tabs:[]},sideContentProps:((e,t)=>{var a;const s=[{label:`Grading: Question ${t+1}`,iconName:P.d.TICK,body:(0,f.jsx)(Oc,{solution:k.answers[t].question.solution,questionId:k.answers[t].question.id,submissionId:e.submissionId,initialXp:k.answers[t].grade.xp,xpAdjustment:k.answers[t].grade.xpAdjustment,maxXp:k.answers[t].question.maxXp,studentName:k.answers[t].student.name,studentUsername:k.answers[t].student.username,comments:null!==(a=k.answers[t].grade.comments)&&void 0!==a?a:"",graderName:k.answers[t].grade.grader?k.answers[t].grade.grader.name:void 0,gradedAt:k.answers[t].grade.grader?k.answers[t].grade.gradedAt:void 0}),id:ge.B_.grading},{label:`Question ${t+1}`,iconName:P.d.NINJA,body:(0,f.jsx)(ae.Z,{content:k.answers[t].question.content}),id:ge.B_.questionOverview},{label:"Autograder",iconName:P.d.AIRPLANE,body:(0,f.jsx)(ue,{testcases:N,autogradingResults:A,handleTestcaseEval:he,workspaceLocation:"grading"}),id:ge.B_.autograder},{label:"Briefing",iconName:P.d.BRIEFCASE,body:(0,f.jsx)(ae.Z,{content:k?k.assessment.summaryLong:"Briefing Unavailable. Try refreshing the page."}),id:ge.B_.briefing}];k.answers[t].question.library.external.symbols.includes("get_matrix")&&s.push({label:"Tone Matrix",iconName:P.d.GRID_VIEW,body:(0,f.jsx)(fe.Z,{}),id:ge.B_.toneMatrix});return{onChange:(e,t,a)=>{e!==t&&I(e)},tabs:{beforeDynamicTabs:s,afterDynamicTabs:[]},workspaceLocation:_c}})(e,Se),replProps:{handleBrowseHistoryDown:F,handleBrowseHistoryUp:z,handleReplEval:ie,handleReplValueChange:oe,output:D,replValue:L,sourceChapter:(null===we||void 0===we||null===(p=we.library)||void 0===p?void 0:p.chapter)||_.Chapter.SOURCE_4,sourceVariant:null!==(m=null===we||void 0===we||null===(x=we.library)||void 0===x?void 0:x.variant)&&void 0!==m?m:_.Variant.DEFAULT,externalLibrary:(null===we||void 0===we||null===(b=we.library)||void 0===b||null===(v=b.external)||void 0===v?void 0:v.name)||"NONE",replButtons:(()=>{const e=(0,f.jsx)($._,{handleReplOutputClear:re},"clear_repl");return[(0,f.jsx)(X.e,{handleReplEval:ie,isRunning:R},"eval_repl"),e]})()}};return(0,f.jsx)("div",{className:l()("WorkspaceParent",s.DARK),children:(0,f.jsx)(Ie.Z,{...Ae})})},Uc=[{value:!1,label:"my groups"},{value:!0,label:"all groups"}],Fc=[{value:!1,label:"ungraded"},{value:!0,label:"all"}],zc=[{value:10,label:"10"},{value:15,label:"15"},{value:25,label:"25"},{value:50,label:"50"}],Vc=()=>{var e,t,a,s;const{courseId:n,gradingOverviews:o,role:l,group:g}=(0,C.kP)(),p=(0,h.UO)(),m=l===u.uU.Admin,[x,b]=(0,c.useState)(m||null===g),[v,j]=(0,c.useState)(10),[S,I]=(0,c.useState)(!1),w=(0,d.I0)(),A=(0,c.useCallback)(((e,t)=>{w((0,y.fetchGradingOverviews)(x,(0,bc.R6)(S),(0,bc.Fo)(e,v),t))}),[w,x,S,v]);if(p.submissionId&&(null===(e=p.submissionId)||void 0===e||!e.match(L.CJ))||p.questionId&&(null===(t=p.questionId)||void 0===t||!t.match(L.CJ)))return(0,f.jsx)(h.Fg,{to:`/courses/${n}/grading`});const T=(0,je.GA)(p.submissionId),E=(0,je.GA)(p.questionId)||0;if(null!==T)return(0,f.jsx)(Bc,{questionId:E,submissionId:T});const N=(0,f.jsx)(i.t,{className:"Grading",description:"Fetching submissions...",icon:(0,f.jsx)(r.$,{size:r.E.LARGE})}),R=null!==(a=null===o||void 0===o||null===(s=o.data)||void 0===s?void 0:s.map((e=>e.studentName?e:{...e,studentName:"(user has yet to log in)"})))&&void 0!==a?a:[];return(0,f.jsx)(Ne.Z,{loadContentDispatch:()=>w((0,y.fetchGradingOverviews)(x)),display:void 0===(null===o||void 0===o?void 0:o.data)?N:(0,f.jsxs)(xc.Zb,{children:[(0,f.jsx)(xc.kC,{justifyContent:"justify-between",children:(0,f.jsxs)(xc.kC,{justifyContent:"justify-start",spaceX:"space-x-6",children:[(0,f.jsx)(xc.Dx,{children:"Submissions"}),(0,f.jsx)(xc.zx,{variant:"light",size:"xs",icon:()=>(0,f.jsx)(k.I,{icon:P.d.EXPORT,style:{marginRight:"0.5rem"}}),onClick:()=>(0,bc.gN)(o.data),children:"Export to CSV"})]})}),(0,f.jsxs)(xc.kC,{justifyContent:"justify-start",marginTop:"mt-2",spaceX:"space-x-2",children:[(0,f.jsx)(xc.xv,{children:"Viewing"}),(0,f.jsx)(yc.Z,{options:Fc,selectedValue:S,onClick:I,popoverProps:{position:M.Ly.BOTTOM},buttonProps:{minimal:!0,rightIcon:"caret-down"}}),(0,f.jsx)(xc.xv,{children:"submissions from"}),(0,f.jsx)(yc.Z,{options:Uc,selectedValue:x,onClick:b,popoverProps:{position:M.Ly.BOTTOM},buttonProps:{minimal:!0,rightIcon:"caret-down"}}),(0,f.jsx)(xc.xv,{children:"showing"}),(0,f.jsx)(yc.Z,{options:zc,selectedValue:v,onClick:j,popoverProps:{position:M.Ly.BOTTOM},buttonProps:{minimal:!0,rightIcon:"caret-down"}}),(0,f.jsx)(xc.xv,{children:"entries per page."})]}),(0,f.jsx)(Ec,{totalRows:o.count,pageSize:v,submissions:R,updateEntries:A})]}),fullWidth:!0})};var Hc=a(80821),Kc=a(95980);const $c=()=>{const[e,t]=(0,c.useState)(u.Vf[0]),[a,s]=(0,c.useState)(!1),{sourceChapter:n=b.Z.defaultSourceChapter,sourceVariant:i=b.Z.defaultSourceVariant}=(0,C.kP)(),r=(0,d.I0)(),o=(0,c.useCallback)((e=>r((0,ke.changeSublanguage)(e))),[r]),l=(0,c.useCallback)((e=>{s(!0),t(e)}),[s,t]),h=(0,c.useCallback)((()=>{s(!1)}),[s]),p=(0,c.useCallback)((()=>{s(!1),o(e)}),[e,s,o]),y=(0,c.useCallback)(((e,{handleClick:t})=>(0,f.jsx)(Ze.s,{onClick:t,text:e.displayName},e.displayName)),[]),v=(0,c.useCallback)((({itemsParentRef:e,renderItem:t,items:a})=>{const s=a.filter((({variant:e})=>e===_.Variant.DEFAULT)),n=a.filter((({variant:e})=>e!==_.Variant.DEFAULT));return(0,f.jsxs)(Al.v,{ulRef:e,children:[s.map(t),n.length>0&&(0,f.jsx)(Ze.s,{text:"Variants",icon:"cog",children:n.map(t)},"variant-menu")]})}),[]),j=Qe.P.ofType(),S=(0,f.jsxs)(g.V,{canEscapeKeyClose:!0,canOutsideClickClose:!0,className:"change-default-lang-dialog",icon:P.d.ERROR,isCloseButtonShown:!0,isOpen:a,onClose:h,title:"Updating default Source sublanguage",children:[(0,f.jsxs)(A.a,{children:["Are you sure you want to update the ",(0,f.jsx)("b",{children:"default Playground Source sublanguage"})," from"," ",(0,u.w$)(n,i)," to ",(0,f.jsx)("b",{children:e.displayName}),"?"]}),(0,f.jsx)(T.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(ee.Z,{label:"Cancel",onClick:h,options:{minimal:!1}}),(0,f.jsx)(ee.Z,{label:"Confirm",onClick:p,options:{minimal:!1,intent:x.S.DANGER}})]})})]});return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(j,{items:u.Vf,onItemSelect:l,itemRenderer:y,itemListRenderer:v,filterable:!1,children:(0,f.jsxs)(m.z,{rightIcon:P.d.DOUBLE_CARET_VERTICAL,children:[(0,f.jsx)("span",{className:"hidden-xs hidden-sm",children:"Default sublanguage: "}),(0,f.jsx)("span",{children:(0,u.w$)(n,i)})]})}),S]})},Xc=({handleDeleteAssessment:e,data:t})=>{const[a,s]=(0,c.useState)(!1),n=(0,c.useCallback)((()=>s(!0)),[]),i=(0,c.useCallback)((()=>s(!1)),[]),r=(0,c.useCallback)((()=>{const{id:a}=t;e(a),i()}),[t,i,e]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(ee.Z,{icon:P.d.TRASH,onClick:n}),(0,f.jsxs)(g.V,{icon:P.d.WARNING_SIGN,isOpen:a,onClose:i,title:"Deleting assessment",canOutsideClickClose:!0,children:[(0,f.jsxs)(A.a,{children:[(0,f.jsxs)("p",{children:["Are you sure you want to ",(0,f.jsx)("b",{children:"delete"})," the assessment ",(0,f.jsx)("i",{children:t.title}),"?"]}),(0,f.jsx)("p",{children:(0,f.jsx)("b",{children:"All submissions and their answers will be deleted as well."})})]}),(0,f.jsx)(T.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(ee.Z,{label:"Cancel",icon:P.d.CROSS,onClick:i,options:{minimal:!1}}),(0,f.jsx)(ee.Z,{label:"Confirm",icon:P.d.TRASH,onClick:r,options:{minimal:!1,intent:x.S.DANGER}})]})})]})]})};var Wc=a(80614);const qc=e=>{const[t,a]=c.useState(void 0),[s,i]=c.useState(!1),[r,o]=c.useState(!1),[d,h]=c.useState(-1);c.useEffect((()=>{e.assessmentConfigurations&&-1===d&&h(e.assessmentConfigurations[0].assessmentConfigId)}),[e.assessmentConfigurations,d]);const{handleUploadAssessment:u}=e,g=c.useMemo((()=>{var t;return null===(t=e.assessmentConfigurations)||void 0===t?void 0:t.map((e=>({value:e.assessmentConfigId,label:e.type})))}),[e.assessmentConfigurations]),p=c.useCallback((()=>{-1!==d?(t&&(u(t,r,d),o(!1)),a(void 0)):(0,U.N9)("Please select a valid assessment type before uploading!")}),[t,r,u,d]),m=c.useCallback((()=>a(void 0)),[a]),y=c.useCallback((e=>{a(e[0]),o(!1)}),[a]),b=c.useCallback((e=>{e.length>1&&(0,U.N9)("Uploading multiple files at once is not currently supported!",2e3)}),[]),{getRootProps:v,getInputProps:C,isFocused:j,isDragActive:I,isDragAccept:k,isDragReject:w}=(0,Wc.uI)({multiple:!1,onDropAccepted:y,onDropRejected:b}),A=c.useMemo((()=>l()("dropzone-base",j||I?"dropzone-active":void 0,k?"dropzone-accept":void 0,w?"dropzone-reject":void 0)),[j,I,k,w]),T=c.useCallback((()=>{r?o(!1):i(!0)}),[r,i,o]),M=c.useMemo((()=>(0,f.jsx)("div",{className:"toggle-button-wrapper",children:(0,f.jsx)(qe.rs,{checked:r,onChange:T})})),[r,T]),E=c.useCallback((()=>{o(!0),i(!1)}),[o]),N=c.useCallback((()=>{i(!1)}),[i]),R=c.useMemo((()=>(0,f.jsxs)("div",{className:"dropzone-controls",children:[(0,f.jsx)(ee.Z,{label:"Yes",icon:P.d.CONFIRM,onClick:E,options:{minimal:!1,intent:x.S.DANGER}}),(0,f.jsx)(ee.Z,{label:"No",icon:P.d.CROSS,onClick:N,options:{minimal:!1}})]})),[N,E]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(n.Z,{elevation:S.u.TWO,interactive:!0,children:(0,f.jsxs)("div",{...v({className:A}),children:[(0,f.jsx)("input",{...C()}),(0,f.jsx)("p",{children:"Drag 'n' drop a file here, or click to select a file"})]})}),t&&(0,f.jsxs)(n.Z,{className:"dropzone-prompt",elevation:S.u.TWO,interactive:!0,children:[(0,f.jsx)("h3",{children:null===t||void 0===t?void 0:t.name}),!s&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:"dropzone-controls",children:[(0,f.jsx)(Xa.L,{options:g,onChange:e=>h(parseInt(e.target.value)),value:d}),(0,f.jsx)(ee.Z,{label:"Confirm Upload",icon:P.d.UPLOAD,onClick:p,options:{minimal:!1,intent:x.S.DANGER}}),(0,f.jsx)(ee.Z,{label:"Cancel Upload",icon:P.d.DELETE,onClick:m,options:{minimal:!1}})]}),(0,f.jsxs)("div",{className:"dropzone-controls",children:[(0,f.jsx)("p",{children:"Force update opened assessment"}),M]})]}),s&&(0,f.jsx)("p",{children:"Are you sure that you want to force update the assessment?"}),s&&R]})]})};var Zc=a(83490);const Yc="YYYY-MM-DD HH:mm:ss ZZ",Jc=({data:e,forOpenDate:t,handleAssessmentChangeDate:a})=>{const s=new Date(2010,0,0),n=new Date(2030,11,31),i=t?e.openAt:e.closeAt,r=Bt(i,Bt.ISO_8601,!0),[o,l]=(0,c.useState)(!1),[d,h]=(0,c.useState)(r),u=(0,c.useCallback)((()=>l(!0)),[]),p=(0,c.useCallback)((()=>l(!1)),[]),m=(0,c.useCallback)((()=>{if(d){const{id:s,openAt:n,closeAt:i}=e;a(s,t?d.toISOString():n,t?i:d.toISOString()),p()}else(0,U.N9)("No date and time selected!",2e3),h(r)}),[d,r,e,a,t,p]),y=c.useCallback((e=>h(Bt(e))),[]),b=c.useCallback((()=>{(0,U.N9)("Failed to parse date string! Defaulting to current date.",2e3),h(r)}),[r]),v=(0,f.jsx)(Zc.S,{formatDate:e=>Bt(e).format(Yc),onChange:y,onError:b,parseDate:e=>{const t=Bt(e,Yc,!0);return!!t.isValid()&&t.toDate()},placeholder:`${Yc} or select a date`,value:null===d||void 0===d?void 0:d.toISOString(),disableTimezoneSelect:!0,timePrecision:"second",fill:!0,minDate:s,maxDate:n,closeOnSelection:!1});return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("span",{className:"date-cell-text",children:r.format(Yc)}),(0,f.jsx)(ee.Z,{icon:P.d.EDIT,onClick:u}),(0,f.jsxs)(g.V,{icon:P.d.INFO_SIGN,isOpen:o,onClose:p,title:"Updating assessment settings",canOutsideClickClose:!0,children:[(0,f.jsxs)(A.a,{children:[(0,f.jsxs)("p",{children:[t?"Opening":"Closing"," date and time:"]}),v]}),(0,f.jsx)(T.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(ee.Z,{label:"Cancel",icon:P.d.CROSS,onClick:p,options:{minimal:!1}}),(0,f.jsx)(ee.Z,{label:"Confirm",icon:P.d.TICK,onClick:m,options:{minimal:!1,intent:x.S.DANGER}})]})})]})]})},Qc=({data:e,handlePublishAssessment:t})=>{const[a,s]=(0,c.useState)(!1),[n]=(0,c.useState)(!!e.isPublished),i=(0,c.useCallback)((()=>s(!0)),[]),r=(0,c.useCallback)((()=>s(!1)),[]),o=(0,c.useCallback)((()=>{const{id:a}=e;t(!n,a),r()}),[e,n,r,t]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(qe.rs,{className:"publish-cell",checked:n,onChange:i}),(0,f.jsxs)(g.V,{icon:P.d.WARNING_SIGN,isOpen:a,onClose:r,title:(n?"Unpublish":"Publish")+" assessment",canOutsideClickClose:!0,children:[(0,f.jsxs)(A.a,{children:[(0,f.jsxs)("p",{children:["Are you sure you want to ",(0,f.jsx)("b",{children:n?"unpublish":"publish"})," the assessment"," ",(0,f.jsx)("i",{children:e.title}),"?"]}),n?(0,f.jsx)("p",{children:(0,f.jsx)("b",{children:"This will hide the assessment for students and prevent them from uploading new answers. Admins and staff are not affected."})}):null]}),(0,f.jsx)(T.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(ee.Z,{label:"Cancel",icon:P.d.CROSS,onClick:r,options:{minimal:!1}}),(0,f.jsx)(ee.Z,{label:"Confirm",icon:P.d.CONFIRM,onClick:o,options:{minimal:!1,intent:x.S.DANGER}})]})})]})]})};class ed extends c.Component{constructor(e){super(e),this.loadContent=()=>{this.props.handleAssessmentOverviewFetch(),this.props.handleFetchCourseConfigs()},this.dateFilterComparator=(e,t)=>{const a=new Date(t);return a<e?-1:a>e?1:0},this.onGridReady=e=>{this.gridApi=e.api,this.columnApi=e.columnApi,this.gridApi.sizeColumnsToFit(),this.columnApi.applyColumnState({state:[{colId:"openAt",sort:"desc"},{colId:"closeAt",sort:"desc"}]})},this.resizeGrid=()=>{this.gridApi&&this.gridApi.sizeColumnsToFit()},this.toggleDropzone=()=>{this.setState({showDropzone:!this.state.showDropzone})},this.state={showDropzone:!1},this.columnDefs=[{field:"number",headerName:"ID",width:50},{headerName:"Title",field:"title"},{headerName:"Category",field:"type",width:100},{headerName:"Open Date",field:"openAt",filter:"agDateColumnFilter",filterParams:{comparator:this.dateFilterComparator,inRangeInclusive:!0},sortingOrder:["desc","asc",null],cellRenderer:Jc,cellRendererParams:{handleAssessmentChangeDate:this.props.handleAssessmentChangeDate,forOpenDate:!0},width:150},{headerName:"Close Date",field:"closeAt",filter:"agDateColumnFilter",filterParams:{comparator:this.dateFilterComparator,inRangeInclusive:!0},sortingOrder:["desc","asc",null],cellRenderer:Jc,cellRendererParams:{handleAssessmentChangeDate:this.props.handleAssessmentChangeDate,forOpenDate:!1},width:150},{headerName:"Publish",field:"",cellRenderer:Qc,cellRendererParams:{handlePublishAssessment:this.props.handlePublishAssessment},width:100,filter:!1,resizable:!1,sortable:!1,cellStyle:{padding:0}},{headerName:"Delete",field:"",cellRenderer:Xc,cellRendererParams:{handleDeleteAssessment:this.props.handleDeleteAssessment},width:100,filter:!1,resizable:!1,sortable:!1,cellStyle:{padding:0}}],this.defaultColumnDefs={filter:!0,resizable:!0,sortable:!0}}render(){const e=(0,f.jsxs)("div",{className:"GridControls ground-control-controls",children:[(0,f.jsx)(m.z,{active:this.state.showDropzone,icon:P.d.CLOUD_UPLOAD,intent:this.state.showDropzone?x.S.PRIMARY:x.S.NONE,onClick:this.toggleDropzone,children:(0,f.jsx)("span",{className:"hidden-xs",children:"Upload assessment"})}),(0,f.jsx)($c,{}),(0,f.jsx)(m.z,{icon:P.d.REFRESH,onClick:this.props.handleAssessmentOverviewFetch,children:(0,f.jsx)("span",{className:"hidden-xs",children:"Refresh assessments"})})]}),t=(0,f.jsx)(w.U,{isOpen:this.state.showDropzone,keepChildrenMounted:!0,children:(0,f.jsx)(qc,{handleUploadAssessment:this.props.handleUploadAssessment,assessmentConfigurations:this.props.assessmentConfigurations})}),a=(0,f.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,f.jsx)(Na.AgGridReact,{domLayout:"autoHeight",columnDefs:this.columnDefs,defaultColDef:this.defaultColumnDefs,onGridReady:this.onGridReady,onGridSizeChanged:this.resizeGrid,rowData:this.props.assessmentOverviews,rowHeight:30,suppressCellFocus:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0})}),s=(0,f.jsxs)("div",{className:"GroundControl",children:[e,t,(0,f.jsx)(Ae.i,{}),a]});return(0,f.jsx)("div",{children:(0,f.jsx)(Ne.Z,{display:s,loadContentDispatch:this.loadContent})})}}const td=ed,ad=(0,d.$j)((e=>({assessmentOverviews:e.session.assessmentOverviews,assessmentConfigurations:e.session.assessmentConfigurations})),(e=>(0,Hc.DE)({handleAssessmentChangeDate:Kc.changeDateAssessment,handleAssessmentOverviewFetch:y.fetchAssessmentOverviews,handleDeleteAssessment:Kc.deleteAssessment,handleUploadAssessment:Kc.uploadAssessment,handlePublishAssessment:Kc.publishAssessment,handleFetchCourseConfigs:y.fetchCourseConfig},e)))(td),sd=e=>{const{data:t}=e;let a=!1;null!==t.notificationPreference&&null!==t.notificationPreference.isEnabled&&(a=t.notificationPreference.isEnabled);const s=c.useCallback((()=>{e.setStateHandler(e.rowIndex,!a)}),[e,a]);return(0,f.jsx)(qe.rs,{checked:a,onChange:s})},nd=e=>{const[t,a]=c.useState(),s=e.data[e.field];s.sort(((e,t)=>e.minutes-t.minutes));const n=e=>e.minutes>=60?Math.round(e.minutes/60*100)/100+" hour(s)":`${e.minutes} minute(s)`,i=e.data.isEnabled;let r;const o=s.filter((e=>e.isDefault));let l;if(1===o.length&&(r=o[0]),null!==e.data.notificationPreference){const t=s.filter((t=>t.id===e.data.notificationPreference.timeOptionId));1===t.length&&(l=t[0])}if(l||r){const e=l||r;t&&t.id===e.id||a(e)}return(0,f.jsx)(Qe.P,{filterable:!1,items:s,itemRenderer:(e,{handleClick:t,handleFocus:a,modifiers:s,query:i})=>(0,f.jsx)(Ze.s,{active:s.active,disabled:s.disabled,onClick:t,onFocus:a,roleStructure:"listoption",text:n(e)},e.id),onItemSelect:t=>{a(t),e.setStateHandler(e.rowIndex,t)},noResults:(0,f.jsx)(Ze.s,{disabled:!0,text:"No results.",roleStructure:"listoption"}),disabled:!i,children:(0,f.jsx)(m.z,{text:t?n(t):"Choose default",rightIcon:"caret-down",disabled:!i})})},id=()=>{const e=c.useRef(),t=(0,d.I0)(),a=(0,C.ix)((e=>e.session)),[s,n]=(0,c.useState)(!1),i=c.useRef(a.configurableNotificationConfigs);c.useEffect((()=>{a.courseRegId&&t((0,y.fetchConfigurableNotificationConfigs)(a.courseRegId))}),[t,a.courseRegId]),c.useEffect((()=>{var e;void 0!==a.configurableNotificationConfigs&&(i.current=(0,N.cloneDeep)(a.configurableNotificationConfigs)),null===(e=i.current)||void 0===e||e.forEach((e=>{null===e.notificationPreference&&(e.notificationPreference={id:-1,isEnabled:!0,timeOptionId:null})}))}),[a]);const r=[{headerName:"Notification Type",field:"notificationType.name",rowDrag:!0},{headerName:"Assessment Type",field:"assessmentConfig.type",valueFormatter:e=>{var t;return(null===(t=e.data.assessmentConfig)||void 0===t?void 0:t.type)||"-"}},{headerName:"Recipients",field:"notificationType.forStaff",valueFormatter:e=>e.data.notificationType.forStaff?"Staff":"Student"},{headerName:"Reminder",field:"timeOptions",cellRenderer:nd,cellRendererParams:{setStateHandler:(t,a)=>{var s,r,o;const l=[...null!==(s=i.current)&&void 0!==s?s:[]];l[t].notificationPreference.timeOptionId=a.id,i.current=l,null===(r=e.current)||void 0===r||null===(o=r.getDisplayedRowAtIndex(t))||void 0===o||o.setDataValue("timeOptions",l[t].timeOptions),n(!0)},field:"timeOptions"}},{headerName:"Enabled",field:"notificationPreference.isEnabled",cellRenderer:sd,cellRendererParams:{setStateHandler:(t,a)=>{var s,r,o;const l=[...null!==(s=i.current)&&void 0!==s?s:[]];l[t].notificationPreference.isEnabled=a,i.current=l,null===(r=e.current)||void 0===r||null===(o=r.getDisplayedRowAtIndex(t))||void 0===o||o.setDataValue("notificationPreference.isEnabled",a),n(!0)},field:"notificationPreference.isEnabled"}}],o=(0,f.jsxs)("div",{children:[(0,f.jsx)(p.H1,{children:"Notifications"}),(0,f.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,f.jsx)(Na.AgGridReact,{domLayout:"autoHeight",columnDefs:r,defaultColDef:{filter:!1,resizable:!0,sortable:!1},onGridReady:t=>{e.current=t.api,t.api.sizeColumnsToFit()},onGridSizeChanged:()=>{var t;return null===(t=e.current)||void 0===t?void 0:t.sizeColumnsToFit()},rowData:i.current,rowHeight:36,rowDragManaged:!0,suppressCellFocus:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0})}),(0,f.jsx)(m.z,{text:"Save",style:{marginTop:"15px"},disabled:!s,intent:s?x.S.WARNING:x.S.NONE,onClick:()=>{var e,r;if(!s)return;const o=null!==(e=null===(r=i.current)||void 0===r?void 0:r.map((e=>({...e.notificationPreference,notificationConfigId:e.id}))))&&void 0!==e?e:[];t((0,y.updateNotificationPreferences)(o,a.courseRegId)),n(!1)}})]});return(0,f.jsx)(Ne.Z,{loadContentDispatch:()=>{},display:o,fullWidth:!1})};var rd=a(11934),od=a(86282),ld=a.n(od);class cd extends c.PureComponent{constructor(e){super(e),this.recorder=void 0,this.handleCloseDialog=()=>this.setState({dialogOpen:!1}),this.handleOpenDialog=()=>this.setState({dialogOpen:!0}),this.updateTimerDuration=()=>{this.setState({duration:this.props.getTimerDuration()})},this.handleTruncatePlaybackData=()=>{const e=this.props.playbackData.inputs.filter((e=>e.time<=1e3*this.props.currentPlayerTime));this.props.handleResetInputs(e)},this.handleRecorderPausing=()=>{if(!this.recorder)return;const{handleSetIsEditorReadonly:e,handleSetSourcecastData:t,handleTimerPause:a}=this.props;clearInterval(this.state.updater),e(!0),a(),this.recorder.pause();t("","","",window.URL.createObjectURL(this.recorder.exportWAV()),this.props.playbackData)},this.handleRecorderStarting=()=>{this.recorder=new(ld());const{handleRecordInit:e,handleSetIsEditorReadonly:t,handleTimerStart:a}=this.props;this.recorder.start().then((()=>{e(),t(!1),a();const s=setInterval(this.updateTimerDuration,100);this.setState({updater:s})}),(e=>{alert("Microphone not found: "+e)}))},this.handleRecorderResuming=()=>{if(!this.recorder)return;const{handleSetIsEditorReadonly:e,handleTimerResume:t}=this.props;e(!1),t(-1);const a=setInterval(this.updateTimerDuration,100);this.setState({updater:a}),this.recorder.resume()},this.handleRecorderResumingFromCurrent=()=>{if(!this.recorder)return;const{currentPlayerTime:e,handleSetIsEditorReadonly:t,handleTimerResume:a}=this.props;this.handleTruncatePlaybackData(),t(!1),a(1e3*e);const s=setInterval(this.updateTimerDuration,100);this.setState({updater:s}),this.recorder.resume(e)},this.handleRecorderStopping=()=>{if(!this.recorder)return;const{handleSetIsEditorReadonly:e,handleTimerStop:t}=this.props;e(!1),t(),clearInterval(this.state.updater),this.recorder.stop(),this.setState({fileDataBlob:this.recorder.exportWAV()}),this.recorder.clear()},this.handleRecorderResetting=()=>{const{handleSetIsEditorReadonly:e,handleTimerReset:t}=this.props;e(!1),t(),clearInterval(this.state.updater),this.setState({duration:0}),this.recorder&&(this.recorder.stop(),this.recorder.clear())},this.handleRecorderSaving=()=>{this.state.fileDataBlob?this.props.handleSaveSourcecastData(this.state.saveTitle,this.state.saveDescription,this.state.saveUID,this.state.fileDataBlob,this.props.playbackData):alert("No recording found")},this.renderLabel=e=>{const t=Math.floor(e/60),a=Math.floor(e-60*t);return(t<10?"0"+t:t)+":"+(a<10?"0"+a:a)},this.handleSaveTitleInputChange=e=>{this.setState({saveTitle:e.target.value})},this.handleSaveDescriptionInputChange=e=>{this.setState({saveDescription:e.target.value})},this.handleSaveUIDInputChange=e=>{this.setState({saveUID:e.target.value})},this.state={dialogOpen:!1,duration:0,updater:void 0,saveTitle:"",saveDescription:"",saveUID:""}}async componentDidMount(){ld().getPermission().then((()=>{}),(e=>{alert("Microphone not found: "+e)}))}render(){const e=(0,f.jsx)(ee.Z,{label:"Record Pause",icon:P.d.SNOWFLAKE,onClick:this.props.handleRecordPause}),t=(0,f.jsx)(ee.Z,{label:"Pause",icon:P.d.PAUSE,onClick:this.handleRecorderPausing}),a=(0,f.jsx)(ee.Z,{label:"Resume",icon:P.d.PLAY,onClick:this.handleRecorderResuming}),i=(0,f.jsx)(ee.Z,{label:"Resume Here",icon:P.d.PLAY,onClick:this.handleRecorderResumingFromCurrent}),r=(0,f.jsx)(ee.Z,{label:"Record",icon:P.d.PLAY,onClick:this.handleRecorderStarting}),o=(0,f.jsx)(ee.Z,{label:"Stop",icon:P.d.STOP,onClick:this.handleRecorderStopping}),l=(0,f.jsx)(ee.Z,{label:"Reset",icon:P.d.REFRESH,onClick:this.handleRecorderResetting}),c=(0,f.jsx)(ee.Z,{label:"Upload",icon:P.d.FLOPPY_DISK,onClick:this.handleOpenDialog});return(0,f.jsxs)("div",{children:[(0,f.jsxs)(g.V,{icon:"info-sign",isOpen:this.state.dialogOpen,onClose:this.handleCloseDialog,title:"Upload Sourcecast",canOutsideClickClose:!0,children:[(0,f.jsxs)("div",{className:s.DIALOG_BODY,children:[(0,f.jsx)(Ea.B,{id:"title",leftIcon:P.d.HEADER,onChange:this.handleSaveTitleInputChange,placeholder:"Title",value:this.state.saveTitle}),(0,f.jsx)("br",{}),(0,f.jsx)(Ea.B,{id:"description",leftIcon:P.d.LIST_DETAIL_VIEW,onChange:this.handleSaveDescriptionInputChange,placeholder:"Description",value:this.state.saveDescription}),(0,f.jsx)("br",{}),(0,f.jsx)(Ea.B,{id:"uid",leftIcon:P.d.KEY,onChange:this.handleSaveUIDInputChange,placeholder:"UID (optional, only alphanumeric, dash and underscore allowed)",value:this.state.saveUID})]}),(0,f.jsx)("div",{className:s.DIALOG_FOOTER,children:(0,f.jsxs)("div",{className:s.DIALOG_FOOTER_ACTIONS,children:[(0,f.jsx)(ee.Z,{label:"Confirm Upload",icon:P.d.TICK,onClick:this.handleRecorderSaving}),(0,f.jsx)(ee.Z,{label:"Cancel",icon:P.d.CROSS,onClick:this.handleCloseDialog})]})})]}),(0,f.jsx)("br",{}),(0,f.jsx)("div",{className:"Timer",children:(0,f.jsx)(n.Z,{elevation:2,style:{background:"#24323F"},children:(0,f.jsx)(p.H1,{children:this.renderLabel(this.props.recordingStatus!==H.bl.paused?this.state.duration/1e3:this.props.currentPlayerTime)})})}),(0,f.jsx)("br",{}),(0,f.jsxs)("div",{className:"RecorderControl",children:[this.props.recordingStatus===H.bl.notStarted&&r,this.props.recordingStatus===H.bl.paused&&a,this.props.recordingStatus===H.bl.paused&&i,this.props.recordingStatus===H.bl.recording&&t,this.props.recordingStatus===H.bl.recording&&e,this.props.recordingStatus===H.bl.paused&&o,this.props.recordingStatus===H.bl.finished&&c,this.props.recordingStatus!==H.bl.notStarted&&l]}),(0,f.jsx)("br",{})]})}}const dd=cd,hd="sourcereel",ud="sourcecast",gd="Welcome to Sourcereel!",pd=()=>{const{selectedTab:e,setSelectedTab:t}=(0,Ce.__)(hd,ge.B_.sourcereel),a=(0,C.ix)((e=>e.session.courseId)),{chapter:n,variant:i}=(0,C.ix)((e=>e.workspaces[hd].context)),{audioUrl:r,currentPlayerTime:o,codeDeltasToApply:h,inputToApply:u,playbackDuration:g,playbackStatus:m,sourcecastIndex:x}=(0,C.ix)((e=>e.workspaces.sourcecast)),{isFolderModeEnabled:y,activeEditorTabIndex:b,editorTabs:v,externalLibrary:j,isDebugging:S,isEditorAutorun:I,isEditorReadonly:k,isRunning:w,output:A,playbackData:T,recordingStatus:M,replValue:E,timeElapsedBeforePause:N,timeResumed:R}=(0,C.ix)((e=>e.workspaces[hd])),D=(0,d.I0)(),{handleChapterSelect:L,handleEditorEval:O,handleEditorValueChange:G,handleExternalSelect:B,handleRecordInput:U,handleReplEval:F,handleSetSourcecastStatus:z,handleSetIsEditorReadonly:V}=(0,c.useMemo)((()=>({handleChapterSelect:e=>D((0,ke.chapterSelect)(e,_.Variant.DEFAULT,hd)),handleEditorEval:()=>D((0,ke.evalEditor)(hd)),handleEditorValueChange:e=>D((0,ke.updateEditorValue)(hd,0,e)),handleExternalSelect:e=>D((0,ke.externalLibrarySelect)(e,hd)),handleRecordInput:e=>D((0,rd.recordInput)(e,hd)),handleReplEval:()=>D((0,ke.evalRepl)(hd)),handleSetSourcecastStatus:e=>D((0,ja.setSourcecastStatus)(e,ud)),handleSetIsEditorReadonly:e=>D((0,ke.setIsEditorReadonly)(hd,e))})),[D]);(0,c.useEffect)((()=>{(0,Ca.fetchSourcecastIndex)(ud)}),[]),(0,c.useEffect)((()=>{if(u)switch(u.type){case"activeTabChange":t(u.data);break;case"chapterSelect":L(u.data);break;case"externalLibrarySelect":B(u.data);break;case"forcePause":z(H.PO.forcedPaused)}}),[u]);const W=()=>N+Date.now()-R,q=(0,c.useMemo)((()=>({handleDebuggerPause:()=>D((0,va.beginDebuggerPause)(hd)),handleDebuggerResume:()=>D((0,va.debuggerResume)(hd)),handleDebuggerReset:()=>D((0,va.debuggerReset)(hd)),handleInterruptEval:()=>D((0,va.beginInterruptExecution)(hd)),handleToggleEditorAutorun:()=>D((0,ke.toggleEditorAutorun)(hd))})),[D]),Z=(0,f.jsx)(Sa.k,{handleDebuggerPause:q.handleDebuggerPause,handleDebuggerResume:q.handleDebuggerResume,handleDebuggerReset:q.handleDebuggerReset,handleEditorEval:()=>{O(),M===H.bl.recording&&U({time:W(),type:"keyboardCommand",data:H.SO.run})},handleInterruptEval:q.handleInterruptEval,handleToggleEditorAutorun:q.handleToggleEditorAutorun,isEntrypointFileDefined:null!==b,isDebugging:S,isEditorAutorun:I,isRunning:w},"autorun"),Y=(0,f.jsx)(K.b,{handleChapterSelect:({chapter:e},t)=>{L(e),M===H.bl.recording&&U({time:W(),type:"chapterSelect",data:e})},isFolderModeEnabled:y,sourceChapter:n,sourceVariant:i},"chapter"),J=(0,c.useMemo)((()=>(0,f.jsx)($._,{handleReplOutputClear:()=>D((0,ke.clearReplOutput)(hd))},"clear_repl")),[D]),Q=(0,f.jsx)(X.e,{handleReplEval:F,isRunning:w},"eval_repl"),ee=(0,c.useMemo)((()=>({setActiveEditorTabIndex:e=>D((0,ke.updateActiveEditorTabIndex)(hd,e)),removeEditorTabByIndex:e=>D((0,ke.removeEditorTab)(hd,e)),handleDeclarationNavigate:e=>D((0,ke.navigateToDeclaration)(hd,e)),handleEditorUpdateBreakpoints:e=>D((0,ke.setEditorBreakpoint)(hd,0,e))})),[D]),ae={handleEditorEval:O,handleEditorValueChange:G,handleRecordInput:U,codeDeltasToApply:h,inputToApply:u,isEditorAutorun:I,isEditorReadonly:k,editorVariant:ud,isFolderModeEnabled:y,activeEditorTabIndex:b,setActiveEditorTabIndex:ee.setActiveEditorTabIndex,removeEditorTabByIndex:ee.removeEditorTabByIndex,editorTabs:v.map(te.F),handleDeclarationNavigate:ee.handleDeclarationNavigate,handleEditorUpdateBreakpoints:ee.handleEditorUpdateBreakpoints,editorSessionId:"",getTimerDuration:W,isPlaying:m===H.PO.playing,isRecording:M===H.bl.recording},se=(0,ka.Z)(hd),ne=(0,Ia.Z)(hd),ie=(0,c.useMemo)((()=>({handleBrowseHistoryDown:()=>D((0,ke.browseReplHistoryDown)(hd)),handleBrowseHistoryUp:()=>D((0,ke.browseReplHistoryUp)(hd)),handleReplValueChange:e=>D((0,ke.updateReplValue)(e,hd)),handleDeleteSourcecastEntry:e=>D((0,rd.deleteSourcecastEntry)(e,ud)),handleResetInputs:e=>D((0,rd.resetInputs)(e,hd)),handleSaveSourcecastData:(e,t,a,s,n)=>D((0,ja.saveSourcecastData)(e,t,a,s,n,ud)),handleSetSourcecastData:(e,t,a,s,n)=>D((0,ja.setSourcecastData)(e,t,a,s,n,ud)),handleTimerPause:()=>D((0,rd.timerPause)(hd)),handleTimerReset:()=>D((0,rd.timerReset)(hd)),handleTimerResume:e=>D((0,rd.timerResume)(e,hd)),handleTimerStart:()=>D((0,rd.timerStart)(hd)),handleTimerStop:()=>D((0,rd.timerStop)(hd))})),[D]),re={controlBarProps:{editorButtons:[Z,Y]},editorContainerProps:ae,handleSideContentHeightChange:e=>D((0,ve.changeSideContentHeight)(e,hd)),replProps:{output:A,replValue:E,handleBrowseHistoryDown:ie.handleBrowseHistoryDown,handleBrowseHistoryUp:ie.handleBrowseHistoryUp,handleReplEval:F,handleReplValueChange:ie.handleReplValueChange,sourceChapter:n,sourceVariant:i,externalLibrary:j,replButtons:[Q,J]},sideBarProps:{tabs:[]},sideContentProps:{onChange:e=>{t(e),M===H.bl.recording&&U({time:W(),type:"activeTabChange",data:e})},selectedTabId:e,tabs:{beforeDynamicTabs:[{label:"Recording Panel",iconName:P.d.COMPASS,body:(0,f.jsxs)("div",{children:[(0,f.jsx)("span",{className:"Multi-line",children:(0,f.jsxs)(p.SU,{children:[" ",gd," "]})}),(0,f.jsx)(dd,{currentPlayerTime:o,editorValue:v[0].value,getTimerDuration:W,playbackData:T,handleRecordInit:()=>{const e={chapter:n,externalLibrary:j,editorValue:v[0].value};D((0,rd.recordInit)(e,hd))},handleRecordPause:()=>U({time:W(),type:"forcePause",data:null}),handleResetInputs:ie.handleResetInputs,handleSaveSourcecastData:ie.handleSaveSourcecastData,handleSetSourcecastData:ie.handleSetSourcecastData,handleSetIsEditorReadonly:V,handleTimerPause:ie.handleTimerPause,handleTimerReset:ie.handleTimerReset,handleTimerResume:ie.handleTimerResume,handleTimerStart:ie.handleTimerStart,handleTimerStop:ie.handleTimerStop,recordingStatus:M})]}),id:ge.B_.sourcereel},{label:"Sourcecast Table",iconName:P.d.EDIT,body:(0,f.jsx)("div",{children:(0,f.jsx)(Ba,{handleDeleteSourcecastEntry:ie.handleDeleteSourcecastEntry,sourcecastIndex:x,courseId:a})}),id:ge.B_.introduction},se,ne],afterDynamicTabs:[]},workspaceLocation:hd}},oe=(0,c.useMemo)((()=>({handleSetCurrentPlayerTime:e=>D((0,ja.setCurrentPlayerTime)(e,ud)),handleSetCodeDeltasToApply:e=>D((0,ja.setCodeDeltasToApply)(e,ud)),handleSetInputToApply:e=>D((0,ja.setInputToApply)(e,ud)),handleSetSourcecastDuration:e=>D((0,ja.setSourcecastDuration)(e,ud)),handlePromptAutocomplete:(e,t,a)=>D((0,ke.promptAutocomplete)(hd,e,t,a))})),[D]),le={handleChapterSelect:L,handleEditorValueChange:G,handleExternalSelect:B,handleSetSourcecastStatus:z,handleSetIsEditorReadonly:V,audioUrl:r,currentPlayerTime:o,playbackData:T,playbackStatus:m,handleSetCurrentPlayerTime:oe.handleSetCurrentPlayerTime,handleSetCodeDeltasToApply:oe.handleSetCodeDeltasToApply,handleSetInputToApply:oe.handleSetInputToApply,handleSetSourcecastDuration:oe.handleSetSourcecastDuration,handlePromptAutocomplete:oe.handlePromptAutocomplete,duration:g};return(0,f.jsxs)("div",{className:l()("Sourcereel",s.DARK),children:[M===H.bl.paused?(0,f.jsx)(Ma,{...le}):void 0,(0,f.jsx)(Ie.Z,{...re})]})},md=()=>{const e=(0,d.I0)();c.useEffect((()=>{e((0,y.fetchNotifications)())}),[e]);const{agreedToResearch:t,assessmentConfigurations:a,enableGame:s,role:n}=(0,C.kP)(),i=n!==u.uU.Student?[(0,f.jsx)(h.AW,{path:"groundcontrol",element:(0,f.jsx)(ad,{})},0),(0,f.jsx)(h.AW,{path:`grading/${L.R6}`,element:(0,f.jsx)(Vc,{})},1),(0,f.jsx)(h.AW,{path:"sourcereel",element:(0,f.jsx)(pd,{})},2),(0,f.jsx)(h.AW,{path:"gamesimulator",element:(0,f.jsx)(mc,{})},3),(0,f.jsx)(h.AW,{path:"dashboard",element:(0,f.jsx)(ps,{})},4)]:null;return(0,f.jsxs)("div",{className:j.Z.Academy,children:[b.Z.showResearchPrompt&&null===t&&(0,f.jsx)(v,{}),(0,f.jsxs)(h.Z5,{children:[null===a||void 0===a?void 0:a.map((e=>(0,f.jsx)(h.AW,{path:`${(0,je.q1)(e.type)}/${L._T}`,element:(0,f.jsx)(Ge,{assessmentConfiguration:e})},e.type))),s&&(0,f.jsx)(h.AW,{path:"game",element:(0,f.jsx)(kl,{})}),(0,f.jsx)(h.AW,{path:"/notipreference",element:(0,f.jsx)(id,{})}),(0,f.jsx)(h.AW,{path:"sourcecast/:sourcecastId?",element:(0,f.jsx)(za,{})}),(0,f.jsx)(h.AW,{path:"achievements/*",element:(0,f.jsx)(fa,{})}),(0,f.jsx)(h.AW,{path:"",element:(0,f.jsx)(h.Fg,{replace:!0,to:s?"game":a&&a.length>0?`${(0,je.q1)(a[0].type)}`:n===u.uU.Admin?"adminpanel":"/404"})}),i,n===u.uU.Admin&&(0,f.jsx)(h.AW,{path:"adminpanel",element:(0,f.jsx)(hs,{})}),(0,f.jsx)(h.AW,{path:"*",element:(0,f.jsx)(Be.default,{})})]})]})},xd=()=>{const e=(0,d.I0)(),t=(0,h.s0)(),{courseId:a}=(0,C.kP)(),{courseId:o}=(0,h.UO)(),u=null!=o?parseInt(o,10):void 0;return c.useEffect((()=>{if(null===o||void 0===o||!o.match(L.CJ))return t("/");void 0===u||Number.isNaN(u)||a===u||e((0,y.updateLatestViewedCourse)(u))}),[a,e,u,t,o]),Number.isNaN(u)?(0,f.jsx)(h.Fg,{to:"/"}):u===a?(0,f.jsx)(md,{}):(0,f.jsx)("div",{className:l()(j.Z["Academy-switching-courses"],s.DARK),children:(0,f.jsx)(n.Z,{className:s.ELEVATION_4,children:(0,f.jsx)(i.t,{description:"Switching courses...",icon:(0,f.jsx)(r.$,{size:r.E.LARGE})})})})},yd=xd;yd.displayName="Academy";const bd=xd},24128:(e,t,a)=>{"use strict";a.r(t),a.d(t,{Component:()=>d,default:()=>h});var s=a(68358),n=a(43076),i=a(70352),r=a(72884),o=a.n(r),l=(a(47313),a(46417));const c=()=>(0,l.jsx)("div",{className:o()("NoPage",s.DARK),"data-testid":"NotFound-Component",children:(0,l.jsx)(n.t,{icon:i.d.ERROR,title:"404 Not Found",description:"The requested resource could not be found"})}),d=c;d.displayName="NotFound";const h=c},88115:(e,t,a)=>{var s={"./_lib/buildFormatLongFn/index.js":[22210,7],"./_lib/buildLocalizeFn/index.js":[22197,7],"./_lib/buildMatchFn/index.js":[13585,7],"./_lib/buildMatchPatternFn/index.js":[96412,7],"./af/_lib/formatDistance/index.js":[28046,7,55468],"./af/_lib/formatLong/index.js":[92022,7,86224],"./af/_lib/formatRelative/index.js":[91851,7,60458],"./af/_lib/localize/index.js":[70688,7,49845],"./af/_lib/match/index.js":[21834,7,14865],"./af/index.js":[38795,7,72534],"./ar-DZ/_lib/formatDistance/index.js":[49021,7,59922],"./ar-DZ/_lib/formatLong/index.js":[99200,7,88932],"./ar-DZ/_lib/formatRelative/index.js":[46902,7,4080],"./ar-DZ/_lib/localize/index.js":[35339,7,90938],"./ar-DZ/_lib/match/index.js":[98291,7,47210],"./ar-DZ/index.js":[81330,7,60617],"./ar-EG/_lib/formatDistance/index.js":[60572,7,31492],"./ar-EG/_lib/formatLong/index.js":[7470,7,99338],"./ar-EG/_lib/formatRelative/index.js":[20756,7,40511],"./ar-EG/_lib/localize/index.js":[35129,7,67291],"./ar-EG/_lib/match/index.js":[19881,7,75416],"./ar-EG/index.js":[81868,7,99193],"./ar-MA/_lib/formatDistance/index.js":[17241,7,9801],"./ar-MA/_lib/formatLong/index.js":[8303,7,97562],"./ar-MA/_lib/formatRelative/index.js":[22422,7,27990],"./ar-MA/_lib/localize/index.js":[66386,7,50340],"./ar-MA/_lib/match/index.js":[18382,7,18640],"./ar-MA/index.js":[22214,7,56907],"./ar-SA/_lib/formatDistance/index.js":[97682,7,29405],"./ar-SA/_lib/formatLong/index.js":[59224,7,90667],"./ar-SA/_lib/formatRelative/index.js":[5605,7,58337],"./ar-SA/_lib/localize/index.js":[58632,7,89547],"./ar-SA/_lib/match/index.js":[36986,7,63590],"./ar-SA/index.js":[31732,7,77188],"./ar-TN/_lib/formatDistance/index.js":[7001,7,24830],"./ar-TN/_lib/formatLong/index.js":[4910,7,54698],"./ar-TN/_lib/formatRelative/index.js":[95147,7,45604],"./ar-TN/_lib/localize/index.js":[68422,7,90002],"./ar-TN/_lib/match/index.js":[97417,7,72410],"./ar-TN/index.js":[47841,7,15569],"./ar/_lib/formatDistance/index.js":[20214,7,97872],"./ar/_lib/formatLong/index.js":[34043,7,69357],"./ar/_lib/formatRelative/index.js":[97112,7,48320],"./ar/_lib/localize/index.js":[88302,7,18228],"./ar/_lib/match/index.js":[55935,7,55928],"./ar/index.js":[95225,7,6083],"./az/_lib/formatDistance/index.js":[47599,7,47736],"./az/_lib/formatLong/index.js":[89224,7,76604],"./az/_lib/formatRelative/index.js":[15817,7,8667],"./az/_lib/localize/index.js":[21352,7,11652],"./az/_lib/match/index.js":[48414,7,94954],"./az/index.js":[54720,7,68349],"./be-tarask/_lib/formatDistance/index.js":[44282,7,47841],"./be-tarask/_lib/formatLong/index.js":[91635,7,73055],"./be-tarask/_lib/formatRelative/index.js":[72732,7,6597,28264],"./be-tarask/_lib/localize/index.js":[23566,7,94251],"./be-tarask/_lib/match/index.js":[59719,7,71114],"./be-tarask/index.js":[48677,7,6597,51156],"./be/_lib/formatDistance/index.js":[48580,7,560],"./be/_lib/formatLong/index.js":[27592,7,48012],"./be/_lib/formatRelative/index.js":[85479,7,6597,36021],"./be/_lib/localize/index.js":[20332,7,9214],"./be/_lib/match/index.js":[45840,7,58479],"./be/index.js":[94423,7,6597,59052],"./bg/_lib/formatDistance/index.js":[86159,7,28981],"./bg/_lib/formatLong/index.js":[70417,7,82299],"./bg/_lib/formatRelative/index.js":[74666,7,6915],"./bg/_lib/localize/index.js":[44725,7,71431],"./bg/_lib/match/index.js":[67908,7,37128],"./bg/index.js":[56773,7,83933],"./bn/_lib/formatDistance/index.js":[99863,7,54110],"./bn/_lib/formatLong/index.js":[17450,7,57319],"./bn/_lib/formatRelative/index.js":[32879,7,313],"./bn/_lib/localize/index.js":[83892,9,52058],"./bn/_lib/match/index.js":[54678,7,26018],"./bn/index.js":[55527,7,62769],"./bs/_lib/formatDistance/index.js":[32987,7,62477],"./bs/_lib/formatLong/index.js":[78463,7,25559],"./bs/_lib/formatRelative/index.js":[45365,7,69810],"./bs/_lib/localize/index.js":[41101,7,46335],"./bs/_lib/match/index.js":[30451,7,57210],"./bs/index.js":[69399,7,24145],"./ca/_lib/formatDistance/index.js":[88245,7,93414],"./ca/_lib/formatLong/index.js":[14376,7,77285],"./ca/_lib/formatRelative/index.js":[21993,7,30639],"./ca/_lib/localize/index.js":[20825,7,98371],"./ca/_lib/match/index.js":[14032,7,24113],"./ca/index.js":[44837,7,16409],"./cs/_lib/formatDistance/index.js":[63845,7,76326],"./cs/_lib/formatLong/index.js":[56837,7,45022],"./cs/_lib/formatRelative/index.js":[34344,7,25526],"./cs/_lib/localize/index.js":[29738,7,19025],"./cs/_lib/match/index.js":[34534,7,31458],"./cs/index.js":[74019,7,15040],"./cy/_lib/formatDistance/index.js":[64022,7,78248],"./cy/_lib/formatLong/index.js":[97733,7,65416],"./cy/_lib/formatRelative/index.js":[52124,7,21454],"./cy/_lib/localize/index.js":[90817,7,43325],"./cy/_lib/match/index.js":[49770,7,46328],"./cy/index.js":[34963,7,87605],"./da/_lib/formatDistance/index.js":[68105,7,77466],"./da/_lib/formatLong/index.js":[14737,7,54307],"./da/_lib/formatRelative/index.js":[1197,7,54897],"./da/_lib/localize/index.js":[13638,7,70679],"./da/_lib/match/index.js":[44357,7,4794],"./da/index.js":[78893,7,88650],"./de-AT/_lib/localize/index.js":[10132,7,92708],"./de-AT/index.js":[62594,7,11133],"./de/_lib/formatDistance/index.js":[71762,7,50816],"./de/_lib/formatLong/index.js":[86882,7,9710],"./de/_lib/formatRelative/index.js":[41503,7,85754],"./de/_lib/localize/index.js":[95003,7,25325],"./de/_lib/match/index.js":[28694,7,46081],"./de/index.js":[97367,7,21773],"./el/_lib/formatDistance/index.js":[22471,7,88466],"./el/_lib/formatLong/index.js":[77125,7,67992],"./el/_lib/formatRelative/index.js":[44892,7,95695],"./el/_lib/localize/index.js":[44314,7,59315],"./el/_lib/match/index.js":[4014,7,60526],"./el/index.js":[81740,7,52025],"./en-AU/_lib/formatLong/index.js":[20285,7,5474],"./en-AU/index.js":[7498,7,75811],"./en-CA/_lib/formatDistance/index.js":[9254,7,95951],"./en-CA/_lib/formatLong/index.js":[60854,7,45074],"./en-CA/index.js":[81748,7,64368],"./en-GB/_lib/formatLong/index.js":[7201,7,81834],"./en-GB/index.js":[61510,7,58912],"./en-IE/index.js":[2302,7,41432],"./en-IN/_lib/formatLong/index.js":[2117,7,56071],"./en-IN/index.js":[65340,7,72062],"./en-NZ/_lib/formatLong/index.js":[61246,7,7882],"./en-NZ/index.js":[16312,7,84898],"./en-US/_lib/formatDistance/index.js":[80297,7],"./en-US/_lib/formatLong/index.js":[10839,7],"./en-US/_lib/formatRelative/index.js":[97700,7],"./en-US/_lib/localize/index.js":[75786,7],"./en-US/_lib/match/index.js":[57675,7],"./en-US/index.js":[21711,7],"./en-ZA/_lib/formatLong/index.js":[58231,7,74430],"./en-ZA/index.js":[39975,7,80963],"./eo/_lib/formatDistance/index.js":[86005,7,38747],"./eo/_lib/formatLong/index.js":[87315,7,88689],"./eo/_lib/formatRelative/index.js":[21814,7,4335],"./eo/_lib/localize/index.js":[66425,7,87263],"./eo/_lib/match/index.js":[36854,7,18376],"./eo/index.js":[11015,7,75454],"./es/_lib/formatDistance/index.js":[81042,7,31643],"./es/_lib/formatLong/index.js":[50163,7,38879],"./es/_lib/formatRelative/index.js":[73403,7,73288],"./es/_lib/localize/index.js":[88355,7,37098],"./es/_lib/match/index.js":[40201,7,3409],"./es/index.js":[32662,7,91402],"./et/_lib/formatDistance/index.js":[27510,7,83368],"./et/_lib/formatLong/index.js":[39803,7,50689],"./et/_lib/formatRelative/index.js":[43403,7,80617],"./et/_lib/localize/index.js":[84024,7,92793],"./et/_lib/match/index.js":[99781,7,62752],"./et/index.js":[28518,7,96700],"./eu/_lib/formatDistance/index.js":[83071,7,39161],"./eu/_lib/formatLong/index.js":[17970,7,4082],"./eu/_lib/formatRelative/index.js":[82738,7,39523],"./eu/_lib/localize/index.js":[90534,7,29884],"./eu/_lib/match/index.js":[77171,7,28991],"./eu/index.js":[85684,7,75916],"./fa-IR/_lib/formatDistance/index.js":[95299,7,41807],"./fa-IR/_lib/formatLong/index.js":[67750,7,16783],"./fa-IR/_lib/formatRelative/index.js":[13084,7,36202],"./fa-IR/_lib/localize/index.js":[69370,7,42225],"./fa-IR/_lib/match/index.js":[23346,7,17573],"./fa-IR/index.js":[6423,7,47443],"./fi/_lib/formatDistance/index.js":[76957,7,97374],"./fi/_lib/formatLong/index.js":[32686,7,14063],"./fi/_lib/formatRelative/index.js":[39004,7,11908],"./fi/_lib/localize/index.js":[50831,7,53454],"./fi/_lib/match/index.js":[46469,7,700],"./fi/index.js":[33862,7,5997],"./fr-CA/_lib/formatLong/index.js":[2840,7,5517],"./fr-CA/index.js":[66488,7,6470],"./fr-CH/_lib/formatLong/index.js":[22570,7,46329],"./fr-CH/_lib/formatRelative/index.js":[94375,7,42728],"./fr-CH/index.js":[44928,7,82609],"./fr/_lib/formatDistance/index.js":[23506,7,92707],"./fr/_lib/formatLong/index.js":[92699,7,61772],"./fr/_lib/formatRelative/index.js":[13893,7,25580],"./fr/_lib/localize/index.js":[85963,7,59770],"./fr/_lib/match/index.js":[72669,7,49930],"./fr/index.js":[5438,7,2389],"./fy/_lib/formatDistance/index.js":[50245,7,9247],"./fy/_lib/formatLong/index.js":[53196,7,34583],"./fy/_lib/formatRelative/index.js":[92984,7,53786],"./fy/_lib/localize/index.js":[17681,7,89670],"./fy/_lib/match/index.js":[77493,7,51613],"./fy/index.js":[79346,7,37404],"./gd/_lib/formatDistance/index.js":[15683,7,8926],"./gd/_lib/formatLong/index.js":[5390,7,32641],"./gd/_lib/formatRelative/index.js":[66979,7,76084],"./gd/_lib/localize/index.js":[15483,7,18386],"./gd/_lib/match/index.js":[11364,7,34192],"./gd/index.js":[99458,7,57109],"./gl/_lib/formatDistance/index.js":[65976,7,9620],"./gl/_lib/formatLong/index.js":[28056,7,29533],"./gl/_lib/formatRelative/index.js":[19665,7,45010],"./gl/_lib/localize/index.js":[54234,7,9468],"./gl/_lib/match/index.js":[58316,7,96119],"./gl/index.js":[62909,7,66539],"./gu/_lib/formatDistance/index.js":[17403,7,7606],"./gu/_lib/formatLong/index.js":[63887,7,21603],"./gu/_lib/formatRelative/index.js":[56254,7,10399],"./gu/_lib/localize/index.js":[93574,7,26640],"./gu/_lib/match/index.js":[63929,7,96605],"./gu/index.js":[59699,7,11455],"./he/_lib/formatDistance/index.js":[53881,7,44388],"./he/_lib/formatLong/index.js":[14928,7,70481],"./he/_lib/formatRelative/index.js":[90786,7,87860],"./he/_lib/localize/index.js":[56881,7,17819],"./he/_lib/match/index.js":[92801,7,8314],"./he/index.js":[65113,7,66936],"./hi/_lib/formatDistance/index.js":[33642,7,38750],"./hi/_lib/formatLong/index.js":[23453,7,23601],"./hi/_lib/formatRelative/index.js":[35622,7,72739],"./hi/_lib/localize/index.js":[3e4,9,43959],"./hi/_lib/match/index.js":[94,7,64813],"./hi/index.js":[82016,7,39184],"./hr/_lib/formatDistance/index.js":[16097,7,87513],"./hr/_lib/formatLong/index.js":[47631,7,11893],"./hr/_lib/formatRelative/index.js":[94443,7,64858],"./hr/_lib/localize/index.js":[1196,7,93592],"./hr/_lib/match/index.js":[52393,7,57706],"./hr/index.js":[10738,7,23666],"./ht/_lib/formatDistance/index.js":[63507,7,35018],"./ht/_lib/formatLong/index.js":[68992,7,99887],"./ht/_lib/formatRelative/index.js":[64386,7,96455],"./ht/_lib/localize/index.js":[62176,7,68778],"./ht/_lib/match/index.js":[87332,7,78394],"./ht/index.js":[29043,7,94989],"./hu/_lib/formatDistance/index.js":[44412,7,65563],"./hu/_lib/formatLong/index.js":[37194,7,33212],"./hu/_lib/formatRelative/index.js":[30709,7,38217],"./hu/_lib/localize/index.js":[45563,7,82129],"./hu/_lib/match/index.js":[34478,7,39375],"./hu/index.js":[44356,7,6504],"./hy/_lib/formatDistance/index.js":[949,7,9446],"./hy/_lib/formatLong/index.js":[6918,7,89046],"./hy/_lib/formatRelative/index.js":[35395,7,25038],"./hy/_lib/localize/index.js":[26441,7,28328],"./hy/_lib/match/index.js":[14635,7,8591],"./hy/index.js":[19264,7,17822],"./id/_lib/formatDistance/index.js":[49823,7,90243],"./id/_lib/formatLong/index.js":[6469,7,50599],"./id/_lib/formatRelative/index.js":[60804,7,80680],"./id/_lib/localize/index.js":[78409,7,50417],"./id/_lib/match/index.js":[51406,7,50931],"./id/index.js":[20130,7,35820],"./is/_lib/formatDistance/index.js":[73961,7,32680],"./is/_lib/formatLong/index.js":[99154,7,31131],"./is/_lib/formatRelative/index.js":[98680,7,91658],"./is/_lib/localize/index.js":[66045,7,81017],"./is/_lib/match/index.js":[72914,7,26574],"./is/index.js":[12635,7,68003],"./it-CH/_lib/formatLong/index.js":[59947,7,76709],"./it-CH/index.js":[17811,7,74061],"./it/_lib/formatDistance/index.js":[1495,7,84519],"./it/_lib/formatLong/index.js":[80001,7,30799],"./it/_lib/formatRelative/index.js":[16441,7,48433],"./it/_lib/localize/index.js":[59087,7,32126],"./it/_lib/match/index.js":[4053,7,9267],"./it/index.js":[53896,7,36936],"./ja-Hira/_lib/formatDistance/index.js":[14949,7,46608],"./ja-Hira/_lib/formatLong/index.js":[9726,7,21308],"./ja-Hira/_lib/formatRelative/index.js":[40504,7,25551],"./ja-Hira/_lib/localize/index.js":[16264,7,79733],"./ja-Hira/_lib/match/index.js":[6654,7,13831],"./ja-Hira/index.js":[42426,7,44331],"./ja/_lib/formatDistance/index.js":[69527,7,31221],"./ja/_lib/formatLong/index.js":[98145,7,28725],"./ja/_lib/formatRelative/index.js":[99194,7,2370],"./ja/_lib/localize/index.js":[83303,7,71469],"./ja/_lib/match/index.js":[28170,7,84248],"./ja/index.js":[3745,7,70789],"./ka/_lib/formatDistance/index.js":[5451,7,27282],"./ka/_lib/formatLong/index.js":[79941,7,39040],"./ka/_lib/formatRelative/index.js":[67735,7,83665],"./ka/_lib/localize/index.js":[87563,7,72240],"./ka/_lib/match/index.js":[58204,7,95796],"./ka/index.js":[13706,7,90666],"./kk/_lib/formatDistance/index.js":[72196,7,48801],"./kk/_lib/formatLong/index.js":[50909,7,35597],"./kk/_lib/formatRelative/index.js":[27458,7,54223],"./kk/_lib/localize/index.js":[14728,7,50219],"./kk/_lib/match/index.js":[77914,7,45502],"./kk/index.js":[76470,7,29546],"./km/_lib/formatDistance/index.js":[3643,7,34329],"./km/_lib/formatLong/index.js":[70369,7,58860],"./km/_lib/formatRelative/index.js":[52054,7,39538],"./km/_lib/localize/index.js":[67271,7,27591],"./km/_lib/match/index.js":[15399,7,92973],"./km/index.js":[26748,7,13054],"./kn/_lib/formatDistance/index.js":[29995,7,43433],"./kn/_lib/formatLong/index.js":[27486,7,24951],"./kn/_lib/formatRelative/index.js":[65830,7,45549],"./kn/_lib/localize/index.js":[91666,7,7185],"./kn/_lib/match/index.js":[90764,7,79619],"./kn/index.js":[64061,7,67650],"./ko/_lib/formatDistance/index.js":[43427,7,59778],"./ko/_lib/formatLong/index.js":[52504,7,46717],"./ko/_lib/formatRelative/index.js":[39822,7,97722],"./ko/_lib/localize/index.js":[48960,7,798],"./ko/_lib/match/index.js":[34549,7,55675],"./ko/index.js":[57549,7,24152],"./lb/_lib/formatDistance/index.js":[72396,7,51443],"./lb/_lib/formatLong/index.js":[54825,7,96965],"./lb/_lib/formatRelative/index.js":[62602,7,4274],"./lb/_lib/localize/index.js":[96275,7,83038],"./lb/_lib/match/index.js":[91070,7,32216],"./lb/index.js":[5924,7,75131],"./lt/_lib/formatDistance/index.js":[54805,7,46100],"./lt/_lib/formatLong/index.js":[74040,7,66863],"./lt/_lib/formatRelative/index.js":[71417,7,62915],"./lt/_lib/localize/index.js":[55912,7,22302],"./lt/_lib/match/index.js":[51510,7,7547],"./lt/index.js":[22191,7,60804],"./lv/_lib/formatDistance/index.js":[46197,7,14181],"./lv/_lib/formatLong/index.js":[92559,7,48246],"./lv/_lib/formatRelative/index.js":[27300,7,38189],"./lv/_lib/localize/index.js":[20781,7,88738],"./lv/_lib/match/index.js":[96379,7,91217],"./lv/index.js":[10408,7,18688],"./mk/_lib/formatDistance/index.js":[42494,7,33921],"./mk/_lib/formatLong/index.js":[28631,7,8298],"./mk/_lib/formatRelative/index.js":[13092,7,36078],"./mk/_lib/localize/index.js":[69104,7,18711],"./mk/_lib/match/index.js":[18887,7,13787],"./mk/index.js":[49206,7,52946],"./mn/_lib/formatDistance/index.js":[8655,7,82285],"./mn/_lib/formatLong/index.js":[30314,7,72884],"./mn/_lib/formatRelative/index.js":[47991,7,18585],"./mn/_lib/localize/index.js":[28940,7,2572],"./mn/_lib/match/index.js":[70613,7,18115],"./mn/index.js":[75445,7,76602],"./ms/_lib/formatDistance/index.js":[1531,7,27543],"./ms/_lib/formatLong/index.js":[49539,7,85408],"./ms/_lib/formatRelative/index.js":[38101,7,16625],"./ms/_lib/localize/index.js":[92429,7,67136],"./ms/_lib/match/index.js":[85491,7,99924],"./ms/index.js":[35307,7,68976],"./mt/_lib/formatDistance/index.js":[93369,7,42560],"./mt/_lib/formatLong/index.js":[36670,7,35672],"./mt/_lib/formatRelative/index.js":[93824,7,84940],"./mt/_lib/localize/index.js":[63273,7,53817],"./mt/_lib/match/index.js":[44729,7,84164],"./mt/index.js":[73676,7,80817],"./nb/_lib/formatDistance/index.js":[21448,7,4668],"./nb/_lib/formatLong/index.js":[60086,7,63081],"./nb/_lib/formatRelative/index.js":[40191,7,52266],"./nb/_lib/localize/index.js":[37117,7,5441],"./nb/_lib/match/index.js":[41372,7,7850],"./nb/index.js":[43616,7,1202],"./nl-BE/_lib/formatDistance/index.js":[77181,7,19455],"./nl-BE/_lib/formatLong/index.js":[72570,7,14950],"./nl-BE/_lib/formatRelative/index.js":[23778,7,13183],"./nl-BE/_lib/localize/index.js":[85549,7,78650],"./nl-BE/_lib/match/index.js":[9248,7,59900],"./nl-BE/index.js":[38539,7,94935],"./nl/_lib/formatDistance/index.js":[65010,7,15907],"./nl/_lib/formatLong/index.js":[48177,7,56985],"./nl/_lib/formatRelative/index.js":[74696,7,53099],"./nl/_lib/localize/index.js":[27079,7,44668],"./nl/_lib/match/index.js":[47765,7,32713],"./nl/index.js":[75153,7,93921],"./nn/_lib/formatDistance/index.js":[96508,7,22265],"./nn/_lib/formatLong/index.js":[25012,7,54522],"./nn/_lib/formatRelative/index.js":[84700,7,84390],"./nn/_lib/localize/index.js":[50398,7,28092],"./nn/_lib/match/index.js":[84336,7,59968],"./nn/index.js":[90017,7,76851],"./oc/_lib/formatDistance/index.js":[8796,7,45094],"./oc/_lib/formatLong/index.js":[40290,7,30517],"./oc/_lib/formatRelative/index.js":[30903,7,79896],"./oc/_lib/localize/index.js":[94456,7,7994],"./oc/_lib/match/index.js":[12333,7,90502],"./oc/index.js":[44961,7,17205],"./pl/_lib/formatDistance/index.js":[73845,7,55254],"./pl/_lib/formatLong/index.js":[29050,7,74086],"./pl/_lib/formatRelative/index.js":[73324,7,36366],"./pl/_lib/localize/index.js":[21573,7,49152],"./pl/_lib/match/index.js":[58754,7,55478],"./pl/index.js":[23303,7,47074],"./pt-BR/_lib/formatDistance/index.js":[67632,7,57946],"./pt-BR/_lib/formatLong/index.js":[68548,7,42623],"./pt-BR/_lib/formatRelative/index.js":[50856,7,88001],"./pt-BR/_lib/localize/index.js":[21910,7,37469],"./pt-BR/_lib/match/index.js":[78065,7,12914],"./pt-BR/index.js":[69925,7,48519],"./pt/_lib/formatDistance/index.js":[8223,7,92324],"./pt/_lib/formatLong/index.js":[97633,7,65963],"./pt/_lib/formatRelative/index.js":[22403,7,37510],"./pt/_lib/localize/index.js":[2856,7,23970],"./pt/_lib/match/index.js":[65626,7,76025],"./pt/index.js":[20113,7,66037],"./ro/_lib/formatDistance/index.js":[20042,7,13198],"./ro/_lib/formatLong/index.js":[96273,7,34193],"./ro/_lib/formatRelative/index.js":[4658,7,70350],"./ro/_lib/localize/index.js":[19526,7,4830],"./ro/_lib/match/index.js":[8797,7,54251],"./ro/index.js":[35695,7,90970],"./ru/_lib/formatDistance/index.js":[93855,7,34770],"./ru/_lib/formatLong/index.js":[50515,7,87692],"./ru/_lib/formatRelative/index.js":[46101,7,48237],"./ru/_lib/localize/index.js":[37085,7,60957],"./ru/_lib/match/index.js":[67202,7,48037],"./ru/index.js":[91253,7,27614],"./sk/_lib/formatDistance/index.js":[67097,7,67523],"./sk/_lib/formatLong/index.js":[57938,7,43572],"./sk/_lib/formatRelative/index.js":[67483,7,7711],"./sk/_lib/localize/index.js":[2910,7,93739],"./sk/_lib/match/index.js":[37456,7,12604],"./sk/index.js":[67856,7,4138],"./sl/_lib/formatDistance/index.js":[26098,7,74778],"./sl/_lib/formatLong/index.js":[82703,7,74397],"./sl/_lib/formatRelative/index.js":[7983,7,81888],"./sl/_lib/localize/index.js":[31415,7,7987],"./sl/_lib/match/index.js":[37209,7,26537],"./sl/index.js":[48079,7,39693],"./sq/_lib/formatDistance/index.js":[19778,7,26338],"./sq/_lib/formatLong/index.js":[46577,7,44213],"./sq/_lib/formatRelative/index.js":[70108,7,16987],"./sq/_lib/localize/index.js":[86736,7,21835],"./sq/_lib/match/index.js":[3450,7,224],"./sq/index.js":[8266,7,73226],"./sr-Latn/_lib/formatDistance/index.js":[49477,7,97835],"./sr-Latn/_lib/formatLong/index.js":[33523,7,50343],"./sr-Latn/_lib/formatRelative/index.js":[35436,7,18913],"./sr-Latn/_lib/localize/index.js":[69582,7,75989],"./sr-Latn/_lib/match/index.js":[93866,7,71165],"./sr-Latn/index.js":[34391,7,63122],"./sr/_lib/formatDistance/index.js":[99993,7,42648],"./sr/_lib/formatLong/index.js":[96342,7,52883],"./sr/_lib/formatRelative/index.js":[95429,7,34468],"./sr/_lib/localize/index.js":[25109,7,56162],"./sr/_lib/match/index.js":[20146,7,23476],"./sr/index.js":[45117,7,8514],"./sv/_lib/formatDistance/index.js":[27535,7,48142],"./sv/_lib/formatLong/index.js":[44035,7,94375],"./sv/_lib/formatRelative/index.js":[38065,7,47795],"./sv/_lib/localize/index.js":[58259,7,36682],"./sv/_lib/match/index.js":[44413,7,22972],"./sv/index.js":[39273,7,43924],"./ta/_lib/formatDistance/index.js":[255,7,8263],"./ta/_lib/formatLong/index.js":[89994,7,98459],"./ta/_lib/formatRelative/index.js":[96439,7,35136],"./ta/_lib/localize/index.js":[14066,7,74594],"./ta/_lib/match/index.js":[81014,7,99426],"./ta/index.js":[48714,7,33739],"./te/_lib/formatDistance/index.js":[94144,7,31594],"./te/_lib/formatLong/index.js":[84106,7,31518],"./te/_lib/formatRelative/index.js":[44765,7,34082],"./te/_lib/localize/index.js":[40947,7,58749],"./te/_lib/match/index.js":[17309,7,47173],"./te/index.js":[30065,7,5876],"./th/_lib/formatDistance/index.js":[17040,7,3330],"./th/_lib/formatLong/index.js":[39518,7,90412],"./th/_lib/formatRelative/index.js":[6865,7,45203],"./th/_lib/localize/index.js":[53965,7,25367],"./th/_lib/match/index.js":[9994,7,65156],"./th/index.js":[75134,7,21408],"./tr/_lib/formatDistance/index.js":[30741,7,75325],"./tr/_lib/formatLong/index.js":[56543,7,91178],"./tr/_lib/formatRelative/index.js":[35576,7,87039],"./tr/_lib/localize/index.js":[12155,7,78958],"./tr/_lib/match/index.js":[27937,7,17290],"./tr/index.js":[19045,7,90203],"./ug/_lib/formatDistance/index.js":[73622,7,83928],"./ug/_lib/formatLong/index.js":[69360,7,92028],"./ug/_lib/formatRelative/index.js":[89411,7,7873],"./ug/_lib/localize/index.js":[57320,7,1027],"./ug/_lib/match/index.js":[62862,7,33173],"./ug/index.js":[26383,7,26744],"./uk/_lib/formatDistance/index.js":[58940,7,60889],"./uk/_lib/formatLong/index.js":[78467,7,7700],"./uk/_lib/formatRelative/index.js":[95726,7,6597,68977],"./uk/_lib/localize/index.js":[18500,7,55248],"./uk/_lib/match/index.js":[50533,7,36013],"./uk/index.js":[52061,7,6597,20671],"./uz-Cyrl/_lib/formatDistance/index.js":[96538,7,36694],"./uz-Cyrl/_lib/formatLong/index.js":[13022,7,9698],"./uz-Cyrl/_lib/formatRelative/index.js":[70673,7,62460],"./uz-Cyrl/_lib/localize/index.js":[44732,7,46430],"./uz-Cyrl/_lib/match/index.js":[56601,7,47302],"./uz-Cyrl/index.js":[39855,7,52570],"./uz/_lib/formatDistance/index.js":[37432,7,63062],"./uz/_lib/formatLong/index.js":[5941,7,53234],"./uz/_lib/formatRelative/index.js":[85426,7,14393],"./uz/_lib/localize/index.js":[43277,7,61603],"./uz/_lib/match/index.js":[62320,7,2181],"./uz/index.js":[57267,7,28110],"./vi/_lib/formatDistance/index.js":[66371,7,37639],"./vi/_lib/formatLong/index.js":[68759,7,93187],"./vi/_lib/formatRelative/index.js":[79719,7,92448],"./vi/_lib/localize/index.js":[36189,7,35983],"./vi/_lib/match/index.js":[11416,7,66482],"./vi/index.js":[73902,7,65679],"./zh-CN/_lib/formatDistance/index.js":[89973,7,94291],"./zh-CN/_lib/formatLong/index.js":[15685,7,61872],"./zh-CN/_lib/formatRelative/index.js":[78431,7,38178],"./zh-CN/_lib/localize/index.js":[31584,7,65535],"./zh-CN/_lib/match/index.js":[19125,7,78602],"./zh-CN/index.js":[11345,7,24994],"./zh-HK/_lib/formatDistance/index.js":[20999,7,66824],"./zh-HK/_lib/formatLong/index.js":[47444,7,39983],"./zh-HK/_lib/formatRelative/index.js":[37574,7,8462],"./zh-HK/_lib/localize/index.js":[45241,7,54019],"./zh-HK/_lib/match/index.js":[68465,7,43970],"./zh-HK/index.js":[3508,7,50126],"./zh-TW/_lib/formatDistance/index.js":[95978,7,48085],"./zh-TW/_lib/formatLong/index.js":[25438,7,50815],"./zh-TW/_lib/formatRelative/index.js":[69896,7,73782],"./zh-TW/_lib/localize/index.js":[35018,7,7028],"./zh-TW/_lib/match/index.js":[48411,7,21919],"./zh-TW/index.js":[44683,7,470]};function n(e){if(!a.o(s,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],n=t[0];return Promise.all(t.slice(2).map(a.e)).then((()=>a.t(n,16|t[1])))}n.keys=()=>Object.keys(s),n.id=88115,e.exports=n},5041:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});const s={Application__main:"Academy_Application__main__WbAGW",WorkspaceParent:"Academy_WorkspaceParent__QkrJ0","bp5-tag":"Academy_bp5-tag__qdxCt",badge:"Academy_badge__T8ws1","bp5-overlay":"Academy_bp5-overlay__NG6bM","bp5-popover-content":"Academy_bp5-popover-content__D5ZSM","badge-tag":"Academy_badge-tag__A0vj4",Academy:"Academy_Academy__1mjfJ","Academy-switching-courses":"Academy_Academy-switching-courses__aaVIr"}},5602:(e,t,a)=>{"use strict";e.exports=a.p+"static/media/default_cover_image.e2be07249bb127696687.jpg"}}]);